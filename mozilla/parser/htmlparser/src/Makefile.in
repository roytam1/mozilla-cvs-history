#
# The contents of this file are subject to the Netscape Public License
# Version 1.0 (the "NPL"); you may not use this file except in
# compliance with the NPL.  You may obtain a copy of the NPL at
# http://www.mozilla.org/NPL/
#
# Software distributed under the NPL is distributed on an "AS IS" basis,
# WITHOUT WARRANTY OF ANY KIND, either express or implied. See the NPL
# for the specific language governing rights and limitations under the
# NPL.
#
# The Initial Developer of this code under the NPL is Netscape
# Communications Corporation.  Portions created by Netscape are
# Copyright (C) 1998 Netscape Communications Corporation.  All Rights
# Reserved.
#

DEPTH		= ../..
topsrcdir	= @top_srcdir@
srcdir		= @srcdir@
VPATH		= .:@srcdir@

include $(DEPTH)/config/autoconf.mk

MODULE		= htmlparser
LIBRARY_NAME	= raptorhtmlpars
IS_COMPONENT	= 1

REQUIRES	= xpcom netlib raptor

CPPSRCS		= \
		nsDTDUtils.cpp \
		nsHTMLTokenizer.cpp \
		nsXMLTokenizer.cpp \
		nsExpatTokenizer.cpp \
		nsElementTable.cpp \
		CNavDTD.cpp \
		COtherDTD.cpp \
		CRtfDTD.cpp \
		nsHTMLEntities.cpp \
		nsHTMLNullSink.cpp \
		nsHTMLTags.cpp \
		nsHTMLTokens.cpp \
		nsLoggingSink.cpp \
		nsParser.cpp \
		CParserContext.cpp \
		nsParserModule.cpp \
		nsParserNode.cpp \
		nsScanner.cpp \
		nsToken.cpp \
		nsTokenHandler.cpp \
		nsHTMLContentSinkStream.cpp \
		nsHTMLToTXTSinkStream.cpp \
		nsValidDTD.cpp \
		nsWellFormedDTD.cpp \
		nsViewSourceHTML.cpp \
		nsXIFDTD.cpp \
		nsExpatDTD.cpp \
		$(NULL)

#
# Disable some DTD debugging code in the parser that 
# breaks on some compilers because of some broken 
# streams code in prstrm.cpp.
#
ifndef MOZ_DISABLE_DTD_DEBUG
CPPSRCS		+= nsDTDDebug.cpp prstrm.cpp
endif

EXPORTS		= \
		nshtmlpars.h \
		nsIContentSink.h \
		nsITokenizer.h \
		nsIExpatTokenizer.h \
		nsIHTMLContentSink.h \
		nsHTMLContentSinkStream.h \
		nsIHTMLFragmentContentSink.h \
		nsHTMLToTXTSinkStream.h \
		nsHTMLEntities.h \
		nsHTMLEntityList.h \
		nsHTMLTags.h \
		nsHTMLTagList.h \
		nsHTMLTokens.h \
		nsILoggingSink.h \
		nsIParserNode.h \
		nsIParser.h \
		nsParser.h \
		nsIDTD.h \
		nsIDTDDebug.h \
		nsIParserFilter.h \
		nsToken.h \
		CNavDTD.h \
		COtherDTD.h \
		nsWellFormedDTD.h \
		nsValidDTD.h \
		CRtfDTD.h \
		nsXIFDTD.h \
		nsParserCIID.h \
		nsExpatDTD.h \
		nsParserError.h \
		nsIElementObserver.h \
		nsIParserService.h \
		$(NULL)

EXPORTS		:= $(addprefix $(srcdir)/, $(EXPORTS))

EXTRA_DSO_LDOPTS = \
		$(MOZ_NECKO_UTIL_LIBS) \
		$(DIST)/lib/libexpat_s.a \
		$(DIST)/lib/libxmltok_s.a \
		$(NULL)
ifdef MOZ_PERF
EXTRA_DSO_LDOPTS += \
		$(DIST)/lib/libmozutil_s.a \
		$(NULL)
endif

include $(topsrcdir)/config/rules.mk

#
# Currently on HP, we need this sl to be linked using aCC to call the
# global constructs for the CTagList.  Unfortunately if we turn on CXX
# linking for all .sl's there is a problem with gfx
#
ifeq ($(OS_ARCH),HP-UX)
ifneq (,$(filter aCC,$(CXX)))
DSO_LDOPTS	= -b -Wl,-E -Wl,+s -L$(DIST)/bin
MKSHLIB		= $(CXX) $(DSO_LDOPTS)
endif
endif

DEFINES		+= -D_IMPL_NS_HTMLPARS -DXML_DTD

INCLUDES	+= -I.

