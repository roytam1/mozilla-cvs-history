#!/bin/sh
# The contents of this file are subject to the Netscape Public
# License Version 1.1 (the "License"); you may not use this file
# except in compliance with the License. You may obtain a copy of
# the License at http://www.mozilla.org/NPL/
# 
# Software distributed under the License is distributed on an "AS
# IS" basis, WITHOUT WARRANTY OF ANY KIND, either express or
# implied. See the License for the specific language governing
# rights and limitations under the License.
# 
# The Original Code is the Netscape Mailstone utility, 
# released March 17, 2000.
# 
# The Initial Developer of the Original Code is Netscape
# Communications Corporation. Portions created by Netscape are
# Copyright (C) 1999-2000 Netscape Communications Corporation. All
# Rights Reserved.
# 
# Contributor(s):	Dan Christian <robodan@netscape.com>
#			Marcel DePaolis <marcel@netcape.com>
# 
# Alternatively, the contents of this file may be used under the
# terms of the GNU Public License (the "GPL"), in which case the
# provisions of the GPL are applicable instead of those above.
# If you wish to allow use of your version of this file only
# under the terms of the GPL and not to allow others to use your
# version of this file under the NPL, indicate your decision by
# deleting the provisions above and replace them with the notice
# and other provisions required by the GPL.  If you do not delete
# the provisions above, a recipient may use your version of this
# file under either the NPL or the GPL.
#####################################################

# This just runs the right test with the right path to perl
# Usage: mstone testname
if [ -z "$1" -o "$1" = "-h" -o "$1" = "--help" ] ; then
   echo "Usage: $0 testname [arguments]"
   echo "Common arguments:"
   echo "  -t time		Test time.  s=seconds, m=minutes, h=hours"
   echo "  -r ramp_time		Connection ramp up time.  s=seconds, m=..."
   echo "  -l load		Number of test clients to use."
   echo "  -b 'banner'		Test description banner."
   echo "  -n 'notes'		Test notes."
   echo "Example:"
   echo " ./mstone pop -t 10m -r 90s -l 24 -b 'Pop reads (full store)'"
   exit 1
fi

testcase=$1			# get testname
shift

if [ ! -x perl/bin/perl -o ! -f .license ] ; then # see if setup was ever run
   echo "Critical files are missing.  Run setup."
   exit 2;
fi

if [ -f $testcase ] ; then	# if they gave us the full path
    testfile=$testcase
else
    [ -f conf/$testcase.wld ] && testfile="conf/$testcase.wld"
    [ -f conf/$testcase.pl ] && testfile="conf/$testcase.pl"
fi

extra=""
if [ `uname -s` = HP-UX ] ; then        # HP uses remsh for remote exec
    extra="RSH=/usr/bin/remsh $extra"
fi

if [ -n "`echo $testfile | grep '\.wld$'`" ] ; then
    exec perl/bin/perl -Ibin -- bin/mailmaster.pl $extra -w $testfile "$@"
elif  [ -n "`echo $testfile | grep '\.pl$'`" ] ; then	# BACK COMPAT 4.1
    exec perl/bin/perl -Ibin -- $testfile $extra "$@"
fi

echo "File $testcase is not a workload file"
exit 1;
