#! gmake
#
# The contents of this file are subject to the Netscape Public
# License Version 1.1 (the "License"); you may not use this file
# except in compliance with the License. You may obtain a copy of
# the License at http://www.mozilla.org/NPL/
#
# Software distributed under the License is distributed on an "AS
# IS" basis, WITHOUT WARRANTY OF ANY KIND, either express or
# implied. See the License for the specific language governing
# rights and limitations under the License.
#
# The Original Code is mozilla.org code.
#
# The Initial Developer of the Original Code is Netscape
# Communications Corporation.  Portions created by Netscape are
# Copyright (C) 1998 Netscape Communications Corporation. All
# Rights Reserved.
#
# Contributor(s): 



DEPTH = ../../../..
topsrcdir	= @top_srcdir@
VPATH		= @srcdir@
srcdir		= @srcdir@

include $(DEPTH)/config/autoconf.mk

# This is required for compilation of only this directory
ifeq ($(OS_ARCH),HP-UX)
CFLAGS += $(DSO_CFLAGS)
endif

CSRCS = npshell.c stubs.c
OBJS  = $(CSRCS:.c=.o)

LIBTARGETS = $(OBJDIR)/javatestplugin.so
TARGETS = targets

# Rules to build generated headers

JRI_HEADER_CLASSES =	       \
	JavaTestPlugin	       \
	java.lang.String       \
	java.awt.Window	       \
	java.awt.Component     \
	java.awt.Color	       \
	java.lang.Class

JRI_STUB_CLASSES =	       \
	JavaTestPlugin	       \
	java.lang.String       \
	java.awt.Window	       \
	java.awt.Component     \
	java.awt.Color

include $(topsrcdir)/config/rules.mk

CLASSSRC := .:$(DEPTH)/sun-java/classsrc

INCLUDES += -I_gen

targets:
	@$(MAKE) classes
	@$(MAKE) jri_headers jri_stubs
	@$(MAKE) libtargets

JAVAC =	$(JAVAI) -classpath /usr/local/netscape/java/lib/javac.zip \
	     -ms8m sun.tools.javac.Main

classes: JavaTestPlugin.java
	$(JAVAC) -classpath $(CLASSSRC) JavaTestPlugin.java

libtargets: $(LIBTARGETS)

$(OBJDIR)/javatestplugin.so: $(OBJS)
	$(LD) $(DSO_LDOPTS) -o $@ $(OBJS) $(DSO_LDFLAGS)

install:: $(TARGETS)
	$(INSTALL) $(TARGETS) $(DIST)/bin

INCLUDES += -I$(topsrcdir)/lib/plugin
GARBAGE += so_locations

clobber::
	rm -rf _gen _stubs so_locations

export:: targets
	$(INSTALL) $(LIBTARGETS) $(DIST)/lib

install:: export

$(OBJDIR)/stubs.o:		  \
	../common/npunix.c	  \
	_stubs/JavaTestPlugin.c	  \
	_stubs/java_lang_String.c \
	_stubs/java_awt_Color.c	  \
	_stubs/java_awt_EmbeddedFrame.c
