#!gmake
#
# The contents of this file are subject to the Netscape Public License
# Version 1.0 (the "NPL"); you may not use this file except in
# compliance with the NPL.  You may obtain a copy of the NPL at
# http://www.mozilla.org/NPL/
#
# Software distributed under the NPL is distributed on an "AS IS" basis,
# WITHOUT WARRANTY OF ANY KIND, either express or implied. See the NPL
# for the specific language governing rights and limitations under the
# NPL.
#
# The Initial Developer of this code under the NPL is Netscape
# Communications Corporation.  Portions created by Netscape are
# Copyright (C) 1998 Netscape Communications Corporation.  All Rights
# Reserved.


DEPTH = ../..
topsrcdir	= @top_srcdir@
srcdir		= @srcdir@
VPATH		= @srcdir@

include $(DEPTH)/config/autoconf.mk

include $(topsrcdir)/config/config.mk

TOOLKIT_GFX_LIB     = -lgfx$(MOZ_TOOLKIT)
TOOLKIT_WIDGET_LIB  = -lwidget$(MOZ_TOOLKIT)
TOOLKIT_BASE_LIB    = -lgmbase$(MOZ_TOOLKIT)

ifneq (,$(filter gtk, $(MOZ_TOOLKIT)))
TOOLKIT_CFLAGS = \
        -DWIDGET_DLL = \"libwidgetgtk.so\" \
        -DGFXWIN_DLL = \"libgfxgtk.so\" \
        $(TK_GTK_CFLAGS)

TOOLKIT_CPPSRCS = \
        nsGTKMain.cpp \
        nsGTKMenu.cpp

TOOLKIT_LIBS = $(TK_GTK_LIBS)
else
ifneq (,$(filter motif, $(MOZ_TOOLKIT)))
TOOLKIT_CFLAGS = \
        -DWIDGET_DLL = \"libwidgetmotif.so\" \
        -DGFXWIN_DLL = \"libgfxmotif.so\" \
        $(TK_MOTIF_CFLAGS)

TOOLKIT_CPPSRCS = \
        nsMotifMenu.cpp \
        nsUnixMain.cpp

TOOLKIT_LIBS = $(TK_MOTIF_LIBS) $(XLDFLAGS) $(XLIBS)

endif
endif


PROGS = $(OBJDIR)/apprunner

MODULE = apprunner

REQUIRES = raptor xpcom base netlib pref js dom

INCLUDES += -I../public -I$(PUBLIC)/raptor	\
	   -I$(PUBLIC)/xpcom	\
	   -I$(PUBLIC)/base	\
	   -I$(PUBLIC)/netlib	\
	   -I$(PUBLIC)/pref	\
	   -I$(PUBLIC)/js	\
	   -I$(PUBLIC)/dom

EX_LIBS = \
	-L$(DIST)/bin	\
	-lnsappshell	\
	-lxpcom		\
	-lraptorbase	\
	$(TOOLKIT_WIDGET_LIB)\
	-lraptorgfx	\
	$(TOOLKIT_GFX_LIB)\
	$(TOOLKIT_BASE_LIB)\
	-lreg		\
	-labouturl	\
	-lhttpurl	\
	-lfileurl	\
	-lgophurl	\
	-lftpurl	\
	-lremoturl	\
	-lxp		\
	-lnetutil	\
	-lnetcache	\
	-lnetcnvts	\
	-lmimetype	\
	-lnetwork	\
	-lnetlib	\
	-lraptorwebwidget	\
	-lraptorhtml	\
	-lraptorhtmlpars	\
	-ljsdom		\
	-ljsurl		\
	-lraptorbase	\
	-lsecfree	\
	-ljs		\
	$(JSJ_LIB)	\
	-lpref		\
	-limg		\
	$(JPEG_LIBS)	\
	$(PNG_LIBS)	\
	-lmozutil	\
	-lxp		\
	-lxpcom		\
	$(NSPR_LIBS)	\
	$(ZLIB_LIBS)	\
	-lpwcac		\
	$(NULL)


CPPSRCS = \
	nsAppRunner.cpp 	\
	nsSetupRegistry.cpp	\
	nsUnixStubs.cpp		\
	$(NULL)

CPP_OBJS =			\
 ./$(OBJDIR)/nsAppRunner.o  	\
 ./$(OBJDIR)/nsSetupRegistry.o	\
 ./$(OBJDIR)/nsUnixStubs.o	\
 $(NULL)


TARGETS = $(PROGS)

include $(topsrcdir)/config/rules.mk

$(PROGS) : $(OBJS)
	@$(MAKE_OBJDIR)
	$(CCC) -o $@ $(OBJS) $(LDFLAGS) $(EX_LIBS) $(OS_LIBS) $(TOOLKIT_LIBS)

install:: $(TARGETS)
	$(INSTALL) $(PROGS) $(DIST)/bin

clobber::
	rm -rf $(OBJDIR)/*.o
	rm -rf $(OBJDIR)/$(PROGS)

