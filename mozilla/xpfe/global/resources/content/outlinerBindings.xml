<?xml version="1.0"?>

<bindings id="outlinerBindings"
   xmlns="http://www.mozilla.org/xbl"
   xmlns:html="http://www.w3.org/1999/xhtml"
   xmlns:xul="http://www.mozilla.org/keymaster/gatekeeper/there.is.only.xul">
  
  <binding id="outliner">
    <content orient="vertical">
	  <xul:box class="outliner-columns">
	    <children includes="outlinercol|splitter"/>
	  </xul:box>
	  <xul:outlinerrows class="outliner-rows" flex="1">
	    <children/>
	  </xul:outlinerrows>
	</content>
  </binding>

  <binding id="outlinerrows" extends="xul:box">
    <content>
	  <children/>
      <xul:scrollbar align="vertical" class="outliner-scrollbar"/>
    </content>
	<handlers>
	  <!-- If there is no modifier key, we select on mousedown, not
           click, so that drags work correctly. -->
      <handler event="mousedown">
      <![CDATA[
	     if (!event.ctrlKey && !event.shiftKey && !event.metaKey) {
		   var row = {};
		   var col = {};
		   var v = this.parentNode.outlinerBoxObject.view;
		   v.getCellAt(event.x, event.y, row, col);
           
		   // XXX Check the col to see if it's a cycler.  If so,
		   // don't select.
		   if (!v.selection.isSelected(row.value))
             v.selection.select(row.value);
			 
		   v.selection.currentIndex = row.value;
         }
      ]]>
      </handler>

      <!-- On a click (up+down on the same item), deselect everything
           except this item. -->
      <handler event="click">
      <![CDATA[
	     // XXX Check for cycler.
         if (event.button != 1) return;
         var row = {};
	     var col = {};
	     var v = this.parentNode.outlinerBoxObject.view;
	     v.getCellAt(event.x, event.y, row, col);
         if (event.ctrlKey || event.metaKey) {
           v.selection.toggleSelect(row.value);
           v.selection.currentIndex = row.value;
         }
         else if (event.shiftKey) {
		   v.selection.rangedSelect(null, row.value);
           v.currentIndex = row.value;
         }
         else {
          /* We want to deselect all the selected items except what was
            clicked, UNLESS it was a right-click.  We have to do this
            in click rather than mousedown so that you can drag a
            selected group of items */

		   if (event.button == 1)
		     v.selection.select(row.value);  
         }
      ]]>
      </handler>

      <!-- double-click -->
      <handler event="click" clickcount="2">
      <![CDATA[
           var row = {};
		   var col = {};
		   // XXX Again, we need to check the cycler.
		   var v = this.parentNode.outlinerBoxObject.view;
		   v.getCellAt(event.x, event.y, row, col);
		   if (v.isContainer(row.value))
		     v.toggleOpenState(row.value);
      ]]>
      </handler>
    </handlers>
  </binding>

  <binding id="outlinerbody"/>

  <binding id="outlinercol">
    <content autostretch="never">
      <xul:image class="outlinercol-image" inherits="src"/>
      <xul:text class="outlinercol-text" inherits="crop,value" flex="1" crop="right"/>
      <xul:image class="outlinercol-sortdirection"/>
    </content>
  </binding>

</bindings>

