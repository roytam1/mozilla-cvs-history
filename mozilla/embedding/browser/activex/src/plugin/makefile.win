#!nmake
#
# The contents of this file are subject to the Netscape Public
# License Version 1.1 (the "License"); you may not use this file
# except in compliance with the License. You may obtain a copy of
# the License at http://www.mozilla.org/NPL/
#
# Software distributed under the License is distributed on an "AS
# IS" basis, WITHOUT WARRANTY OF ANY KIND, either express or
# implied. See the License for the specific language governing
# rights and limitations under the License.
#
# The Original Code is mozilla.org code.
#
# The Initial Developer of the Original Code is Netscape
# Communications Corporation.  Portions created by Netscape are
# Copyright (C) 1998 Netscape Communications Corporation. All
# Rights Reserved.
#
# Contributor(s): 

DLLNAME = npmozax
QUIET =
DEPTH =..\..\..\..\..

# The default is to include control support unless told to do otherwise
MOZ_ACTIVEX_PLUGIN_SUPPORT = 1

MAKE_OBJ_TYPE = DLL
DLL=.\$(OBJDIR)\$(DLLNAME).dll
RESFILE = MozActiveX.res
DEFFILE = npmozax.def

OBJS =                                 \
	.\$(OBJDIR)\StdAfx.obj             \
	.\$(OBJDIR)\ControlSite.obj        \
	.\$(OBJDIR)\ControlSiteIPFrame.obj \
	.\$(OBJDIR)\ItemContainer.obj      \
	.\$(OBJDIR)\PropertyBag.obj        \
#	.\$(OBJDIR)\ActiveXPlugin.obj      \
#	.\$(OBJDIR)\ActiveXPluginInstance.obj \
	.\$(OBJDIR)\ActiveScriptSite.obj   \
	.\$(OBJDIR)\LegacyPlugin.obj       \
	.\$(OBJDIR)\MozActiveX.obj         \
	.\$(OBJDIR)\npwin.obj              \
	$(NULL)

# most of these have to be here for nsSetupRegistry.cpp...

LINCS=  \
!ifdef MOZ_ACTIVEX_PLUGIN_SUPPORT
  -I..\control \
  -I$(MOZ_PLUGINSDK)\include \
!endif
  $(NULL) 

LLIBS=                         \
 $(NULL)

WIN_LIBS = \
 comdlg32.lib                   \
 ole32.lib                      \
 oleaut32.lib                   \
 uuid.lib                       \
 shell32.lib                    \
 $(NULL)


LCFLAGS = /D "WIN32" /GX /FR /U "ClientWallet"
LLFLAGS = -SUBSYSTEM:windows /DLL

include <$(DEPTH)\config\rules.mak>

!ifdef MOZ_NO_DEBUG_RTL
LCFLAGS = $(LCFLAGS) -DMOZ_NO_DEBUG_RTL
!endif

!ifdef MOZ_ACTIVEX_PLUGIN_SUPPORT
LCFLAGS = $(LCFLAGS) -DMOZ_ACTIVEX_PLUGIN_SUPPORT
!endif

install:: $(DLL)
	$(MAKE_INSTALL) $(DLL) $(DIST)\bin

$(DEFFILE) : mkctldef.bat
	mkctldef.bat $(DEFFILE)

ActiveScriptSite.cpp: ../control/ActiveScriptSite.cpp
	-cp ../control/ActiveScriptSite.cpp .

npwin.cpp: $(MOZ_PLUGINSDK)/common/npwin.cpp
	-cp -f $(MOZ_PLUGINSDK)/common/npwin.cpp .

MozActiveX.res: MozActiveX.rc resource.h

MozActiveX.cpp: StdAfx.h

LegacyPlugin.cpp \
ActiveXPlugin.cpp \
ActiveXPluginInstance.cpp: StdAfx.h ActiveXPlugin.h ActiveXPluginInstance.h

PropertyBag.cpp : ../control/PropertyBag.cpp
	-cp ../control/PropertyBag.cpp .

ControlSite.cpp : ../control/ControlSite.cpp
	-cp ../control/ControlSite.cpp .

ControlSiteIPFrame.cpp : ../control/ControlSiteIPFrame.cpp
	-cp ../control/ControlSiteIPFrame.cpp .

ItemContainer.cpp : ../control/ItemContainer.cpp
	-cp ../control/ItemContainer.cpp .

clobber::
	-del $(DEFFILE)
