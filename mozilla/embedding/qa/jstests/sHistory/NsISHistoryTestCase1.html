<html>
<head>
<script TYPE="text/javascript" SRC="nsISHistoryTestLib.js"></script>
<script TYPE="text/javascript">

var urlList = ["http://www.cisco.com",
               "http://www.yahoo.com",
               "http://www.mozilla.org"
                ];
var cnt = 0;
var testWin = window.open("about:blank", "testWin");
var sHistory = sHistoryInit(testWin);
var count = 0;
var index = 0;

var maxLength = 100;

function loadPages()
{

  var urlTotal = urlList.length;
  var initTime = 10000;

  netscape.security.PrivilegeManager.enablePrivilege("UniversalBrowserAccess");

  // Load pages sequentially in the child window

/*
   for (cnt=0; cnt < urlTotal; cnt++)
   {
      alert ("Setting timer to load " + urlList[cnt] + " in " + (cnt + 1)*initTime + " milliseconds");
      setTimeout("testWin.location.href=urlList[cnt];", (cnt + 1)*initTime);
   }

   setTimeout("SHistoryTests();", cnt*initTime);
*/

   testWin.location = urlList[cnt++];

   if (cnt == urlTotal)
     setTimeout("sHistoryTests()", 5000);
   else
     setTimeout("loadPages()", 6000);

}

function sHistoryTests()
{
  netscape.security.PrivilegeManager.enablePrivilege("UniversalBrowserAccess");
  netscape.security.PrivilegeManager.enablePrivilege("UniversalXPConnect");


  // begins testing session history interface;
  if (!sHistory)
  {
    alert("Unable to get session history");
    return;
  }

  alert("Testing nsISHistory interfaces\n");

  count = testHistoryCount(sHistory);	 // GetCount()
  alert("global count: " + count);

  index = testHistoryIndex(sHistory);	 // GetIndex()
  alert ("global index: " + index);

  maxLength = testMaxLength(sHistory);	 // GetMaxLength()
  alert ("global maxLength: " + maxLength);

  // Test GetEntryAtIndex()
	 for(cnt = 0; cnt < count; cnt++) {
	   entry = testGetEntryAtIndex(sHistory, cnt, false);
	   if (entry)
		 alert("GetEntryAtIndex() Valid, cnt =  " + cnt);
	   else
		 alert("GetEntryAtIndex() Invalid, cnt = " + cnt);
	 }   // for

	 // Test the enumerator
	 var simpleEnum = testSimpleEnum(sHistory);	// Get simple enumerator
	 alert("global simpleEnum: " + simpleEnum);
	 if (simpleEnum) {
		var enumCnt = 0;
		while (simpleEnum.hasMoreElements())
		{
			nextObj = simpleEnum.getNext();
			alert("global nextObj: " + nextObj);
			if (!nextObj)
			  continue;
			nextHE = nextObj.QueryInterface(Components.interfaces.nsIHistoryEntry);
			alert("global nextHE: " + nextHE);
			if (!nextHE)
			  continue;
		    testHistoryEntry(nextHE, enumCnt);
		    enumCnt++;
		}  // while
	 }   // if simplenum

}

</script>
</head>
<body>
<script TYPE="text/javascript">
  loadPages();
</script>
</body>
</html>