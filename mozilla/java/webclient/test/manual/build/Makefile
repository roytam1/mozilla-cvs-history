# The contents of this file are subject to the Mozilla Public
# License Version 1.1 (the "License"); you may not use this file
# except in compliance with the License. You may obtain a copy of
# the License at http://www.mozilla.org/MPL/
#
# Software distributed under the License is distributed on an "AS
# IS" basis, WITHOUT WARRANTY OF ANY KIND, either express or
# implied. See the License for the specific language governing
# rights and limitations under the License.
#
# The Original Code is mozilla.org code.
#
# The Initial Developer of the Original Code is Sun Microsystems,
# Inc. Portions created by Sun are
# Copyright (C) 1999 Sun Microsystems, Inc. All
# Rights Reserved.
#
# Contributor(s):


DEPTH=..
SRC=$(DEPTH)/src
CONFIG=$(DEPTH)/config/
UTILS=$(DEPTH)/utils
BUILD_DIR=$(DEPTH)/build
CLASSES=$(BUILD_DIR)/classes
include html.list
include $(CONFIG)/CommonProperties

all: html cgi lst classes

html: images
	@echo Proceed HTML files ...
	@for i in $(HTML_LIST) ;do \
		perl $(UTILS)/configurator.pl $(CONFIG)/CommonProperties $(HTML_ROOT_DIR)/$${i} $(SRC)/html/$${i} ; \
	done
	@echo Creating chkbox group in $(START_HTML) ...
	@perl $(UTILS)/lst_gen.pl $(HTML_ROOT_DIR)/$(START_HTML) $(CONFIG)/$(LST_FILE)

images:
	@echo Copy images ...
	@mkdir -p $(HTML_ROOT_DIR)/log
	@mkdir -p $(HTML_ROOT_DIR)/images
	@cp -f $(SRC)/images/*.gif  $(HTML_ROOT_DIR)/images

stress:
	@echo compiling stress tests
	$(JDKHOME)/bin/javac -g -d $(MOZ_SRC)/mozilla/dist/classes -classpath $(MOZ_SRC)/mozilla/dist/classes ../src/classes/manual/stress/*.java
	@echo +++ Creating stress.bat.  Use this to run the stress browser.
	rm -f stress
	@echo set XPCOM_CHECK_THREADSAFE=0 >> stress
	@echo perl $(MOZ_SRC)/mozilla/java/webclient/src_share/runem.pl WCRandom $(MOZ_SRC)/mozilla %1% >> stress
	chmod 755 stress


cgi: 
	@echo Proceed CGI scripts ...
	@perl $(UTILS)/configurator.pl $(CONFIG)/CommonProperties $(CGI_BIN_ROOT_DIR)/results.cgi $(SRC)/cgi/results.cgi
	@chmod a+x $(CGI_BIN_ROOT_DIR)/results.cgi
	@perl $(UTILS)/configurator.pl $(CONFIG)/CommonProperties $(CGI_BIN_ROOT_DIR)/start.cgi $(SRC)/cgi/start.cgi
	@chmod a+x $(CGI_BIN_ROOT_DIR)/start.cgi
	@perl $(UTILS)/configurator.pl $(CONFIG)/CommonProperties $(CGI_BIN_ROOT_DIR)/finish.cgi $(SRC)/cgi/finish.cgi
	@chmod a+x $(CGI_BIN_ROOT_DIR)/finish.cgi
	@perl $(UTILS)/configurator.pl $(CONFIG)/CommonProperties $(CGI_BIN_ROOT_DIR)/stop.cgi $(SRC)/cgi/stop.cgi
	@chmod a+x $(CGI_BIN_ROOT_DIR)/stop.cgi

lst:    
	@echo Copy list file ...
	@cp -f $(CONFIG)/WebClientTests.lst $(CGI_BIN_ROOT_DIR)

classes::
	@echo Making classes ...
	@cd $(CLASSES);$(MAKE)





