#!nmake
#
# The contents of this file are subject to the Mozilla Public
# License Version 1.1 (the "License"); you may not use this file
# except in compliance with the License. You may obtain a copy of
# the License at http://www.mozilla.org/MPL/
#
# Software distributed under the License is distributed on an "AS
# IS" basis, WITHOUT WARRANTY OF ANY KIND, either express or
# implied. See the License for the specific language governing
# rights and limitations under the License.
#
# The Original Code is mozilla.org code.
#
# The Initial Developer of the Original Code is Sun Microsystems,
# Inc. Portions created by Sun are
# Copyright (C) 1999 Sun Microsystems, Inc. All
# Rights Reserved.
#
# Contributor(s):


DEPTH=..
SRC=$(DEPTH)\src
CONFIG=$(DEPTH)\config
UTILS=$(DEPTH)\utils
BUILD_DIR=$(DEPTH)\build
CLASSES=$(BUILD_DIR)\classes
!include html.list
!include $(CONFIG)\CommonProperties
DIRS=classes 

all: html images cgi lst 
        @set MAKE_ARGS=$@
	@$(MAKE) /NOLOGO -f Makefile.win $(DIRS)
        

html:: 
        @echo Proceed HTML files ...
	@$(MAKE) /NOLOGO /f Makefile.win $(HTML_LIST)
	@echo Creating chkbox group in $(START_HTML) ...
	@perl $(UTILS)\lst_gen.pl $(HTML_ROOT_DIR)/$(START_HTML) $(CONFIG)/$(LST_FILE)

$(HTML_LIST)::
	@perl $(UTILS)\configurator.pl \
                                          $(CONFIG)\CommonProperties \
                                          $(HTML_ROOT_DIR)\$@ \
                                          $(SRC)\html\$@ 
images:
	@echo Copy images ...
        @if not exist $(HTML_ROOT_DIR)\log \
	@mkdir $(HTML_ROOT_DIR)\log
        @if not exist $(HTML_ROOT_DIR)\images \
	@mkdir $(HTML_ROOT_DIR)\images
	@copy $(SRC)\images\*.gif  $(HTML_ROOT_DIR)\images

cgi: 
	@echo Proceed CGI scripts ...
	@perl $(UTILS)\configurator.pl $(CONFIG)/CommonProperties $(CGI_BIN_ROOT_DIR)/results.cgi $(SRC)/cgi/results.cgi
	@perl $(UTILS)\configurator.pl $(CONFIG)/CommonProperties $(CGI_BIN_ROOT_DIR)/start.cgi $(SRC)/cgi/start.cgi
	@perl $(UTILS)\configurator.pl $(CONFIG)/CommonProperties $(CGI_BIN_ROOT_DIR)/finish.cgi $(SRC)/cgi/finish.cgi
	@perl $(UTILS)\configurator.pl $(CONFIG)/CommonProperties $(CGI_BIN_ROOT_DIR)/stop.cgi $(SRC)/cgi/stop.cgi

lst:    
	@echo Copy list file ...
	@copy $(CONFIG)\WebClientTests.lst $(CGI_BIN_ROOT_DIR)

clobber:	
	@set MAKE_ARGS=$@
	@$(MAKE) /NOLOGO -f makefile.win $(DIRS)
        @-del /Q /S $(HTML_ROOT_DIR)\images\*.*
        @-del /Q /S $(HTML_ROOT_DIR)\*.html
        @-del /Q $(CGI_BIN_ROOT_DIR)\WebclientTests.lst
        @-del /Q $(CGI_BIN_ROOT_DIR)\start.cgi
        @-del /Q $(CGI_BIN_ROOT_DIR)\results.cgi
        @-del /Q $(CGI_BIN_ROOT_DIR)\finish.cgi
        @-del /Q $(CGI_BIN_ROOT_DIR)\stop.cgi

$(DIRS)::
	@echo Making $(MAKE_ARGS) in $@
	@cd $@
	@$(MAKE) /NOLOGO -f Makefile.win $(MAKE_ARGS)
	@cd ..



