#//------------------------------------------------------------------------
#//
#// Makefile to build the motif part of the native version of webclient
#//
#//------------------------------------------------------------------------

DEPTH        = ../../../..
topsrcdir	= @top_srcdir@
srcdir		= @srcdir@
VPATH		= @srcdir@

include $(DEPTH)/config/autoconf.mk

include $(topsrcdir)/config/config.mk

MODULE		= webclient_motif
LIBRARY_NAME	= webclient_motif

STUB_LIBRARY_NAME = webclientstub

# we don't want the shared lib, but we want to force the creation of a 
# static lib.
override NO_SHARED_LIB=1
override NO_STATIC_LIB=

CPPSRCS         = \
		BrowserControlNativeShimStub.cpp \
		MotifBrowserControlCanvas.cpp \
		MotifBrowserControlCanvasStub.cpp \
		gtkmozilla.cpp \
		nsSetupRegistry.cpp \
		$(NULL)

# files that go into lib$(STUB_LIBRARY_NAME).so
STUBOBJS	= \
		BrowserControlNativeShimStub.o \
		MotifBrowserControlCanvasStub.o \
		$(NULL)

# files that go into lib$(LIBRARY_NAME).a
SHAREOBJS	= \
		MotifBrowserControlCanvas.o \
		gtkmozilla.o \
		nsSetupRegistry.o \
		$(NULL)

include $(topsrcdir)/config/rules.mk

#ifeq ($(NSPR_INCLUDE_DIR),)
INCLUDES +=            -I$(DIST)/include/private
#else
INCLUDES +=            -I$(NSPR_INCLUDE_DIR)/private
#endif

ifndef MOZ_MONOLITHIC_TOOLKIT
CXXFLAGS	+= $(MOZ_GTK_CFLAGS)
CFLAGS		+= $(MOZ_GTK_CFLAGS)
else
CXXFLAGS	+= $(TK_CFLAGS)
CFLAGS		+= $(TK_CFLAGS)
endif

# include mozilla/widget/src/gtk/nsGtkEventHandler.h
INCLUDES += -I$(topsrcdir)/widget/src/gtk

# START section might end up in a file that gets included from this Makefile
STUB_LIBRARY		:= lib$(STUB_LIBRARY_NAME).so

# take the controls for creating the libraries
$(LIBRARY): $(LOBJS) $(SHAREOBJS) $(STUB_LIBRARY) Makefile Makefile.in
	$(AR) -o $@ $(SHAREOBJS) $(LOBJS) $(SUB_LOBJS)
	$(RANLIB) $@
	@rm -f foodummyfilefoo $(SUB_LOBJS)

$(STUB_LIBRARY): $(STUBOBJS) Makefile Makefile.in
	$(MKSHLIB) -o $@ $(STUBOBJS) $(LOBJS) $(EXTRA_DSO_LDOPTS)

install::
	$(INSTALL) -m 444 $(LIBRARY) $(DIST)/lib
	$(INSTALL) -m 444 $(STUB_LIBRARY) $(DIST)/lib $(DIST)/bin

# END possible include section



# force everything to be done in the export phase
export:: MotifBrowserControlCanvas.h NativeEventThread.h nsSetupRegistry.cpp ../BrowserControlNativeShim.h  libs install


nsSetupRegistry.cpp:
	ln $(DEPTH)/webshell/tests/viewer/nsSetupRegistry.cpp nsSetupRegistry.cpp

MotifBrowserControlCanvas.h:
	@echo Assuming class org.mozilla.webclient.motif.MotifBrowserControlCanvas is in $(JAVAH_FLAGS)
	$(JAVAH) $(JAVAH_FLAGS)  -o $@ org.mozilla.webclient.motif.MotifBrowserControlCanvas

NativeEventThread.h:
	@echo Assuming class org.mozilla.webclient.motif.NativeEventThread is in $(JAVAH_FLAGS)
	$(JAVAH) $(JAVAH_FLAGS)  -o $@ org.mozilla.webclient.motif.NativeEventThread

../BrowserControlNativeShim.h:
	@echo Assuming class org.mozilla.webclient.BrowserControlNativeShim is in $(JAVAH_FLAGS)
	$(JAVAH) $(JAVAH_FLAGS)  -o $@ org.mozilla.webclient.BrowserControlNativeShim
