<html>
 <head>
  <title>Test case for bug #xxxxx</title>
  <style>
   body { font-family: "Arial", monospace; font-size: 12pt; }
   div:first-letter { color: green; font-size: 36pt; background-color: khaki; }
   .fl:first-letter {
     font-size: 72pt; background-color: gold; float: left;
     margin-right: 5px;
   }
   :first-letter { color: red; }
   div { margin: 1em; border: 1px solid grey; }
   span { text-decoration: underline; }
   div.test { border: 2px solid green; padding: 2px; display: none; }
   p { background: lightgreen; }
   input.blue { background: rgb(128,128,255); }
  </style>
  <script>
    var newTextCount = 1;
    function NewText() {
      return document.createTextNode("Some text #" + newTextCount++);
    }
    function NewImage() {
      var img = document.createElement("img");
      if (img) {
        img.src = "blue-square.gif";
        img.width = "50";
        img.height = "50";
      }
      return img;
    }
    function NewComment() {
      return document.createComment("Another pesky comment");
    }
    function NewInline() {
      var i = document.createElement("i");
      if (i) {
        i.appendChild(NewText());
        i.appendChild(NewComment());
        i.appendChild(NewText());
      }
      return i;
    }
    function NewBlock() {
      var b = document.createElement("p");
      if (b) {
        b.appendChild(NewText());
        b.appendChild(NewComment());
        b.appendChild(NewText());
      }
      return b;
    }
    function NewButton(msg,func) {
      var b = document.createElement("input");
      if (b) {
        b.type = "button";
        b.value = msg;
        b.onclick = func;
      }
      return b;
    }

    function InsertIt(ctor) {
      var list = document.getElementsByName("it");
      if (list) {
        for (var i = 0; i < list.length; i++) {
          var node = list[i];
          if (node) {
            node.insertBefore(ctor(), node.childNodes[0]);
          }
        }
      }
    }
    function AppendIt(ctor) {
      var list = document.getElementsByName("it");
      if (list) {
        for (var i = 0; i < list.length; i++) {
          var node = list[i];
          if (node) {
            node.appendChild(ctor());
          }
        }
      }
    }

    function InsertText() { InsertIt(NewText); }
    function AppendText() { AppendIt(NewText); }
    function InsertImage() { InsertIt(NewImage); }
    function AppendImage() { AppendIt(NewImage); }
    function InsertComment() { InsertIt(NewComment); }
    function AppendComment() { AppendIt(NewComment); }
    function InsertBlock() { InsertIt(NewBlock); }
    function AppendBlock() { AppendIt(NewBlock); }
    function InsertInline() { InsertIt(NewInline); }
    function AppendInline() { AppendIt(NewInline); }

    function FindText(n) {
      var kids = n.childNodes;
      for (var i = 0; i < kids.length; i++) {
        var kid = kids[i];
        if (kid.nodeType == Node.TEXT_NODE) {
          return kid;
	}
      }
      return null;
    }
    function ShrinkText() {
      var list = document.getElementsByName("it");
      if (list) {
        for (var i = 0; i < list.length; i++) {
          var text = FindText(list[i]);
          if (text) {
            text.deleteData(0, 1);
          }
        }
      }
    }
    function GrowText() {
      var list = document.getElementsByName("it");
      if (list) {
        for (var i = 0; i < list.length; i++) {
          var text = FindText(list[i]);
          if (text) {
            text.insertData(0, "Zz");
          }
        }
      }
    }

    function RemoveNode(n) {
      var list = document.getElementsByName("it");
      if (list) {
        for (var i = 0; i < list.length; i++) {
          var node = list[i];
          if (node && node.childNodes[n]) {
            node.removeChild(node.childNodes[n]);
          }
        }
      }
    }
    function RemoveNodeN() {
      var list = document.getElementsByName("it");
      if (list) {
        for (var i = 0; i < list.length; i++) {
          var node = list[i];
          if (node && node.childNodes.length) {
            node.removeChild(node.childNodes[node.childNodes.length-1]);
          }
        }
      }
    }
    function RemoveNode0() { RemoveNode(0); }
    function RemoveNode1() { RemoveNode(1); }
    function RemoveNode2() { RemoveNode(2); }
    function RemoveNode3() { RemoveNode(3); }

    var seed = 0;
    function Rand() {
      seed = (seed * 69069 + 12359) & 0x7fffffff;
      return seed;
    }

    var tests = new Array(17);
    tests[0] = InsertText;
    tests[1] = AppendText;
    tests[2] = InsertComment;
    tests[3] = AppendComment;
    tests[4] = InsertImage;
    tests[5] = AppendImage;
    tests[6] = InsertBlock;
    tests[7] = AppendBlock;
    tests[8] = InsertInline;
    tests[9] = AppendInline;
    tests[10] = ShrinkText;
    tests[11] = GrowText;
    tests[12] = RemoveNode0;
    tests[13] = RemoveNode1;
    tests[14] = RemoveNode2;
    tests[15] = RemoveNode3;
    tests[16] = RemoveNodeN;

    function RandomTests() {
      for (var i = 0; i < 100; i++) {
        var rr = Rand() >> 3;
        var ix = rr % tests.length;
        dump(ix + "\n");
        var f = tests[ix];
        f();
      }
    }

    function RunTest() {
      RandomTests();
    }

    function SetupTest() {
      // Create input buttons
     if (false) {
      var it = document.getElementById("form");
      if (it) {
        for (var i = 0; i < tests.length; i++) {
          var s = tests[i] + "";
          s = s.slice(10, s.indexOf("("));
          var b = NewButton(s, tests[i]);
          it.appendChild(b);
        }
      }
     }
      document.getElementsByName("0")[0].style.display = "block";
    }

    var currentTest = 0;
    var numTests = 6;
    function NextTest() {
     document.getElementsByName(currentTest)[0].style.display = "none";
     currentTest = (currentTest + 1) % numTests;
     document.getElementsByName(currentTest)[0].style.display = "block";
    }
  </script>
 </head>
 <body onload="SetupTest();">
  <form id="form">
   <input type=button value="NextTest" onclick="NextTest();" class=blue>
   <input type=button value="RunTest" onclick="RunTest();" class=blue><br>
   <input type=button value="0: InsertText" onclick="InsertText();">
   <input type=button value="1: AppendText" onclick="AppendText();">
   <input type=button value="2: InsertComment" onclick="InsertComment();">
   <input type=button value="3: AppendComment" onclick="AppendComment();">
   <input type=button value="4: InsertImage" onclick="InsertImage();">
   <input type=button value="5: AppendImage" onclick="AppendImage();">
   <input type=button value="6: InsertBlock" onclick="InsertBlock();">
   <input type=button value="7: AppendBlock" onclick="AppendBlock();">
   <input type=button value="8: InsertInline" onclick="InsertInline();">
   <input type=button value="9: AppendInline" onclick="AppendInline();">
   <input type=button value="10: ShrinkText" onclick="ShrinkText();">
   <input type=button value="11: GrowText" onclick="GrowText();">
   <input type=button value="12: RemoveNode0" onclick="RemoveNode0();">
   <input type=button value="13: RemoveNode1" onclick="RemoveNode1();">
   <input type=button value="14: RemoveNode2" onclick="RemoveNode2();">
   <input type=button value="15: RemoveNode3" onclick="RemoveNode3();">
   <input type=button value="16: RemoveNodeN" onclick="RemoveNodeN();">
  </form>
  <hr>

  <div class="test" name="0">
   Simple first-letter; direct child of the block
   <div name="it">
    Twas brillig and the slithey toves...And Bush one.
    Twas brillig and the slithey toves...And Bush one.
    Twas brillig and the slithey toves...And Bush one.
   </div><br clear=all>
  </div>

  <div class="test" name="1">
   Floating first-letter; direct child of the block
   <div class="fl" name="it">
    Twas brillig and the slithey toves...And Bush one.
    Twas brillig and the slithey toves...And Bush one.
    Twas brillig and the slithey toves...And Bush one.
   </div><br clear=all>
  </div>

<!--
  <div class="test" name="2">
   Simple first-letter; indirect child of the block
   <div name="it">
    <span>
     Twas brillig and the slithey toves...And Bush one.
     Twas brillig and the slithey toves...And Bush one.
     Twas brillig and the slithey toves...And Bush one.
    </span>
   </div><br clear=all>
  </div>

  <div class="test" name="3">
   Floating first-letter; indirect child of the block
   <div class="fl" name="it">
    <span>
     Twas brillig and the slithey toves...And Bush one.
     Twas brillig and the slithey toves...And Bush one.
     Twas brillig and the slithey toves...And Bush one.
    </span>
   </div><br clear=all>
  </div>

  <div class="test" name="4">
   Simple first-letter; indirect child of the block; span is target of
   insert/remove
   <div>
    <span name="it">
     Twas brillig and the slithey toves...And Bush one.
     Twas brillig and the slithey toves...And Bush one.
     Twas brillig and the slithey toves...And Bush one.
    </span>
   </div><br clear=all>
  </div>

  <div class="test" name="5">
   Floating first-letter; indirect child of the block; span is target of
   insert/remove
   <div class="fl">
    <span name="it">
     Twas brillig and the slithey toves...And Bush one.
     Twas brillig and the slithey toves...And Bush one.
     Twas brillig and the slithey toves...And Bush one.
    </span>
   </div><br clear=all>
  </div>
-->
 </body>
</html>
