<HTML>
<HEAD>
</HEAD>
<BODY onload=loadLanguages()>
<H1>SOAP Test: Unscramble</H1>
The entered word will be unscrambled against a dictionary.  Other services found on
<A href="http://www.xmethods.com">X Methods Website</A>.  View the source of this 
page for details on how it was called.  If you compile mozilla DEBUG (you also need  
MOZ_SOAP), the message sent and received will  be logged to the console.
<p>Experimenters may wish to add other tests which exercize services, with specific 
user interfaces such as the one in this test.
<SCRIPT>

  var currentCall;

// Passed in as the response handler in the asynchronous case
// and called directly (see below) in the synchronous case
function oncompletion(resp, call, status) { 
  document.getElementById('BUTTON').value = "Call";
  if (status != 0) {
    alert("Error completion: " + status);
    return true;
  }

  // Was there a SOAP fault in the response?
  if (resp.fault != null) {
    var f = resp.fault;
    var detail = f.detail;
    var ds = new XMLSerializer();
    var detailStr = detail ? ds.serializeToString(detail) : "";
    alert("Fault namespace: " + f.faultNamespaceURI + "\nFault code: " + f.faultCode + "\nFault string: " + f.faultString + "\nFault actor: "  + f.faultActor + "\nDetail: " + detailStr);
  }
  else {
	  var ret = resp.getParameters(false, {})[0].value;
	  for (i = 0; i < ret.length; i++) {
		  alert(ret[i]);
	  }
  }
  return true;
}

function makeCall(language,word) {
  var s = new SOAPCall();
  // The targetObjectURI, methodName and destinatioName are mandatory.
  // The actionURI is optional.

  s.transportURI = "http://ray.dsl.xmission.com:8080/soap/servlet/rpcrouter";

  // Set the parameters on the call object. Note that in this case,
  // the last parameter is an object that will be serialized into
  // a struct parameter. It does not have a parameter wrapper because 
  // we don't need it to be named
  s.encode(0, "unscramble", "http://soaptests.mozilla.org/unscramble", 0, null,
  2, new Array(new SOAPParameter(language,"language"), new SOAPParameter(word,"word")));
    if (currentCall != null) { currentCall.abort(); }
  document.getElementById('BUTTON').value = "Wait...";

  //  The following line allows the browser with default security 
  //  settings to attach a verifySource header instead of requesting 
  //  UniversalBrowserRead.  Uncomment it if the server permits
  //  verifySource headers.  If the server does not permit them, then
  //  this setting will cause the service request to fail:

  s.verifySourceHeader = true;

  //  If no verification of source headers is occurring, then it is necessary
  //  to request privileges.

  if (!s.verifySourceHeader)
    netscape.security.PrivilegeManager.enablePrivilege("UniversalBrowserRead");

  currentCall = s.asyncInvoke(oncompletion);
}
function loadLanguages()
{
  var s = new SOAPCall();
  // The targetObjectURI, methodName and destinatioName are mandatory.
  // The actionURI is optional.

  s.transportURI = "http://ray.dsl.xmission.com:8080/soap/servlet/rpcrouter";

  // Set the parameters on the call object. Note that in this case,
  // the last parameter is an object that will be serialized into
  // a struct parameter. It does not have a parameter wrapper because 
  // we don't need it to be named
  s.encode(0, "languages", "http://soaptests.mozilla.org/unscramble", 0, null, 0, null);
    if (currentCall != null) { currentCall.abort(); }

  //  The following line allows the browser with default security 
  //  settings to attach a verifySource header instead of requesting 
  //  UniversalBrowserRead.  Uncomment it if the server permits
  //  verifySource headers.  If the server does not permit them, then
  //  this setting will cause the service request to fail:

  s.verifySourceHeader = true;

  //  If no verification of source headers is occurring, then it is necessary
  //  to request privileges.

  if (!s.verifySourceHeader)
    netscape.security.PrivilegeManager.enablePrivilege("UniversalBrowserRead");

    var list = s.invoke(oncompletion).getParameters(false, {})[0].value;
    for (i = 0; i < list.length; i++) {
      var option = document.createElement("option");
      option.value = list[i];
      option.text = list[i];
      document.getElementById('LANGUAGE').add(option,null);
    }
}
</SCRIPT>
<P>
<FORM>

<SELECT ID=LANGUAGE SIZE="1" name="RequestName">
</SELECT>
<INPUT
<INPUT ID=WORD TYPE="text">
<INPUT ID=BUTTON TYPE="button" VALUE="Call" ONCLICK="makeCall(document.getElementById('LANGUAGE').value,document.getElementById('WORD').value);">
</BODY>
</HTML>
