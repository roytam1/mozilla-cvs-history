[%# The contents of this file are subject to the Mozilla Public
  # License Version 1.1 (the "License"); you may not use this file
  # except in compliance with the License. You may obtain a copy of
  # the License at http://www.mozilla.org/MPL/
  #
  # Software distributed under the License is distributed on an "AS
  # IS" basis, WITHOUT WARRANTY OF ANY KIND, either express or
  # implied. See the License for the specific language governing
  # rights and limitations under the License.
  #
  # The Original Code is the Bugzilla Test Runner System.
  #
  # The Initial Developer of the Original Code is Maciej Maczynski.
  # Portions created by Maciej Maczynski are Copyright (C) 2001
  # Maciej Maczynski. All Rights Reserved.
  #
  # Contributor(s): Ed Fuentetaja <efuentetaja@acm.org>
  #					Greg Hendricks <ghendricks@novell.com>
  #%]

[%# INTERFACE:
  # ...
  #%]

[%############################################################################%]
[%# Template Initialization                                                  #%]
[%############################################################################%]

[% PROCESS global/variables.none.tmpl %]
[% PROCESS testopia/blocks.html.tmpl %]
[% title = "Test Run $run.id: $run.summary" %]

[%############################################################################%]
[%# Page Header                                                              #%]
[%############################################################################%]

[% PROCESS global/header.html.tmpl %]
[% PROCESS testopia/blocks.html.tmpl %]
[% PROCESS testopia/style.none.tmpl %]

[% PROCESS testopia/messages.html.tmpl %]

[% IF run.canedit %]
<script src="testopia/js/util.js" type="text/javascript"></script>
<script src="testopia/js/tags.js" type="text/javascript"></script>
<script src="testopia/dojo-ajax/dojo.js" type="text/javascript"></script>
<script type="text/javascript">
	function getSelected (ccbox){
		var ccselected = new Array();
	    for (j=0; j < ccbox.options.length; j++){
	    	if (ccbox.options[j].selected != 0)
	    	    ccselected.push(ccbox.options[j].value);
	    	
	    }
	    var sel = ccselected.toString();
	    return sel;
	}

	function fillcc (data){
         var xmldocroot = data.documentElement;
         var newcc = xmldocroot.getElementsByTagName('user');
		 var cc = document.getElementById("cc");
		 cc.options.length = 0;
         for (i=0; i< newcc.length; i++){
           var id = newcc[i].childNodes[0].firstChild.nodeValue;
           var name = newcc[i].childNodes[1].firstChild.nodeValue;
           var myOp = new Option(name, id);
           cc.add(myOp,null);
         }
         document.getElementById("newcc").value = '';
         document.getElementById("addCC").disabled = false;
         document.getElementById("deleteCC").disabled = false;

	}
    function updateCC(cctext, action){
		if (cctext == '')
		  return;
        document.getElementById("addCC").disabled = true;
        document.getElementById("deleteCC").disabled = true;
	    dojo.io.bind({
			url:     "tr_show_run.cgi",
			content: {  cc: cctext, run_id: [% run.id %], action: action },
			load:    function(type, data, evt){ fillcc(data);},
			error:   function(type, error){ alert("ERROR");},
			mimetype: "text/xml"
    	});
    }
    
</script>
<style>
  .number_cell{
      border: 1px solid #000;
      width: 100px;
      text-align: right;
  }
</style>
[% END %]

[% ##### Overview ##### %]
<form method="post" action="tr_show_run.cgi">
<div id="run_overview">
<h3>Overview</h3>
<table border="0" cellpadding="1" width="100%">
  <tbody align="left">
    <tr class="bz_row_header">
      <th>Plan</th>
      <th>Plan Text Version</th>
      <th>Start Date</th>
      </tr>
    <tr class="bz_row_data">
      <td><a href="tr_show_plan.cgi?plan_id=[% run.plan.id FILTER none %]">[% run.plan.name FILTER html %]</a></td>
      <td>[% run.plan_text_version FILTER html %]</td>
      <td>[% run.start_date FILTER time %]</td>
      </tr>
    <tr class="bz_row_header">
      <th>Product</th>
      <th>Product Version</th>
      <th>Stop Date</th>
      </tr>
    <tr class="bz_row_data">
      <td>[% run.plan.product_name FILTER html %]</td>
      <td>[% run.product_version FILTER html %]</td>
      <td>[% run.stop_date FILTER time %]</td>
    </tr>
    <tr class="bz_row_header">
      <th>Manager</th>
      <th>Percent Complete</th>
      <th>Status</th>
      </tr>
    <tr class="bz_row_data">
      <td><a href="mailto:[% run.manager.email FILTER html %]">[% run.manager.identity FILTER html %]</a></td>
      <td align="center">    
        [% PROCESS testopia/percent_bar.html.tmpl 
           percent = run.percent_complete 
        %]
      </td>
      <td align="center">
      [% IF run.stop_date %]
        STOPPED
      [% ELSE %]
        RUNNING
      [% END %]
      </td>
    </tr>
    
    <tr class="bz_row_data">
      <td colspan="3"><div align="right">
      <table>
      	<tr>
          <!-- 
          <td><a href="tr_testrun_regression.cgi?run_id=[% run.id FILTER none %]">Create regression test cases</a></td> -->
          <td><input type="submit" name="action" value="Commit"></td>
          <td><input type="submit" name="action" value="History"></td>
	      [% IF run.candelete %]
          <td><input type="submit" name="action" value="Delete"></td>
          [% END %]
		  <td><input type="submit" name="action" value="Clone"></td>	      
		</tr>      
      </table>
      </div></td>
    </tr>
  </tbody>
</table>
</div>

<br><br>
[% ##### Categories and Tags ##### %]
<h3>CC, Coverage, Tags</h3>
<div id="run_categories">
<table width="100%" border="0">
  <tr class="bz_row_header">
	<th>CC List</th>
    <th>Case Run Status</th>
    <th><a href="tr_tags.cgi?id=[% run.id FILTER none %]&amp;type=run">Tags</a></th>
  </tr>
  <tr>
    <td valign="top">
    <table>
      <tr>
        <td>
		  <input name="newcc" id="newcc">
	      <input type="button" id="addCC" value="Add" onclick="updateCC(document.getElementById('newcc').value, 'addcc')">
	    </td>
	  </tr>
	  <tr>
	    <td>
	      <select name="cc" id="cc" size="5" multiple="multiple">
	      [% FOREACH cc = run.cc %]
	        <option value="[% cc.id FILTER none %]">[% cc.login FILTER html %]</option>
	      [% END %]
          </select>
          <br>
          <input type="button" id="deleteCC" value="Remove" onclick="updateCC(getSelected(document.getElementById('cc')), 'removecc')">				
        </td>
      </tr>
    </table>
    </td>
	<td>
	<table align="center">
	  <tr>
	    <th align="right">Idle:</th>
	    <td class="number_cell"><b>[% run.idle_count FILTER html %]</b></td>
	  </tr>
	  <tr>
	    <th align="right">Passed:</th>
	    <td class="number_cell"><b>[% run.passed_count FILTER html %]</b></td>
	  </tr>
	  <tr>
	    <th align="right">Failed:</th>
	    <td class="number_cell"><b>[% run.failed_count FILTER html %]</b></td>
	    </td>
	  </tr>
      <tr>
        <th align="right">Running:</th>
        <td class="number_cell"><b>[% run.running_count FILTER html %]</b></td>
      </tr>
      <tr>
        <th align="right">Paused:</th>
        <td class="number_cell"><b>[% run.paused_count FILTER html %]</b></td>
      </tr>
      <tr>
        <th align="right">Blocked:</th>
        <td class="number_cell"><b>[% run.blocked_count FILTER html %]</b></td>
        </td>
      </tr>
	  <tr>
	    <th align="right">Total:</th>
	    <td class="number_cell"><b>[% run.case_count FILTER html %]</b></td>
	  </tr>
    </table>
	</td>
  
    <td valign="top" align="center">

    <div id="tagTable">
    [% PROCESS testopia/tag/table.html.tmpl 
       item = run 
       type = 'run'
    %]
    </div>
    </td>
    
  </tr>
</table>
</div>
<br><br>
<h3>Test Case Run Logs</h3>
Filter: 
<a href="tr_show_run.cgi?run_id=[% run.id FILTER none %]">Show All</a>&nbsp;|&nbsp;
<a href="tr_show_run.cgi?run_id=[% run.id FILTER none %]&assignee=[% user.login FILTER url_quote %]&assignee_type=exact">Assigned to Me</a>&nbsp;|&nbsp;
<a href="tr_show_run.cgi?run_id=[% run.id FILTER none %]&testedby=[% user.login FILTER url_quote %]&testedby_type=exact">Tested by Me</a>&nbsp;|&nbsp;
<a href="tr_show_run.cgi?run_id=[% run.id FILTER none %]&close_date=0">Open</a>&nbsp;|&nbsp;
<a href="tr_show_run.cgi?run_id=[% run.id FILTER none %]&close_date=1">Closed</a>
<br/>
[% PROCESS testopia/caserun/table.html.tmpl 
   caseruns = run.current_caseruns %]
<a href="tr_list_cases.cgi?current_tab=case&plan_id=[% run.plan.id %]&exclude=[% run.case_id_list %]&addrun=[% run.id FILTER none %]">Add Cases</a>&nbsp;
<a href="tr_list_caseruns.cgi?run_id=[% run.id FILTER none %]">Update Multiple</a>
<!-- 
<form action="tr_list_cases.cgi" method="POST">
  <input type="hidden" name="exclude" value="[% run.case_id_list %]" />
  <input type="hidden" name="current_tab" value="case" />
  <input type="hidden" name="plan_id" value="[% run.plan.id %]" />
  <input type="submit" value="Add Cases" />
</form>
 -->
<br><br>
<h3>Attributes</h3>

[% PROCESS testopia/run/form.html.tmpl %]
</form>
[% PROCESS global/footer.html.tmpl %]
