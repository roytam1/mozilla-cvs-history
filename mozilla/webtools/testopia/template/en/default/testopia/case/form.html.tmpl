[%# 1.0@bugzilla.org %]
[%# The contents of this file are subject to the Mozilla Public
  # License Version 1.1 (the "License"); you may not use this file
  # except in compliance with the License. You may obtain a copy of
  # the License at http://www.mozilla.org/MPL/
  #
  # Software distributed under the License is distributed on an "AS
  # IS" basis, WITHOUT WARRANTY OF ANY KIND, either express or
  # implied. See the License for the specific language governing
  # rights and limitations under the License.
  #
  # The Original Code is the Bugzilla Test Runner System.
  #
  # The Initial Developer of the Original Code is Maciej Maczynski.
  # Portions created by Maciej Maczynski are Copyright (C) 2001
  # Maciej Maczynski. All Rights Reserved.
  #
  # Contributor(s): Ed Fuentetaja <efuentetaja@acm.org>
  #                 Greg Hendricks <ghendricks@novell.com>
  #                 Tyler Peterson <typeterson@novell.com>
  #%]

[%# INTERFACE:
  # ...
  #%]

<script src="testopia/js/DocumentManager.js" type="text/javascript"></script>
<script type="text/javascript">
    dojo.require("dojo.widget.Editor2");  
    dojo.require("dojo.widget.Editor2Plugin.DialogCommands");  
    dojo.require("dojo.widget.ComboBox");
    setupDM     = new DocumentManager("tcsetup",     "[% action FILTER html %]", ["tcsetupHeading"]);
    breakdownDM = new DocumentManager("tcbreakdown", "[% action FILTER html %]", ["tcbreakdownHeading"]);
    actionDM    = new DocumentManager("tcaction",    "[% action FILTER html %]", ["tcactionHeading"]);
    effectDM    = new DocumentManager("tceffect",    "[% action FILTER html %]", ["tceffectHeading"]);
    
    function checkAddruns(status){
      if (status == 2){
        document.getElementById('addruns').disabled = false;
      }
      else {
        document.getElementById('addruns').disabled = true;
      }
    }
    
    
    dojo.addOnLoad(
      function() {
       dojo.widget.manager.getWidgetById('tester').setValue('[% case.default_tester.login FILTER none %]');
       dojo.widget.manager.getWidgetById('tester').setLabel('[% case.default_tester.login FILTER none %]');
      }
    );
</script>

<a name="attributes"></a>
  <input type="hidden" name="case_id" value="[% case.id FILTER none %]"/>
<table>
<tr><td>  
  <table>
    <tr>
      <th align="right">Summary</td>
      <td colspan="3"><input name="summary" size="80" value="[% case.summary FILTER html %]"></td>
    </tr>
    <tr>
      <th align="right">Default Tester</td>
      <td><input dojoType="Select" 
                 dataUrl="tr_quicksearch.cgi?action=getuser&search=%{searchString}" 
                 mode="remote"
                 autoComplete="true"
                 id="tester"
                 name="tester"
                 maxListLength="10" 
                 style="width:200px; height:15px"
                 value="[% case.default_tester.login FILTER html %]" >
      
      </td>
      <th align="right">Add Tags</td>
      <td><input name="addtags" size="30" /></td>
    </tr>
    
    <tr>
      <th align="right">Alias</td>
      <td><input name="alias" size="30" value="[% case.alias FILTER html %]"></td>
      <th align="right">Requirement:</td>
      <td><input name="requirement" size="30" value="[% case.requirement FILTER html %]"></td>
    </tr>
  
    <tr>
      <th align="right">Status</td>
      <td>
        [% IF action == 'Add' %]
          [% status_default = Param('default-test-case-status') %]
        [% ELSE %]
          [% status_default = case.status %]
        [% END %]
        [% PROCESS select sel = { name      => 'status',
                                  accesskey => 's', 
                                  list      => case.get_status_list
                                  default   => status_default 
                                  events => 'onChange="checkAddruns(this.value)"'} %]
      </td>
      <th align="right">Automatic</td>
      <td><select name="isautomated" id="isautomated">
            <option value="0">Manual</option>
            <option value="1" [% 'selected' IF case.isautomated %]>Automatic</option>
          </select>
      </td>
    </tr>

    <tr>
      <th align="right">Priority</td>
      <td>
        [% PROCESS select sel = { name      => 'priority',
                                  accesskey => 'p', 
                                  list      => case.get_priority_list
                                  default   => case.priority ? case.priority : Param('defaultpriority')} %]
      </td>
      
      <th align="right">Script</td>
      <td><input name="script" id="script" value="[% case.script FILTER html %]"></td>
    </tr>

    <tr>
      <th align="right"><a href="tr_categories.cgi?plan_id=[% case.plans.0.id %]" target="_blank">Category</a></td>
      <td>
        [% PROCESS select sel = { name      => 'category',
                                  accesskey => 'c', 
                                  list      => case.get_category_list
                                  default   => case.category.name } %]
      </td>
      <th align="right">Arguments:</td>
      <td><input name="arguments" id="arguments" value="[% case.arguments FILTER html %]"></td>
    </tr>
    <tr>
      <th align="right">Estimated&nbsp;Time:<br>(HH:MM:SS)</th>
      <td><input name="estimated_time" value="[% case.estimated_time FILTER html %]"></td>
      <th align="right">Add to Runs</th>
      <td><input name="addruns" id="addruns" size="30" [% 'disabled="disabled"' UNLESS case.status == 'CONFIRMED' OR (Param('default-test-case-status') == 'CONFIRMED' AND form_action == 'tr_new_case.cgi') %]></td>
    </tr>  
  </table> 
 </td>
[% IF action == "Add" %]

  <td valign="top">
    <table>
      <tr><th align="center">Select Components From</th></tr>
      <tr>
      <td>
      [% PROCESS select sel = { name      => 'prod_pick',
                                list      => user.get_selectable_products,
                                default   => case.get_product_ids.0,
                                events    => 'onChange="getProdComps(this.value)"',
                                accesskey => 'p' } %]
      </td>
    </tr>
    <tr>
        <td>
    [% comps = [] %]
    [% FOREACH c = case.components %]
      [% comps.push(c.id) %]
    [% END %]
  
    [% PROCESS select sel = { name      => 'components',
                              accesskey => 'c', 
                              list      => case.get_selectable_components(1)
                              default   => comps
                              mult      => 1
                              deflist   => 1
                              elements  => 7 
                              events    => "onChange=\"chgTester(this)\""} %]

        </td>
      </tr>
    </table>
</td>
[% END %]
</tr> 
</table>
  <p align="right">
    <input type="SUBMIT" name="action" id="action" class="tr_button" value="[% action FILTER html %]">
  </p>
  
<br><br>
<h3>Dependencies</h3>
  <table align="center">
    <tr>
      <th> Depends on </th>
      <th> Blocks </th>
    </tr>
    <tr>
      <td> 
      [% FOREACH dep = case.dependson %]
        <a href="tr_show_case.cgi?case_id=[% dep.id FILTER none %]" title="[% dep.summary %]">[% dep.id FILTER none %]</a> 
      [% END %]
      </td>
      <td> 
      [% FOREACH dep = case.blocked %]
        <a href="tr_show_case.cgi?case_id=[% dep.id FILTER none %]" title="[% dep.summary %]">[% dep.id FILTER none %]</a> 
      [% END %]
      </td>
    </tr>
    <tr>
      <td> <input name="tcdependson" size="30" value="[% case.dependson_list FILTER html %]"> </td>
      <td> <input name="tcblocks" size="30" value="[% case.blocked_list FILTER html %]"> </td>
    </tr>
    <tr>
      <td>
<!-- 
        <a href="tr_showdependencytree.cgi?case_id=[% case.id FILTER none %]">Show dependency tree</a>
-->
      </td>
      <td>
<!-- 
        [% IF Param('webdotbase') %]
          <a href="tr_showdependencygraph.cgi?case_id=[% case.id FILTER none %]">Show dependency graph</a>
        [% END %]
-->
      </td>
    </tr>
  </table>      
  <p align="right">
    <input type="SUBMIT" name="action" id="action" class="tr_button" value="[% action FILTER html %]">
  </p>

[%# action, effect %]
  <h3 id="tcsetupHeading">Set Up</h3>
  <div id="tcsetupDiv">[% case.text.setup FILTER xss %]</div>
  <h3 id="tcbreakdownHeading">Break Down</h3>
  <div id="tcbreakdownDiv">[% case.text.breakdown FILTER xss %]</div>
  <h3 id="tcactionHeading">Action</h3>
  <div id="tcactionDiv">[% case.text.action FILTER xss %]</div>
  <h3 id="tceffectHeading">Expected Results</h3>
  <div id="tceffectDiv">[% case.text.effect FILTER xss %]</div>     
