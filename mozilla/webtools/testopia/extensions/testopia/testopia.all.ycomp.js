ATTACHMENT_DELETE_WARNING="You are about to remove the selected attachments. This cannot be undone. Continue?";CASE_CATEGORY_DELETE_WARNING="You are about to delete the selected test case category.  Are you sure you want to continue?";CASE_DELETE_WARNING="You are about to delete the selected test cases including all children and history. This action cannot be undone. Are you sure you want to continue?";PLAN_DELETE_WARNING="You are about to delete the selected test plans including all children and history. This action cannot be undone. Are you sure you want to continue?";RUN_DELETE_WARNING="You are about to delete the selected test runs including all children and history. This action cannot be undone. Are you sure you want to continue?";CASERUN_DELETE_WARNING="You are about to remove the selected test cases from this run including all history. This action cannot be undone. Are you sure you want to continue?";ENVIRONMENT_DELETE_WARNING="You are about to delete the selected test environment including associated test case data. This action cannot be undone. Are you sure you want to continue?";PRODUCT_PLAN_IMPORT='Accepts XML files under 2 MB in size. <br> See <a href="extensions/testopia/testopia.xsd" target="_blank">testopia.xsd</a> for proper format.';PLAN_CASES_IMPORT='Accepts CSV and XML files under 2 MB in size. <br> See <a href="extensions/testopia/import_example.csv" target="_blank">import_example.csv</a> and <a href="extensions/testopia/testopia.xsd" target="_blank">testopia.xsd</a> for proper format.';var Testopia={};Testopia.Attachment={};Testopia.Build={};Testopia.TestCase={};Testopia.TestCase.Bugs={};Testopia.TestCaseRun={};Testopia.Category={};Testopia.Environment={};Testopia.TestPlan={};Testopia.TestRun={};Testopia.Search={};Testopia.Tags={};Testopia.Util={};Testopia.Product={};Testopia.User={};Testopia.Search.dashboard_urls=[];Ext.state.Manager.setProvider(new Ext.state.CookieProvider({expires:new Date(new Date().getTime()+(1000*60*60*24*30))}));Ext.data.Connection.timeout=120000;Ext.Updater.defaults.timeout=120000;Ext.Ajax.timeout=120000;Ext.BLANK_IMAGE_URL="extensions/testopia/extjs/resources/images/default/s.gif";Ext.override(Ext.form.Field,{fireKey:function(A){if(((Ext.isIE&&A.type=="keydown")||A.type=="keypress")&&A.isSpecialKey()){this.fireEvent("specialkey",this,A)}else{this.fireEvent(A.type,this,A)}},initEvents:function(){this.el.on("focus",this.onFocus,this);this.el.on("blur",this.onBlur,this);this.el.on("keydown",this.fireKey,this);this.el.on("keypress",this.fireKey,this);this.el.on("keyup",this.fireKey,this);this.originalValue=this.getValue()}});Ext.override(Ext.menu.Menu,{ignoreParentClicks:true,enableScrolling:false});Ext.grid.CheckColumn=function(A){Ext.apply(this,A);if(!this.id){this.id=Ext.id()}this.renderer=this.renderer.createDelegate(this)};Ext.grid.CheckColumn.prototype={init:function(A){this.grid=A;this.grid.on("render",function(){var B=this.grid.getView();B.mainBody.on("mousedown",this.onMouseDown,this)},this)},onMouseDown:function(D,C){if(C.className&&C.className.indexOf("x-grid3-cc-"+this.id)!=-1){D.stopEvent();var B=this.grid.getView().findRowIndex(C);var A=this.grid.store.getAt(B);A.set(this.dataIndex,!A.data[this.dataIndex])}},renderer:function(B,C,A){C.css+=" x-grid3-check-col-td";return'<div class="x-grid3-check-col'+(B=="1"?"-on":"")+" x-grid3-cc-"+this.id+'">&#160;</div>'}};var imgButtonTpl=new Ext.Template('<table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td><button type="button"><img src="{0}"></button></td></tr></tbody></table>');Testopia.Util.displayStatusIcon=function(A){return'<img src="extensions/testopia/img/'+A+'_small.gif" alt="'+A+'" title="'+A+'">'};Testopia.Util.makeLink=function(G,A,F,B,C,E,D){if(D=="bug"){if(E.isTreport===true){return'<a href="show_bug.cgi?id='+G+'" target="_blank">'+G+"</a>"}return'<a href="show_bug.cgi?id='+G+'">'+G+"</a>"}if(E.isTreport===true){return'<a href="tr_show_'+D+".cgi?"+D+"_id="+G+'" target="_blank">'+G+"</a>"}return'<a href="tr_show_'+D+".cgi?"+D+"_id="+G+'">'+G+"</a>"};Testopia.Util.CascadeProductSelection=function(){addOption=function(B,C){try{B.add(C,null)}catch(D){B.add(C,B.length)}};lsearch=function(D,B){if(typeof B!="object"){if(B==D){return true}return false}for(var C in B){if(B[C]==D){return true}}return false};this.addOption=addOption;var A=function(H,C){var E=Testopia.Util.urlQueryToJSON(window.location.search);if(C){E.product=C}for(var D in H.selectTypes){if(typeof H.selectTypes[D]!="function"){try{document.getElementById(H.selectTypes[D]).options.length=0;for(var B in H[H.selectTypes[D]]){if(typeof H[H.selectTypes[D]][B]!="function"){var G=new Option(H[H.selectTypes[D]][B],H[H.selectTypes[D]][B],false,lsearch(H[H.selectTypes[D]][B],E[H.selectTypes[D]]));addOption(document.getElementById(H.selectTypes[D]),G)}}document.getElementById(H.selectTypes[D]).disabled=false;document.getElementById(H.selectTypes[D])}catch(F){}}}};this.fillSelects=A;this.onProductSelection=function(B){var E=[];for(var C=0;C<B.options.length;C++){if(B.options[C].selected===true){E.push(B.options[C].value)}}var F=new Ext.form.BasicForm("testopia_helper_frm",{});var D=B.id=="classification"?"classification":"product";F.submit({url:"tr_query.cgi",params:{value:E.join(","),action:"getversions",type:D},success:function(H,G){A(G.result.objects)},failure:Testopia.Util.error})};return this};Testopia.User.Lookup=function(A){Testopia.User.Lookup.superclass.constructor.call(this,{id:A.id||"user_lookup",store:new Ext.data.JsonStore({url:"tr_quicksearch.cgi",listeners:{exception:Testopia.Util.loadError},baseParams:{action:"getuser"},root:"users",totalProperty:"total",id:"login",fields:[{name:"login",mapping:"id"},{name:"name",mapping:"name"}]}),listeners:{valid:function(B){B.value=B.getRawValue()},beforequery:function(C){if(A.multistring){var B=C.query.match(/(^.*),(.*)/);if(B){C.combo.multivalue=B[1];C.query=B[2]}}},select:function(E,D,C){if(A.multistring){var B=E.multivalue||"";B=B?B+", "+D.get("login"):D.get("login");E.setValue(B)}}},queryParam:"search",loadingText:"Looking up users...",displayField:"login",valueField:"login",typeAhead:true,hideTrigger:true,minListWidth:300,forceSelection:false,emptyText:"Type a username...",pageSize:20,tpl:'<tpl for="."><div class="x-combo-list-item"><table><tr><td>{name}</td></tr><tr><td><b>{login}</td></tr></table></div></tpl>'});Ext.apply(this,A)};Ext.extend(Testopia.User.Lookup,Ext.form.ComboBox);DocCompareToolbar=function(B,C){var A=new Ext.data.JsonStore({url:"tr_history.cgi",listeners:{exception:Testopia.Util.loadError},baseParams:{action:"getdocversions",object:B,object_id:C},root:"list",fields:[{name:"id",mapping:"id"},{name:"name",mapping:"name"}]});this.toolbar=new Ext.Toolbar({id:"doc_compare_tbar",items:[new Ext.Toolbar.Fill(),new Ext.form.ComboBox({id:"doc_view",store:A,displayField:"name",valueField:"id",width:50,triggerAction:"all"}),{xtype:"button",id:"doc_view_btn",text:"View Version",handler:function(){var D=Ext.getCmp("object_panel").add({title:"Version "+Ext.getCmp("doc_view").getValue(),closable:true,autoScroll:true});D.show();D.load({url:"tr_history.cgi",params:{action:"showdoc",object:B,object_id:C,version:Ext.getCmp("doc_view").getValue()},failure:Testopia.Util.error})}}]});return this.toolbar};Testopia.Util.HistoryList=function(A,B){this.store=new Ext.data.JsonStore({url:"tr_history.cgi",listeners:{exception:Testopia.Util.loadError},baseParams:{action:"show",object:A,object_id:B},root:"list",fields:[{name:"what",mapping:"what"},{name:"who",mapping:"who"},{name:"oldvalue",mapping:"oldvalue"},{name:"newvalue",mapping:"newvalue"},{name:"when",mapping:"changed"}]});this.columns=[{header:"What",width:150,dataIndex:"what",sortable:true},{header:"Who",width:180,sortable:true,dataIndex:"who"},{header:"When",width:150,sortable:true,dataIndex:"when"},{header:"Old",width:180,sortable:true,dataIndex:"oldvalue"},{id:"new",header:"New",width:180,sortable:true,dataIndex:"newvalue"}];Testopia.Util.HistoryList.superclass.constructor.call(this,{title:"Change History",id:"history-grid",layout:"fit",loadMask:{msg:"Loading History..."},autoExpandColumn:"new",autoScroll:true,sm:new Ext.grid.RowSelectionModel({singleSelect:false})});this.on("rowcontextmenu",this.onContextClick,this);this.on("activate",this.onActivate,this)};Ext.extend(Testopia.Util.HistoryList,Ext.grid.GridPanel,{onActivate:function(){if(!this.store.getCount()){this.store.load()}},onContextClick:function(B,A,C){if(!this.menu){this.menu=new Ext.menu.Menu({id:"history-ctx-menu",enableScrolling:false,items:[{text:"Refresh",icon:"extensions/testopia/img/refresh.png",iconCls:"img_button_16x",handler:function(){B.store.reload()}}]})}C.stopEvent();this.menu.showAt(C.getXY())}});Testopia.Util.PagingBar=function(F,G){this.type=F;var H=E(G.baseParams);function I(){this.updateInfo()}function E(L){var K=new Object();for(var J in L){K[J]=L[J]}return K}function D(){this.cursor=0;this.afterTextEl.el.innerHTML=String.format(this.afterPageText,1);this.field.dom.value=1;this.updateInfo()}var A=new Ext.form.ComboBox({store:new Ext.data.SimpleStore({fields:["value","name"],id:0,data:[[25,25],[50,50],[100,100],[500,500]],autoLoad:true}),id:F+"_page_sizer",mode:"local",displayField:"name",valueField:"value",triggerAction:"all",editable:false,width:50});A.on("select",function(L,K,J){this.pageSize=K.get("value");Ext.state.Manager.set("TESTOPIA_DEFAULT_PAGE_SIZE",K.get("value"));G.baseParams.limit=K.get("value");G.load({params:{start:0},callback:I.createDelegate(this)})},this);this.sizer=A;var C=new Ext.Button({text:"View All",enableToggle:true});C.on("toggle",function(J,K){if(K){this.pageSize=0;G.load({params:{viewall:1},callback:D.createDelegate(this)})}else{this.pageSize=A.getValue();G.load({params:{start:0,limit:A.getValue()}})}},this);var B=new Ext.form.TextField({allowBlank:true,id:F+"_paging_filter",selectOnFocus:true});B.on("specialkey",function(N,O){var K=O.getKey();if(K==O.ENTER){var P={start:0,limit:A.getValue()};if(this.getValue().length===0){G.baseParams=E(H);G.load({params:P});Ext.getCmp(F+"_filtered_txt").hide();return }var P={start:0,limit:A.getValue()};var L=this.getValue();var J=L.match(/(^.*?):/);if(J){J=J[1];var M=Testopia.Util.trim(L.substr(L.indexOf(":")+1,L.length));if(J.match(/^start/i)){J="start_date"}if(J.match(/^stop/i)){J="stop_date"}if(J.match(/^manager/i)){J="manager"}switch(J){case"status":if(F=="case"){J="case_status"}else{if(F=="caserun"){J="case_run_status"}else{J="run_status";if(M.match(/running/i)){M=0}else{M=1}}}break;case"tester":J="default_tester";break;case"plan":J="plan_id";break;case"case":J="case_id";break;case"run":J="run_id";break;case"product_version":J="default_product_version";break}G.baseParams[J]=M;G.baseParams[J+"_type"]="substring"}else{if(F=="case"||F=="run"){G.baseParams.summary=this.getValue();G.baseParams.summary_type="allwordssubst"}else{if(F=="caserun"){G.baseParams.case_summary=this.getValue();G.baseParams.case_summary_type="allwordssubst"}else{G.baseParams.name=this.getValue();G.baseParams.name_type="allwordssubst"}}}G.load({params:P});Ext.getCmp(F+"_filtered_txt").show()}if((K==O.BACKSPACE||K==O.DELETE)&&this.getValue().length===0){G.baseParams=H;G.load({params:{start:0,limit:A.getValue()}});Ext.getCmp(F+"_filtered_txt").hide()}});A.on("render",function(){var J=new Ext.ToolTip({target:F+"_paging_filter",title:"Quick Search Filter",hideDelay:"500",html:"Enter column and search term separated by ':'<br> <b>Example:</b> priority: P3<br>Blank field and ENTER to clear"})});Testopia.Util.PagingBar.superclass.constructor.call(this,{id:F+"_pager",pageSize:Ext.state.Manager.get("TESTOPIA_DEFAULT_PAGE_SIZE",25),displayInfo:true,displayMsg:"Displaying test "+F+"s {0} - {1} of {2}",emptyMsg:"No test "+F+"s were found",store:G,items:["Filter: ",B," ","-","View "," ",A," ",C," ",{type:"tbtext",text:"(FILTERED)",hidden:true,id:F+"_filtered_txt",style:"font-weight:bold;color:red"}]});this.on("render",this.setPager,this);this.cursor=0};Ext.extend(Testopia.Util.PagingBar,Ext.PagingToolbar,{setPager:function(){Ext.getCmp(this.type+"_page_sizer").setValue(Ext.state.Manager.get("TESTOPIA_DEFAULT_PAGE_SIZE",25))}});Testopia.Util.updateFromList=function(B,D,A){var C=new Ext.form.BasicForm("testopia_helper_frm",{});D.ctype="json";D.action="update";C.submit({url:"tr_list_"+B+"s.cgi",params:D,success:function(G,E){if(B=="caserun"){Ext.getCmp("run_progress").updateProgress(E.result.passed,E.result.failed,E.result.blocked,E.result.complete)}Testopia.Util.notify.msg("Test "+B+"s updated","The selected {0}s were updated successfully",B);if(A.selectedRows){A.store.baseParams.addcases=A.selectedRows.join(",");Ext.getCmp(B+"_filtered_txt").show()}try{Ext.getCmp("case_details_panel").store.reload()}catch(F){}A.store.reload({callback:function(){if(A.selectedRows){var K=A.getSelectionModel();var J=[];for(var I=0;I<A.selectedRows.length;I++){var H=A.store.find("case_id",A.selectedRows[I]);if(H>=0){J.push(H)}}K.selectRows(J);if(K.getCount()<1){Ext.getCmp("case_details_panel").disable()}}}})},failure:function(F,E){Testopia.Util.error(F,E);A.store.reload({callback:function(){if(A.selectedRows){A.getSelectionModel().selectRows(A.selectedRows)}}})}})};Testopia.Util.ComboRenderer=function(B,F,E,A,C,D){f=this.getColumnModel().getCellEditor(C,A).field;record=f.store.getById(B);if(record){return record.data[f.displayField]}else{return B}};Testopia.Util.error=function(C,A){C.el.unmask();var B;if(A.response.status&&A.response.status!=200){B={title:"System Error!",msg:A.response.responseText,buttons:Ext.Msg.OK,icon:Ext.MessageBox.ERROR,minWidth:450}}else{B={title:"An Error Has Occurred",msg:A.result.message,buttons:Ext.Msg.OK,icon:Ext.MessageBox.ERROR,prompt:true,value:A.result.message,multiline:true,minWidth:450}}Ext.Msg.show(B)};Testopia.Util.loadError=function(H,D,A,G,F,B,C){var E="There was an error loading the data: ";if(D=="response"){E+=F.responseText}Ext.Msg.show({title:"An Error Has Occurred",width:450,msg:E,prompt:true,multiline:true,value:E,buttons:Ext.Msg.OK,icon:Ext.MessageBox.ERROR})};Testopia.Util.getSelectedObjects=function(C,F){var E=C.getSelectionModel().getSelections();var A=[];var D;for(var B=0;B<E.length;B++){A.push(E[B].get(F))}D=A.join(",");return D};Testopia.Util.editFirstSelection=function(A){if(A.store.getCount()===0){return }var B=A.store.indexOf(A.getSelectionModel().getSelected());if(B==-1){B=0}A.plugins[0].startEditing(B)};Testopia.Util.urlQueryToJSON=function(A){A=A.replace(/.*\//,"");var H={};var G=A.split("?",2);var D=G[0];var C=G[1]?G[1]:D;var E=C.split("&");for(var B=0;B<E.length;B++){var F=E[B].split("=");if(H[F[0]]){if(typeof H[F[0]]=="object"){H[F[0]].push(unescape(F[1]))}else{H[F[0]]=new Array(H[F[0]]);H[F[0]].push(unescape(F[1]))}}else{H[F[0]]=unescape(F[1])}}return H};Testopia.Util.JSONToURLQuery=function(C,A,D){A=A||"";for(var B in C){if(D.indexOf(B)!=-1){continue}if(typeof C[B]=="object"){for(i=0;i<C[B].length;i++){A=A+B+"="+escape(C[B][i])+"&"}}else{A=A+B+"="+escape(C[B])+"&"}}if(A.lastIndexOf("&")==A.length-1){A=A.substr(0,A.length-1)}return A};Testopia.Util.notify=function(){var B;function A(C,D){return['<div class="msg">','<div class="x-box-tl"><div class="x-box-tr"><div class="x-box-tc"></div></div></div>','<div class="x-box-ml"><div class="x-box-mr"><div class="x-box-mc"><h3>',C,"</h3>",D,"</div></div></div>",'<div class="x-box-bl"><div class="x-box-br"><div class="x-box-bc"></div></div></div>',"</div>"].join("")}return{msg:function(F,E){if(!B){B=Ext.DomHelper.insertFirst(document.getElementById("bugzilla-body"),{id:"msg-div"},true)}B.alignTo(document,"t-t");var D=String.format.apply(String,Array.prototype.slice.call(arguments,1));var C=Ext.DomHelper.append(B,{html:A(F,D)},true);C.slideIn("t").pause(1).ghost("t",{remove:true})},init:function(){return }}}();Testopia.Util.trim=function(A){A=A.replace(/^\s+/g,"");A=A.replace(/\s+$/g,"");return A};Testopia.Util.PlanSelector=function(B,A){var E=A.action.match("case")?false:true;var D=new Testopia.TestPlan.Grid({product_id:B},{id:"plan_selector_grid",height:300,single:E});var C=new Testopia.Product.Combo({mode:"local",value:B});C.on("select",function(H,G,F){D.store.baseParams={ctype:"json",product_id:G.get("id")};D.store.load()});Testopia.Util.PlanSelector.superclass.constructor.call(this,{items:[D],buttons:[{text:"Use Selected",handler:function(){var F=A.action+"?plan_id="+Testopia.Util.getSelectedObjects(D,"plan_id");if(A.bug_id){F=F+"&bug="+A.bug_id}window.location=F}}]});D.on("render",function(){var F=D.getTopToolbar().items.items;for(var G=0;G<F.length;G++){F[G].destroy()}D.getTopToolbar().add("Product: ",C);D.getSelectionModel().un("rowselect",D.getSelectionModel().events.rowselect.listeners[0].fn);D.getSelectionModel().un("rowdeselect",D.getSelectionModel().events.rowdeselect.listeners[0].fn);D.store.load()})};Ext.extend(Testopia.Util.PlanSelector,Ext.Panel);Testopia.Util.DisableTools=function(D,B){if(typeof B!="object"){B=[]}for(var A in D.items.items){if(B.indexOf(D.items.items[A].id)!=-1){continue}try{D.items.items[A].disable()}catch(C){}}};Testopia.Attachment.Grid=function(A){function B(D){return'<a href="tr_attachment.cgi?attach_id='+D+'">'+D+"</a>"}this.object=A;this.store=new Ext.data.JsonStore({url:"tr_attachment.cgi",root:"attachment",listeners:{exception:Testopia.Util.loadError},baseParams:{ctype:"json",action:"list",object:this.object.type,object_id:this.object.id},id:"attach_id",fields:[{name:"attach_id",mapping:"attachment_id"},{name:"submitter",mapping:"submitter"},{name:"caserun_id",mapping:"caserun_id"},{name:"filename",mapping:"filename"},{name:"timestamp",mapping:"creation_ts"},{name:"mimetype",mapping:"mime_type"},{name:"description",mapping:"description"},{name:"isviewable",mapping:"isviewable"},{name:"canedit",mapping:"canedit"},{name:"candelete",mapping:"candelete"},{name:"size",mapping:"datasize"}]});var C=this.store;this.columns=[{id:"attach_id",header:"ID",width:20,sortable:true,dataIndex:"attach_id",renderer:B},{header:"Created",width:50,sortable:true,dataIndex:"timestamp",renderer:function(D,F,E){if(E.get("caserun_id")&&Ext.getCmp("caserun_grid")&&Ext.getCmp("caserun_grid").getSelectionModel().getSelected().get("caserun_id")==E.get("caserun_id")){return"<b>* "+D+"</b>"}else{return D}}},{header:"Name",width:50,editor:{xtype:"textfield"},sortable:true,dataIndex:"name"},{header:"Submitted by",width:50,sortable:true,dataIndex:"submitter"},{header:"Type",width:30,editor:{xtype:"textfield"},sortable:true,dataIndex:"mimetype"},{header:"Description",width:120,editor:{xtype:"textfield",value:"description"},sortable:true,dataIndex:"description"},{header:"Size",width:50,sortable:true,dataIndex:"size",renderer:function(D){if(D){return D+" Bytes"}}}];this.form=new Ext.form.BasicForm("testopia_helper_frm",{});Testopia.Attachment.Grid.superclass.constructor.call(this,{title:"Attachments",id:"attachments_panel",loadMask:{msg:"Loading attachments..."},autoExpandColumn:"Name",autoScroll:true,plugins:[new Ext.ux.grid.RowEditor({id:"attachment_row_editor",saveText:"Update"})],enableColumnHide:true,tbar:["->",{xtype:"button",id:"edit_attachment_btn",icon:"extensions/testopia/img/edit.png",iconCls:"img_button_16x",disabled:true,tooltip:"Edit Attachments",handler:function(){Testopia.Util.editFirstSelection(Ext.getCmp("attachments_panel"))}},{xtype:"button",id:"add_attachment_btn",icon:"extensions/testopia/img/add.png",iconCls:"img_button_16x",tooltip:"Attach a new file",handler:this.newAttachment.createDelegate(this)},{xtype:"button",id:"delete_attachment_btn",icon:"extensions/testopia/img/delete.png",iconCls:"img_button_16x",disabled:true,tooltip:"Remove selected attachments",handler:this.deleteAttachment.createDelegate(this)}],sm:new Ext.grid.RowSelectionModel({singleSelect:false,listeners:{rowselect:function(F,D,E){if(E.get("candelete")){Ext.getCmp("delete_attachment_btn").enable()}if(E.get("canedit")){Ext.getCmp("edit_attachment_btn").enable()}},rowdeselect:function(F,D,E){if(F.getCount()<1){Ext.getCmp("delete_attachment_btn").disable();Ext.getCmp("edit_attachment_btn").disable()}}}}),viewConfig:{forceFit:true}});this.on("rowcontextmenu",this.onContextClick,this);this.on("activate",this.onActivate,this);Ext.getCmp("attachment_row_editor").on("afteredit",this.onGridEdit,this)};Ext.extend(Testopia.Attachment.Grid,Ext.grid.GridPanel,{onContextClick:function(C,B,D){var E=this.selectionModel;var A=this.object;if(!this.menu){this.menu=new Ext.menu.Menu({id:"AttachGrid-ctx-menu",enableScrolling:false,items:[{text:"Delete Selected Attachments",id:"attach_delete_mnu",icon:"extensions/testopia/img/delete.png",iconCls:"img_button_16x",disabled:true,handler:this.deleteAttachment.createDelegate(this)},{text:"Reload List",handler:function(){C.store.reload()}}]})}D.stopEvent();if(C.getSelectionModel().getCount()<1){C.getSelectionModel().selectRow(B)}if(C.getSelectionModel().getSelected().get("candelete")){Ext.getCmp("attach_delete_mnu").enable()}else{Ext.getCmp("attach_delete_mnu").enable()}this.menu.showAt(D.getXY())},onGridEdit:function(C){var A=C.record.data;var B=this.store;A.ctype="json";A.action="edit";this.form.submit({url:"tr_attachment.cgi",params:A,success:function(E,D){B.commitChanges()},failure:function(E,D){Testopia.Util.error(E,D);B.rejectChanges()}})},newAttachment:function(){var A=new Testopia.Attachment.NewAttachmentPopup(this.object);A.window.show()},deleteAttachment:function(){object=this.object;Ext.Msg.show({title:"Confirm Delete?",msg:ATTACHMENT_DELETE_WARNING,buttons:Ext.Msg.YESNO,fn:function(B){if(B=="yes"){var A=new Ext.form.BasicForm("testopia_helper_frm");A.submit({url:"tr_attachment.cgi",params:{attach_ids:Testopia.Util.getSelectedObjects(Ext.getCmp("attachments_panel"),"id"),action:"remove",ctype:"json",object:object.type,object_id:object.id},success:function(){Ext.getCmp("attachments_panel").store.load()},failure:Testopia.Util.error})}},animEl:"delete_attachment_btn",icon:Ext.MessageBox.QUESTION})},onActivate:function(A){if(this.object.type=="caserun"){this.store.baseParams={ctype:"json",action:"list",object:"caserun",object_id:Ext.getCmp("caserun_grid").getSelectionModel().getSelected().get("caserun_id")};this.store.load()}if(!this.store.getCount()){this.store.load()}}});Testopia.Attachment.Form=function(){var A=1;Testopia.Attachment.Form.superclass.constructor.call(this,{title:"Attachments",id:"attachments_form",autoScroll:true,items:[{layout:"column",items:[{columnWidth:0.5,layout:"form",bodyStyle:"padding: 5px 5px 10px 10px",id:"attach_file_col",items:[{xtype:"field",fieldLabel:"Attachment",inputType:"file",name:"file1",width:300}]},{columnWidth:0.5,id:"attach_desc_col",bodyStyle:"padding: 5px 5px 10px 10px",layout:"form",items:[{xtype:"textfield",fieldLabel:"Description",name:"file_desc1",width:300}]}]}],buttons:[{text:"Attach Another",handler:function(){A++;if(A>4){Ext.Msg.show({msg:"You may only attach 4 files at a time",title:"Limit Exceeded",buttons:Ext.Msg.OK,icon:Ext.MessageBox.WARNING});return }Ext.getCmp("attach_file_col").add(new Ext.form.Field({fieldLabel:"Attachment",inputType:"file",name:"file"+A,width:300}));Ext.getCmp("attach_desc_col").add(new Ext.form.Field({fieldLabel:"Description",name:"file_desc"+A,width:300}));Ext.getCmp("attachments_form").doLayout()}}]});this.on("activate",this.onActivate,this)};Ext.extend(Testopia.Attachment.Form,Ext.Panel,{onActivate:function(){Ext.getCmp("attachments_form").doLayout()}});Testopia.Attachment.NewAttachmentPopup=function(A){if(!this.window){var B=new Ext.Window({id:"new_attachment_win",title:"Attach a file",closable:true,width:400,height:180,plain:true,shadow:false,closable:false,layout:"fit",items:[{xtype:"form",id:"new_attach_frm",fileUpload:true,bodyStyle:"padding: 10px",items:[{xtype:"textfield",id:"attach_desc",fieldLabel:"Description",name:"description",allowBlank:false},{xtype:"field",id:"attach_file",inputType:"file",fieldLabel:"File",name:"data",allowBlank:false}]}],buttons:[{text:"Submit",handler:function(){Ext.getCmp("new_attach_frm").getForm().submit({url:"tr_attachment.cgi",params:{action:"add",object:A.type,object_id:A.id,ctype:"json"},success:function(){Ext.getCmp("attachments_panel").store.load();Ext.getCmp("new_attachment_win").close()},failure:Testopia.Util.error})}},{text:"Cancel",handler:function(){Ext.getCmp("new_attachment_win").close()}}]});this.window=B}return this};Testopia.TestPlan.Store=function(A,B){A.ctype="json";Testopia.TestPlan.Store.superclass.constructor.call(this,{url:"tr_list_plans.cgi",listeners:{exception:Testopia.Util.loadError},baseParams:A,totalProperty:"totalResultsAvailable",root:"Result",autoLoad:B,id:"plan_id",fields:[{name:"plan_id",mapping:"plan_id"},{name:"name",mapping:"name"},{name:"author",mapping:"author_name"},{name:"creation_date",mapping:"creation_date"},{name:"product",mapping:"product_name"},{name:"product_id",mapping:"product_id"},{name:"prod_version",mapping:"default_product_version"},{name:"type",mapping:"plan_type"},{name:"case_count",mapping:"case_count"},{name:"run_count",mapping:"run_count"}],remoteSort:true});this.paramNames.sort="order"};Ext.extend(Testopia.TestPlan.Store,Ext.data.JsonStore);Testopia.TestPlan.TypesStore=function(A){Testopia.TestPlan.TypesStore.superclass.constructor.call(this,{url:"tr_quicksearch.cgi",root:"types",listeners:{exception:Testopia.Util.loadError},baseParams:{action:"getplantypes"},autoLoad:A,id:"id",fields:[{name:"id",mapping:"id"},{name:"name",mapping:"name"}]})};Ext.extend(Testopia.TestPlan.TypesStore,Ext.data.JsonStore);Testopia.TestPlan.TypesCombo=function(A){Testopia.TestPlan.TypesCombo.superclass.constructor.call(this,{id:A.id||"plan_type_combo",store:A.transform?false:new Testopia.TestPlan.TypesStore(A.mode=="local"?true:false),loadingText:"Looking up types...",displayField:"name",valueField:"id",typeAhead:true,triggerAction:"all",minListWidth:300,forceSelection:true,transform:A.transform,emptyText:"Please select..."});Ext.apply(this,A);this.store.on("load",function(){if(A.value){this.setValue(A.value)}},this)};Ext.extend(Testopia.TestPlan.TypesCombo,Ext.form.ComboBox);Testopia.TestPlan.Import=function(B){var A=new Ext.Window({id:"plan_import_win",closable:true,width:450,height:150,plain:true,shadow:false,layout:"fit",items:[{xtype:"form",height:250,url:"tr_importer.cgi",id:"importform",baseParams:{action:"upload",ctype:"json",plan_id:B.plan_id,product_id:B.product_id},fileUpload:true,items:[{height:50,style:"padding: 5px",border:false,html:B.product_id?PRODUCT_PLAN_IMPORT:PLAN_CASES_IMPORT},{xtype:"field",fieldLabel:"Upload File",labelStyle:"padding: 5px",inputType:"file",name:"data",width:300}],buttons:[{text:"Submit",handler:function(){Ext.getCmp("importform").getForm().submit({success:function(){if(B.product_id){Ext.getCmp("object_panel").activate("product_plan_grid");Ext.getCmp("product_plan_grid").store.load()}else{Ext.getCmp("object_panel").activate("plan_case_grid");Ext.getCmp("plan_case_grid").store.load()}Ext.getCmp("plan_import_win").close()},failure:Testopia.Util.error})}}]}]});A.show(this)};Testopia.TestPlan.Grid=function(D,A){D.limit=Ext.state.Manager.get("TESTOPIA_DEFAULT_PAGE_SIZE",25);D.current_tab="plan";this.params=D;var C=new Testopia.Product.VersionCombo({id:"plan_grid_version_chooser",hiddenName:"prod_version",mode:"remote",params:{product_id:D.product_id},listeners:{startedit:function(){var E=Ext.getCmp(A.id||"plan_grid").getSelectionModel().getSelected().get("product_id");if(C.store.baseParams.product_id!=E){C.store.baseParams.product_id=E;C.store.load()}}}});this.store=new Testopia.TestPlan.Store(D);var B=this.store;this.columns=[{header:"ID",width:30,dataIndex:"plan_id",sortable:true,renderer:Testopia.Util.makeLink.createDelegate(this,["plan"],true),hideable:false},{header:"Name",width:220,dataIndex:"name",id:"plan_name",sortable:true,editor:{xtype:"textfield",allowBlank:false}},{header:"Author",width:150,sortable:true,dataIndex:"author"},{header:"Created",width:110,sortable:true,dataIndex:"creation_date",hidden:true},{header:"Product",width:180,sortable:true,dataIndex:"product",hidden:true},{header:"Product Version",width:60,sortable:true,dataIndex:"prod_version",editor:C,renderer:Testopia.Util.ComboRenderer.createDelegate(this)},{header:"Type",width:60,sortable:true,dataIndex:"type",editor:new Testopia.TestPlan.TypesCombo({id:"plan_grid_ types_chooser",hiddenName:"type",mode:"remote"}),renderer:Testopia.Util.ComboRenderer.createDelegate(this)},{header:"Cases",width:20,sortable:false,dataIndex:"case_count"},{header:"Runs",width:20,sortable:false,dataIndex:"run_count"}];this.form=new Ext.form.BasicForm("testopia_helper_frm",{});this.bbar=new Testopia.Util.PagingBar("plan",this.store);Testopia.TestPlan.Grid.superclass.constructor.call(this,{title:"Test Plans",id:A.id||"plan_grid",layout:"fit",region:"center",stripeRows:true,loadMask:{msg:"Loading Test Plans..."},autoExpandColumn:"plan_name",autoScroll:true,plugins:[new Ext.ux.grid.RowEditor({id:"plan_row_editor",saveText:"Update"})],sm:new Ext.grid.RowSelectionModel({singleSelect:A.single||false,listeners:{rowselect:function(G,E,F){if(Ext.getCmp("plan_add_run_mnu")){Ext.getCmp("plan_add_run_mnu").enable()}if(Ext.getCmp("plan_add_case_mnu")){Ext.getCmp("plan_add_case_mnu").enable()}if(Ext.getCmp("plan_grid_edit_mnu")){Ext.getCmp("plan_grid_edit_mnu").enable()}Ext.getCmp("new_run_button").enable();Ext.getCmp("new_case_button").enable();Ext.getCmp("edit_plan_list_btn").enable();if(G.getCount()>1){if(Ext.getCmp("plan_add_run_mnu")){Ext.getCmp("plan_add_run_mnu").disable()}Ext.getCmp("new_run_button").disable()}},rowdeselect:function(G,E,F){if(G.getCount()<1){Ext.getCmp("new_run_button").disable();Ext.getCmp("new_case_button").disable();Ext.getCmp("edit_plan_list_btn").disable()}}}}),enableColumnHide:true,tbar:[{xtype:"button",text:"New Run",id:"new_run_button",disabled:true,handler:this.newRun.createDelegate(this)},{xtype:"button",text:"New Case",id:"new_case_button",disabled:true,handler:this.newCase.createDelegate(this)},new Ext.Toolbar.Fill(),{xtype:"button",id:"save_plan_list_btn",icon:"extensions/testopia/img/save.png",iconCls:"img_button_16x",tooltip:"Save this search",handler:function(E,F){Testopia.Search.save("plan",Ext.getCmp(A.id||"plan_grid").store.baseParams)}},{xtype:"button",id:"link_plan_list_btn",icon:"extensions/testopia/img/link.png",iconCls:"img_button_16x",tooltip:"Create a link to this list",handler:function(E,F){Testopia.Search.LinkPopup(Ext.getCmp(A.id||"plan_grid").store.baseParams)}},{xtype:"button",id:"edit_plan_list_btn",icon:"extensions/testopia/img/edit.png",iconCls:"img_button_16x",disabled:true,tooltip:"Edit Selected Test Plan",handler:function(){Testopia.Util.editFirstSelection(Ext.getCmp(A.id||"plan_grid"))}},{xtype:"button",id:"new_plan_list_btn",icon:"extensions/testopia/img/new.png",iconCls:"img_button_16x",tooltip:"Create a New Test Plan",handler:function(){Testopia.TestPlan.NewPlanPopup(D.product_id)}}],viewConfig:{forceFit:true}});Ext.apply(this,A);this.on("rowcontextmenu",this.onContextClick,this);this.on("activate",this.onActivate,this);Ext.getCmp("plan_row_editor").on("afteredit",this.onGridEdit,this)};Ext.extend(Testopia.TestPlan.Grid,Ext.grid.GridPanel,{onContextClick:function(B,A,C){B.selindex=A;if(!this.menu){this.menu=new Ext.menu.Menu({id:"plan-ctx-menu",enableScrolling:false,items:[{text:"Create a New Test Plan",id:"plan_menu_new_plan",icon:"extensions/testopia/img/new.png",iconCls:"img_button_16x",handler:this.newPlan.createDelegate(this)},{text:"Add a New Test Run to Selected Plan",id:"plan_add_run_mnu",handler:this.newRun.createDelegate(this)},{text:"Add a New Test Case to Selected Plans",id:"plan_add_case_mnu",handler:this.newCase.createDelegate(this)},{text:"Edit",id:"plan_grid_edit_mnu",menu:{enableScrolling:false,items:[{text:"Type",handler:function(){var D=new Ext.Window({title:"Change Plan Type",id:"plan_type_win",layout:"fit",split:true,plain:true,shadow:false,listeners:{afterlayout:function(){Ext.getCmp("plan_type_win_types_combo").focus("",10)}},width:350,height:150,items:[new Ext.FormPanel({labelWidth:"40",bodyStyle:"padding: 5px",items:[new Testopia.TestPlan.TypesCombo({id:"plan_type_win_types_combo",fieldLabel:"Plan Type"})]})],buttons:[{text:"Update Type",handler:function(){var E={plan_type:Ext.getCmp("plan_type_combo").getValue(),ids:Testopia.Util.getSelectedObjects(B,"plan_id")};Testopia.Util.updateFromList("plan",E,B);D.close()}},{text:"Cancel",handler:function(){D.close()}}]});D.show()}},{text:"Tags",handler:function(){Testopia.Tags.update("plan",B)}}]}},{text:"Reports",menu:{enableScrolling:false,items:[{text:"New Status Report",handler:function(){Ext.getCmp("object_panel").setActiveTab("dashboardpanel");var D=new Ext.ux.Portlet({title:"Status Report",closable:true,autoScroll:true,tools:PortalTools});D.url="tr_run_reports.cgi?type=status&plan_ids="+Testopia.Util.getSelectedObjects(B,"plan_id");Testopia.Search.dashboard_urls.push(D.url);Ext.getCmp("dashboard_leftcol").add(D);Ext.getCmp("dashboard_leftcol").doLayout();D.load({url:D.url})}},{text:"New Completion Report",handler:function(){Ext.getCmp("object_panel").setActiveTab("dashboardpanel");var D=new Ext.ux.Portlet({title:"Completion Report",closable:true,autoScroll:true,tools:PortalTools});D.url="tr_run_reports.cgi?type=completion&plan_ids="+Testopia.Util.getSelectedObjects(B,"plan_id");Testopia.Search.dashboard_urls.push(D.url);Ext.getCmp("dashboard_leftcol").add(D);Ext.getCmp("dashboard_leftcol").doLayout();D.load({url:D.url})}},{text:"New Run Execution Report",handler:function(){var D=new Ext.Window({title:"Select a date range",id:"plan_execution_win",layout:"fit",split:true,plain:true,shadow:false,width:350,height:150,items:[new Ext.FormPanel({labelWidth:"40",bodyStyle:"padding: 5px",items:[{xtype:"datefield",id:"execution_start_date",fieldLabel:"Start Date",name:"chfieldfrom"},{xtype:"datefield",fieldLabel:"Stop Date",id:"execution_stop_date",emptyText:"Now",name:"chfieldto"}]})],buttons:[{text:"Submit",handler:function(){Ext.getCmp("object_panel").setActiveTab("dashboardpanel");var E=new Ext.ux.Portlet({title:"Execution Report",closable:true,autoScroll:true,tools:PortalTools});E.url="tr_run_reports.cgi?type=execution&plan_ids="+Testopia.Util.getSelectedObjects(B,"plan_id")+"&chfieldfrom="+Ext.getCmp("execution_start_date").getValue()+"&chfieldto="+Ext.getCmp("execution_stop_date").getValue();Testopia.Search.dashboard_urls.push(E.url);Ext.getCmp("dashboard_leftcol").add(E);Ext.getCmp("dashboard_leftcol").doLayout();E.load({url:E.url});D.close()}},{text:"Cancel",handler:function(){D.close()}}]});D.show()}},{text:"New Priority Breakdown Report",handler:function(){Ext.getCmp("object_panel").setActiveTab("dashboardpanel");var D=new Ext.ux.Portlet({title:"Status Report",closable:true,autoScroll:true,tools:PortalTools});D.url="tr_run_reports.cgi?type=priority&plan_ids="+Testopia.Util.getSelectedObjects(B,"plan_id");Testopia.Search.dashboard_urls.push(D.url);Ext.getCmp("dashboard_leftcol").add(D);Ext.getCmp("dashboard_leftcol").doLayout();D.load({url:D.url})}},{text:"New Bug Report",handler:function(){Ext.getCmp("object_panel").setActiveTab("dashboardpanel");var D=new Ext.ux.Portlet({title:"Bug Report",closable:true,autoScroll:true,tools:PortalTools});D.url="tr_run_reports.cgi?type=bug_grid&plan_ids="+Testopia.Util.getSelectedObjects(B,"plan_id")+"&noheader=1";Testopia.Search.dashboard_urls.push(D.url);Ext.getCmp("dashboard_leftcol").add(D);Ext.getCmp("dashboard_leftcol").doLayout();D.load({scripts:true,url:D.url})}},{text:"Missing Cases Report",handler:function(){window.open("tr_list_cases.cgi?report_type=missing&plan_ids="+Testopia.Util.getSelectedObjects(B,"plan_id"))}}]}},{text:"Refresh List",icon:"extensions/testopia/img/refresh.png",iconCls:"img_button_16x",handler:function(){B.store.reload()}},{text:"View Test Plan(s) in a New Tab",handler:function(){var E=Testopia.Util.getSelectedObjects(B,"plan_id").split(",");var D;for(D=0;D<E.length;D+=1){window.open("tr_show_plan.cgi?plan_id="+E[D])}}},{text:"Export",menu:[{text:"Test Results as CSV",handler:function(){window.location="tr_list_caseruns.cgi?ctype=csv&viewall=1&plan_id="+Testopia.Util.getSelectedObjects(B,"plan_id")}},{text:"Cases as CSV",handler:function(){window.location="tr_list_cases.cgi?ctype=csv&viewall=1&plan_id="+Testopia.Util.getSelectedObjects(B,"plan_id")}},{text:"Plans as XML",handler:function(){window.location="tr_list_plans.cgi?ctype=xml&viewall=1&plan_id="+Testopia.Util.getSelectedObjects(B,"plan_id")}}]}]})}C.stopEvent();if(B.getSelectionModel().getCount()<1){B.getSelectionModel().selectRow(A)}this.menu.showAt(C.getXY())},newPlan:function(){Testopia.TestPlan.NewPlanPopup(this.params.product_id)},newRun:function(){Testopia.TestRun.NewRunPopup(this.getSelectionModel().getSelected())},newCase:function(){Testopia.TestCase.NewCasePopup(Testopia.Util.getSelectedObjects(this,"plan_id"),this.getSelectionModel().getSelected().get("product_id"))},onGridEdit:function(C){var B=this.store;var A=C.record.data;A.action="edit";this.form.submit({url:"tr_process_plan.cgi",params:A,success:function(E,D){B.commitChanges()},failure:function(E,D){Testopia.Util.error(E,D);B.rejectChanges()}})},onActivate:function(A){if(!this.store.getCount()){this.store.load()}}});Testopia.TestPlan.NewPlanForm=function(C){var A=new Testopia.Product.VersionCombo({id:"new_plan_form_version_chooser",hiddenName:"prod_version",fieldLabel:"<b>Product Version</b>",mode:"local",params:{product_id:C}});var B=new Testopia.Product.Combo({id:"new_plan_form_product_chooser",hiddenName:"product_id",fieldLabel:"<b>Product</b>",mode:"local",value:C});B.on("select",function(F,E,D){A.reset();A.store.baseParams.product_id=E.get("id");A.store.load();A.enable()});Testopia.TestPlan.NewPlanForm.superclass.constructor.call(this,{url:"tr_new_plan.cgi",id:"new_plan_form",baseParams:{action:"add"},fileUpload:true,labelAlign:"top",frame:true,title:"New Plan",bodyStyle:"padding:5px 5px 0",width:800,height:500,items:[{layout:"column",items:[{columnWidth:0.5,layout:"form",items:[{xtype:"textfield",fieldLabel:"<b>Plan Name</b>",id:"new_plan_name",name:"plan_name",anchor:"95%",allowBlank:false},new Testopia.TestPlan.TypesCombo({id:"new_plan_form_types_chooser",mode:"local",hiddenName:"type",fieldLabel:"<b>Plan Type</b>"})]},{columnWidth:0.5,layout:"form",items:[B,A]}]},{xtype:"tabpanel",height:280,activeItem:0,items:[{layout:"fit",title:"Plan Document",items:[{id:"plan_doc",xtype:"htmleditor",name:"plandoc"}]},new Testopia.Attachment.Form()]}],buttons:[{text:"Submit",handler:function(){if(!Ext.getCmp("new_plan_form").getForm().isValid()){return }Ext.getCmp("new_plan_form").getForm().submit({success:function(E,F){if(F.result.err){alert("One or more attachments were either too large or were empty. These have been ignored.")}Ext.Msg.show({title:"Plan Created",msg:"Plan "+F.result.plan+" Created. Would you like to go there now?",buttons:Ext.Msg.YESNO,icon:Ext.MessageBox.QUESTION,fn:function(G){if(G=="yes"){window.location="tr_show_plan.cgi?plan_id="+F.result.plan}}});try{Ext.getCmp("newplan-win").close()}catch(D){}},failure:Testopia.Util.error})}},{text:"Cancel",handler:function(){if(Ext.getCmp("newplan-win")){Ext.getCmp("newplan-win").close()}else{window.location="tr_show_product.cgi"}}}]})};Ext.extend(Testopia.TestPlan.NewPlanForm,Ext.form.FormPanel);Testopia.TestPlan.NewPlanPopup=function(A){var B=new Ext.Window({id:"newplan-win",closable:true,width:800,height:550,plain:true,shadow:false,layout:"fit",items:[new Testopia.TestPlan.NewPlanForm(A)]});B.show(this)};Testopia.TestPlan.ClonePanel=function(E){var B=new Testopia.Product.Combo({id:"plan_clone_product_chooser",hiddenName:"product_id",fieldLabel:"Copy To Product",mode:"local",width:550,value:E.product_id});var C=new Testopia.Product.VersionCombo({id:"plan_clone_version_chooser",hiddenName:"prod_version",fieldLabel:"Product Version",params:{product_id:E.product_id},allowBlank:false});var F=new Testopia.Build.Combo({fieldLabel:"Select a Build",id:"plan_clone_build_chooser",mode:"local",hiddenName:"new_run_build",params:{product_id:E.product_id,activeonly:1}});var A=new Testopia.Environment.Combo({fieldLabel:"Select an Environment",id:"plan_clone_environment_chooser",mode:"local",hiddenName:"new_run_env",params:{product_id:E.product_id,isactive:1}});B.on("select",function(I,H,G){C.reset();C.store.baseParams.product_id=H.id;Ext.getCmp("plan_clone_build_chooser").store.baseParams.product_id=H.id;Ext.getCmp("plan_clone_environment_chooser").store.baseParams.product_id=H.id;Ext.getCmp("plan_clone_build_chooser").store.load();Ext.getCmp("plan_clone_environment_chooser").store.load();if(H.id==E.product_id){Ext.getCmp("copy_categories").disable()}else{Ext.getCmp("copy_categories").enable()}C.store.load();C.enable()});function D(){var G=this.getForm();var H=G.getValues();if(G.isValid()){G.submit({success:function(J,I){Ext.Msg.show({title:"Plan Copied",msg:"Plan "+I.result.plan_id+" Created. Would you like to go there now?",buttons:Ext.Msg.YESNO,icon:Ext.MessageBox.QUESTION,fn:function(K){if(K=="yes"){window.location="tr_show_plan.cgi?plan_id="+I.result.plan_id}}})},failure:Testopia.Util.error})}}Testopia.TestPlan.ClonePanel.superclass.constructor.call(this,{id:"plan_clone_panel",url:"tr_process_plan.cgi",baseParams:{action:"clone"},bodyStyle:"padding: 10px",border:false,autoScroll:true,width:600,items:[{layout:"table",border:false,layoutConfig:{columns:2,width:"100%"},items:[{colspan:2,layout:"form",border:false,items:[{id:"plan_clone_name",xtype:"textfield",fieldLabel:"<b>New Plan Name</b>",name:"plan_name",allowBlank:false,width:550},B,C]},{layout:"form",border:false,items:[{xtype:"checkbox",name:"copy_attachments",checked:false,boxLabel:"Copy Plan Attachments",hideLabel:true},{xtype:"checkbox",name:"copy_doc",checked:true,boxLabel:"Copy Plan Document",hideLabel:true},{xtype:"hidden",name:"plan_id",value:E.plan_id}]},{layout:"form",border:false,items:[{xtype:"checkbox",name:"copy_tags",checked:true,boxLabel:"Copy Plan Tags",hideLabel:true},{xtype:"checkbox",name:"copy_perms",checked:true,boxLabel:"Copy Plan Permissions",hideLabel:true}]},{layout:"form",border:false,colspan:2,items:[{xtype:"checkbox",name:"keep_plan_author",checked:false,boxLabel:"Maintain original author (unchecking will make me the author of the new plan)",hideLabel:true},{xtype:"fieldset",autoHeight:true,checkboxToggle:true,checkboxName:"copy_cases",id:"copy_cases",title:"Copy Test Cases",collapsed:true,items:[{xtype:"checkbox",id:"case_copy_plan_ids",name:"make_copy",boxLabel:"Create a copy (Unchecking will create a link to selected plans)",hideLabel:true,listeners:{check:function(H,G){if(G===true){Ext.getCmp("copy_cases_keep_author").enable();Ext.getCmp("copy_cases_keep_tester").enable();Ext.getCmp("copy_run_cases_cbox").disable()}else{Ext.getCmp("copy_cases_keep_author").disable();Ext.getCmp("copy_cases_keep_tester").disable();Ext.getCmp("copy_run_cases_cbox").enable()}}}},{xtype:"checkbox",name:"keep_case_authors",id:"copy_cases_keep_author",checked:false,disabled:true,boxLabel:"Maintain original authors (unchecking will make me the author of the copied cases)",hideLabel:true},{xtype:"checkbox",id:"copy_cases_keep_tester",boxLabel:"Keep Default Tester (unchecking will make you the default tester of copied cases)",hideLabel:true,name:"keep_tester",checked:true},{xtype:"checkbox",name:"copy_categories",id:"copy_categories",checked:false,disabled:true,boxLabel:"Copy Categories to new product (unchecking will place copied cases in the default category for the selected product)",hideLabel:true}]},{xtype:"fieldset",autoHeight:true,checkboxToggle:true,checkboxName:"copy_runs",id:"copy_runs",title:"Copy Test Runs",collapsed:true,items:[{xtype:"checkbox",name:"keep_run_managers",checked:false,boxLabel:"Maintain managers (unchecking will make me the manager of the new runs)",hideLabel:true},{xtype:"checkbox",name:"copy_run_tags",checked:true,boxLabel:"Copy tags from the old run to the new run",hideLabel:true},{xtype:"checkbox",name:"copy_run_cases",id:"copy_run_cases_cbox",checked:true,boxLabel:"Link cases in copied run to original test cases (unchecking will produce an empty test run)",hideLabel:true},F,A]}]}]}],buttons:[{text:"Submit",handler:D.createDelegate(this)},{text:"Cancel",handler:function(){Ext.getCmp("plan-clone-win").close()}}]})};Ext.extend(Testopia.TestPlan.ClonePanel,Ext.form.FormPanel);Testopia.TestPlan.ClonePopup=function(B){var A=new Ext.Window({id:"plan-clone-win",closable:true,width:750,title:"Create a Copy of Plan "+B.plan_id,height:500,plain:true,shadow:false,closable:true,layout:"fit",items:[new Testopia.TestPlan.ClonePanel(B)]});A.show()};Testopia.TestCase.Store=function(A,B){Testopia.TestCase.Store.superclass.constructor.call(this,{url:"tr_list_cases.cgi",baseParams:A,listeners:{exception:Testopia.Util.loadError},totalProperty:"totalResultsAvailable",root:"Result",autoLoad:B,id:"case_id",fields:[{name:"case_id",mapping:"case_id"},{name:"plan_id",mapping:"plan_id"},{name:"alias",mapping:"alias"},{name:"case_summary",mapping:"summary"},{name:"author",mapping:"author_name"},{name:"tester",mapping:"default_tester"},{name:"creation_date",mapping:"creation_date"},{name:"category",mapping:"category_name"},{name:"priority",mapping:"priority"},{name:"status",mapping:"status"},{name:"run_count",mapping:"run_count"},{name:"requirement",mapping:"requirement"},{name:"isautomated",mapping:"isautomated"}],remoteSort:true})};Ext.extend(Testopia.TestCase.Store,Ext.data.JsonStore);Testopia.TestCase.StatusListStore=function(A){Testopia.TestCase.StatusListStore.superclass.constructor.call(this,{url:"tr_quicksearch.cgi",root:"statuses",listeners:{exception:Testopia.Util.loadError},baseParams:{action:"getcasestatus"},autoLoad:A,id:"id",fields:[{name:"id",mapping:"id"},{name:"name",mapping:"name"}]})};Ext.extend(Testopia.TestCase.StatusListStore,Ext.data.JsonStore);Testopia.TestCase.ComponentStore=function(A,B){A.action="getcomponents";Testopia.TestCase.ComponentStore.superclass.constructor.call(this,{url:"tr_quicksearch.cgi",root:"components",baseParams:A,listeners:{exception:Testopia.Util.loadError},autoLoad:B,id:"id",fields:[{name:"id",mapping:"id"},{name:"name",mapping:"name"},{name:"qa",mapping:"qa_contact"},{name:"product",mapping:"product"}]})};Ext.extend(Testopia.TestCase.ComponentStore,Ext.data.JsonStore);Testopia.TestCase.PriorityStore=function(A){Testopia.TestCase.PriorityStore.superclass.constructor.call(this,{url:"tr_quicksearch.cgi",root:"priorities",listeners:{exception:Testopia.Util.loadError},baseParams:{action:"getpriorities"},autoLoad:A,id:"id",fields:[{name:"id",mapping:"id"},{name:"name",mapping:"name"}]})};Ext.extend(Testopia.TestCase.PriorityStore,Ext.data.JsonStore);Testopia.TestCase.StatusListCombo=function(A){Testopia.TestCase.StatusListCombo.superclass.constructor.call(this,{id:A.id||"case_status_combo",store:A.transform?false:new Testopia.TestCase.StatusListStore(A.mode=="local"?true:false),loadingText:"Looking up statuses...",displayField:"name",valueField:"id",typeAhead:true,triggerAction:"all",minListWidth:100,forceSelection:true,transform:A.transform,emptyText:"Please select..."});Ext.apply(this,A);this.store.on("load",function(){if(A.value){this.setValue(A.value)}},this)};Ext.extend(Testopia.TestCase.StatusListCombo,Ext.form.ComboBox);Testopia.TestCase.ComponentCombo=function(A){Testopia.TestCase.ComponentCombo.superclass.constructor.call(this,{id:A.id||"component_combo",store:A.transform?false:new Testopia.TestCase.ComponentStore(A.params,A.mode=="local"?true:false),loadingText:"Looking up Components...",displayField:"name",valueField:"id",editable:true,triggerAction:"all",minListWidth:300,forceSelection:true,transform:A.transform,emptyText:"Please select..."});Ext.apply(this,A);this.store.on("load",function(){if(A.value){this.setValue(A.value)}},this)};Ext.extend(Testopia.TestCase.ComponentCombo,Ext.form.ComboBox);Testopia.TestCase.PriorityCombo=function(A){Testopia.TestCase.PriorityCombo.superclass.constructor.call(this,{id:A.id||"priority_combo",store:A.transform?false:new Testopia.TestCase.PriorityStore(A.mode=="local"?true:false),loadingText:"Looking up priorities...",displayField:"name",valueField:"id",typeAhead:true,triggerAction:"all",minListWidth:100,forceSelection:true,transform:A.transform,emptyText:"Please select..."});Ext.apply(this,A);this.store.on("load",function(){if(A.value){this.setValue(A.value)}},this)};Ext.extend(Testopia.TestCase.PriorityCombo,Ext.form.ComboBox);Testopia.TestCase.Panel=function(D,A){var B=new Testopia.TestCase.Grid(D,A);var C=new Testopia.TestCase.Filter();this.cgrid=B;this.store=B.store;this.params=D;Testopia.TestCase.Panel.superclass.constructor.call(this,{title:"Test Cases",layout:"border",id:"case-panel",items:[C,B]});this.on("activate",this.onActivate,this)};Ext.extend(Testopia.TestCase.Panel,Ext.Panel,{onActivate:function(A){if(!this.store.getCount()){this.store.load({params:this.params})}}});Testopia.TestCase.Filter=function(){this.form=new Ext.form.BasicForm("testopia_helper_frm",{});Testopia.TestCase.Filter.superclass.constructor.call(this,{title:"Search for Test Cases",region:"north",layout:"fit",frame:true,collapsible:true,height:120,items:[{buttons:[{text:"Search",handler:function(){Ext.getCmp("case_search").getForm().submit()}}]}]})};Ext.extend(Testopia.TestCase.Filter,Ext.Panel);Testopia.TestCase.Grid=function(D,B){D.limit=Ext.state.Manager.get("TESTOPIA_DEFAULT_PAGE_SIZE",25);D.current_tab="case";this.params=D;var A=new Testopia.Category.Combo({id:"case_grid_cateogy_chooser",hiddenName:"category",mode:"remote",params:{product_id:D.product_id},listeners:{startedit:function(){var E=Ext.getCmp(B.id||"case_grid").getSelectionModel().getSelected().get("product_id");if(A.store.baseParams.product_id!=E){A.store.baseParams.product_id=E;A.store.load()}}}});this.store=new Ext.data.GroupingStore({url:"tr_list_cases.cgi",baseParams:D,reader:new Ext.data.JsonReader({totalProperty:"totalResultsAvailable",root:"Result",id:"case_id",fields:[{name:"case_id",mapping:"case_id"},{name:"sortkey",mapping:"sortkey"},{name:"plan_id",mapping:"plan_id"},{name:"alias",mapping:"alias"},{name:"summary",mapping:"summary"},{name:"author",mapping:"author_name"},{name:"tester",mapping:"default_tester"},{name:"creation_date",mapping:"creation_date"},{name:"category",mapping:"category_name"},{name:"priority",mapping:"priority"},{name:"status",mapping:"status"},{name:"run_count",mapping:"run_count"},{name:"requirement",mapping:"requirement"},{name:"product_id",mapping:"product_id"},{name:"component",mapping:"component"},{name:"modified",mapping:"modified"},{name:"isautomated",mapping:"isautomated"},{name:"plan_name",mapping:"plan_name"},{name:"average_time",mapping:"average_time"},{name:"estimated_time",mapping:"estimated_time"}]}),listeners:{exception:Testopia.Util.loadError},remoteSort:true,sortInfo:{field:"case_id",direction:"ASC"},groupField:D.plan_id?"":"plan_id"});var C=this.store;C.paramNames.sort="order";C.on("beforeload",function(E,F){E.baseParams.ctype="json"});this.columns=[{header:"ID",width:50,dataIndex:"case_id",sortable:true,groupRenderer:function(E){return E},renderer:Testopia.Util.makeLink.createDelegate(this,["case"],true),hideable:false},{header:"Sort Key",width:50,sortable:true,dataIndex:"sortkey",editor:{xtype:"numberfield",allowBlank:true,allowDecimals:false,allowNegative:false},id:"sortkey"},{header:"Summary",width:220,dataIndex:"summary",id:"case_summary",sortable:true,editor:{xtype:"textfield",allowBlank:false}},{header:"Author",width:150,sortable:true,dataIndex:"author",hidden:true},{header:"Default Tester",width:150,sortable:true,dataIndex:"tester",editor:new Testopia.User.Lookup({hiddenName:"tester"}),renderer:Testopia.Util.ComboRenderer.createDelegate(this)},{header:"Created",width:110,sortable:true,dataIndex:"creation_date",hidden:true},{header:"Last Modified",width:110,sortable:true,dataIndex:"modified",hidden:true},{header:"Priority",width:100,sortable:true,dataIndex:"priority",editor:new Testopia.TestCase.PriorityCombo({hiddenName:"priority",mode:"remote"}),renderer:Testopia.Util.ComboRenderer.createDelegate(this)},{header:"Category",width:100,sortable:true,dataIndex:"category",editor:A,renderer:Testopia.Util.ComboRenderer.createDelegate(this)},{header:"Component",width:110,sortable:true,dataIndex:"component"},{header:"Status",width:100,sortable:true,dataIndex:"status",editor:new Testopia.TestCase.StatusListCombo("status"),renderer:Testopia.Util.ComboRenderer.createDelegate(this)},{header:"Requirement",width:40,sortable:true,dataIndex:"requirement",hidden:true,editor:{xtype:"textfield",name:"requirement"}},{header:"Estimated Time",width:60,sortable:true,dataIndex:"estimated_time",editor:{xtype:"textfield"},hidden:true},{header:"Average Time",width:60,sortable:false,dataIndex:"average_time",hidden:true},{header:"Plan",width:40,sortable:true,dataIndex:"plan_id",hidden:true,renderer:Testopia.Util.makeLink.createDelegate(this,["plan"],true),groupRenderer:function(E,F,G){return E+': "'+G.get("plan_name")+'"'}},{header:"Run Count",width:40,sortable:false,dataIndex:"run_count",hidden:true}];this.view=new Ext.grid.GroupingView({forceFit:true,groupTextTpl:'{text} ({[values.rs.length]} {[values.rs.length > 1 ? "Items" : "Item"]})'});this.form=new Ext.form.BasicForm("testopia_helper_frm",{});this.bbar=new Testopia.Util.PagingBar("case",this.store);Testopia.TestCase.Grid.superclass.constructor.call(this,{title:"Test Cases",id:B.id||"case_grid",loadMask:{msg:"Loading Test Cases..."},layout:"fit",stripeRows:true,region:"center",autoExpandColumn:"case_summary",autoScroll:true,plugins:[new Ext.ux.grid.RowEditor({id:"case_row_editor",saveText:"Update"})],sm:new Ext.grid.RowSelectionModel({singleSelect:false,listeners:{rowselect:function(G,E,F){if(Ext.getCmp("delete_case_list_btn")){Ext.getCmp("delete_case_list_btn").enable();Ext.getCmp("edit_case_list_btn").enable()}},rowdeselect:function(G,E,F){if(G.getCount()<1){if(Ext.getCmp("delete_case_list_btn")){Ext.getCmp("delete_case_list_btn").disable();Ext.getCmp("edit_case_list_btn").disable()}}}}}),viewConfig:{forceFit:true},tbar:[new Ext.Toolbar.Fill(),{xtype:"button",id:"case_grid_tocsv",icon:"extensions/testopia/img/csv.png",iconCls:"img_button_16x",tooltip:"Export Test Cases to CSV",handler:function(){window.location="tr_list_cases.cgi?ctype=csv&viewall=1&"+Testopia.Util.JSONToURLQuery(Ext.getCmp(B.id||"case_grid").store.baseParams,"",["viewall","ctype"])}},{xtype:"button",id:"case_grid_toxml",icon:"extensions/testopia/img/xml.png",iconCls:"img_button_16x",tooltip:"Export Test Cases to XML",handler:function(){window.location="tr_list_cases.cgi?ctype=xml&viewall=1&"+Testopia.Util.JSONToURLQuery(Ext.getCmp(B.id||"case_grid").store.baseParams,"",["viewall","ctype"])}},{xtype:"button",id:"save_case_list_btn",icon:"extensions/testopia/img/save.png",iconCls:"img_button_16x",tooltip:"Save this search",handler:function(E,F){Testopia.Search.save("case",Ext.getCmp(B.id||"case_grid").store.baseParams)}},{xtype:"button",id:"link_case_list_btn",icon:"extensions/testopia/img/link.png",iconCls:"img_button_16x",tooltip:"Create a link to this list",handler:function(E,F){Testopia.Search.LinkPopup(Ext.getCmp(B.id||"case_grid").store.baseParams)}},{xtype:"button",id:"edit_case_list_btn",icon:"extensions/testopia/img/edit.png",disabled:true,iconCls:"img_button_16x",tooltip:"Edit Selected Test Case",handler:function(){Testopia.Util.editFirstSelection(Ext.getCmp(B.id||"case_grid"))}},{xtype:"button",id:"add_case_list_btn",icon:"extensions/testopia/img/new.png",iconCls:"img_button_16x",tooltip:"Create a New Test Case",handler:function(){try{if(plan){Testopia.TestCase.NewCasePopup(plan.plan_id,plan.product_id)}}catch(E){window.location="tr_new_case.cgi"}}},{xtype:"button",id:"delete_case_list_btn",disabled:true,icon:"extensions/testopia/img/delete.png",iconCls:"img_button_16x",tooltip:"Delete Selected Test Cases",handler:this.deleteList.createDelegate(this)}]});Ext.apply(this,B);this.on("activate",this.onActivate,this);this.on("rowcontextmenu",this.onContextClick,this);Ext.getCmp("case_row_editor").on("afteredit",this.onGridEdit,this)};Ext.extend(Testopia.TestCase.Grid,Ext.grid.GridPanel,{onContextClick:function(B,A,E){B.selindex=A;if(!this.menu){var D;try{D=plan?false:true}catch(C){D=true}this.menu=new Ext.menu.Menu({id:"case_list_ctx_menu",enableScrolling:false,items:[{text:"Modify Selected Test Cases",icon:"extensions/testopia/img/edit.png",iconCls:"img_button_16x",menu:{enableScrolling:false,items:[{text:"Requirements",handler:function(){Ext.Msg.prompt("Edit Requirements","",function(F,G){if(F=="ok"){Testopia.Util.updateFromList("case",{requirement:G,ids:Testopia.Util.getSelectedObjects(B,"case_id")},B)}})}},{text:"Category",disabled:D,handler:function(){var F=new Ext.Window({title:"Edit Category",id:"status-win",plain:true,shadow:false,width:300,height:150,items:[new Testopia.Category.Combo({fieldLabel:"Category",params:{product_id:plan.product_id}})],buttons:[{text:"Submit",handler:function(){Testopia.Util.updateFromList("case",{category:Ext.getCmp("case_category_combo").getValue(),ids:Testopia.Util.getSelectedObjects(B,"case_id")},B);F.close()}},{text:"Close",handler:function(){F.close()}}]});F.show(this)}},{text:"Status",handler:function(){var F=new Ext.Window({title:"Edit Status",id:"status-win",plain:true,shadow:false,listeners:{afterlayout:function(){Ext.getCmp("case_status_update").focus("",10)}},width:300,height:150,items:[new Testopia.TestCase.StatusListCombo({id:"case_status_update",fieldLabel:"Status"})],buttons:[{text:"Submit",handler:function(){Testopia.Util.updateFromList("case",{status:Ext.getCmp("case_status_combo").getValue(),ids:Testopia.Util.getSelectedObjects(B,"case_id")},B);F.close()}},{text:"Close",handler:function(){F.close()}}]});F.show(this)}},{text:"Priority",handler:function(){var F=new Ext.Window({title:"Edit Priority",id:"priority-win",layout:"form",plain:true,shadow:false,listeners:{afterlayout:function(){Ext.getCmp("case_priority_update").focus("",10)}},width:300,height:150,labelWidth:30,items:[new Testopia.TestCase.PriorityCombo({id:"case_priority_update",fieldLabel:"Priority"})],buttons:[{text:"Submit",handler:function(){Testopia.Util.updateFromList("case",{priority:Ext.getCmp("priority_combo").getValue(),ids:Testopia.Util.getSelectedObjects(B,"case_id")},B);F.close()}},{text:"Close",handler:function(){F.close()}}]});F.show(this)}},{text:"Tester",handler:function(){var F=new Ext.Window({title:"Change Default Tester",id:"def_tester_win",layout:"fit",plain:true,shadow:false,split:true,listeners:{afterlayout:function(){Ext.getCmp("tester_update").focus("",10)}},width:350,height:150,items:[new Ext.FormPanel({labelWidth:"40",bodyStyle:"padding: 5px",items:[new Testopia.User.Lookup({id:"tester_update",fieldLabel:"Default Tester"})]})],buttons:[{text:"Update Tester",handler:function(){Testopia.Util.updateFromList("case",{tester:Ext.getCmp("tester_update").getValue(),ids:Testopia.Util.getSelectedObjects(B,"case_id")},B);F.close()}},{text:"Cancel",handler:function(){F.close()}}]});F.show()}},{text:"Automation",handler:function(){var F=new Ext.form.Checkbox({checked:false,name:"isautomated",id:"isautomated_update",fieldLabel:"Enable Automation"});var G=new Ext.form.TextField({xtype:"textfield",disabled:true,name:"script",fieldLabel:"Script "});var I=new Ext.form.TextField({xtype:"textfield",name:"arguments",disabled:true,fieldLabel:"Arguments "});F.on("check",function(){if(G.disabled){G.enable();I.enable()}else{G.disable();I.disable()}},F);var H=new Ext.Window({title:"Edit Automation Settings",id:"auto-win",layout:"form",plain:true,shadow:false,listeners:{afterlayout:function(){Ext.getCmp("isautomated_update").focus("",10)}},width:350,height:250,items:[{id:"automation_form",bodyStyle:"padding: 5px",xtype:"form",items:[F,I,G]}],buttons:[{text:"Submit",handler:function(){params=Ext.getCmp("automation_form").getForm().getValues();params.ids=Testopia.Util.getSelectedObjects(B,"case_id");Testopia.Util.updateFromList("case",params,B);H.close()}},{text:"Close",handler:function(){H.close()}}]});H.show(this)}}]}},{text:"Delete Selected Test Cases",icon:"extensions/testopia/img/delete.png",iconCls:"img_button_16x",handler:this.deleteList.createDelegate(this)},{text:"Add Selected Test Cases to Run... ",handler:function(){Ext.Msg.prompt("Add to runs","",function(F,G){if(F=="ok"){Testopia.Util.updateFromList("case",{addruns:G,ids:Testopia.Util.getSelectedObjects(B,"case_id")},B)}})}},{text:"Copy or Link Selected Test Cases to Plan(s)... ",handler:function(){var F=B.getSelectionModel().getSelected();Testopia.TestCase.clonePopup(F.get("product_id"),Testopia.Util.getSelectedObjects(B,"case_id"))}},{text:"Unlink from Plan",disabled:D,handler:function(){Ext.Msg.show({title:"Unlink Selected Test Cases",msg:"You are about to unlink the selected test cases from this plan. If a test case is not linked to any other plans, it will be deleted. Do you want to continue?",buttons:Ext.Msg.YESNO,icon:Ext.Msg.WARNING,fn:function(G){if(G=="yes"){var F=new Ext.form.BasicForm("testopia_helper_frm");F.submit({url:"tr_list_cases.cgi",params:{case_ids:Testopia.Util.getSelectedObjects(B,"case_id"),action:"unlink",plan_id:plan.plan_id},success:function(H){Ext.Msg.show({msg:"Test cases removed",buttons:Ext.Msg.OK,icon:Ext.MessageBox.INFO});B.store.reload()},failure:function(I,H){Testopia.Util.error(I,H);B.store.reload()}})}}})}},{text:"Add or Remove Tags from Selected Cases...",handler:function(){Testopia.Tags.update("case",B)}},{text:"Add or Remove Bugs from Selected Cases...",handler:function(){Testopia.TestCase.Bugs.update(B)}},{text:"Add or Remove Components from Selected Cases...",handler:function(){var F=new Ext.Window({title:"Add or Remove Components",id:"component_update_win",layout:"fit",split:true,plain:true,shadow:false,width:550,height:85,items:[new Testopia.TestCase.Components(B)]});F.show()}},{text:"Refresh List",icon:"extensions/testopia/img/refresh.png",iconCls:"img_button_16x",handler:function(){B.store.reload()}},{text:"View Test Case(s) in a New Tab",handler:function(){var F=Testopia.Util.getSelectedObjects(B,"case_id").split(",");var G;for(G=0;G<F.length;G+=1){window.open("tr_show_case.cgi?case_id="+F[G])}}}]})}E.stopEvent();if(B.getSelectionModel().getCount()<1){B.getSelectionModel().selectRow(A)}this.menu.showAt(E.getXY())},onGridEdit:function(D){var C=this.store;var B=D.record.data;B.action="edit";var A;if(!B.tester.match("@")){A=B.tester;delete B.tester}this.form.submit({url:"tr_process_case.cgi",params:B,success:function(F,E){if(A){B.tester=A}C.commitChanges()},failure:function(F,E){Testopia.Util.error(F,E);if(A){B.tester=A}C.rejectChanges()}})},deleteList:function(){var A=this;Ext.Msg.show({title:"Confirm Delete?",msg:CASE_DELETE_WARNING,buttons:Ext.Msg.YESNO,animEl:"case-delete-btn",icon:Ext.MessageBox.QUESTION,fn:function(C){if(C=="yes"){var B=new Ext.form.BasicForm("testopia_helper_frm");B.submit({url:"tr_list_cases.cgi",params:{case_ids:Testopia.Util.getSelectedObjects(A,"case_id"),action:"delete"},success:function(D){Ext.Msg.show({msg:"Test cases deleted",buttons:Ext.Msg.OK,icon:Ext.MessageBox.INFO});A.store.reload()},failure:function(E,D){Testopia.Util.error(E,D);A.store.reload()}})}}})},onActivate:function(A){if(!this.store.getCount()){this.store.load()}}});Testopia.TestCase.NewCaseForm=function(C,B,A){Testopia.TestCase.NewCaseForm.superclass.constructor.call(this,{id:"newcaseform",url:"tr_new_case.cgi",baseParams:{action:"add"},fileUpload:true,labelAlign:"left",frame:true,title:"Create a New Test Case",bodyStyle:"padding:5px 5px 0",width:1050,height:670,items:[{layout:"table",layoutConfig:{columns:2,width:"100%"},items:[{colspan:2,layout:"form",items:[{id:"ncf-summary",xtype:"textfield",fieldLabel:"<b>Summary</b>",name:"summary",allowBlank:false,width:800},{xtype:"hidden",name:"components",id:"compfield"},{xtype:"hidden",name:"plan_id",id:"planfield",value:C}]},{layout:"form",items:[new Testopia.User.Lookup({id:"default_tester",hiddenName:"tester",fieldLabel:"Default Tester"}),{xtype:"textfield",fieldLabel:"Alias",id:"case_alias",name:"alias"},new Testopia.TestCase.PriorityCombo({fieldLabel:'<b>Priority</b>&nbsp;&nbsp;<img src="images/help.png" id="priority_help" style="cursor:pointer" onclick=\'window.open("testing_priorities.html","Priority Definitions","resizable=no, scrollbars=yes, width=550,height=420");\'/>',hiddenName:"priority",mode:"local",allowBlank:false}),new Testopia.Category.Combo({fieldLabel:"<b>Category</b>",hiddenName:"category",mode:"local",allowBlank:false,params:{product_id:B}}),{xtype:"textfield",fieldLabel:"Estimated Time (HH:MM:SS)",id:"estimated_time",name:"estimated_time"},{xtype:"textfield",fieldLabel:"Bugs",id:"ncf-bugs",name:"bugs"},{xtype:"textfield",fieldLabel:"Blocks",id:"ncf-blocks",name:"tcblocks"}]},{layout:"form",items:[new Testopia.TestCase.StatusListCombo({fieldLabel:"<b>Status</b>",hiddenName:"status",mode:"local",value:DEFAULT_CASE_STATUS,allowBlank:false,id:"ncf-casestatus"}),{xtype:"textfield",fieldLabel:"Add Tags",id:"ncf-addtags",name:"addtags"},{xtype:"textfield",fieldLabel:"Requirements",id:"ncf-reqs",name:"requirement"},{xtype:"checkbox",fieldLabel:"Automated",id:"ncf-automated",name:"isautomated",value:"1"},{xtype:"textfield",fieldLabel:"Scripts",id:"ncf-scripts",name:"script"},{xtype:"textfield",fieldLabel:"Arguments",id:"ncf-arguments",name:"arguments"},{xtype:"textfield",fieldLabel:"Add to Run",id:"ncf-addtorun",name:"addruns",value:A},{xtype:"textfield",fieldLabel:"Depends On",id:"ncf-dependson",name:"tcdependson"}]}]},{xtype:"tabpanel",id:"ncf_tabs",height:356,activeItem:1,items:[{layout:"column",title:"Setup Procedures",items:[{columnWidth:0.5,items:[{title:"Setup",layout:"fit",items:[{id:"ncf-setup_doc",name:"tcsetup",xtype:"htmleditor",scrollable:true}]}]},{columnWidth:0.5,items:[{title:"Break Down",layout:"fit",items:[{id:"ncf-breakdown_doc",name:"tcbreakdown",xtype:"htmleditor",scrollable:true}]}]}]},{layout:"column",title:"Actions",items:[{columnWidth:0.5,items:[{title:"Action",layout:"fit",items:[{id:"ncf-action",name:"tcaction",xtype:"htmleditor",scrollable:true,listeners:{initialize:function(E){if(!E.getValue()){var D=new Ext.data.Connection();D.request({url:"tr_quicksearch.cgi",params:{action:"get_action"},success:function(F){E.setValue(F.responseText)},failure:Testopia.Util.error})}}}}]}]},{columnWidth:0.5,items:[{title:"Expected Results",layout:"fit",items:[{id:"ncf-effect",name:"tceffect",xtype:"htmleditor",scrollable:true,listeners:{initialize:function(E){if(!E.getValue()){var D=new Ext.data.Connection();D.request({url:"tr_quicksearch.cgi",params:{action:"get_effect"},success:function(F){E.setValue(F.responseText)},failure:Testopia.Util.error})}}}}]}]}]},new Testopia.Attachment.Form(),{title:"Components",id:"component_picker",height:250,layout:"fit",xtype:"grid",store:new Testopia.TestCase.ComponentStore({product_id:B},true),columns:[{sortable:true,dataIndex:"name",width:500}],sm:new Ext.grid.RowSelectionModel({singleSelect:false}),tbar:["Product"," ",new Testopia.Product.Combo({mode:"local",value:B,id:"comp_product_combo"})]}]}],buttons:[{text:"Submit",handler:function(){if(!Ext.getCmp("newcaseform").getForm().isValid()){return }Ext.getCmp("newcaseform").getForm().submit({method:"POST",success:function(D,E){if(E.result.err){alert("One or more attachments were either too large or were empty. These have been ignored.")}Ext.Msg.show({title:"Test Case Created",msg:"Test case "+E.result.tc+" Created. Would you like to go there now?",buttons:Ext.Msg.YESNO,icon:Ext.MessageBox.QUESTION,fn:function(F){if(F=="yes"){window.location="tr_show_case.cgi?case_id="+E.result.tc}}});if(Ext.getCmp("plan_case_grid")){Ext.getCmp("plan_case_grid").store.reload()}else{if(Ext.getCmp("newrun_casegrid")){Ext.getCmp("newrun_casegrid").store.reload()}else{if(Ext.getCmp("caserun_grid")){Ext.getCmp("caserun_grid").store.reload()}else{if(Ext.getCmp("product_case_grid")){Ext.getCmp("product_case_grid").store.reload()}}}}},failure:Testopia.Util.error})}},{text:"Cancel",id:"ncf_cancel_btn",handler:function(){Ext.getCmp("newcaseform").getForm().reset();try{if(Ext.getCmp("newcase-win")){Ext.getCmp("newcase-win").close()}else{window.location="tr_show_product.cgi"}}catch(D){}}}]});Ext.getCmp("comp_product_combo").on("select",function(F,E,D){Ext.getCmp("component_picker").store.baseParams.product_id=E.get("id");Ext.getCmp("component_picker").store.load()});Ext.getCmp("component_picker").getSelectionModel().on("rowselect",function(D,E,F){Ext.getCmp("compfield").setValue(Testopia.Util.getSelectedObjects(Ext.getCmp("component_picker"),"id"));Ext.getCmp("default_tester").setValue(F.get("qa"))});Ext.getCmp("ncf_tabs").on("tabchange",function(D,E){E.doLayout()})};Ext.extend(Testopia.TestCase.NewCaseForm,Ext.form.FormPanel);Testopia.TestCase.NewCasePopup=function(D,B,A){var C=new Ext.Window({id:"newcase-win",closable:true,width:Ext.getBody().getViewSize().width-150,height:Ext.getBody().getViewSize().height-150,plain:true,shadow:false,layout:"fit",items:[new Testopia.TestCase.NewCaseForm(D,B,A)]});C.show(this)};Testopia.TestCase.PlanList=function(A,C){this.remove=function(){var G=new Ext.form.BasicForm("testopia_helper_frm",{});G.submit({url:"tr_process_case.cgi",params:{action:"unlink",plan_id:Testopia.Util.getSelectedObjects(Ext.getCmp("case_plan_grid"),"plan_id"),case_id:A},success:function(){D.load()},failure:Testopia.Util.error})};this.store=new Ext.data.JsonStore({url:"tr_process_case.cgi",listeners:{exception:Testopia.Util.loadError},baseParams:{action:"getplans",case_id:A},root:"plans",id:"plan_id",fields:[{name:"plan_id",mapping:"plan_id"},{name:"plan_name",mapping:"plan_name"}]});var D=this.store;this.columns=[{header:"ID",dataIndex:"plan_id",hideable:false,renderer:Testopia.Util.makeLink.createDelegate(this,["plan"],true)},{header:"Name",width:150,dataIndex:"plan_name",id:"plan_name",sortable:true,hideable:false}];var E=new Ext.form.ComboBox({store:new Testopia.TestPlan.Store({product_id:C,viewall:1},false),loadingText:"Looking up plans...",id:"link_plan_combo",width:150,displayField:"name",valueField:"plan_id",typeAhead:true,triggerAction:"all",minListWidth:300,forceSelection:true,emptyText:"Choose a Plan..."});var B=new Ext.Button({icon:"extensions/testopia/img/add.png",iconCls:"img_button_16x",tooltip:"Link to plan",handler:function(){var G=new Ext.form.BasicForm("testopia_helper_frm",{});G.submit({url:"tr_process_case.cgi",params:{action:"link",plan_ids:E.getValue(),case_id:A},success:function(){D.load()},failure:Testopia.Util.error})}});var F=new Ext.Button({icon:"extensions/testopia/img/delete.png",iconCls:"img_button_16x",tooltip:"Unlink Selected Plans",handler:this.remove});Testopia.TestCase.PlanList.superclass.constructor.call(this,{title:"Plans",split:true,layout:"fit",autoExpandColumn:"plan_name",collapsible:true,id:"case_plan_grid",loadMask:{msg:"Loading plans..."},autoScroll:true,sm:new Ext.grid.RowSelectionModel({singleSelect:true}),viewConfig:{forceFit:true},tbar:[E,B,F]});D.on("load",function(G,H,I){if(G.getCount()==1){F.disable()}else{F.enable()}});this.on("rowcontextmenu",this.onContextClick,this);this.on("activate",this.onActivate,this)};Ext.extend(Testopia.TestCase.PlanList,Ext.grid.GridPanel,{onContextClick:function(B,A,C){B.getSelectionModel().selectRow(A);if(!this.menu){this.menu=new Ext.menu.Menu({id:"tags-ctx-menu",items:[{text:"Unlink Selected Plans",id:"plan_remove_mnu",icon:"extensions/testopia/img/delete.png",iconCls:"img_button_16x",handler:B.remove},{text:"Go to Plan",handler:function(){window.location="tr_show_plan.cgi?plan_id="+B.getSelectionModel().getSelected().get("plan_id")}},{text:"Refresh",icon:"extensions/testopia/img/refresh.png",iconCls:"img_button_16x",handler:function(){B.store.reload()}}]})}if(this.store.getCount()==1){Ext.getCmp("plan_remove_mnu").disable()}else{Ext.getCmp("plan_remove_mnu").enable()}C.stopEvent();this.menu.showAt(C.getXY())},onActivate:function(A){if(!this.store.getCount()){this.store.load()}}});Testopia.TestCase.Clone=function(A,C){var B=new Testopia.TestPlan.Grid({product_id:A},{id:"plan_clone_grid"});Testopia.TestCase.Clone.superclass.constructor.call(this,{id:"case-clone-panel",layout:"border",items:[{region:"north",layout:"fit",border:false,height:300,items:[B]},{region:"center",xtype:"form",title:"Clone Options",id:"case_clone_frm",border:false,frame:true,autoScroll:true,bodyStyle:"padding: 10px",labelWidth:250,height:280,items:[{xtype:"fieldset",autoHeight:true,checkboxToggle:true,checkboxName:"copy_cases",title:"Create a copy (Unchecking will create a link to selected plans)",id:"case_copy_method",collapsed:true,items:[{xtype:"hidden",id:"case_copy_plan_ids",name:"plan_ids"},{xtype:"hidden",id:"case_clone_product_id",value:A,name:"product_id"},{xtype:"checkbox",boxLabel:"Keep Author (unchecking will make you the author of copied cases)",hideLabel:true,name:"keep_author",checked:true},{xtype:"checkbox",boxLabel:"Keep Default Tester (unchecking will make you the default tester of copied cases)",hideLabel:true,name:"keep_tester",checked:true},{xtype:"checkbox",boxLabel:"Copy case document (action, expected results, etc.)",hideLabel:true,name:"copy_doc",checked:true},{xtype:"checkbox",boxLabel:"Copy Attachments",hideLabel:true,name:"copy_attachments"},{xtype:"checkbox",boxLabel:"Copy Tags",hideLabel:true,name:"copy_tags",checked:true},{xtype:"checkbox",boxLabel:"Copy components",hideLabel:true,name:"copy_comps",checked:true},{xtype:"checkbox",boxLabel:"Copy category to new product",hideLabel:true,disabled:true,id:"case_clone_category_box",name:"copy_category",checked:true}]}]}],buttons:[{text:"Submit",handler:function(){Ext.getCmp("case_copy_plan_ids").setValue(Testopia.Util.getSelectedObjects(Ext.getCmp("plan_clone_grid"),"plan_id"));var D=Ext.getCmp("case_clone_frm").getForm();var E=D.getValues();D.baseParams={};D.baseParams.action="clone";D.baseParams.ids=C;D.submit({url:"tr_list_cases.cgi",success:function(G,H){if(E.copy_cases){if(H.result.tclist.length==1){Ext.Msg.show({title:"Test Case Copied",msg:"Test case "+H.result.tclist[0]+" Copied from Case "+C+". Would you like to go there now?",buttons:Ext.Msg.YESNO,icon:Ext.MessageBox.QUESTION,fn:function(I){if(I=="yes"){window.location="tr_show_case.cgi?case_id="+H.result.tclist[0]}}})}else{Ext.Msg.show({title:"Test Case Copied",msg:H.result.tclist.length+' Test cases Copied successfully <a href="tr_list_cases.cgi?case_id='+H.result.tclist.join(",")+'">View List</a>',buttons:Ext.Msg.OK,icon:Ext.MessageBox.INFO})}}else{Ext.Msg.show({title:"Test Case(s) Linked",msg:"Test cases "+C+" Linked successfully",buttons:Ext.Msg.OK,icon:Ext.MessageBox.INFO})}Ext.getCmp("case-clone-win").close();try{Ext.getCmp("case_plan_grid").store.reload()}catch(F){}},failure:Testopia.Util.error})}},{text:"Cancel",handler:function(){try{Ext.getCmp("case-clone-win").close()}catch(D){window.location="tr_show_product.cgi"}}}]})};Ext.extend(Testopia.TestCase.Clone,Ext.Panel);Testopia.TestCase.clonePopup=function(A,B){var D=new Ext.Window({id:"case-clone-win",closable:true,width:800,height:550,plain:true,shadow:false,layout:"fit",items:[new Testopia.TestCase.Clone(A,B)]});var E=Ext.getCmp("plan_clone_grid");Ext.apply(E,{title:"Select plans to clone cases to"});D.show(this);var C=new Testopia.Product.Combo({id:"case_clone_win_product_chooser",mode:"local",value:A});C.on("select",function(H,G,F){E.store.baseParams={ctype:"json",product_id:G.get("id")};if(G.get("id")!=A){Ext.getCmp("case_clone_category_box").enable()}else{Ext.getCmp("case_clone_category_box").disable()}Ext.getCmp("case_clone_product_id").setValue(G.get("id"));E.store.load()});E.getTopToolbar().removeAll();E.getTopToolbar().add("Product: ",C);E.getSelectionModel().un("rowselect",E.getSelectionModel().events.rowselect.listeners[0].fn);E.getSelectionModel().un("rowdeselect",E.getSelectionModel().events.rowdeselect.listeners[0].fn);E.store.load()};Testopia.TestCaseRun.StatusListStore=function(A){Testopia.TestCaseRun.StatusListStore.superclass.constructor.call(this,{url:"tr_quicksearch.cgi",root:"statuses",listeners:{exception:Testopia.Util.loadError},baseParams:{action:"getcaserunstatus"},autoLoad:A,id:"id",fields:[{name:"id",mapping:"id"},{name:"name",mapping:"name"}]})};Ext.extend(Testopia.TestCaseRun.StatusListStore,Ext.data.JsonStore);Testopia.TestCaseRun.StatusListCombo=function(A){Testopia.TestCaseRun.StatusListCombo.superclass.constructor.call(this,{id:A.id||"case_run_status_combo",store:A.transform?false:new Testopia.TestCaseRun.StatusListStore(A.mode=="local"?true:false),loadingText:"Looking up statuses...",displayField:"name",valueField:"id",typeAhead:true,triggerAction:"all",minListWidth:300,forceSelection:true,transform:A.transform,emptyText:"Please select..."});Ext.apply(this,A);this.store.on("load",function(){if(A.value){this.setValue(A.value)}},this)};Ext.extend(Testopia.TestCaseRun.StatusListCombo,Ext.form.ComboBox);Testopia.TestCaseRun.Panel=function(E,D){var A=new Testopia.TestCaseRun.Grid(E,D);var B=new Testopia.TestCaseRun.Filter();var C=new Testopia.TestCaseRun.Info();this.cgrid=A;this.store=A.store;this.params=E;this.caserun=C;Testopia.TestCaseRun.Panel.superclass.constructor.call(this,{layout:"border",title:"Test Cases",id:"caserun-panel",border:false,bodyBorder:false,items:[B,A,C]});C.disable();this.on("activate",this.onActivate,this)};Ext.extend(Testopia.TestCaseRun.Panel,Ext.Panel,{onActivate:function(A){this.store.load()}});Testopia.TestCaseRun.Filter=function(){this.form=new Ext.form.BasicForm("caserun_filter_form",{});var A=this.form;Testopia.TestCaseRun.Filter.superclass.constructor.call(this,{title:"Search for Test Results",id:"caserun_search",region:"north",border:false,bodyBorder:false,layout:"fit",split:true,frame:true,collapsible:true,height:"auto",autoScroll:true,contentEl:"caserun-filter-div",buttons:[new Ext.form.TextField({id:"caserun_save_filter_txt",validateOnBlur:false,allowBlank:false}),{text:"Save Filter",handler:function(){if(!Ext.getCmp("caserun_save_filter_txt").isValid()){Ext.Msg.show({title:"Invalid Entry",msg:"Please enter a name for this filter",buttons:Ext.Msg.OK,icon:Ext.MessageBox.WARNING});return false}var B=new Ext.form.BasicForm("testopia_helper_frm",{});var C=A.getValues();C.action="save_filter";C.query_name=Ext.getCmp("caserun_save_filter_txt").getValue();B.submit({url:"tr_process_run.cgi",params:C,success:function(){Ext.getCmp("run_east_panel").activate("run_filter_grid");Ext.getCmp("run_filter_grid").store.reload();Testopia.Util.notify.msg("Filter Saved","Added filter {0}",C.query_name)},failure:Testopia.Util.error})}},{text:"Reset",handler:function(){document.getElementById("caserun_filter_form").reset();var D=Ext.getCmp("caserun_grid").store;var B=D.baseParams.run_id;var C=D.baseParams.ctype;D.baseParams={};D.baseParams.run_id=B;D.baseParams.ctype=C;D.baseParams.limit=Ext.getCmp("caserun_pager").pageSize;D.load({callback:function(){Ext.getCmp("caserun_filtered_txt").hide();Ext.getCmp("run_filter_grid").getSelectionModel().clearSelections();if(Ext.getCmp("caserun_grid").getSelectionModel().getCount()<1){Ext.getCmp("caserun-panel").caserun.disable()}}})}},{text:"Filter",handler:function(){var B=Ext.getCmp("caserun_grid").store;B.baseParams=A.getValues();B.baseParams.limit=Ext.getCmp("caserun_pager").pageSize;B.baseParams.distinct=1;B.load({callback:function(){Ext.getCmp("caserun_filtered_txt").show();if(Ext.getCmp("caserun_grid").getSelectionModel().getCount()<1){Ext.getCmp("caserun-panel").caserun.disable()}}})}}]})};Ext.extend(Testopia.TestCaseRun.Filter,Ext.Panel);Testopia.TestCaseRun.List=function(C,A){this.params=C;this.store=new Ext.data.GroupingStore({url:"tr_list_caseruns.cgi",baseParams:C,reader:new Ext.data.JsonReader({totalProperty:"totalResultsAvailable",root:"Result",id:"caserun_id",fields:[{name:"caserun_id",mapping:"case_run_id"},{name:"case_id",mapping:"case_id"},{name:"run_id",mapping:"run_id"},{name:"build",mapping:"build_name"},{name:"environment",mapping:"env_name"},{name:"assignee",mapping:"assignee_name"},{name:"testedby",mapping:"testedby"},{name:"status",mapping:"status"},{name:"category",mapping:"category"},{name:"priority",mapping:"priority"},{name:"close_date",mapping:"close_date"},{name:"bug_count",mapping:"bug_count"},{name:"case_summary",mapping:"case_summary"},{name:"component",mapping:"component"},{name:"bug_list",mapping:"bug_list"},{name:"case_bug_list",mapping:"case_bug_list"},{name:"plan_name",mapping:"plan_name"}]}),remoteSort:true,sortInfo:{field:"run_id",direction:"ASC"},groupField:"run_id"});var B=this.store;B.paramNames.sort="order";B.on("beforeload",function(D,E){D.baseParams.ctype="json"});this.summary_sort=function(){this.store.sortInfo.field="summary";this.store.sortInfo.direction=="DESC"?this.store.sortInfo.direction="ASC":this.store.sortInfo.direction="DESC";this.getView().mainHd.select("td").removeClass(this.getView().sortClasses);this.store.load()};this.bbar=new Testopia.Util.PagingBar("caserun",this.store);this.columns=[{header:"Case",width:50,dataIndex:"case_id",sortable:true,groupRenderer:function(D){return D},renderer:Testopia.Util.makeLink.createDelegate(this,["case"],true)},{header:"Run",width:50,dataIndex:"run_id",sortable:true,groupRenderer:function(D){return D},renderer:Testopia.Util.makeLink.createDelegate(this,["run"],true)},{header:"Build",width:50,dataIndex:"build",sortable:true,id:"caserun_list_build_col"},{header:"Environment",width:50,dataIndex:"environment",sortable:true},{header:"Assignee",width:150,sortable:true,dataIndex:"assignee"},{header:"Tested By",width:150,sortable:true,dataIndex:"testedby"},{header:"Status",width:30,sortable:true,dataIndex:"status",groupRenderer:function(D){return D},renderer:Testopia.Util.displayStatusIcon},{header:"Closed",width:60,sortable:true,dataIndex:"close_date"},{header:"Priority",width:60,sortable:true,dataIndex:"priority"},{header:"Category",width:100,sortable:true,dataIndex:"category"},{header:"Component",width:100,sortable:true,dataIndex:"component"},{header:"Plan Name",width:100,sortable:true,hidden:true,dataIndex:"plan_name"},{header:"Bugs In This Build and Environment",width:100,dataIndex:"bug_list",sortable:false,hideable:true,renderer:function(D){var G=D.bugs;var F="";for(var E=0;E<G.length;E++){if(typeof G[E]!="function"){F=F+'<a href="show_bug.cgi?id='+G[E].bug_id+'" '+(G[E].closed?'class="bz_closed"':"")+">"+G[E].bug_id+"</a>, "}}return F}},{header:"Bugs In All Builds and Environments",width:100,dataIndex:"case_bug_list",sortable:false,hideable:true,renderer:function(D){var G=D.bugs;var F="";for(var E=0;E<G.length;E++){if(typeof G[E]!="function"){F=F+'<a href="show_bug.cgi?id='+G[E].bug_id+'" '+(G[E].closed?'class="bz_closed"':"")+">"+G[E].bug_id+"</a>, "}}return F}}];this.view=new Ext.grid.GroupingView({forceFit:true,groupTextTpl:'{text} ({[values.rs.length]} {[values.rs.length > 1 ? "Items" : "Item"]})',enableRowBody:true,getRowClass:function(D,G,F,E){F.body="<p><a href=\"javascript:Ext.getCmp('caserun_list_grid').summary_sort()\">Summary:</a> "+D.data.case_summary+"</p>";return"x-grid3-row-expanded"}});this.tbar=[new Ext.Toolbar.Fill(),{xtype:"button",id:"caserun_grid_tocsv",icon:"extensions/testopia/img/csv.png",iconCls:"img_button_16x",tooltip:"Export Results to CSV",handler:function(){window.location="tr_list_caseruns.cgi?ctype=csv&viewall=1&"+Testopia.Util.JSONToURLQuery(Ext.getCmp(A.id||"caserun_list_grid").store.baseParams,"",["viewall","ctype"])}},{xtype:"button",id:"save_caserun_list_btn",icon:"extensions/testopia/img/save.png",iconCls:"img_button_16x",tooltip:"Save this search",handler:function(D,E){Testopia.Search.save("caserun",Ext.getCmp(A.id||"caserun_list_grid").store.baseParams)}},{xtype:"button",id:"link_case_list_btn",icon:"extensions/testopia/img/link.png",iconCls:"img_button_16x",tooltip:"Create a link to this list",handler:function(D,E){Testopia.Search.LinkPopup(Ext.getCmp(A.id||"caserun_list_grid").store.baseParams)}}];Testopia.TestCaseRun.List.superclass.constructor.call(this,{id:A.id||"caserun_list_grid",title:"Case Run History",loadMask:{msg:"Loading Test Cases..."},layout:"fit",region:"center",stripeRows:true,autoExpandColumn:"caserun_list_build_col",autoScroll:true,sm:new Ext.grid.RowSelectionModel({singleSelect:false}),viewConfig:{forceFit:true}});Ext.apply(this,A);this.on("activate",this.onActivate,this)};Ext.extend(Testopia.TestCaseRun.List,Ext.grid.GridPanel,{deleteList:function(){var A=this;Ext.Msg.show({title:"Confirm Delete?",msg:CASERUN_DELETE_WARNING,buttons:Ext.Msg.YESNO,animEl:"caserun-delete-btn",icon:Ext.MessageBox.QUESTION,fn:function(C){if(C=="yes"){var B=new Ext.form.BasicForm("testopia_helper_frm");B.submit({url:"tr_list_caseruns.cgi",params:{caserun_ids:Testopia.Util.getSelectedObjects(A,"caserun_id"),action:"delete",deltype:"cr",single:true,ctype:"json"},success:function(D){Ext.Msg.show({msg:"Test cases removed",buttons:Ext.Msg.OK,icon:Ext.MessageBox.INFO});A.store.reload()},failure:function(E,D){Testopia.Util.error(E,D);A.store.reload()}})}}})},onActivate:function(A){if(!this.store.getCount()){this.store.load()}}});Testopia.TestCaseRun.Grid=function(G,F){G.limit=Ext.state.Manager.get("TESTOPIA_DEFAULT_PAGE_SIZE",25);this.params=G;this.run=F;var A=new Ext.form.BasicForm("testopia_helper_frm",{});var C;this.summary_sort=function(){this.store.sortInfo.field="summary";this.store.sortInfo.direction=="DESC"?this.store.sortInfo.direction="ASC":this.store.sortInfo.direction="DESC";this.getView().mainHd.select("td").removeClass(this.getView().sortClasses);this.store.load()};envRenderer=function(I,N,L,H,J,K){var M=this.getColumnModel().getCellEditor(J,H).field;record=M.store.getById(I);if(record){return'<a href="tr_environments.cgi?env_id='+record.data[M.valueField]+'">'+record.data[M.displayField]+"</a>"}else{return'<a href="tr_environments.cgi?env_id='+L.data.env_id+'">'+I+"</a>"}};this.store=new Ext.data.GroupingStore({url:"tr_list_caseruns.cgi",baseParams:G,reader:new Ext.data.JsonReader({totalProperty:"totalResultsAvailable",root:"Result",id:"caserun_id",fields:[{name:"caserun_id",mapping:"case_run_id"},{name:"sortkey",mapping:"sortkey"},{name:"case_id",mapping:"case_id"},{name:"run_id",mapping:"run_id"},{name:"build",mapping:"build_name"},{name:"environment",mapping:"env_name"},{name:"env_id",mapping:"env_id"},{name:"assignee",mapping:"assignee_name"},{name:"testedby",mapping:"testedby"},{name:"status",mapping:"status"},{name:"requirement",mapping:"requirement"},{name:"category",mapping:"category"},{name:"priority",mapping:"priority"},{name:"close_date",mapping:"close_date"},{name:"bug_count",mapping:"bug_count"},{name:"case_summary",mapping:"case_summary"},{name:"type",mapping:"type"},{name:"id",mapping:"id"},{name:"component",mapping:"component"},{name:"bug_list",mapping:"bug_list"},{name:"case_bug_list",mapping:"case_bug_list"},{name:"plan_name",mapping:"plan_name"}]}),remoteSort:true,sortInfo:{field:"sortkey",direction:"ASC"},groupField:"run_id"});var E=this.store;E.paramNames.sort="order";E.on("beforeload",function(H,I){H.baseParams.ctype="json"});var B=new Testopia.Build.Combo({id:"tb_build",width:100,fieldLabel:"Build",hiddenName:"build",mode:"remote",forceSelection:false,allowBlank:false,typeAhead:true,disabled:true,params:{product_id:F.plan.product_id,activeonly:1}});var D=new Testopia.Environment.Combo({id:"tb_environment",width:100,fieldLabel:"Environment",hiddenName:"environment",mode:"remote",forceSelection:false,allowBlank:false,typeAhead:true,disabled:true,params:{product_id:F.plan.product_id,isactive:1}});B.on("select",function(J,I,H){G={build_id:I.get("id"),ids:Testopia.Util.getSelectedObjects(Ext.getCmp("caserun_grid"),"caserun_id")};Testopia.Util.updateFromList("caserun",G,Ext.getCmp("caserun_grid"))});D.on("select",function(J,I,H){G={env_id:I.get("environment_id"),ids:Testopia.Util.getSelectedObjects(Ext.getCmp("caserun_grid"),"caserun_id")};Testopia.Util.updateFromList("caserun",G,Ext.getCmp("caserun_grid"))});this.object_type="environment";this.columns=[{header:"Case",width:50,dataIndex:"case_id",sortable:true,renderer:Testopia.Util.makeLink.createDelegate(this,["case"],true)},{header:"Run",width:50,dataIndex:"run_id",sortable:true,renderer:Testopia.Util.makeLink.createDelegate(this,["run"],true),hidden:true},{header:"Index",width:50,dataIndex:"sortkey",sortable:true,editor:new Ext.grid.GridEditor(new Ext.form.NumberField())},{header:"Build",width:50,dataIndex:"build",sortable:true,editor:new Ext.grid.GridEditor(new Testopia.Build.Combo({params:{product_id:F.plan.product_id,activeonly:1}})),renderer:Testopia.Util.ComboRenderer.createDelegate(this)},{header:"Environment",width:50,dataIndex:"environment",sortable:true,editor:new Ext.grid.GridEditor(new Testopia.Environment.Combo({params:{product_id:F.plan.product_id,isactive:1}})),renderer:envRenderer.createDelegate(this)},{header:"Assignee",width:150,sortable:true,dataIndex:"assignee",editor:new Ext.grid.GridEditor(new Testopia.User.Lookup({id:"caserun_assignee"})),renderer:Testopia.Util.ComboRenderer.createDelegate(this)},{header:"Tested By",width:150,sortable:true,dataIndex:"testedby",hidden:true},{header:"Closed",width:90,sortable:true,dataIndex:"close_date"},{header:"Status",width:30,sortable:true,dataIndex:"status",align:"center",renderer:Testopia.Util.displayStatusIcon},{header:"Priority",width:60,sortable:true,dataIndex:"priority",editor:new Ext.grid.GridEditor(new Testopia.TestCase.PriorityCombo({id:"caserun_priority"})),renderer:Testopia.Util.ComboRenderer.createDelegate(this)},{header:"Category",width:100,sortable:true,dataIndex:"category",editor:new Ext.grid.GridEditor(new Testopia.Category.Combo({id:"caserun_category",params:{product_id:F.plan.product_id}})),renderer:Testopia.Util.ComboRenderer.createDelegate(this)},{header:"Requirement",width:150,sortable:true,dataIndex:"requirement",hidden:true},{header:"Component",width:100,sortable:true,dataIndex:"component"},{header:"Plan Name",width:100,sortable:true,hidden:true,dataIndex:"plan_name"},{header:"Bugs In This Build and Environment",width:100,dataIndex:"bug_list",sortable:false,hideable:true,renderer:function(H){var K=H.bugs;var J="";for(var I=0;I<K.length;I++){if(typeof K[I]!="function"){J=J+'<a href="show_bug.cgi?id='+K[I].bug_id+'" '+(K[I].closed?'class="bz_closed"':"")+">"+K[I].bug_id+"</a>, "}}return J}},{header:"Bugs In All Builds and Environments",width:100,dataIndex:"case_bug_list",sortable:false,hideable:true,renderer:function(H){var K=H.bugs;var J="";for(var I=0;I<K.length;I++){if(typeof K[I]!="function"){J=J+'<a href="show_bug.cgi?id='+K[I].bug_id+'" '+(K[I].closed?'class="bz_closed"':"")+">"+K[I].bug_id+"</a>, "}}return J}}];this.form=new Ext.form.BasicForm("testopia_helper_frm",{});this.bbar=new Testopia.Util.PagingBar("caserun",this.store);this.tbar=new Ext.Toolbar({id:"caserun_grid_tb",items:[{xtype:"button",template:imgButtonTpl,text:"extensions/testopia/img/IDLE.gif",tooltip:"Mark as IDLE (Not Run)",disabled:true,handler:function(){Testopia.Util.updateFromList("caserun",{status_id:1,ids:Testopia.Util.getSelectedObjects(Ext.getCmp("caserun_grid"),"caserun_id")},Ext.getCmp("caserun_grid"))}},{xtype:"button",template:imgButtonTpl,text:"extensions/testopia/img/PASSED.gif",tooltip:"Mark as PASSED",disabled:true,handler:function(){Testopia.Util.updateFromList("caserun",{status_id:2,ids:Testopia.Util.getSelectedObjects(Ext.getCmp("caserun_grid"),"caserun_id"),update_bug:Ext.getCmp("update_bugs").getValue()},Ext.getCmp("caserun_grid"))}},{xtype:"button",template:imgButtonTpl,text:"extensions/testopia/img/FAILED.gif",tooltip:"Mark as FAILED",disabled:true,handler:function(){Testopia.Util.updateFromList("caserun",{status_id:3,ids:Testopia.Util.getSelectedObjects(Ext.getCmp("caserun_grid"),"caserun_id"),update_bug:Ext.getCmp("update_bugs").getValue()},Ext.getCmp("caserun_grid"))}},{xtype:"button",template:imgButtonTpl,text:"extensions/testopia/img/RUNNING.gif",tooltip:"Mark as RUNNING",disabled:true,handler:function(){var H=0;var K=1;var J=Ext.getCmp("caserun_grid").getSelectionModel().getSelections();for(var I=0;I<J.length;I++){if(J[I].get("assignee")!=user_login){K=0;break}}if(K==0){Ext.Msg.show({title:"Reassign Test Case?",msg:"Setting this test case to Running will lock it so that only the assignee can update it. Would you like to make yourself the assignee?",buttons:Ext.MessageBox.YESNO,icon:Ext.MessageBox.QUESTION,fn:function(L){if(L=="yes"){H=1}Testopia.Util.updateFromList("caserun",{status_id:4,reassign:H,ids:Testopia.Util.getSelectedObjects(Ext.getCmp("caserun_grid"),"caserun_id")},Ext.getCmp("caserun_grid"))}})}else{Testopia.Util.updateFromList("caserun",{status_id:4,reassign:H,ids:Testopia.Util.getSelectedObjects(Ext.getCmp("caserun_grid"),"caserun_id")},Ext.getCmp("caserun_grid"))}}},{xtype:"button",template:imgButtonTpl,text:"extensions/testopia/img/PAUSED.gif",tooltip:"Mark as PAUSED",disabled:true,handler:function(){Testopia.Util.updateFromList("caserun",{status_id:5,ids:Testopia.Util.getSelectedObjects(Ext.getCmp("caserun_grid"),"caserun_id")},Ext.getCmp("caserun_grid"))}},{xtype:"button",template:imgButtonTpl,text:"extensions/testopia/img/BLOCKED.gif",tooltip:"Mark as BLOCKED",disabled:true,handler:function(){Testopia.Util.updateFromList("caserun",{status_id:6,ids:Testopia.Util.getSelectedObjects(Ext.getCmp("caserun_grid"),"caserun_id")},Ext.getCmp("caserun_grid"))}},{xtype:"button",template:imgButtonTpl,text:"extensions/testopia/img/ERROR.gif",tooltip:"Mark as ERROR",disabled:true,handler:function(){Testopia.Util.updateFromList("caserun",{status_id:7,ids:Testopia.Util.getSelectedObjects(Ext.getCmp("caserun_grid"),"caserun_id")},Ext.getCmp("caserun_grid"))}}," ","-","Update Bugs: ",new Ext.form.Checkbox({id:"update_bugs",disabled:true})," ","-"," ",B," ",D,new Ext.Toolbar.Fill(),{xtype:"button",id:"caserun_grid_tocsv",icon:"extensions/testopia/img/csv.png",iconCls:"img_button_16x",tooltip:"Export Results to CSV",handler:function(){window.location="tr_list_caseruns.cgi?ctype=csv&viewall=1&run_id="+F.run_id}},{xtype:"button",id:"add_case_to_run_btn",tooltip:"Add cases to this run",icon:"extensions/testopia/img/add.png",iconCls:"img_button_16x",handler:function(){Testopia.TestRun.AddCasePopup(F)}},{xtype:"button",id:"new_case_to_run_btn",tooltip:"Create a new case and add it to this run",icon:"extensions/testopia/img/new.png",iconCls:"img_button_16x",handler:function(){Testopia.TestCase.NewCasePopup(F.plan_id,F.product_id,F.run_id)}},{xtype:"button",id:"caserun_grid_edit_btn",icon:"extensions/testopia/img/edit.png",iconCls:"img_button_16x",tooltip:"Edit Selected Test Case",handler:function(){Testopia.Util.editFirstSelection(Ext.getCmp("caserun_grid"))}},{xtype:"button",id:"caserun_grid_delete_btn",icon:"extensions/testopia/img/delete.png",iconCls:"img_button_16x",tooltip:"Remove Selected Test Cases from This Run",handler:this.deleteList.createDelegate(this)},new Testopia.TestRun.ProgressBar({id:"run_progress",text:"0%",width:100})]});Testopia.TestCaseRun.Grid.superclass.constructor.call(this,{region:"center",id:"caserun_grid",border:false,bodyBorder:false,height:"400",stripeRows:true,split:true,enableDragDrop:true,loadMask:{msg:"Loading Test Cases..."},autoExpandColumn:"case_summary",autoScroll:true,sm:new Ext.grid.RowSelectionModel({singleSelect:false,listeners:{rowdeselect:function(L,K,J){if(L.getCount()<1){Ext.getCmp("case_details_panel").disable();Ext.getCmp("tb_build").disable();Ext.getCmp("tb_environment").disable();Ext.getCmp("update_bugs").disable();var H=this.grid.getTopToolbar().items.items;for(var I=0;I<H.length;I++){if((H[I].id=="add_case_to_run_btn"||H[I].id=="run_progress")){if(Ext.getCmp("run_status_cycle").text=="RUNNING"){H[I].enable()}}else{H[I].disable()}}}},rowselect:function(N,M,K){Ext.getCmp("case_details_panel").enable();if(Ext.getCmp("run_status_cycle").text=="RUNNING"){Ext.getCmp("summary_tb").enable();Ext.getCmp("tb_build").enable();Ext.getCmp("tb_environment").enable();Ext.getCmp("update_bugs").enable();var H=N.grid.getTopToolbar().items.items;for(var I=0;I<H.length;I++){H[I].enable()}}if(M==C){return }var L=[];for(I=0;I<N.grid.store.data.items.length;I++){if(N.grid.getSelectionModel().isSelected(I)){L.push(N.grid.store.getAt(I).get("case_id"))}}N.grid.selectedRows=L;if(N.getCount()>1){return }Ext.getCmp("case_bugs_panel").tcid=K.get("case_id");Ext.getCmp("case_comps_panel").tcid=K.get("case_id");Ext.getCmp("attachments_panel").object=K.data;Ext.getCmp("case_details_panel").caserun_id=K.get("caserun_id");Ext.getCmp("casetagsgrid").obj_id=K.get("case_id");var J=Ext.getCmp("caserun_center_region").getActiveTab();Ext.getCmp(J.id).fireEvent("activate");if(Ext.getCmp("case_bugs_panel")){Ext.getCmp("case_bugs_panel").case_id=K.get("case_id")}if(Ext.getCmp("case_bugs_panel")){Ext.getCmp("case_bugs_panel").case_id=K.get("case_id")}Ext.getCmp("case_details_panel").store.load({params:{caserun_id:K.get("caserun_id"),action:"gettext"}});C=M}}}),viewConfig:{forceFit:true,enableRowBody:true,getRowClass:function(H,K,J,I){J.body="<p><a href=\"javascript:Ext.getCmp('caserun_grid').summary_sort()\">Summary:</a> "+H.data.case_summary+"</p>";return"x-grid3-row-expanded"}}});this.on("rowcontextmenu",this.onContextClick,this);this.on("afteredit",this.onGridEdit,this);this.on("activate",this.onActivate,this)};Ext.extend(Testopia.TestCaseRun.Grid,Ext.grid.EditorGridPanel,{onContextClick:function(B,A,C){B.selindex=A;if(!this.menu){this.menu=new Ext.menu.Menu({id:"caserun-ctx-menu",items:[{text:"Change",icon:"extensions/testopia/img/edit.png",iconCls:"img_button_16x",menu:{items:[{text:"Build",handler:function(){var D=new Ext.Window({title:"Edit Build",id:"status-win",plain:true,shadow:false,width:320,height:150,listeners:{afterlayout:function(){Ext.getCmp("multi_build").focus("",10)}},layout:"form",bodyStyle:"padding: 5px",items:[new Testopia.Build.Combo({params:{product_id:B.run.plan.product_id,activeonly:1},fieldLabel:"Build",id:"multi_build"}),new Ext.form.Checkbox({fieldLabel:"Apply to all cases in this run",id:"build_applyall"})],buttons:[{text:"Submit",handler:function(){params={run_id:B.run.run_id,applyall:Ext.getCmp("build_applyall").getValue(),build_id:Ext.getCmp("multi_build").getValue(),ids:Testopia.Util.getSelectedObjects(B,"caserun_id")};Testopia.Util.updateFromList("caserun",params,B);D.close()}},{text:"Close",handler:function(){D.close()}}]});D.show(this)}},{text:"Environment",handler:function(){var D=new Ext.Window({title:"Edit Environment",id:"status-win",plain:true,shadow:false,width:320,height:150,listeners:{afterlayout:function(){Ext.getCmp("multi_env").focus("",10)}},layout:"form",bodyStyle:"padding: 5px",items:[new Testopia.Environment.Combo({params:{product_id:B.run.plan.product_id,isactive:1},fieldLabel:"Environment",id:"multi_env"}),new Ext.form.Checkbox({fieldLabel:"Apply to all cases in this run",id:"env_applyall"})],buttons:[{text:"Submit",handler:function(){params={run_id:B.run.run_id,applyall:Ext.getCmp("env_applyall").getValue(),env_id:Ext.getCmp("multi_env").getValue(),ids:Testopia.Util.getSelectedObjects(B,"caserun_id")};Testopia.Util.updateFromList("caserun",params,B);D.close()}},{text:"Close",handler:function(){D.close()}}]});D.show(this)}},{text:"Priority",handler:function(){var D=new Ext.Window({title:"Edit Priority",id:"priority-win",plain:true,shadow:false,width:320,height:150,listeners:{afterlayout:function(){Ext.getCmp("multi_priority").focus("",10)}},layout:"form",bodyStyle:"padding: 5px",items:[new Testopia.TestCase.PriorityCombo({fieldLabel:"Priority",id:"multi_priority"})],buttons:[{text:"Submit",handler:function(){params={run_id:B.run.run_id,priority:Ext.getCmp("multi_priority").getValue(),ids:Testopia.Util.getSelectedObjects(B,"case_id")};Testopia.Util.updateFromList("case",params,B);D.close()}},{text:"Close",handler:function(){D.close()}}]});D.show(this)}},{text:"Category",handler:function(){var D=new Ext.Window({title:"Edit Category",id:"status-win",plain:true,shadow:false,width:300,height:150,listeners:{afterlayout:function(){Ext.getCmp("multi_category").focus("",10)}},items:[new Testopia.Category.Combo({fieldLabel:"Category",id:"multi_category",params:{product_id:run.product_id}})],buttons:[{text:"Submit",handler:function(){Testopia.Util.updateFromList("case",{category:Ext.getCmp("case_category_combo").getValue(),ids:Testopia.Util.getSelectedObjects(B,"case_id")},B);D.close()}},{text:"Close",handler:function(){D.close()}}]});D.show(this)}},{text:"Assignee",handler:function(){var D=new Ext.Window({title:"Edit Assignee",id:"status-win",plain:true,shadow:false,width:320,height:150,listeners:{afterlayout:function(){Ext.getCmp("multi_assignee").focus("",10)}},layout:"form",bodyStyle:"padding: 5px",items:[new Testopia.User.Lookup({fieldLabel:"Assignee",id:"multi_assignee"}),new Ext.form.Checkbox({fieldLabel:"Apply to all cases in this run",id:"assignee_applyall"})],buttons:[{text:"Submit",handler:function(){params={run_id:B.run.run_id,applyall:Ext.getCmp("assignee_applyall").getValue(),assignee:Ext.getCmp("multi_assignee").getValue(),ids:Testopia.Util.getSelectedObjects(B,"caserun_id")};Testopia.Util.updateFromList("caserun",params,B);D.close()}},{text:"Close",handler:function(){D.close()}}]});D.show(this)}}]}},{text:"Remove Selected Cases",icon:"extensions/testopia/img/delete.png",iconCls:"img_button_16x",handler:this.deleteList.createDelegate(this)},{text:"Add or Remove Tags",handler:function(){Testopia.Tags.update("case",B)}},{text:"New Test Run",id:"addRun",handler:function(){window.location="tr_new_run.cgi?plan_id="+run.plan_id}},{text:"Clone Run with Selected Cases",handler:function(){Testopia.TestRun.ClonePopup(B.run.product_id,B.run.run_id,Testopia.Util.getSelectedObjects(B,"case_id"))}},{text:"Copy or Link Selected Test Cases to Plan(s)... ",handler:function(){var D=B.getSelectionModel().getSelected();Testopia.TestCase.clonePopup(B.run.product_id,Testopia.Util.getSelectedObjects(B,"case_id"))}},{text:"Add Selected Test Cases to Run... ",handler:function(){Ext.Msg.prompt("Add to runs","",function(D,E){if(D=="ok"){Testopia.Util.updateFromList("case",{addruns:E,ids:Testopia.Util.getSelectedObjects(B,"case_id")},B)}})}},{text:"Refresh List",icon:"extensions/testopia/img/refresh.png",iconCls:"img_button_16x",handler:function(){B.store.reload()}},{text:"View Test Case in a New Window",handler:function(){window.open("tr_show_case.cgi?case_id="+B.store.getAt(B.selindex).get("case_id"))}},{text:"List These Test Cases in a New Window",handler:function(){var D=Ext.getCmp("caserun_search").form.getValues();if(D){window.open("tr_list_cases.cgi?"+Testopia.Util.JSONToURLQuery(D,"",["current_tab"])+"&isactive=1")}else{window.open("tr_list_cases.cgi?run_id="+B.store.getAt(B.selindex).get("run_id"))}}}]})}C.stopEvent();if(B.getSelectionModel().getCount()<1){B.getSelectionModel().selectRow(A)}this.menu.showAt(C.getXY())},onGridEdit:function(B){var A={caserun_id:B.record.get("caserun_id")};var C=this.store;switch(B.field){case"sortkey":A.action="update_sortkey";A.sortkey=B.value;break;case"build":A.action="update_build";A.build_id=B.value;break;case"environment":A.action="update_environment";A.caserun_env=B.value;break;case"assignee":A.action="update_assignee";A.assignee=B.value;break;case"priority":A.action="update_priority";A.priority=B.value;break;case"category":A.action="update_category";A.category=B.value;break}this.form.submit({url:"tr_caserun.cgi",params:A,success:function(E,D){if(D.result.caserun){var F=B.grid.store.reader.readRecords({Result:[D.result.caserun]}).records[0];B.grid.store.insert(B.row,F);C.commitChanges();B.grid.store.remove(B.record);B.grid.getSelectionModel().selectRow(B.row)}else{C.commitChanges()}},failure:function(E,D){Testopia.Util.error(E,D);C.rejectChanges()}})},deleteList:function(){var A=this;if(A.getSelectionModel().getCount()<1){return }var B=new Ext.Window({title:"Confirm Delete?",id:"case_delete_win",plain:true,shadow:false,width:520,height:250,layout:"table",bodyStyle:"padding: 5px",layoutConfig:{columns:1,width:"100%"},items:[{html:CASERUN_DELETE_WARNING,bodyStyle:"padding: 5px; font-weight:bold; color: red"},{xtype:"fieldset",items:[{xtype:"radio",name:"delete_cases_options",id:"delete_cases_radio_group",inputValue:"cr_all",checked:true,boxLabel:"Remove case from this run for all builds and environments",hideLabel:true},{xtype:"radio",name:"delete_cases_options",inputValue:"cr",boxLabel:"Remove case from this run for SELECTED build and environment only",hideLabel:true},{xtype:"radio",name:"delete_cases_options",inputValue:"plan_single",boxLabel:"Remove case from this run and from this test plan",hideLabel:true},{xtype:"radio",name:"delete_cases_options",inputValue:"all_plans",boxLabel:"Delete this case completely (remove from all test plans)",hideLabel:true}]}],buttons:[{text:"Submit",handler:function(){var C=new Ext.form.BasicForm("testopia_helper_frm");C.submit({url:"tr_list_caseruns.cgi",params:{caserun_ids:Testopia.Util.getSelectedObjects(A,"caserun_id"),action:"delete",deltype:Ext.getCmp("delete_cases_radio_group").getGroupValue(),ctype:"json"},success:function(D){Ext.Msg.show({msg:"Test cases removed",buttons:Ext.Msg.OK,icon:Ext.MessageBox.INFO});A.store.reload()},failure:function(E,D){Testopia.Util.error(E,D);A.store.reload()}});B.close()}},{text:"Cancel",handler:function(){B.close()}}]});B.show(this)},onActivate:function(A){if(!this.store.getCount()){this.store.load()}}});Testopia.TestCaseRun.Info=function(){this.caserun_id;this.store=new Ext.data.Store({url:"tr_caserun.cgi",baseParams:{action:"gettext"},reader:new Ext.data.XmlReader({record:"casetext",id:"case_id"},[{name:"action",mapping:"action"},{name:"results",mapping:"effect"},{name:"setup",mapping:"setup"},{name:"breakdown",mapping:"breakdown"},{name:"case_id",mapping:"case_id"},{name:"summary",mapping:"summary"},{name:"notes",mapping:"notes"}])});var A=this.store;A.on("load",function(C,D){Ext.getCmp("action_editor").setValue(D[0].get("action"));Ext.getCmp("effect_editor").setValue(D[0].get("results"));Ext.getCmp("setup_editor").setValue(D[0].get("setup"));Ext.getCmp("breakdown_editor").setValue(D[0].get("breakdown"));Ext.getCmp("caserun_tb_summary").setText("Case "+D[0].get("case_id")+" - "+D[0].get("summary"))});appendNote=function(){var C=new Ext.form.BasicForm("testopia_helper_frm",{});C.submit({url:"tr_list_caseruns.cgi",params:{action:"update",note:Ext.getCmp("caserun_append_note_fld").getValue(),ids:Testopia.Util.getSelectedObjects(Ext.getCmp("caserun_grid"),"caserun_id")},success:function(){Ext.getCmp("caserun_append_note_fld").reset();A.reload()},failure:Testopia.Util.error})};processText=function(){var C=new Ext.form.BasicForm("testopia_helper_frm",{});var D={};D.tcsetup=Ext.getCmp("setup_editor").getValue();D.tcbreakdown=Ext.getCmp("breakdown_editor").getValue();D.tcaction=Ext.getCmp("action_editor").getValue();D.tceffect=Ext.getCmp("effect_editor").getValue();D.case_id=Ext.getCmp("caserun_grid").getSelectionModel().getSelected().get("case_id");D.action="update_doc";C.submit({url:"tr_process_case.cgi",params:D,success:function(){Testopia.Util.notify.msg("Test case updated","Test Case {0} was updated successfully","Document")},failure:Testopia.Util.error})};var B=new Ext.Toolbar({id:"summary_tb",disabled:true,items:[new Ext.Button({template:imgButtonTpl,text:"extensions/testopia/img/IDLE.gif",tooltip:"Mark as IDLE (Not Run)",handler:function(){Testopia.Util.updateFromList("caserun",{status_id:1,ids:Testopia.Util.getSelectedObjects(Ext.getCmp("caserun_grid"),"caserun_id")},Ext.getCmp("caserun_grid"))}}),new Ext.Button({template:imgButtonTpl,text:"extensions/testopia/img/PASSED.gif",tooltip:"Mark as PASSED",handler:function(){Testopia.Util.updateFromList("caserun",{status_id:2,ids:Testopia.Util.getSelectedObjects(Ext.getCmp("caserun_grid"),"caserun_id"),update_bug:Ext.getCmp("update_bugs").getValue()},Ext.getCmp("caserun_grid"))}}),new Ext.Button({template:imgButtonTpl,text:"extensions/testopia/img/FAILED.gif",tooltip:"Mark as FAILED",handler:function(){Testopia.Util.updateFromList("caserun",{status_id:3,ids:Testopia.Util.getSelectedObjects(Ext.getCmp("caserun_grid"),"caserun_id"),update_bug:Ext.getCmp("update_bugs").getValue()},Ext.getCmp("caserun_grid"))}}),new Ext.Button({template:imgButtonTpl,text:"extensions/testopia/img/RUNNING.gif",tooltip:"Mark as RUNNING",handler:function(){var C=0;var F=1;var E=Ext.getCmp("caserun_grid").getSelectionModel().getSelections();for(var D=0;D<E.length;D++){if(E[D].get("assignee")!=user_login){F=0;break}}if(F==0){Ext.Msg.show({title:"Reassign Test Case?",msg:"Setting this test case to Running will lock it so that only the assignee can update it. Would you like to make yourself the assignee?",buttons:Ext.MessageBox.YESNO,icon:Ext.MessageBox.QUESTION,fn:function(G){if(G=="yes"){C=1}Testopia.Util.updateFromList("caserun",{status_id:4,reassign:C,ids:Testopia.Util.getSelectedObjects(Ext.getCmp("caserun_grid"),"caserun_id")},Ext.getCmp("caserun_grid"))}})}else{Testopia.Util.updateFromList("caserun",{status_id:4,reassign:C,ids:Testopia.Util.getSelectedObjects(Ext.getCmp("caserun_grid"),"caserun_id")},Ext.getCmp("caserun_grid"))}}}),new Ext.Button({template:imgButtonTpl,text:"extensions/testopia/img/PAUSED.gif",tooltip:"Mark as PAUSED",handler:function(){Testopia.Util.updateFromList("caserun",{status_id:5,ids:Testopia.Util.getSelectedObjects(Ext.getCmp("caserun_grid"),"caserun_id")},Ext.getCmp("caserun_grid"))}}),new Ext.Button({template:imgButtonTpl,text:"extensions/testopia/img/BLOCKED.gif",tooltip:"Mark as BLOCKED",handler:function(){Testopia.Util.updateFromList("caserun",{status_id:6,ids:Testopia.Util.getSelectedObjects(Ext.getCmp("caserun_grid"),"caserun_id")},Ext.getCmp("caserun_grid"))}}),new Ext.Button({template:imgButtonTpl,text:"extensions/testopia/img/ERROR.gif",tooltip:"Mark as ERROR",handler:function(){Testopia.Util.updateFromList("caserun",{status_id:7,ids:Testopia.Util.getSelectedObjects(Ext.getCmp("caserun_grid"),"caserun_id")},Ext.getCmp("caserun_grid"))}}),new Ext.Toolbar.TextItem({text:"",id:"caserun_tb_summary"})]});Testopia.TestCaseRun.Info.superclass.constructor.call(this,{id:"case_details_panel",layout:"fit",region:"south",split:true,border:false,style:"padding-bottom: 10px",bodyBorder:false,collapsible:true,height:340,items:[{xtype:"tabpanel",bodyBorder:false,activeTab:0,id:"caserun_center_region",title:"Details",tbar:B,items:[{layout:"column",title:"Action / Expected Results",id:"action_panel",items:[{columnWidth:0.5,layout:"fit",items:{title:"Action",height:Ext.state.Manager.get("bigtext_height",230),id:"cr_action_panel",bodyBorder:false,border:false,layout:"fit",autoScroll:true,items:[{id:"action_editor",xtype:"htmleditor"}]}},{columnWidth:0.5,layout:"fit",items:{title:"Expected Results",height:Ext.state.Manager.get("bigtext_height",230),id:"cr_results_panel",bodyBorder:false,border:false,autoScroll:true,layout:"fit",items:[{id:"effect_editor",xtype:"htmleditor"}]}}],buttons:[{text:"Update Action/Results",handler:processText.createDelegate(this)}]},{layout:"column",title:"Set Up / Break Down",items:[{columnWidth:0.5,layout:"fit",items:{title:"Setup",height:Ext.state.Manager.get("bigtext_height",230),id:"cr_setup_panel",bodyBorder:false,autoScroll:true,border:false,layout:"fit",items:[{id:"setup_editor",xtype:"htmleditor"}]}},{columnWidth:0.5,layout:"fit",items:{title:"Breakdown",height:Ext.state.Manager.get("bigtext_height",230),id:"cr_breakdown_panel",bodyBorder:false,autoScroll:true,border:false,layout:"fit",items:[{id:"breakdown_editor",xtype:"htmleditor"}]}}],buttons:[{text:"Update Setup/Breakdown",handler:processText.createDelegate(this)}]},{title:"Notes",id:"caserun_notes_panel",border:false,bodyBorder:false,autoScroll:true,layout:"fit",items:[{xtype:"dataview",bodyBorder:false,store:A,itemSelector:"div.breakdowndiv",loadingText:"Loading...",tpl:new Ext.XTemplate('<tpl for=".">','<div id="notesdiv" style="margin: 5px; padding: 5px; border: 1px solid black;"><pre>{notes}</pre></div>',"</tpl>",'<div class="x-clear"><input id="caserun_append_note_fld" ></div>')}],bbar:["Add a Note: ",{xtype:"textfield",id:"caserun_append_note_fld",width:1000},{xtype:"button",text:"Append Note",handler:appendNote.createDelegate(this)}]},new Testopia.TestCaseRun.History(),new Testopia.Attachment.Grid({id:0,type:"caserun"}),new Testopia.TestCase.Bugs.Grid(),new Testopia.TestCase.Components(),new Testopia.Tags.ObjectTags("case",0)]}]})};Ext.extend(Testopia.TestCaseRun.Info,Ext.Panel,this);Testopia.TestCaseRun.History=function(){this.store=new Ext.data.JsonStore({url:"tr_caserun.cgi",listeners:{exception:Testopia.Util.loadError},baseParams:{action:"gethistory"},root:"records",fields:[{name:"caserun_id",mapping:"case_run_id"},{name:"build",mapping:"build_name"},{name:"environment",mapping:"env_name"},{name:"status",mapping:"status_name"},{name:"testedby",mapping:"testedby"},{name:"closed",mapping:"close_date"},{name:"isactive",mapping:"isactive"},{name:"bug_list",mapping:"bug_list"}]});this.columns=[{header:"Build",width:150,dataIndex:"build",sortable:true},{header:"Environment",width:150,dataIndex:"environment",sortable:true},{header:"Status",width:50,dataIndex:"status",sortable:true,renderer:Testopia.Util.displayStatusIcon},{header:"Tested By",width:200,dataIndex:"testedby",sortable:true},{header:"Closed",width:150,dataIndex:"closed",sortable:true},{header:"Bugs In This Build and Environment",width:100,dataIndex:"bug_list",sortable:false,hideable:true,renderer:function(A){if(!A){return }var D=A.bugs;var C="";for(var B=0;B<D.length;B++){if(typeof D[B]!="function"){C=C+'<a href="show_bug.cgi?id='+D[B].bug_id+'" '+(D[B].closed?'class="bz_closed"':"")+">"+D[B].bug_id+"</a>, "}}return C}}];Testopia.TestCaseRun.History.superclass.constructor.call(this,{border:false,title:"History",id:"caserun_history_panel",bodyBorder:false,loadMask:{msg:"Loading Test Cases..."},autoScroll:true,sm:new Ext.grid.RowSelectionModel({singleSelect:true})});this.on("activate",this.onActivate,this)};Ext.extend(Testopia.TestCaseRun.History,Ext.grid.GridPanel,{onActivate:function(A){this.store.load({params:{action:"gethistory",caserun_id:Ext.getCmp("caserun_grid").getSelectionModel().getSelected().get("caserun_id")}})}});Testopia.TestCase.Bugs.Grid=function(E){var A=new Ext.form.BasicForm("testopia_helper_frm",{});function D(F){return'<a href="show_bug.cgi?id='+F+'" target="_blank">'+F+"</a>"}var B;if(E){B=E}this.tcid=B;this.store=new Ext.data.JsonStore({url:"tr_process_case.cgi",root:"bugs",listeners:{exception:Testopia.Util.loadError},baseParams:{action:"getbugs"},fields:[{name:"run_id",mapping:"run_id"},{name:"build",mapping:"build"},{name:"env",mapping:"env"},{name:"summary",mapping:"summary"},{name:"case_run_id",mapping:"case_run_id"},{name:"bug_id",mapping:"bug_id"},{name:"status",mapping:"status"},{name:"resolution",mapping:"resolution"},{name:"assignee",mapping:"assignee"},{name:"severity",mapping:"severity"},{name:"priority",mapping:"priority"}]});addbug=function(){B=this.tcid;var G;var F="case";if(Ext.getCmp("caserun_grid")){F="caserun";G=Testopia.Util.getSelectedObjects(Ext.getCmp("caserun_grid"),"caserun_id")}else{G=B}A.submit({url:"tr_list_cases.cgi",params:{action:"update_bugs",bug_action:"attach",bugs:Ext.getCmp("attachbug").getValue(),type:F,ids:G},success:function(){C.load({params:{case_id:B}});Ext.getCmp("attachbug").reset()},failure:Testopia.Util.error})};removebug=function(){B=this.tcid;var F="case";if(Ext.getCmp("caserun_grid")){F="caserun";ids=Testopia.Util.getSelectedObjects(Ext.getCmp("caserun_grid"),"caserun_id")}else{ids=B}A.submit({url:"tr_list_cases.cgi",params:{action:"update_bugs",bugs:Testopia.Util.getSelectedObjects(Ext.getCmp("case_bugs_panel"),"bug_id"),type:F,ids:ids},success:function(){C.load({params:{case_id:B}})},failure:Testopia.Util.error})};newbug=function(){var F=new Ext.Panel({id:"new_bug_panel"});var H;if(Ext.getCmp("caserun_grid")&&Ext.getCmp("caserun_grid").getSelectionModel().getCount()){H=Ext.getCmp("caserun_grid").getSelectionModel().getSelected().get("caserun_id")}var G=new Ext.data.Store({url:"tr_process_case.cgi",baseParams:{action:"case_to_bug",case_id:this.tcid,caserun_id:H},reader:new Ext.data.XmlReader({record:"newbug",id:"case_id"},[{name:"product",mapping:"product"},{name:"version",mapping:"version"},{name:"component",mapping:"component"},{name:"comment",mapping:"comment"},{name:"case_id",mapping:"case_id"},{name:"assigned_to",mapping:"assigned_to"},{name:"qa_contact",mapping:"qa_contact"},{name:"short_desc",mapping:"short_desc"}])});G.load();G.on("load",function(){var I="enter_bug.cgi?";for(var J=0;J<G.fields.keys.length;J++){I=I+G.fields.keys[J]+"="+escape(G.getAt(0).get(G.fields.keys[J]))+"&"}I=I+"caserun_id="+H;window.open(I)})};var C=this.store;this.columns=[{header:"Bug",width:150,dataIndex:"bug_id",sortable:true,renderer:D},{header:"Found In Run",width:50,dataIndex:"run_id",sortable:true,renderer:Testopia.Util.makeLink.createDelegate(this,["run"],true)},{header:"With Build",width:50,dataIndex:"build",sortable:true},{header:"Environment",width:50,dataIndex:"env",sortable:true},{id:"bugs_summary",header:"Summary",width:200,dataIndex:"summary",sortable:true},{header:"Status",width:50,dataIndex:"status",sortable:true},{header:"Resolution",width:50,dataIndex:"resolution",sortable:true},{header:"Severity",width:50,dataIndex:"severity",sortable:true},{header:"Asignee",width:150,dataIndex:"assignee",sortable:true},{header:"Priority",width:50,dataIndex:"priority",sortable:true}];Testopia.TestCase.Bugs.Grid.superclass.constructor.call(this,{tbar:[new Ext.form.TextField({width:50,id:"attachbug"}),{xtype:"button",tooltip:"Attach a Bug",icon:"extensions/testopia/img/add.png",iconCls:"img_button_16x",handler:addbug.createDelegate(this)},{xtype:"button",tooltip:"File new Bug",icon:"extensions/testopia/img/new.png",iconCls:"img_button_16x",handler:newbug.createDelegate(this)},{xtype:"button",tooltip:"Remove selected bugs from test case or run",icon:"extensions/testopia/img/delete.png",iconCls:"img_button_16x",handler:removebug.createDelegate(this)},"-","This view includes all bugs attached to the selected test case regardless of run"],border:false,title:"Bugs",id:"case_bugs_panel",bodyBorder:false,autoExpandColumn:"bugs_summary",loadMask:{msg:"Loading..."},autoScroll:true,sm:new Ext.grid.RowSelectionModel({singleSelect:true})});this.on("rowcontextmenu",this.onContextClick,this);this.on("activate",this.onActivate,this)};Ext.extend(Testopia.TestCase.Bugs.Grid,Ext.grid.GridPanel,{onContextClick:function(B,A,C){this.menu=new Ext.menu.Menu({id:"tags-ctx-menu",items:[{text:"Refresh List",icon:"extensions/testopia/img/refresh.png",iconCls:"img_button_16x",handler:function(){B.store.reload()}},{text:"Attach Selected Bug to Current Run/Build/Environment",id:"reattach_bug",icon:"extensions/testopia/img/add.png",disabled:Ext.getCmp("caserun_grid")?false:true,iconCls:"img_button_16x",handler:function(){var E=B.store.getAt(A);var D=new Ext.form.BasicForm("testopia_helper_frm",{});D.submit({url:"tr_list_cases.cgi",params:{action:"update_bugs",bug_action:"attach",bugs:Testopia.Util.getSelectedObjects(Ext.getCmp("case_bugs_panel"),"bug_id"),type:"caserun",ids:Testopia.Util.getSelectedObjects(Ext.getCmp("caserun_grid"),"caserun_id")},success:function(){Ext.getCmp("caserun_grid").store.reload();B.store.reload();Ext.getCmp("attachbug").reset()},failure:Testopia.Util.error})}}]});C.stopEvent();if(B.getSelectionModel().getCount()<1){B.getSelectionModel().selectRow(A)}this.menu.showAt(C.getXY())},onActivate:function(A){this.store.load({params:{case_id:this.tcid}})}});Testopia.TestCase.Components=function(A){var H=new Ext.form.BasicForm("testopia_helper_frm",{});var E;var D;if(A){E=A}else{if(Ext.getCmp("caserun_grid").getSelectionModel().getCount()){E=Ext.getCmp("caserun_grid").getSelectionModel().getSelected().get("case_id")}}try{if(run){D=run.plan.product_id}}catch(C){try{if(tcase){D=tcase.product_id}}catch(F){}}this.tcid=E;this.store=new Ext.data.JsonStore({url:"tr_process_case.cgi",root:"comps",listeners:{exception:Testopia.Util.loadError},baseParams:{action:"getcomponents"},id:"component_id",fields:[{name:"name",mapping:"name"},{name:"id",mapping:"id"},{name:"product",mapping:"product"}]});var B=this.store;this.columns=[{header:"ID",width:150,dataIndex:"id",sortable:false,hidden:true},{id:"comp_name",header:"Component",width:150,dataIndex:"name",sortable:true},{id:"product",header:"Product",width:150,dataIndex:"product",sortable:true}];var I=new Testopia.Product.Combo({id:"comp_product_chooser",mode:"local",value:D});var G=new Testopia.TestCase.ComponentCombo({params:{product_id:D}});this.pchooser=I;I.on("select",function(){G.reset();G.store.baseParams={product_id:I.getValue(),action:"getcomponents"};G.store.load()});addcomp=function(){E=this.tcid;if(typeof E=="object"){H.submit({url:"tr_list_cases.cgi",params:{action:"update",comp_action:"add",components:G.getValue(),ids:Testopia.Util.getSelectedObjects(E,"case_id")},success:function(){Testopia.Util.notify.msg("Component Added","Added component {0} to {1} cases(s)",G.getRawValue(),E.getSelectionModel().getCount())},failure:Testopia.Util.error});return }H.submit({url:"tr_process_case.cgi",params:{action:"addcomponent",component_id:G.getValue(),case_id:this.tcid},success:function(){B.load({params:{case_id:E}})},failure:Testopia.Util.error})};removecomp=function(){E=this.tcid;if(typeof E=="object"){H.submit({url:"tr_list_cases.cgi",params:{action:"update",comp_action:"rem",components:G.getValue(),ids:Testopia.Util.getSelectedObjects(E,"case_id")},success:function(){Testopia.Util.notify.msg("Component Removed","Removed component {0} from {1} cases(s)",G.getRawValue(),E.getSelectionModel().getCount())},failure:Testopia.Util.error});return }H.submit({url:"tr_process_case.cgi",params:{action:"removecomponent",component_id:Testopia.Util.getSelectedObjects(Ext.getCmp("case_comps_panel"),"id"),case_id:this.tcid},success:function(){B.load({params:{case_id:E}})},failure:Testopia.Util.error})};Testopia.TestCase.Components.superclass.constructor.call(this,{tbar:[I,G,{xtype:"button",tooltip:"Attach selected component",icon:"extensions/testopia/img/add.png",iconCls:"img_button_16x",handler:addcomp.createDelegate(this)},{xtype:"button",tooltip:"Remove component from test case",icon:"extensions/testopia/img/delete.png",iconCls:"img_button_16x",handler:removecomp.createDelegate(this)}],border:false,title:"Components",id:"case_comps_panel",bodyBorder:false,autoExpandColumn:"comp_name",loadMask:{msg:"Loading..."},autoScroll:true,sm:new Ext.grid.RowSelectionModel({singleSelect:false})});this.on("rowcontextmenu",this.onContextClick,this);this.on("activate",this.onActivate,this)};Ext.extend(Testopia.TestCase.Components,Ext.grid.GridPanel,{onContextClick:function(B,A,C){if(!this.menu){this.menu=new Ext.menu.Menu({id:"tags-ctx-menu",items:[{text:"Refresh List",icon:"extensions/testopia/img/refresh.png",iconCls:"img_button_16x",handler:function(){B.store.reload()}}]})}C.stopEvent();if(B.getSelectionModel().getCount()<1){B.getSelectionModel().selectRow(A)}this.menu.showAt(C.getXY())},onActivate:function(A){this.store.load({params:{case_id:this.tcid},callback:function(C,D,B){if(B===false){Testopia.Util.loadError()}}});this.pchooser.store.load()}});Testopia.TestCase.Bugs.update=function(A){function C(G,F,D){var E=new Ext.form.BasicForm("testopia_helper_frm",{});E.submit({url:"tr_list_cases.cgi",params:{action:"update_bugs",bug_action:G,bugs:F,type:"case",ids:Testopia.Util.getSelectedObjects(D,"case_id")},success:function(){},failure:Testopia.Util.error})}var B=new Ext.Window({title:"Add or Remove Bugs",id:"bugs_edit_win",layout:"fit",split:true,plain:true,shadow:false,listeners:{afterlayout:function(){Ext.getCmp("bug_field").focus("",10)}},width:350,height:150,items:[new Ext.FormPanel({labelWidth:"40",bodyStyle:"padding: 5px",items:[{xtype:"textfield",name:"bugs",id:"bug_field",fieldLabel:"Bugs"}]})],buttons:[{text:"Attach Bug",handler:function(){C("attach",Ext.getCmp("bug_field").getValue(),A);B.close()}},{text:"Remove Bug",handler:function(){C("remove",Ext.getCmp("bug_field").getValue(),A);B.close()}},{text:"Close",handler:function(){B.close()}}]});B.show()};Testopia.TestRun.Grid=function(F,B){F.limit=Ext.state.Manager.get("TESTOPIA_DEFAULT_PAGE_SIZE",25);F.current_tab="run";this.params=F;this.store=new Ext.data.JsonStore({url:"tr_list_runs.cgi",listeners:{exception:Testopia.Util.loadError},baseParams:F,totalProperty:"totalResultsAvailable",root:"Result",id:"run_id",fields:[{name:"run_id",mapping:"run_id"},{name:"plan_id",mapping:"plan_id"},{name:"summary",mapping:"summary"},{name:"manager",mapping:"manager_name"},{name:"start_date",mapping:"start_date"},{name:"stop_date",mapping:"stop_date"},{name:"build",mapping:"build.name"},{name:"environment",mapping:"environment.name"},{name:"status",mapping:"status"},{name:"case_count",mapping:"case_count"},{name:"run_product_version",mapping:"product_version"},{name:"product_id",mapping:"product_id"},{name:"passed_pct",mapping:"passed_pct"},{name:"failed_pct",mapping:"failed_pct"},{name:"blocked_pct",mapping:"blocked_pct"},{name:"complete_pct",mapping:"complete_pct"},{name:"plan_version",mapping:"plan_version"},{name:"bug_list",mapping:"bug_list"}],remoteSort:true});var D=this.store;D.paramNames.sort="order";D.on("beforeload",function(G,H){G.baseParams.ctype="json"});var A=new Testopia.Build.Combo({hiddenName:"build",id:"run_grid_build",mode:"remote",params:{product_id:F.product_id,activeonly:1},listeners:{startedit:function(){var G=Ext.getCmp(B.id||"run_grid").getSelectionModel().getSelected().get("product_id");if(A.store.baseParams.product_id!=G){A.store.baseParams.product_id=G;A.store.load()}}}});var E=new Testopia.Environment.Combo({hiddenName:"environment",id:"run_grid_env",mode:"remote",params:{product_id:F.product_id,isactive:1},listeners:{startedit:function(){var G=Ext.getCmp(B.id||"run_grid").getSelectionModel().getSelected().get("product_id");if(E.store.baseParams.product_id!=G){E.store.baseParams.product_id=G;E.store.load()}}}});var C=new Testopia.Product.VersionCombo({hiddenName:"run_product_version",id:"run_grid_version",mode:"remote",params:{product_id:F.product_id},listeners:{startedit:function(){var G=Ext.getCmp(B.id||"run_grid").getSelectionModel().getSelected().get("product_id");if(C.store.baseParams.product_id!=G){C.store.baseParams.product_id=G;C.store.load()}}}});this.columns=[{header:"Run ID",width:30,dataIndex:"run_id",id:"run_id",sortable:true,renderer:Testopia.Util.makeLink.createDelegate(this,["run"],true),hideable:false},{header:"Summary",width:220,dataIndex:"summary",id:"run_name",sortable:true,editor:{xtype:"textfield",allowBlank:false}},{header:"Manager Name",width:150,dataIndex:"manager",id:"manager_name_col",sortable:true,hidden:true,editor:new Testopia.User.Lookup({hiddenName:"manager"}),renderer:Testopia.Util.ComboRenderer.createDelegate(this)},{header:"Start Date",width:110,dataIndex:"start_date",sortable:true,hidden:true},{header:"Stop Date",width:110,dataIndex:"stop_date",sortable:true,hidden:true},{header:"Build",width:110,dataIndex:"build",id:"build_col",sortable:true,editor:A,renderer:Testopia.Util.ComboRenderer.createDelegate(this)},{header:"Enviroment",width:110,dataIndex:"environment",id:"environment",sortable:true,editor:E,renderer:Testopia.Util.ComboRenderer.createDelegate(this)},{header:"Status",width:50,dataIndex:"status",id:"status",sortable:true},{header:"Case Count",width:30,dataIndex:"case_count",sortable:false,hidden:true},{header:"Product Version",width:150,dataIndex:"product_version",id:"product_version",sortable:true,hidden:true,editor:C,renderer:Testopia.Util.ComboRenderer.createDelegate(this)},{header:"Plan ID",width:30,dataIndex:"plan_id",sortable:true,hidden:true,renderer:Testopia.Util.makeLink.createDelegate(this,["plan"],true)},{header:"Complete",width:110,dataIndex:"complete_pct",sortable:false,hideable:true,renderer:function(H,G,I){var J="";J=J+'<div class="x-progress-wrap" style="width: 98px; height: 15;">';J=J+'    <div style="position: relative;">';J=J+'    <div class="x-progress-bar-green" style="width: '+Math.floor(I.get("passed_pct")*98)+'px; height: 14;"></div>';J=J+'    <div class="x-progress-bar-red" style="width: '+Math.floor(I.get("failed_pct")*98)+'px; height: 14;"></div>';J=J+'    <div class="x-progress-bar-orange" style="width: '+Math.floor(I.get("blocked_pct")*98)+'px; height: 14;"></div>';J=J+'    <div class="x-progress-text-main x-hidden" style="font-weight: bold; z-index: 99;">';J=J+'        <div style="width: 100px; height: 12px;">'+H+"</div>";J=J+"    </div>";J=J+'    <div class="x-progress-text-main x-progress-text-back-main" style="font-weight: bold;">';J=J+'        <div style="width: 100px; height: 12px;">'+H+"</div>";J=J+"    </div>";J=J+"    </div>";J=J+"</div>";return J}}];this.form=new Ext.form.BasicForm("testopia_helper_frm",{});this.bbar=new Testopia.Util.PagingBar("run",this.store);Testopia.TestRun.Grid.superclass.constructor.call(this,{title:"Test Runs",id:B.id||"run_grid",loadMask:{msg:"Loading Test Runs..."},autoExpandColumn:"run_summary",autoScroll:true,stripeRows:true,plugins:[new Ext.ux.grid.RowEditor({id:"run_row_editor",saveText:"Update"})],sm:new Ext.grid.RowSelectionModel({singleSelect:false,listeners:{rowselect:function(I,G,H){Ext.getCmp("new_case_to_run_button").enable();Ext.getCmp("delete_run_list_btn").enable();Ext.getCmp("edit_run_list_btn").enable()},rowdeselect:function(I,G,H){if(I.getCount()<1){Ext.getCmp("new_case_to_run_button").disable();Ext.getCmp("delete_run_list_btn").disable();Ext.getCmp("edit_run_list_btn").disable()}}}}),viewConfig:{forceFit:true},tbar:[{xtype:"button",text:"Add Test Cases to Selected Runs",id:"new_case_to_run_button",disabled:true,handler:function(){var G=Ext.getCmp(B.id||"run_grid").getSelectionModel().getSelected();Testopia.TestRun.AddCasePopup(G)}},new Ext.Toolbar.Fill(),{xtype:"button",id:"save_run_list_btn",icon:"extensions/testopia/img/save.png",iconCls:"img_button_16x",tooltip:"Save this search",handler:function(G,H){Testopia.Search.save("run",Ext.getCmp(B.id||"run_grid").store.baseParams)}},{xtype:"button",id:"link_run_list_btn",icon:"extensions/testopia/img/link.png",iconCls:"img_button_16x",tooltip:"Create a link to this list",handler:function(G,H){Testopia.Search.LinkPopup(Ext.getCmp(B.id||"run_grid").store.baseParams)}},{xtype:"button",id:"edit_run_list_btn",icon:"extensions/testopia/img/edit.png",iconCls:"img_button_16x",disabled:true,tooltip:"Edit Selected Test Run",handler:function(){Testopia.Util.editFirstSelection(Ext.getCmp(B.id||"run_grid"))}},{xtype:"button",id:"add_run_list_btn",icon:"extensions/testopia/img/new.png",iconCls:"img_button_16x",tooltip:"Create a New Test Run",handler:function(){try{if(plan){Testopia.TestRun.NewRunPopup(plan)}}catch(G){window.location="tr_new_run.cgi"}}},{xtype:"button",id:"delete_run_list_btn",icon:"extensions/testopia/img/delete.png",iconCls:"img_button_16x",disabled:true,tooltip:"Delete Selected Test Runs",handler:this.deleteList.createDelegate(this)}]});Ext.apply(this,B);this.on("rowcontextmenu",this.onContextClick,this);this.on("activate",this.onActivate,this);Ext.getCmp("run_row_editor").on("afteredit",this.onGridEdit,this)};Ext.extend(Testopia.TestRun.Grid,Ext.grid.GridPanel,{onContextClick:function(B,A,C){B.selindex=A;if(!this.menu){this.menu=new Ext.menu.Menu({id:"run-ctx-menu",enableScrolling:false,items:[{text:"Reports",menu:{enableScrolling:false,items:[{text:"New Run Status Report",handler:function(){Ext.getCmp("object_panel").setActiveTab("dashboardpanel");var D=new Ext.ux.Portlet({title:"Status Report",closable:true,autoScroll:true,tools:PortalTools});D.url="tr_run_reports.cgi?type=status&run_ids="+Testopia.Util.getSelectedObjects(B,"run_id");Testopia.Search.dashboard_urls.push(D.url);Ext.getCmp("dashboard_leftcol").add(D);Ext.getCmp("dashboard_leftcol").doLayout();D.load({url:D.url})}},{text:"New Run Completion Report",handler:function(){Ext.getCmp("object_panel").setActiveTab("dashboardpanel");var D=new Ext.ux.Portlet({title:"Completion Report",closable:true,autoScroll:true,tools:PortalTools});D.url="tr_run_reports.cgi?type=completion&run_ids="+Testopia.Util.getSelectedObjects(B,"run_id");Testopia.Search.dashboard_urls.push(D.url);Ext.getCmp("dashboard_leftcol").add(D);Ext.getCmp("dashboard_leftcol").doLayout();D.load({url:D.url})}},{text:"New Run Execution Report",handler:function(){var D=new Ext.Window({title:"Select a date range",id:"run_execution_win",layout:"fit",split:true,plain:true,shadow:false,width:350,height:150,items:[new Ext.FormPanel({labelWidth:"40",bodyStyle:"padding: 5px",items:[{xtype:"datefield",id:"execution_start_date",fieldLabel:"Start Date",name:"chfieldfrom"},{xtype:"datefield",fieldLabel:"Stop Date",id:"execution_stop_date",emptyText:"Now",name:"chfieldto"},new Testopia.User.Lookup({id:"exec_tester",fieldLabel:"Tester (optional)"})]})],buttons:[{text:"Submit",handler:function(){Ext.getCmp("object_panel").setActiveTab("dashboardpanel");var E=new Ext.ux.Portlet({title:"Execution Report",closable:true,autoScroll:true,tools:PortalTools});E.url="tr_run_reports.cgi?type=execution&run_ids="+Testopia.Util.getSelectedObjects(B,"run_id")+"&chfieldfrom="+Ext.getCmp("execution_start_date").getValue()+"&chfieldto="+Ext.getCmp("execution_stop_date").getValue()+"&tester="+Ext.getCmp("exec_tester").getValue();Testopia.Search.dashboard_urls.push(E.url);Ext.getCmp("dashboard_leftcol").add(E);Ext.getCmp("dashboard_leftcol").doLayout();E.load({url:E.url});D.close()}},{text:"Cancel",handler:function(){D.close()}}]});D.show()}},{text:"New Priority Breakdown Report",handler:function(){Ext.getCmp("object_panel").setActiveTab("dashboardpanel");var D=new Ext.ux.Portlet({title:"Status Report",closable:true,autoScroll:true,tools:PortalTools});D.url="tr_run_reports.cgi?type=priority&run_ids="+Testopia.Util.getSelectedObjects(B,"run_id");Testopia.Search.dashboard_urls.push(D.url);Ext.getCmp("dashboard_leftcol").add(D);Ext.getCmp("dashboard_leftcol").doLayout();D.load({url:D.url})}},{text:"New Run Bug Report",handler:function(){Ext.getCmp("object_panel").setActiveTab("dashboardpanel");var D=new Ext.ux.Portlet({title:"Bug Report",closable:true,autoScroll:true,tools:PortalTools});D.url="tr_run_reports.cgi?type=bug_grid&run_ids="+Testopia.Util.getSelectedObjects(B,"run_id")+"&noheader=1";Testopia.Search.dashboard_urls.push(D.url);Ext.getCmp("dashboard_leftcol").add(D);Ext.getCmp("dashboard_leftcol").doLayout();D.load({scripts:true,url:D.url})}}]}},{text:"Edit",menu:{items:[{text:"Manager",handler:function(){var D=new Ext.Window({title:"Change Run Manager",id:"run_manager_win",layout:"fit",split:true,plain:true,shadow:false,listeners:{afterlayout:function(){Ext.getCmp("manager_update").focus("",10)}},width:350,height:150,items:[new Ext.FormPanel({labelWidth:"40",bodyStyle:"padding: 5px",items:[new Testopia.User.Lookup({id:"manager_update",fieldLabel:"Run Manager"})]})],buttons:[{text:"Update Manager",handler:function(){Testopia.Util.updateFromList("run",{manager:Ext.getCmp("manager_update").getValue(),ids:Testopia.Util.getSelectedObjects(B,"run_id")},B);D.close()}},{text:"Cancel",handler:function(){D.close()}}]});D.show()}},{text:"Tags",handler:function(){Testopia.Tags.update("run",B)}},{text:"Targets",handler:function(){var D=new Ext.Window({title:"Change Run Targets",id:"run_target_win",layout:"fit",split:true,plain:true,shadow:false,listeners:{afterlayout:function(){Ext.getCmp("target_completion").focus("",10)}},width:350,height:150,items:[new Ext.FormPanel({bodyStyle:"padding: 5px",items:[new Ext.form.NumberField({maxValue:100,minValue:0,id:"target_completion",allowBlank:true,fieldLabel:"Target Completion Rate",hiddenName:"target_completion",listeners:{valid:function(E){Ext.getCmp("target_pass").maxValue=E.getValue()}}}),new Ext.form.NumberField({maxValue:100,minValue:0,allowBlank:true,id:"target_pass",fieldLabel:"Target Pass Rate",hiddenName:"target_pass"})]})],buttons:[{text:"Update Targets",handler:function(){Testopia.Util.updateFromList("run",{target_pass:Ext.getCmp("target_pass").getValue(),target_completion:Ext.getCmp("target_completion").getValue(),ids:Testopia.Util.getSelectedObjects(B,"run_id")},B);D.close()}},{text:"Cancel",handler:function(){D.close()}}]});D.show()}}]}},{text:"Clone Selected Test Runs",icon:"extensions/testopia/img/copy.png",iconCls:"img_button_16x",handler:function(){Testopia.TestRun.ClonePopup(B.getSelectionModel().getSelected().get("product_id"),Testopia.Util.getSelectedObjects(B,"run_id"))}},{text:"Delete Selected Test Runs",icon:"extensions/testopia/img/delete.png",iconCls:"img_button_16x",handler:this.deleteList.createDelegate(this)},{text:"Refresh List",icon:"extensions/testopia/img/refresh.png",iconCls:"img_button_16x",handler:function(){B.store.reload()}},{text:"View Test Run in a New Window",handler:function(){window.open("tr_show_run.cgi?run_id="+B.store.getAt(B.selindex).get("run_id"))}},{text:"View Run's Test Cases in a New Window",handler:function(){window.open("tr_list_cases.cgi?run_id="+B.store.getAt(B.selindex).get("run_id"))}},{text:"Export Results as CSV",handler:function(){window.location="tr_list_caseruns.cgi?ctype=csv&viewall=1&run_id="+Testopia.Util.getSelectedObjects(B,"run_id")}}]})}C.stopEvent();if(B.getSelectionModel().getCount()<1){B.getSelectionModel().selectRow(A)}this.menu.showAt(C.getXY())},onGridEdit:function(D){var C=this.store;var A=D.record.data;A.action="edit";var B;if(!A.manager.match("@")){B=A.manager;delete A.manager}this.form.submit({url:"tr_process_run.cgi",params:A,success:function(F,E){A.manager=B;C.commitChanges()},failure:function(F,E){Testopia.Util.error(F,E);A.manager=B;C.rejectChanges()}})},deleteList:function(){var A=this;Ext.Msg.show({title:"Confirm Delete?",msg:RUN_DELETE_WARNING,buttons:Ext.Msg.YESNO,animEl:"run-delete-btn",icon:Ext.MessageBox.QUESTION,fn:function(C){if(C=="yes"){var B=new Ext.form.BasicForm("testopia_helper_frm");B.submit({url:"tr_list_runs.cgi",params:{run_ids:Testopia.Util.getSelectedObjects(A,"run_id"),action:"delete"},success:function(D){Ext.Msg.show({msg:"Test runs deleted",buttons:Ext.Msg.OK,icon:Ext.MessageBox.INFO});A.store.reload()},failure:function(E,D){Testopia.Util.error(E,D);A.store.reload()}})}}})},onActivate:function(A){if(!this.store.getCount()){this.store.load()}}});Testopia.TestRun.NewRunForm=function(A){if(A.data){A=A.data}var B=new Testopia.TestCase.Grid({plan_id:A.plan_id,case_status:"CONFIRMED"},{title:"Select From Existing Cases",region:"center",id:"newrun_casegrid",height:500});this.casegrid=B;B.on("render",function(D){for(var C=0;C<D.getTopToolbar().items.length;C++){D.getTopToolbar().items.items[C].destroy()}D.getTopToolbar().add({xtype:"button",text:"Select All",handler:function(){B.getSelectionModel().selectAll()}},"->",{xtype:"checkbox",id:"selectall"}," "," Include all CONFIRMED Cases in Plan "+A.id)});Testopia.TestRun.NewRunForm.superclass.constructor.call(this,{url:"tr_new_run.cgi",id:"newrunform",baseParams:{action:"add"},labelAlign:"left",frame:true,title:"New Run",bodyStyle:"padding:5px 5px 0",width:1050,height:800,layout:"border",items:[{region:"north",title:"Filter Cases",height:168,collapsible:true,listeners:{render:function(C){C.load({url:"tr_process_plan.cgi",params:{action:"getfilter",plan_id:A.plan_id},scripts:true})}},autoShow:true,autoScroll:true,buttons:[{text:"Filter",handler:function(){var C=new Ext.form.BasicForm("case_filter");var D=C.getValues();D.plan_id=A.plan_id;D.status="CONFIRMED";B.store.baseParams=D;B.store.load()}}]},B,{region:"south",xtype:"form",url:"tr_new_run.cgi",bodyStyle:"padding: 10px",id:"newrunsouth",height:200,items:[{layout:"column",items:[{columnWidth:0.5,layout:"form",items:[new Testopia.Product.VersionCombo({fieldLabel:"<b>Product Version</b>",hiddenName:"prod_version",mode:"local",forceSelection:true,allowBlank:false,typeAhead:true,params:{product_id:A.product_id}}),new Testopia.User.Lookup({id:"new_run_manager",hiddenName:"manager",fieldLabel:"<b>Run Manager</b>",allowBlank:false}),new Ext.form.NumberField({maxValue:100,minValue:0,allowBlank:true,id:"target_completion",fieldLabel:"Target Completion Rate",hiddenName:"target_completion",listeners:{valid:function(C){Ext.getCmp("target_pass").maxValue=C.getValue()}}})]},{columnWidth:0.5,layout:"form",items:[new Testopia.Build.Combo({fieldLabel:"<b>Build</b>",hiddenName:"build",mode:"local",forceSelection:false,allowBlank:false,typeAhead:true,params:{product_id:A.product_id,activeonly:1},emptyText:"Select or type a new name"}),new Testopia.Environment.Combo({fieldLabel:"<b>Environment</b>",hiddenName:"environment",mode:"local",forceSelection:false,allowBlank:false,typeAhead:true,params:{product_id:A.product_id,isactive:1},emptyText:"Select or type a new name"}),new Ext.form.NumberField({maxValue:100,minValue:0,allowBlank:true,id:"target_pass",fieldLabel:"Target Pass Rate",hiddenName:"target_pass"})]}]},{xtype:"textfield",fieldLabel:"<b>Summary</b>",layout:"fit",id:"run_summary",name:"summary",anchor:"100%",width:600,allowBlank:false},{xtype:"hidden",name:"plan_id",value:A.plan_id},{layout:"fit",fieldLabel:"Notes",id:"notes",xtype:"textarea",width:600,height:80}]}],buttons:[{text:"Create New Case",handler:function(){Testopia.TestCase.NewCasePopup(A.plan_id,A.product_id)}},{text:"Submit",handler:function(){if(!Ext.getCmp("newrunsouth").getForm().isValid()){return }var C={action:"add"};if(Ext.getCmp("selectall").getValue()){C.getall=Ext.getCmp("selectall").getValue()?1:0}else{C.case_ids=Testopia.Util.getSelectedObjects(B,"case_id")}if(!Ext.getCmp("build_combo").getValue()){C.new_build=Ext.getCmp("build_combo").getRawValue()}if(!Ext.getCmp("environment_combo").getValue()){C.new_env=Ext.getCmp("environment_combo").getRawValue()}Ext.getCmp("newrunsouth").getForm().submit({params:C,success:function(D,E){Ext.Msg.show({title:"Test Run Created",msg:"Test run "+E.result.run_id+" Created. Would you like to go there now?",buttons:Ext.Msg.YESNO,icon:Ext.MessageBox.QUESTION,fn:function(F){if(F=="yes"){window.location="tr_show_run.cgi?run_id="+E.result.run_id}}});if(Ext.getCmp("plan_run_grid")){Ext.getCmp("plan_run_grid").store.reload()}},failure:Testopia.Util.error})}},{text:"Cancel",type:"reset",id:"nrf_cancel_btn",handler:function(){Ext.getCmp("newrunsouth").getForm().reset();try{Ext.getCmp("newRun-win").close()}catch(C){window.location="tr_show_product.cgi"}}}]});this.on("render",function(){B.store.load();Ext.getCmp("new_run_manager").setValue(Testopia_user.login)})};Ext.extend(Testopia.TestRun.NewRunForm,Ext.Panel);Testopia.TestRun.NewRunPopup=function(B){var A=new Ext.Window({id:"newRun-win",closable:true,width:Ext.getBody().getViewSize().width-150,height:Ext.getBody().getViewSize().height-150,plain:true,shadow:false,layout:"fit",items:[new Testopia.TestRun.NewRunForm(B)]});A.show(this)};Testopia.TestRun.CloneForm=function(D,H,B){var E=new Testopia.TestPlan.Grid({product_id:D},{id:"run_clone_plan_grid"});var C=new Testopia.Product.VersionCombo({id:"run_clone_version_chooser",mode:"local",hiddenName:"new_run_prod_version",fieldLabel:"Product Version",params:{product_id:D}});var G=new Testopia.Build.Combo({fieldLabel:"Select a Build",id:"run_clone_build_chooser",mode:"local",hiddenName:"new_run_build",params:{product_id:D,activeonly:1}});var A=new Testopia.Environment.Combo({fieldLabel:"Select an Environment",id:"run_clone_environment_chooser",mode:"local",hiddenName:"new_run_env",params:{product_id:D,isactive:1}});function F(){var I=Ext.getCmp("run_clone_frm").getForm();I.baseParams={};if(Ext.getCmp("run_copy_cases").collapsed===false){switch(Ext.getCmp("copy_cases_radio_group").getGroupValue()){case"copy_filtered_cases":I.baseParams=Ext.getCmp("caserun_search").form.getValues();break;case"copy_selected_cases":I.baseParams.case_list=Testopia.Util.getSelectedObjects(Ext.getCmp("caserun_grid"),"caserun_id");break}}I.baseParams.action="clone";I.baseParams.ids=H;I.baseParams.new_run_build=G.getValue();I.baseParams.new_run_environment=A.getValue();I.baseParams.plan_ids=Testopia.Util.getSelectedObjects(E,"plan_id");var J=I.getValues();if(I.isValid()){I.submit({success:function(L,K){var M;if(K.result.runlist.length==1){M=K.result.failures.length>0?"Test cases "+K.result.failures.join(",")+" were not included. They are either DISABLED or PROPOSED. <br>":"";Ext.Msg.show({title:"Run Copied",msg:M+"Run "+K.result.runlist[0]+" Created. Would you like to go there now?",buttons:Ext.Msg.YESNO,icon:Ext.MessageBox.QUESTION,fn:function(N){if(N=="yes"){window.location="tr_show_run.cgi?run_id="+K.result.runlist[0]}}})}else{M=K.result.failures.length>0?K.result.failures.join.length+' Test cases were not included. They are either DISABLED or PROPOSED. <a href="tr_list_cases.cgi?case_id='+K.result.failures.join(",")+'">View List</a> <br>':"";Ext.Msg.show({title:"Test Run Copied",msg:M+K.result.runlist.length+' Test runs Copied successfully. <a href="tr_list_runs.cgi?run_id='+K.result.runlist.join(",")+'">View List</a>',buttons:Ext.Msg.OK,icon:Ext.MessageBox.INFO})}},failure:Testopia.Util.error})}}Testopia.TestRun.CloneForm.superclass.constructor.call(this,{id:"run_clone_form",border:false,width:600,layout:"border",items:[{region:"north",layout:"fit",border:false,height:300,items:[E]},{region:"center",xtype:"form",url:"tr_list_runs.cgi",title:"Clone Options",autoScroll:true,id:"run_clone_frm",border:false,frame:true,bodyStyle:"padding: 10px",labelWidth:160,height:350,items:[{layout:"table",border:false,autoScroll:true,layoutConfig:{columns:2,width:"100%"},items:[{colspan:2,layout:"form",border:false,items:[{id:"run_clone_name",xtype:"textfield",fieldLabel:"New Run Summary",name:"new_run_summary",width:500}]},{layout:"form",border:false,items:[C,G,A]},{layout:"form",border:false,items:[{xtype:"checkbox",name:"copy_tags",checked:true,boxLabel:"Copy Run Tags",hideLabel:true},{xtype:"checkbox",name:"copy_filters",checked:true,boxLabel:"Copy Run Filters",hideLabel:true},{xtype:"hidden",id:"run_clone_product_id",name:"product_id",value:D}]},{colspan:2,layout:"form",border:false,items:[{xtype:"checkbox",name:"keep_run_manager",checked:false,boxLabel:"Maintain original manager (unchecking will make me the manager of the new run)",hideLabel:true},{xtype:"fieldset",autoHeight:true,checkboxToggle:true,checkboxName:"copy_cases",id:"run_copy_cases",title:"Copy Test Cases",collapsed:B?false:true,items:[{xtype:"radio",name:"copy_cases_options",id:"copy_cases_radio_group",inputValue:"copy_all_cases",checked:true,boxLabel:"Include all CONFIRMED cases in selected run(s)",hideLabel:true},{xtype:"radio",name:"copy_cases_options",inputValue:"copy_filtered_cases",boxLabel:"Only include cases that match the selected filter",hideLabel:true},{xtype:"radio",name:"copy_cases_options",inputValue:"copy_selected_cases",boxLabel:"Only include cases that are currently selected",checked:B?true:false,hideLabel:true},{xtype:"checkbox",name:"keep_indexes",checked:true,boxLabel:"Copy Case Indexes",hideLabel:true},{xtype:"checkbox",name:"keep_statuses",boxLabel:"Maintain status of copied cases (unchecking will set case copies to IDLE (Not Run))",hideLabel:true}]}]}]}]}],buttons:[{text:"Submit",handler:F.createDelegate(this)},{text:"Cancel",handler:function(){Ext.getCmp("run-clone-win").close()}}]})};Ext.extend(Testopia.TestRun.CloneForm,Ext.Panel);Testopia.TestRun.ClonePopup=function(B,E,A){var D=new Ext.Window({id:"run-clone-win",closable:true,width:800,height:600,plain:true,shadow:false,layout:"fit",items:[new Testopia.TestRun.CloneForm(B,E,A)]});var F=Ext.getCmp("run_clone_plan_grid");Ext.apply(F,{title:"Select plans to clone runs to"});D.show(this);var C=new Testopia.Product.Combo({id:"run_clone_win_product_chooser",mode:"local",value:B});C.on("select",function(I,H,G){F.store.baseParams={ctype:"json",product_id:H.get("id")};Ext.getCmp("run_clone_version_chooser").reset();Ext.getCmp("run_clone_build_chooser").reset();Ext.getCmp("run_clone_environment_chooser").reset();Ext.getCmp("run_clone_version_chooser").store.baseParams.product_id=H.id;Ext.getCmp("run_clone_build_chooser").store.baseParams.product_id=H.id;Ext.getCmp("run_clone_environment_chooser").store.baseParams.product_id=H.id;Ext.getCmp("run_clone_version_chooser").store.load();Ext.getCmp("run_clone_build_chooser").store.load();Ext.getCmp("run_clone_environment_chooser").store.load();if(H.get("id")!=B){Ext.getCmp("run_clone_build_chooser").allowBlank=false;Ext.getCmp("run_clone_environment_chooser").allowBlank=false;Ext.getCmp("run_clone_version_chooser").allowBlank=false}else{Ext.getCmp("run_clone_build_chooser").allowBlank=true;Ext.getCmp("run_clone_environment_chooser").allowBlank=true;Ext.getCmp("run_clone_version_chooser").allowBlank=true}Ext.getCmp("run_clone_product_id").setValue(H.get("id"));F.store.load()});F.getTopToolbar().removeAll();F.getTopToolbar().add("Product: ",C);F.getSelectionModel().un("rowselect",F.getSelectionModel().events.rowselect.listeners[0].fn);F.getSelectionModel().un("rowdeselect",F.getSelectionModel().events.rowdeselect.listeners[0].fn);F.store.load()};Testopia.TestRun.AddCaseForm=function(A){if(A.data){A=A.data}var B=new Testopia.TestCase.Grid({plan_id:A.plan_id,case_status:"CONFIRMED",exclude:A.run_id},{title:"Select From Existing Cases",region:"center",id:"newrun_casegrid",height:500});B.on("render",function(D){for(var C=0;C<D.getTopToolbar().items.length;C++){D.getTopToolbar().items.items[C].destroy()}D.getTopToolbar().add({xtype:"button",text:"Select All",handler:function(){B.getSelectionModel().selectAll()}});B.store.load()});Testopia.TestRun.AddCaseForm.superclass.constructor.call(this,{url:"tr_new_run.cgi",id:"add_cases_form",title:"Add Cases to Run",bodyStyle:"padding:5px 5px 0",width:1050,height:800,layout:"border",items:[{region:"north",title:"Filter Cases",height:172,collapsible:true,listeners:{render:function(C){C.load({url:"tr_process_plan.cgi",params:{action:"getfilter",plan_id:A.plan_id},scripts:true})}},autoShow:true,autoScroll:true,buttons:[{text:"Filter",handler:function(){var C=new Ext.form.BasicForm("case_filter");var D=C.getValues();D.plan_id=A.plan_id;D.exclude=A.run_id;D.status="CONFIRMED";D.limit=Ext.getCmp("case_pager").pageSize;B.store.baseParams=D;B.store.load()}}]},B],buttons:[{text:"Add Selected Cases to Run",handler:function(){var C=new Ext.form.BasicForm("testopia_helper_frm");C.submit({url:"tr_list_cases.cgi",params:{action:"update",addruns:A.run_id,ids:Testopia.Util.getSelectedObjects(B,"case_id")},success:function(){if(Ext.getCmp("add_case_to_run_win")){Ext.getCmp("add_case_to_run_win").close()}if(Ext.getCmp("caserun_grid")){Ext.getCmp("caserun_grid").store.reload()}},failure:Testopia.Util.error})}}]})};Ext.extend(Testopia.TestRun.AddCaseForm,Ext.Panel);Testopia.TestRun.AddCasePopup=function(B){var A=new Ext.Window({id:"add_case_to_run_win",closable:true,width:Ext.getBody().getViewSize().width-150,height:Ext.getBody().getViewSize().height-150,plain:true,shadow:false,layout:"fit",items:[new Testopia.TestRun.AddCaseForm(B)]});A.show(this)};Testopia.TestRun.FiltersList=function(B){this.store=new Ext.data.JsonStore({url:"tr_process_run.cgi",listeners:{exception:Testopia.Util.loadError},baseParams:{action:"getfilters",run_id:B.run_id},root:"filters",fields:["name","query"]});var A=this.store;this.columns=[{header:"Name",width:30,dataIndex:"name",sortable:true}];Testopia.TestRun.FiltersList.superclass.constructor.call(this,{title:"Filters",id:"run_filter_grid",loadMask:{msg:"Loading Filters ..."},autoScroll:true,sm:new Ext.grid.RowSelectionModel({singleSelect:true,listeners:{rowselect:function(E,J,C){var D=C.get("name");Ext.getCmp("object_panel").setActiveTab("caserun-panel");var F=Testopia.Util.urlQueryToJSON(C.get("query"));var I=document.getElementById("caserun_filter_form");for(var H=0;H<I.length;H++){if(I[H].type=="select-multiple"){for(var G=0;G<I[H].options.length;G++){I[H].options[G].selected=false}var K=F[I[H].name];if(!K){continue}if(typeof K!="object"){K=new Array(K)}for(j=0;j<K.length;j++){for(G=0;G<I[H].options.length;G++){if(I[H].options[G].value==K[j]){I[H].options[G].selected=true;break}}}}else{I[H].value=F[I[H].name]}}Ext.getCmp("caserun_grid").store.baseParams=F;Ext.getCmp("caserun_grid").store.load()}}}),viewConfig:{forceFit:true}});this.on("rowcontextmenu",this.onContextClick,this);this.on("activate",this.onActivate,this)};Ext.extend(Testopia.TestRun.FiltersList,Ext.grid.GridPanel,{onContextClick:function(B,A,C){if(!this.menu){this.menu=new Ext.menu.Menu({id:"run_filter_ctx",items:[{text:"Delete Saved Filter",handler:function(){var D=new Ext.form.BasicForm("testopia_helper_frm",{});D.submit({url:"tr_process_run.cgi",params:{action:"delete_filter",query_name:B.store.getAt(A).get("name"),run_id:B.store.baseParams.run_id},success:function(){Testopia.Util.notify.msg("Filter removed","filter removed successfully");B.store.reload()},failure:Testopia.Util.error})}}]})}C.stopEvent();this.menu.showAt(C.getXY())},onActivate:function(A){if(!this.store.getCount()){this.store.load()}}});Testopia.BugReport=function(A){A.type="bug";this.store=new Ext.data.GroupingStore({url:"tr_run_reports.cgi",baseParams:A,reader:new Ext.data.JsonReader({root:"Result",fields:[{name:"case_id",mapping:"case_id"},{name:"run_id",mapping:"run_id"},{name:"bug_id",mapping:"bug_id"},{name:"case_status",mapping:"case_status"},{name:"bug_status",mapping:"bug_status"},{name:"severity",mapping:"bug_severity"}]}),remoteSort:false,sortInfo:{field:"run_id",direction:"ASC"},groupField:"bug_id"});this.store.isTreport=true;this.view=new Ext.grid.GroupingView({forceFit:true,groupTextTpl:'{text} ({[values.rs.length]} {[values.rs.length > 1 ? "Items" : "Item"]})'});this.columns=[{header:"Run",dataIndex:"run_id",sortable:true,hideable:true,groupRenderer:function(B){return B},renderer:Testopia.Util.makeLink.createDelegate(this,["run"],true)},{header:"Case",dataIndex:"case_id",sortable:true,hideable:true,groupRenderer:function(B){return B},renderer:Testopia.Util.makeLink.createDelegate(this,["case"],true)},{header:"Bug",dataIndex:"bug_id",sortable:true,hideable:true,groupRenderer:function(B){return B},renderer:Testopia.Util.makeLink.createDelegate(this,["bug"],true)},{header:"Bug Status",dataIndex:"bug_status",sortable:true,hideable:true},{header:"Case Status",dataIndex:"case_status",sortable:true,hideable:true},{header:"Severity",dataIndex:"severity",sortable:true,hideable:true}];Testopia.BugReport.superclass.constructor.call(this,{sm:new Ext.grid.RowSelectionModel(),layout:"fit",height:250,autoScroll:true})};Ext.extend(Testopia.BugReport,Ext.grid.GridPanel);Testopia.TestRun.ProgressBar=function(A){Testopia.TestRun.ProgressBar.superclass.constructor.call(this,A)};Ext.extend(Testopia.TestRun.ProgressBar,Ext.ProgressBar,{onRender:function(C,A){Ext.ProgressBar.superclass.onRender.call(this,C,A);var B=new Ext.Template('<div class="{cls}-wrap">','<div style="position:relative">','<div class="{cls}-bar-green"></div>','<div class="{cls}-bar-red"></div>','<div class="{cls}-bar-orange"></div>','<div class="{cls}-text-main" style="font-weight: bold">',"<div>&#160;</div>","</div>",'<div class="{cls}-text-main {cls}-text-back-main" style="font-weight: bold">',"<div>&#160;</div>","</div>","</div>","</div>");if(A){this.el=B.insertBefore(A,{cls:this.baseCls},true)}else{this.el=B.append(C,{cls:this.baseCls},true)}if(this.id){this.el.dom.id=this.id}this.progressBar=Ext.get(this.el.dom.firstChild);this.gbar=Ext.get(this.progressBar.dom.firstChild);this.rbar=Ext.get(this.gbar.dom.nextSibling);this.obar=Ext.get(this.rbar.dom.nextSibling);if(this.textEl){this.textEl=Ext.get(this.textEl);delete this.textTopEl}else{this.textTopEl=Ext.get(this.progressBar.dom.childNodes[3]);var D=Ext.get(this.progressBar.dom.childNodes[4]);this.textTopEl.setStyle("z-index",99).addClass("x-hidden");this.textEl=new Ext.CompositeElement([this.textTopEl.dom.firstChild,D.dom.firstChild]);this.textEl.setWidth(this.progressBar.offsetWidth)}if(this.gvalue||this.rvalue||this.ovalue){this.updateProgress(this.gvalue,this.rvalue,this.ovalue,this.text)}else{this.updateText(this.text)}this.setSize(this.width||"auto","auto");this.progressBar.setHeight(this.progressBar.offsetHeight)},updateProgress:function(C,B,D,G){this.gvalue=C||0;this.rvalue=B||0;this.ovalue=D||0;if(G){this.updateText(G)}var F=Math.floor(C*this.el.dom.firstChild.offsetWidth);var E=Math.floor(B*this.el.dom.firstChild.offsetWidth);var A=Math.floor(D*this.el.dom.firstChild.offsetWidth);this.gbar.setWidth(F);this.rbar.setWidth(E);this.obar.setWidth(A);return this},setSize:function(A,B){Ext.ProgressBar.superclass.setSize.call(this,A,B);if(this.textTopEl){this.textEl.setSize(this.el.dom.offsetWidth,this.el.dom.offsetHeight)}return this}});Testopia.Build.Store=function(A,B){A.action="list";Testopia.Build.Store.superclass.constructor.call(this,{url:"tr_builds.cgi",root:"builds",listeners:{exception:Testopia.Util.loadError},baseParams:A,id:"build_id",autoLoad:B,fields:[{name:"build_id",mapping:"build_id"},{name:"name",mapping:"name"},{name:"milestone",mapping:"milestone"},{name:"description",mapping:"description"},{name:"product_id",mapping:"product_id"},{name:"isactive",mapping:"isactive"}]})};Ext.extend(Testopia.Build.Store,Ext.data.JsonStore);Testopia.Build.Combo=function(A){Testopia.Build.Combo.superclass.constructor.call(this,{id:A.id||"build_combo",store:A.transform?false:new Testopia.Build.Store(A.params,A.mode=="local"?true:false),loadingText:"Looking up builds...",displayField:"name",valueField:"build_id",typeAhead:true,triggerAction:"all",minListWidth:300,forceSelection:true,transform:A.transform,emptyText:"Builds..."});Ext.apply(this,A);this.store.on("load",function(){if(A.value){this.setValue(A.value)}},this)};Ext.extend(Testopia.Build.Combo,Ext.form.ComboBox);Testopia.Build.Grid=function(A){this.product_id=A;this.store=new Testopia.Build.Store({},false);var B=new Testopia.Product.MilestoneCombo({hiddenField:"milestone",mode:"remote",params:{product_id:A},listeners:{startedit:function(){var C=Ext.getCmp("products_pane").getSelectionModel().getSelectedNode().id;if(B.store.baseParams.product_id!=C){B.store.baseParams.product_id=C;B.store.load()}}}});this.columns=[{header:"Name",width:80,sortable:true,dataIndex:"name",editor:{xtype:"textfield",value:"name",allowBlank:false}},{header:"Description",width:120,editor:{xtype:"textfield"},sortable:true,dataIndex:"description"},{header:"Milestone",width:120,sortable:true,dataIndex:"milestone",editor:B},{header:"Active",dataIndex:"isactive",trueText:"Yes",falseText:"No",sortable:true,xtype:"booleancolumn",editor:{xtype:"checkbox",value:"isactive"},width:25}];this.form=new Ext.form.BasicForm("testopia_helper_frm");Testopia.Build.Grid.superclass.constructor.call(this,{title:"Builds",id:"build_grid",loadMask:{msg:"Loading Builds..."},autoExpandColumn:"build_name",autoScroll:true,plugins:[new Ext.ux.grid.RowEditor({id:"build_row_editor",saveText:"Update"})],sm:new Ext.grid.RowSelectionModel({singleSelect:true}),viewConfig:{forceFit:true},tbar:[new Ext.Toolbar.Fill(),{xtype:"button",id:"edit_build_btn",icon:"extensions/testopia/img/edit.png",iconCls:"img_button_16x",tooltip:"Edit Selected Build",handler:function(){Testopia.Util.editFirstSelection(Ext.getCmp("build_grid"))}},{xtype:"button",id:"add_build_btn",icon:"extensions/testopia/img/add.png",iconCls:"img_button_16x",tooltip:"Add a new Build",handler:this.newRecord}]});this.on("rowcontextmenu",this.onContextClick,this);this.on("activate",this.onActivate,this);Ext.getCmp("build_row_editor").on("afteredit",this.onGridEdit,this)};Ext.extend(Testopia.Build.Grid,Ext.grid.GridPanel,{newRecord:function(){NewBuild=Ext.data.Record.create([{name:"name",type:"string"},{name:"milestone"},{name:"description",type:"string"},{name:"isactive",type:"bool"}]);var A=new NewBuild({name:"",milestone:Ext.getCmp("products_pane").getSelectionModel().getSelectedNode().attributes.attributes.defaultmilestone,description:"",isactive:true});var B=Ext.getCmp("build_grid");B.store.insert(0,A);Ext.getCmp("build_row_editor").startEditing(0)},onContextClick:function(B,A,C){B.getSelectionModel().selectRow(A);if(!this.menu){this.menu=new Ext.menu.Menu({id:"build-ctx-menu",enableScrolling:false,items:[{text:"Reports",enableScrolling:false,menu:{items:[{text:"New Completion Report",handler:function(){Ext.getCmp("object_panel").setActiveTab("dashboardpanel");var D=new Ext.ux.Portlet({title:"Build Completion Report",closable:true,autoScroll:true,tools:PortalTools});D.url="tr_builds.cgi?action=report&product_id="+B.product_id+"&build_ids="+Testopia.Util.getSelectedObjects(B,"id");Testopia.Search.dashboard_urls.push(D.url);Ext.getCmp("dashboard_leftcol").add(D);Ext.getCmp("dashboard_leftcol").doLayout();D.load({url:D.url})}}]}},{text:"Add a Build",icon:"extensions/testopia/img/add.png",iconCls:"img_button_16x",handler:this.newRecord},{text:"Edit This Build",icon:"extensions/testopia/img/edit.png",iconCls:"img_button_16x",handler:function(){Testopia.Util.editFirstSelection(B)}},{text:"Refresh",icon:"extensions/testopia/img/refresh.png",iconCls:"img_button_16x",handler:function(){B.store.reload()}}]})}C.stopEvent();this.menu.showAt(C.getXY())},onGridEdit:function(C){var A=C.record.data;var B=this.store;A.product_id=this.product_id;if(A.build_id){A.action="edit"}else{A.action="add"}this.form.submit({url:"tr_builds.cgi",params:A,success:function(E,D){if(D.result.build_id){C.record.set("build_id",D.result.build_id)}B.commitChanges()},failure:function(E,D){Testopia.Util.error(E,D);B.rejectChanges()}})},onActivate:function(A){if(!this.product_id){Ext.Msg.alert("Error","Please select a product.");Ext.getCmp("edit_build_btn").disable();Ext.getCmp("add_build_btn").disable();return }else{if(!this.store.getCount()){this.store.load({params:{product_id:this.product_id}})}}}});Testopia.Category.Store=function(A,B){A.action="list";Testopia.Category.Store.superclass.constructor.call(this,{url:"tr_categories.cgi",root:"categories",listeners:{exception:Testopia.Util.loadError},baseParams:A,id:"category_id",autoLoad:B,fields:[{name:"category_id",mapping:"category_id"},{name:"name",mapping:"name"},{name:"description",mapping:"description"}]})};Ext.extend(Testopia.Category.Store,Ext.data.JsonStore);Testopia.Category.Combo=function(A){Testopia.Category.Combo.superclass.constructor.call(this,{id:A.id||"case_category_combo",store:A.transform?false:new Testopia.Category.Store(A.params,A.mode=="local"?true:false),loadingText:"Looking up categories...",displayField:"name",valueField:"category_id",typeAhead:true,triggerAction:"all",minListWidth:300,forceSelection:true,transform:A.transform,emptyText:"Please select..."});Ext.apply(this,A);this.store.on("load",function(){if(A.value){this.setValue(A.value)}},this)};Ext.extend(Testopia.Category.Combo,Ext.form.ComboBox);Testopia.Category.Grid=function(A){this.product_id=A;this.store=new Testopia.Category.Store({},false);var B=this.store;this.columns=[{header:"Name",width:120,sortable:true,dataIndex:"name",editor:{xtype:"textfield",value:"name",allowBlank:false}},{header:"Description",width:120,id:"category_desc_column",editor:{xtype:"textfield",value:"description"},sortable:true,dataIndex:"description"}];this.form=new Ext.form.BasicForm("testopia_helper_frm",{});Testopia.Category.Grid.superclass.constructor.call(this,{title:"Categories",id:"category_grid",loadMask:{msg:"Loading Categories..."},autoExpandColumn:"category_desc_column",autoScroll:true,plugins:[new Ext.ux.grid.RowEditor({id:"category_row_editor",saveText:"Update"})],enableColumnHide:true,sm:new Ext.grid.RowSelectionModel({singleSelect:true}),viewConfig:{forceFit:true},tbar:[new Ext.Toolbar.Fill(),{xtype:"button",id:"edit_category_btn",icon:"extensions/testopia/img/edit.png",iconCls:"img_button_16x",tooltip:"Edit Selected Category",handler:function(){Testopia.Util.editFirstSelection(Ext.getCmp("category_grid"))}},{xtype:"button",id:"add_category_btn",icon:"extensions/testopia/img/add.png",iconCls:"img_button_16x",tooltip:"Add a new Category",handler:this.newRecord},{xtype:"button",icon:"extensions/testopia/img/delete.png",iconCls:"img_button_16x",tooltip:"Delete this Category",handler:function(){var C=Ext.getCmp("category_grid").getSelectionModel().getSelected();if(!C){Ext.MessageBox.alert("Message","Please select at least one Category to delete")}else{Testopia.Category.remove(A)}}}]});this.on("rowcontextmenu",this.onContextClick,this);this.on("activate",this.onActivate,this);Ext.getCmp("category_row_editor").on("afteredit",this.onGridEdit,this)};Ext.extend(Testopia.Category.Grid,Ext.grid.GridPanel,{newRecord:function(){NewCategory=Ext.data.Record.create([{name:"name",type:"string"},{name:"description",type:"string"}]);var A=new NewCategory({name:"",description:""});var B=Ext.getCmp("category_grid");B.store.insert(0,A);Ext.getCmp("category_row_editor").startEditing(0)},onContextClick:function(B,A,C){B.getSelectionModel().selectRow(A);if(!this.menu){this.menu=new Ext.menu.Menu({id:"category-ctx-menu",enableScrolling:false,items:[{text:"Add a Category",icon:"extensions/testopia/img/add.png",iconCls:"img_button_16x",handler:this.newRecord},{text:"Edit This Category",icon:"extensions/testopia/img/edit.png",iconCls:"img_button_16x",handler:function(){Testopia.Util.editFirstSelection(B)}},{text:"Refresh",icon:"extensions/testopia/img/refresh.png",iconCls:"img_button_16x",handler:function(){B.store.reload()}}]})}C.stopEvent();this.menu.showAt(C.getXY())},onGridEdit:function(C){var A=C.record.data;var B=this.store;A.product_id=this.product_id;if(A.build_id){A.action="edit"}else{A.action="add"}this.form.submit({url:"tr_categories.cgi",params:A,success:function(E,D){if(D.result.category_id){C.record.set("category_id",D.result.category_id)}B.commitChanges()},failure:function(E,D){Testopia.Util.error(E,D);B.rejectChanges()}})},onActivate:function(A){if(!this.product_id){Ext.Msg.alert("Error","Please select a product.");Ext.getCmp("edit_category_btn").disable();Ext.getCmp("add_category_btn").disable();return }else{if(!this.store.getCount()){this.store.load({params:{product_id:this.product_id}})}}}});Testopia.Category.remove=function(){if(!Ext.getCmp("category_grid").getSelectionModel().getSelected().get("category_id")){Ext.getCmp("category_grid").store.reload();return }Ext.Msg.show({title:"Confirm Delete?",msg:CASE_CATEGORY_DELETE_WARNING,buttons:Ext.Msg.YESNO,animEl:"casecategory-delete-btn",icon:Ext.MessageBox.QUESTION,fn:function(B){if(B=="yes"){var A=new Ext.form.BasicForm("testopia_helper_frm");A.submit({url:"tr_categories.cgi",params:{category_id:Ext.getCmp("category_grid").getSelectionModel().getSelected().get("category_id"),action:"delete",product_id:Ext.getCmp("category_grid").product_id},success:function(C){Ext.Msg.show({msg:"Test case category deleted",buttons:Ext.Msg.OK,icon:Ext.MessageBox.INFO});Ext.getCmp("category_grid").store.reload()},failure:Testopia.Util.error})}}})};Ext.ux.TabCloseMenu=function(){var A,C,B;this.init=function(E){A=E;A.on("contextmenu",D)};function D(G,F,H){if(!C){C=new Ext.menu.Menu([{id:A.id+"-close",text:"Close Tab",handler:function(){A.remove(B)}},{id:A.id+"-close-others",text:"Close Other Tabs",handler:function(){A.items.each(function(J){if(J.closable&&J!=B){A.remove(J)}})}}])}B=F;var E=C.items;E.get(A.id+"-close").setDisabled(!F.closable);var I=true;A.items.each(function(){if(this!=F&&this.closable){I=false;return false}});E.get(A.id+"-close-others").setDisabled(I);C.showAt(H.getPoint())}};diff_tab_panel=function(D,F,C){var B=this;var A=new Ext.data.JsonStore({url:"tr_history.cgi",listeners:{exception:Testopia.Util.loadError},baseParams:{action:"getversions",type:D,id:F},root:"versions",fields:[{name:"name",mapping:"name",name:"id",mapping:"id"}]});diff_tab_panel.superclass.constructor.call(this,{title:"Test Panel",height:500,resizeTabs:true,minTabWidth:115,tabWidth:135,enableTabScroll:true,defaults:{autoScroll:true},plugins:new Ext.ux.TabCloseMenu(),activeTab:0,tbar:[new Ext.form.ComboBox({displayField:"name",valueField:"id",name:"product",id:"product_combo",fieldLabel:"Product",store:A,emptyText:"Select a version...",width:200})," Right: ",new Ext.Toolbar.Spacer(),new Ext.form.ComboBox({})," HTML: ",new Ext.form.Radio({id:"format",value:"html",checked:true})," Raw: ",new Ext.form.Radio({id:"format",value:"raw"}),new Ext.Button({text:"Diff",handler:E}),new Ext.Toolbar.Separator(),"Show Version: ",new Ext.form.ComboBox({}),new Ext.Button({text:"Show",handler:E})]});function E(){B.add({title:"New Tab ",iconCls:"tabs",html:"diff_text",closable:true}).show()}};Ext.extend(diff_tab_panel,Ext.TabPanel);Testopia.Environment.Store=function(A,B){A.ctype="json";Testopia.Environment.Store.superclass.constructor.call(this,{url:"tr_list_environments.cgi",listeners:{exception:Testopia.Util.loadError},root:"Result",baseParams:A,totalProperty:"totalResultsAvailable",autoLoad:B,id:"environment_id",fields:[{name:"environment_id",mapping:"environment_id"},{name:"name",mapping:"name"},{name:"run_count",mapping:"run_count"},{name:"isactive",mapping:"isactive"},{name:"product",mapping:"product_name"}],remoteSort:true});this.paramNames.sort="order"};Ext.extend(Testopia.Environment.Store,Ext.data.JsonStore);Testopia.Environment.Combo=function(A){if(A.params){A.params.viewall=1}Testopia.Environment.Combo.superclass.constructor.call(this,{id:A.id||"environment_combo",store:A.transform?false:new Testopia.Environment.Store(A.params,A.mode=="local"?true:false),loadingText:"Looking up environments...",displayField:"name",valueField:"environment_id",typeAhead:true,triggerAction:"all",minListWidth:300,forceSelection:true,transform:A.transform,emptyText:"Environments..."});Ext.apply(this,A);this.store.on("load",function(){if(A.value){this.setValue(A.value)}},this)};Ext.extend(Testopia.Environment.Combo,Ext.form.ComboBox);Testopia.Environment.Grid=function(E,A){this.params=E;this.product_id=E.product_id;function B(F){return'<a href="tr_environments.cgi?env_id='+F+'">'+F+"</a>"}function D(F){return'<a href="tr_show_product.cgi?product_id='+F+'">'+F+"</a>"}this.store=new Testopia.Environment.Store(E,false);var C=this.store;this.columns=[{header:"ID",width:30,dataIndex:"environment_id",sortable:true,renderer:B,hideable:false},{header:"Environment Name",width:110,dataIndex:"name",id:"env_name_col",sortable:true,editor:new Ext.grid.GridEditor(new Ext.form.TextField({allowBlank:false}),{id:"env_name_edt"})},{header:"Product Name",width:150,dataIndex:"product",sortable:true,hidden:true},{header:"Run Count",width:30,dataIndex:"run_count",sortable:false},new Ext.grid.CheckColumn({sortable:true,header:"Active",dataIndex:"isactive",editor:new Ext.grid.GridEditor(new Ext.form.Checkbox({value:"isactive"})),width:25})];this.form=new Ext.form.BasicForm("testopia_helper_frm",{});this.bbar=new Testopia.Util.PagingBar("environment",this.store);Testopia.Environment.Grid.superclass.constructor.call(this,{title:"Environments",id:"environment-grid",loadMask:{msg:"Loading Environments..."},autoExpandColumn:"env_name_col",autoScroll:true,plugins:[new Ext.ux.grid.RowEditor({saveText:"Update"})],sm:new Ext.grid.RowSelectionModel({singleSelect:true,listeners:{rowselect:function(H,F,G){Ext.getCmp("delete_env_list_btn").enable();Ext.getCmp("clone_env_list_btn").enable()},rowdeselect:function(H,F,G){if(H.getCount()<1){Ext.getCmp("delete_env_list_btn").disable();Ext.getCmp("clone_env_list_btn").disable()}}}}),viewConfig:{forceFit:true},tbar:[{xtype:"button",text:"Import",handler:this.importEnv.createDelegate(this)},new Ext.Toolbar.Fill(),{xtype:"button",id:"add_env_list_btn",icon:"extensions/testopia/img/add.png",iconCls:"img_button_16x",tooltip:"Add an Environment",handler:this.createEnv.createDelegate(this,["","add"])},{xtype:"button",id:"clone_env_list_btn",disabled:true,icon:"extensions/testopia/img/copy.png",iconCls:"img_button_16x",tooltip:"Clone this Environment",handler:this.cloneEnv.createDelegate(this)},{xtype:"button",id:"delete_env_list_btn",disabled:true,icon:"extensions/testopia/img/delete.png",iconCls:"img_button_16x",tooltip:"Delete this Environment",handler:this.deleteEnv.createDelegate(this)}]});Ext.apply(this,A);this.on("rowcontextmenu",this.onContextClick,this);this.on("afteredit",this.onGridEdit,this);this.on("activate",this.onActivate,this)};Ext.extend(Testopia.Environment.Grid,Ext.grid.EditorGridPanel,{onContextClick:function(B,A,C){if(!this.menu){this.menu=new Ext.menu.Menu({enableScrolling:false,id:"run-ctx-menu",items:[{text:"Create a new environment",handler:function(){window.location="tr_new_environment.cgi"}},{text:"Delete Environments",handler:this.deleteEnv.createDelegate(this)},{text:"Refresh List",icon:"extensions/testopia/img/refresh.png",iconCls:"img_button_16x",handler:function(){B.store.reload()}}]})}C.stopEvent();if(B.getSelectionModel().getCount()<1){B.getSelectionModel().selectRow(A)}this.menu.showAt(C.getXY())},onGridEdit:function(C){var A={env_id:C.record.get("environment_id")};var B=this.store;switch(C.field){case"name":A.action="rename";A.name=C.value;break;case"isactive":A.action="toggle";break}this.form.submit({url:"tr_environments.cgi",params:A,success:function(E,D){B.commitChanges()},failure:function(E,D){Testopia.Util.error(E,D);B.rejectChanges()}})},deleteEnv:function(){var A=this;Ext.Msg.show({title:"Confirm Delete?",msg:ENVIRONMENT_DELETE_WARNING,buttons:Ext.Msg.YESNO,animEl:"case-delete-btn",icon:Ext.MessageBox.QUESTION,fn:function(B){if(B=="yes"){form=new Ext.form.BasicForm("testopia_helper_frm",{});form.submit({url:"tr_environments.cgi",params:{env_id:A.getSelectionModel().getSelected().get("environment_id"),action:"delete"},success:function(){Ext.Msg.show({msg:"Test environment deleted",buttons:Ext.Msg.OK,icon:Ext.MessageBox.INFO});A.store.reload()},failure:function(D,C){Testopia.Util.error(D,C);A.store.reload()}})}}})},createEnv:function(A,C,E){var B=this;C=C||"add";var D=new Ext.Window({id:"create-env-win",title:"Environment XML Import",closable:true,width:400,height:230,plain:true,shadow:false,layout:"fit",items:[{xtype:"form",url:"tr_environments.cgi",bodyStyle:"padding: 10px",id:"env_create_frm",items:[{xtype:"field",fieldLabel:"Name",inputType:"text",name:"name",value:A!=""?"Copy of "+A:"",allowBlank:false},new Testopia.Product.Combo({mode:"local",fieldLabel:"Product",value:B.product_id,hiddenName:"product_id"}),{xtype:"hidden",name:"action",value:C},{xtype:"hidden",name:"env_id",value:E}],buttons:[{text:"Create",handler:function(){Ext.getCmp("env_create_frm").getForm().submit({success:function(F,G){Ext.Msg.show({title:"Test Environment Created",msg:"Test environment "+G.result.id+" Created. Would you like to go there now?",buttons:Ext.Msg.YESNO,icon:Ext.MessageBox.QUESTION,fn:function(H){if(H=="yes"){window.location="tr_environments.cgi?env_id="+G.result.id}else{B.store.reload()}}});Ext.getCmp("create-env-win").close()},failure:Testopia.Util.error})}},{text:"Cancel",handler:function(){Ext.getCmp("create-env-win").close()}}]}]});D.show(this)},cloneEnv:function(){this.createEnv(this.getSelectionModel().getSelected().get("name"),"clone",this.getSelectionModel().getSelected().get("environment_id"))},importEnv:function(){grid=this;var A=new Ext.Window({id:"import-env-win",title:"Environment XML Import",closable:true,width:400,height:130,plain:true,shadow:false,layout:"fit",items:[{xtype:"form",url:"tr_import_environment.cgi",bodyStyle:"padding: 10px",id:"env_xml_import_frm",fileUpload:true,items:[{xtype:"field",fieldLabel:"XML",inputType:"file",name:"xml",allowBlank:false}],buttons:[{text:"Import",handler:function(){Ext.getCmp("env_xml_import_frm").getForm().submit();Ext.getCmp("import-env-win").close();grid.store.reload()}},{text:"Cancel",handler:function(){Ext.getCmp("import-env-win").close()}}]}]});A.show(this)},onActivate:function(A){if(!this.store.getCount()){this.store.load()}}});Testopia.Product.Store=function(A,B){Testopia.Product.Store.superclass.constructor.call(this,{url:"tr_quicksearch.cgi",root:"products",listeners:{exception:Testopia.Util.loadError},autoLoad:B,id:"id",baseParams:{action:"getproducts",class_id:A},fields:[{name:"id",mapping:"id"},{name:"name",mapping:"name"}]})};Ext.extend(Testopia.Product.Store,Ext.data.JsonStore);Testopia.Product.VersionStore=function(A,B){A.action="getversions";Testopia.Product.VersionStore.superclass.constructor.call(this,{url:"tr_quicksearch.cgi",root:"versions",listeners:{exception:Testopia.Util.loadError},baseParams:A,autoLoad:B,id:"id",fields:[{name:"id",mapping:"id"},{name:"name",mapping:"name"}]})};Ext.extend(Testopia.Product.VersionStore,Ext.data.JsonStore);Testopia.Product.MilestoneStore=function(A,B){A.action="getmilestones";Testopia.Product.MilestoneStore.superclass.constructor.call(this,{url:"tr_quicksearch.cgi",root:"milestones",listeners:{exception:Testopia.Util.loadError},autoLoad:B,baseParams:A,id:"id",fields:[{name:"id",mapping:"id"},{name:"name",mapping:"name"}]})};Ext.extend(Testopia.Product.MilestoneStore,Ext.data.JsonStore);Testopia.Product.Combo=function(A){Testopia.Product.Combo.superclass.constructor.call(this,{id:A.id||"product_combo",store:A.transform?false:new Testopia.Product.Store(A.params,A.mode=="local"?true:false),loadingText:"Looking up products...",displayField:"name",valueField:"id",typeAhead:true,triggerAction:"all",minListWidth:300,forceSelection:true,transform:A.transform,emptyText:"Please select..."});Ext.apply(this,A);this.store.on("load",function(){if(A.value){this.setValue(A.value)}},this)};Ext.extend(Testopia.Product.Combo,Ext.form.ComboBox);Testopia.Product.VersionCombo=function(A){Testopia.Product.VersionCombo.superclass.constructor.call(this,{id:A.id||"product_version_combo",store:A.transform?false:new Testopia.Product.VersionStore(A.params,A.mode=="local"?true:false),loadingText:"Looking up versions...",displayField:"name",valueField:"id",typeAhead:true,triggerAction:"all",minListWidth:300,forceSelection:true,transform:A.transform,emptyText:"Please select..."});Ext.apply(this,A);this.store.on("load",function(){if(A.value){this.setValue(A.value)}},this)};Ext.extend(Testopia.Product.VersionCombo,Ext.form.ComboBox);Testopia.Product.MilestoneCombo=function(A){Testopia.Product.MilestoneCombo.superclass.constructor.call(this,{id:A.id||"milestone_combo",store:A.transform?false:new Testopia.Product.MilestoneStore(A.params,A.mode=="local"?true:false),loadingText:"Looking up milestones...",displayField:"name",valueField:"id",typeAhead:true,triggerAction:"all",minListWidth:300,forceSelection:true,transform:A.transform,emptyText:"Please select..."});Ext.apply(this,A);this.store.on("load",function(){if(A.value){this.setValue(A.value)}},this)};Ext.extend(Testopia.Product.MilestoneCombo,Ext.form.ComboBox);Testopia.Search.save=function(B,E){var D;var A;if(B=="dashboard"){A=3;D=Testopia.Search.dashboard_urls.join("::>")}else{if(B=="custom"){D=E;E={report:true};A=1}else{if(B=="caserun"){E.current_tab="case_run"}else{E.current_tab=B}if(E.report){D="tr_"+B+"_reports.cgi?";A=1}else{D="tr_list_"+B+"s.cgi?";A=0}D=D+Testopia.Util.JSONToURLQuery(E,"",["ctype"])}}var C=new Ext.form.BasicForm("testopia_helper_frm",{});Ext.Msg.prompt("Save As","",function(F,G){if(F=="ok"){C.submit({url:"tr_query.cgi",params:{action:"save_query",query_name:G,query_part:D,type:A},success:function(){if(Ext.getCmp("searches_grid")){Ext.getCmp("searches_grid").store.load()}if(Ext.getCmp("reports_grid")){Ext.getCmp("reports_grid").store.load()}if(Ext.getCmp("dashboard_grid")){Ext.getCmp("dashboard_grid").store.load()}Testopia.Util.notify.msg("Saved","Your search or report was saved.")},failure:Testopia.Util.error})}})};Testopia.Search.fillInForm=function(C,F,A){var E=document.getElementById(C+"_search_form");for(var B=0;B<E.length;B++){if(E[B].type=="select-multiple"){for(k=0;k<E[B].options.length;k++){E[B].options[k].selected=false}var D=F[E[B].name];if(!D){continue}if(typeof D!="object"){D=new Array(D)}for(j=0;j<D.length;j++){for(k=0;k<E[B].options.length;k++){if(E[B].options[k].value==D[j]){E[B].options[k].selected=true;break}}}}else{if(F[E[B].name]){E[B].value=F[E[B].name]||""}}}};Testopia.Search.DashboardPanel=function(A){Testopia.Search.DashboardPanel.superclass.constructor.call(this,{title:A.title||"Dashboard",layout:"fit",closable:A.closable||false,id:A.id||"dashboardpanel",tbar:[{xtype:"button",text:"Add Custom Panel",handler:function(B,C){Ext.Msg.prompt("Enter URL","",function(E,G){if(E=="ok"){var D=G+"&noheader=1";Testopia.Search.dashboard_urls.push(D);var F=new Ext.ux.Portlet({title:"Custom",closable:true,autoScroll:true,tools:PortalTools,url:D});Ext.getCmp("dashboard_leftcol").add(F);Ext.getCmp("dashboard_leftcol").doLayout();F.load({url:D,scripts:false})}})}},new Ext.Toolbar.Fill()],items:[{xtype:"portal",margins:"35 5 5 0",items:[{columnWidth:0.5,baseCls:"x-plain",bodyStyle:"padding:10px 10px 10px 10px",id:A.lc||"dashboard_leftcol",items:[{title:" ",hidden:true}]},{columnWidth:0.5,baseCls:"x-plain",bodyStyle:"padding:10px 10px 10px 10px",id:A.rc||"dashboard_rightcol",items:[{title:" ",hidden:true}]}]}]});this.on("activate",this.onActivate,this)};Ext.extend(Testopia.Search.DashboardPanel,Ext.Panel,{onActivate:function(A){A.doLayout()}});Testopia.Search.Popup=function(A,C){var B=new Ext.Window({id:"search_win",closable:true,width:Ext.getBody().getViewSize().width-150,height:Ext.getBody().getViewSize().height-150,plain:true,shadow:false,layout:"fit",items:[new Testopia.Search.Panel(A,C)]});B.show()};Testopia.Search.Panel=function(A,B){B=B||{};Testopia.Search.Panel.superclass.constructor.call(this,{title:"Create a Search",id:"search_panel",autoScroll:true,activeTab:A+"_search_panel",defaults:{bodyStyle:"padding:10px",autoScroll:true},items:[new Testopia.Search.PlansForm(B),new Testopia.Search.CasesForm(B),new Testopia.Search.RunsForm(B),new Testopia.Search.CaseRunsForm(B)]})};Ext.extend(Testopia.Search.Panel,Ext.TabPanel);Testopia.Search.PlansForm=function(A){this.params=A;Testopia.Search.PlansForm.superclass.constructor.call(this,{title:"Plan Search",id:"plan_search_panel",layout:"fit",autoLoad:{url:"tr_query.cgi?current_tab=plan",params:A,scripts:true,text:"Loading search form...",callback:Testopia.Search.fillInForm.createDelegate(this,["plan",this.params])},buttons:[{text:"Submit",handler:function(){var E=new Ext.form.BasicForm("plan_search_form");var C=E.getValues();var B=Math.round(Math.random()*100);try{Ext.getCmp("search_win").close()}catch(D){}if(A.report){Ext.getCmp("object_panel").add(new Ext.Panel({id:"plan_search"+B,closable:true,title:"Plan Report",autoScroll:true,listeners:{render:function(){this.load({url:"tr_plan_reports.cgi",params:C})}},tbar:[new Ext.Toolbar.Fill(),{xtype:"button",id:"save_plan_report_btn",icon:"extensions/testopia/img/save.png",iconCls:"img_button_16x",tooltip:"Save this report",handler:function(F,G){Testopia.Search.save("plan",C)}},{xtype:"button",id:"link_plan_report_btn",icon:"extensions/testopia/img/link.png",iconCls:"img_button_16x",tooltip:"Create a link to this report",handler:function(F,G){Testopia.Search.LinkPopup(C)}}]}));Ext.getCmp("object_panel").activate("plan_search"+B)}else{Ext.getCmp("object_panel").add(new Testopia.TestPlan.Grid(C,{id:"plan_search"+B,closable:true,title:"Plan Search"}));Ext.getCmp("object_panel").activate("plan_search"+B)}}}]});this.on("activate",this.onActivate,this)};Ext.extend(Testopia.Search.PlansForm,Ext.Panel,{onActivate:function(A){if(!this.rendered){return }if(Ext.get("case_search_form")){Ext.get("case_search_form").remove()}if(Ext.get("run_search_form")){Ext.get("run_search_form").remove()}if(Ext.get("caserun_search_form")){Ext.get("caserun_search_form").remove()}this.params.current_tab="plan";this.load({url:"tr_query.cgi",params:this.params,scripts:true,text:"Loading search form...",callback:Testopia.Search.fillInForm.createDelegate(this,["plan",this.params])})}});Testopia.Search.CasesForm=function(A){this.params=A;Testopia.Search.CasesForm.superclass.constructor.call(this,{title:"Case Search",id:"case_search_panel",layout:"fit",autoLoad:{url:"tr_query.cgi?current_tab=case",params:A,scripts:true,text:"Loading search form...",callback:Testopia.Search.fillInForm.createDelegate(this,["case",this.params])},buttons:[{text:"Submit",handler:function(){var E=new Ext.form.BasicForm("case_search_form");var C=E.getValues();var B=Math.round(Math.random()*100);try{Ext.getCmp("search_win").close()}catch(D){}if(A.report){Ext.getCmp("object_panel").add(new Ext.Panel({id:"case_search"+B,closable:true,title:"Case Report",autoScroll:true,listeners:{render:function(){this.load({url:"tr_case_reports.cgi",params:C})}},tbar:[new Ext.Toolbar.Fill(),{xtype:"button",id:"save_case_report_btn",icon:"extensions/testopia/img/save.png",iconCls:"img_button_16x",tooltip:"Save this report",handler:function(F,G){Testopia.Search.save("case",C)}},{xtype:"button",id:"link_case_report_btn",icon:"extensions/testopia/img/link.png",iconCls:"img_button_16x",tooltip:"Create a link to this report",handler:function(F,G){Testopia.Search.LinkPopup(C)}}]}));Ext.getCmp("object_panel").activate("case_search"+B)}else{Ext.getCmp("object_panel").add(new Testopia.TestCase.Grid(C,{id:"case_search"+B,closable:true,title:"Case Search"}))}Ext.getCmp("object_panel").activate("case_search"+B)}}]});this.on("activate",this.onActivate,this)};Ext.extend(Testopia.Search.CasesForm,Ext.Panel,{onActivate:function(A){if(!this.rendered){return }if(Ext.get("run_search_form")){Ext.get("run_search_form").remove()}if(Ext.get("plan_search_form")){Ext.get("plan_search_form").remove()}if(Ext.get("caserun_search_form")){Ext.get("caserun_search_form").remove()}this.params.current_tab="case";this.load({url:"tr_query.cgi",params:this.params,scripts:true,text:"Loading search form...",callback:Testopia.Search.fillInForm.createDelegate(this,["case",this.params])})}});Testopia.Search.RunsForm=function(A){this.params=A;Testopia.Search.RunsForm.superclass.constructor.call(this,{title:"Run Search",id:"run_search_panel",layout:"fit",autoLoad:{url:"tr_query.cgi?current_tab=run",params:A,scripts:true,text:"Loading search form...",callback:Testopia.Search.fillInForm.createDelegate(this,["run",this.params])},buttons:[{text:"Submit",handler:function(){var E=new Ext.form.BasicForm("run_search_form");var C=E.getValues();if(A.qname){C.qname=A.qname}var B=Math.round(Math.random()*100);try{Ext.getCmp("search_win").close()}catch(D){}if(A.report){Ext.getCmp("object_panel").add(new Ext.Panel({id:"run_search"+B,closable:true,title:"Run Report",autoScroll:true,listeners:{render:function(){this.load({url:"tr_run_reports.cgi",params:C})}},tbar:[new Ext.Toolbar.Fill(),{xtype:"button",id:"save_run_report_btn",icon:"extensions/testopia/img/save.png",iconCls:"img_button_16x",tooltip:"Save this report",handler:function(F,G){Testopia.Search.save("run",C)}},{xtype:"button",id:"link_run_report_btn",icon:"extensions/testopia/img/link.png",iconCls:"img_button_16x",tooltip:"Create a link to this report",handler:function(F,G){Testopia.Search.LinkPopup(C)}}]}));Ext.getCmp("object_panel").activate("run_search"+B)}else{Ext.getCmp("object_panel").add(new Testopia.TestRun.Grid(C,{id:"run_search"+B,closable:true,title:"Run Search"}))}Ext.getCmp("object_panel").activate("run_search"+B)}}]});this.on("activate",this.onActivate,this)};Ext.extend(Testopia.Search.RunsForm,Ext.Panel,{onActivate:function(A){if(!this.rendered){return }if(Ext.get("case_search_form")){Ext.get("case_search_form").remove()}if(Ext.get("plan_search_form")){Ext.get("plan_search_form").remove()}if(Ext.get("caserun_search_form")){Ext.get("caserun_search_form").remove()}this.params.current_tab="run";this.load({url:"tr_query.cgi",params:this.params,scripts:true,text:"Loading search form...",callback:Testopia.Search.fillInForm.createDelegate(this,["run",this.params])})}});Testopia.Search.CaseRunsForm=function(A){this.params=A;Testopia.Search.CaseRunsForm.superclass.constructor.call(this,{title:"Case-Run Search",id:"caserun_search_panel",layout:"fit",autoLoad:{url:"tr_query.cgi?current_tab=case_run",params:A,scripts:true,text:"Loading search form...",callback:Testopia.Search.fillInForm.createDelegate(this,["caserun",this.params])},buttons:[{text:"Submit",handler:function(){var E=new Ext.form.BasicForm("caserun_search_form");var C=E.getValues();var B=Math.round(Math.random()*100);try{Ext.getCmp("search_win").close()}catch(D){}if(A.report){Ext.getCmp("object_panel").add(new Ext.Panel({id:"case_run_search"+B,closable:true,title:"Case-Run Report",autoScroll:true,listeners:{render:function(){this.load({url:"tr_caserun_reports.cgi",params:C})}},tbar:[new Ext.Toolbar.Fill(),{xtype:"button",id:"save_caserun_report_btn",icon:"extensions/testopia/img/save.png",iconCls:"img_button_16x",tooltip:"Save this report",handler:function(F,G){Testopia.Search.save("caserun",C)}},{xtype:"button",id:"link_plan_list_btn",icon:"extensions/testopia/img/link.png",iconCls:"img_button_16x",tooltip:"Create a link to this report",handler:function(F,G){Testopia.Search.LinkPopup(C)}}]}));Ext.getCmp("object_panel").activate("case_run_search"+B)}else{Ext.getCmp("object_panel").add(new Testopia.TestCaseRun.List(C,{id:"case_run_search"+B,closable:true,title:"Case-Run Search"}))}Ext.getCmp("object_panel").activate("case_run_search"+B)}}]});this.on("activate",this.onActivate,this)};Ext.extend(Testopia.Search.CaseRunsForm,Ext.Panel,{onActivate:function(A){if(!this.rendered){return }if(Ext.get("case_search_form")){Ext.get("case_search_form").remove()}if(Ext.get("run_search_form")){Ext.get("run_search_form").remove()}if(Ext.get("plan_search_form")){Ext.get("plan_search_form").remove()}this.params.current_tab="case_run";this.load({url:"tr_query.cgi",params:this.params,scripts:true,text:"Loading search form...",callback:Testopia.Search.fillInForm.createDelegate(this,["caserun",this.params])})}});Testopia.Search.SavedReportsList=function(A){this.store=new Ext.data.JsonStore({url:"tr_query.cgi",listeners:{exception:Testopia.Util.loadError},baseParams:{action:"get_saved_searches",type:A.type},root:"searches",fields:["name","query","author","type"]});var C=this.store;var B="dashboard_leftcol";this.columns=[{header:"Name",width:30,dataindex:"name",sortable:true}];Testopia.Search.SavedReportsList.superclass.constructor.call(this,{id:A.id||"reports_grid",loadMask:{msg:"Loading ..."},autoScroll:true,sm:new Ext.grid.RowSelectionModel({singleSelect:true,listeners:{rowselect:function(H,E,G){var D=G.get("name");if(G.get("type")==1){Ext.getCmp("object_panel").setActiveTab("dashboardpanel");var F=new Ext.ux.Portlet({title:D,id:D,closable:true,autoScroll:true,tools:PortalTools,url:G.get("query")});Ext.getCmp(B).add(F);Ext.getCmp(B).doLayout();Testopia.Search.dashboard_urls.push(G.get("query"));F.load({scripts:true,url:G.get("query")});B=B=="dashboard_leftcol"?"dashboard_rightcol":"dashboard_leftcol"}else{H.grid.loadPanel(G)}}}}),viewConfig:{forceFit:true}});Ext.apply(this,A);this.on("rowcontextmenu",this.onContextClick,this);this.on("activate",this.onActivate,this)};Ext.extend(Testopia.Search.SavedReportsList,Ext.grid.GridPanel,{onContextClick:function(B,A,D){var E=B.store.getAt(A).get("query").match(/(tr_list_|_reports)/);if(E){var C=B.store.getAt(A).get("query").match(/completion/);if(C){E=null}}this.menu=new Ext.menu.Menu({id:"run-ctx-menu",enableScrolling:false,items:[{text:"Open in a new tab",disabled:E?false:true,handler:function(){var F=B.store.getAt(A);if(F.get("type")==0){B.loadPanel(F)}else{var G=new Ext.Panel({title:F.get("name"),closable:true,id:"search"+F.get("name"),autoScroll:true});Ext.getCmp("object_panel").add(G);Ext.getCmp("object_panel").activate("search"+F.get("name"));G.load({url:F.get("query")})}}},{text:"Edit",icon:"extensions/testopia/img/edit.png",iconCls:"img_button_16x",disabled:E?false:true,handler:function(){var H=B.store.getAt(A);var F=H.get("name");var I=H.get("query");var G;G=I.match(/tr_list_(run|case|plan|caserun)s/);if(!G){G=I.match(/tr_(run|case|plan|caserun)_reports/);if(!G){Ext.Msg.show({title:"Non-editable",msg:"This Search or Report cannot be edited",icon:Ext.MessageBox.ERROR,buttons:Ext.MessageBox.OK});return }}G=G[1];var J=Testopia.Util.urlQueryToJSON(H.get("query"));Testopia.Search.Popup(G,J)}},{text:"Delete",icon:"extensions/testopia/img/delete.png",iconCls:"img_button_16x",handler:function(){var F=new Ext.form.BasicForm("testopia_helper_frm",{});Ext.Msg.show({msg:"Are you sure you want to delete this search?",buttons:Ext.MessageBox.YESNO,icon:Ext.MessageBox.QUESTION,fn:function(G,I){if(G=="yes"){var H=B.store.getAt(A);F.submit({url:"tr_query.cgi",params:{action:"delete_query",query_name:H.get("name")},success:function(){if(B){B.store.load()}},failure:Testopia.Util.error})}}})}},{text:"Refresh List",icon:"extensions/testopia/img/refresh.png",iconCls:"img_button_16x",handler:function(){B.store.reload()}}]});D.stopEvent();this.menu.showAt(D.getXY())},onActivate:function(A){if(!this.store.getCount()){this.store.load()}},loadPanel:function(A){var G={id:"search"+A.get("name"),closable:true,title:A.get("name"),lc:"lc_"+A.get("name"),rc:"rc_"+A.get("name")};if(A.get("type")==3){Ext.getCmp("object_panel").add(new Testopia.Search.DashboardPanel(G));Ext.getCmp("object_panel").activate("search"+A.get("name"));Ext.getCmp("search"+A.get("name")).getTopToolbar().add({xtype:"button",id:"link_dashboard_btn",icon:"extensions/testopia/img/link.png",iconCls:"img_button_16x",tooltip:"Create a link to this dashboard",handler:function(K,O){var L=window.location;var M=L.pathname.match(/(.*)[\/\\]([^\/\\]+\.\w+)$/);M=M[1];var N=new Ext.Window({width:300,plain:true,shadow:false,items:[new Ext.form.TextField({value:encodeURI(L.protocol+"//"+L.host+M+"/tr_show_product.cgi?dashboard="+A.get("name")+"&userid="+Testopia_user.id),width:287})]});N.show()}});var I="lc_"+A.get("name");var H=A.get("query").split("::>");var D;for(var F in H){if(typeof H[F]!="string"){continue}var B=Testopia.Util.urlQueryToJSON(H[F]);var J;typeof B.qname=="object"?J=B.qname[0]:J=B.qname;D=new Ext.ux.Portlet({title:J||" ",id:"search"+A.get("name")+F,closable:true,autoScroll:true,tools:PortalTools,url:H[F]});Ext.getCmp(I).add(D);Ext.getCmp(I).doLayout();I=I=="lc_"+A.get("name")?"rc_"+A.get("name"):"lc_"+A.get("name");D.load({scripts:true,url:H[F]})}}else{var E=Testopia.Util.urlQueryToJSON(A.get("query"));var C=E.current_tab;switch(C){case"plan":Ext.getCmp("object_panel").add(new Testopia.TestPlan.Grid(E,G));break;case"run":Ext.getCmp("object_panel").add(new Testopia.TestRun.Grid(E,G));break;case"case":Ext.getCmp("object_panel").add(new Testopia.TestCase.Grid(E,G));break;default:Ext.Msg.show({title:"No Type Found",msg:"There must have been a problem saving this search. I can't find a type",buttons:Ext.Msg.OK,icon:Ext.MessageBox.ERROR});return }Ext.getCmp("object_panel").activate("search"+A.get("name"))}}});PortalTools=[{id:"gear",handler:function(D,C,A){var B=new Ext.form.BasicForm("testopia_helper_frm",{});this.menu=new Ext.menu.Menu({id:"portal_tools_menu",items:[{text:"Save",handler:function(){Ext.Msg.prompt("Save Report As","",function(E,F){if(E=="ok"){B.submit({url:"tr_query.cgi",params:{action:"save_query",query_name:F,query_part:A.url,type:1},success:function(){Ext.getCmp("reports_grid").store.load();A.title=F},failure:Testopia.Util.error})}})}},{text:"Refresh",icon:"extensions/testopia/img/refresh.png",iconCls:"img_button_16x",handler:function(){A.load({url:A.url})}},{text:"Link to this report",handler:function(){var H;if(A.url.match(/^http/)){H=A.url;H=H.replace(/\&noheader=1/gi,"")}else{var E=window.location;var F=E.pathname.match(/(.*)[\/\\]([^\/\\]+\.\w+)$/);F=F[1];H=E.protocol+"//"+E.host+F+"/"+A.url;H=H.replace(/\&noheader=1/gi,"")}var G=new Ext.Window({width:300,plain:true,shadow:false,items:[new Ext.form.TextField({value:H,width:287})]});G.show()}},{text:"Delete",handler:function(){Ext.Msg.show({title:"Confirm Delete?",icon:Ext.MessageBox.QUESTION,msg:"Are you sure you want to delete this report?",buttons:Ext.Msg.YESNO,fn:function(E,F){if(E=="yes"){B.submit({url:"tr_query.cgi",params:{action:"delete_query",query_name:A.title},success:function(){Ext.getCmp("reports_grid").store.load();A.ownerCt.remove(A,true)},failure:Testopia.Util.error})}}})}}]});D.stopEvent();this.menu.showAt(D.getXY())}},{id:"close",handler:function(C,B,A){A.ownerCt.remove(A,true)}}];Testopia.Search.LinkPopup=function(E){if(E.current_tab=="case_run"){E.current_tab="caserun"}var B;if(E.report){B="tr_"+E.current_tab+"_reports.cgi"}else{B="tr_list_"+E.current_tab+"s.cgi"}var A=window.location;var C=A.pathname.match(/(.*)[\/\\]([^\/\\]+\.\w+)$/);C=C[1];var D=new Ext.Window({width:300,plain:true,shadow:false,items:[new Ext.form.TextField({value:A.protocol+"//"+A.host+C+"/"+B+"?"+Testopia.Util.JSONToURLQuery(E,"",["ctype"]),width:287})]});D.show()};Testopia.Tags.Lookup=function(A){Testopia.Tags.Lookup.superclass.constructor.call(this,{id:A.id||"tag_lookup",store:new Ext.data.JsonStore({url:"tr_quicksearch.cgi",listeners:{exception:Testopia.Util.loadError},baseParams:{action:"gettag"},root:"tags",totalProperty:"total",fields:[{name:"id",mapping:"tag_id"},{name:"name",mapping:"tag_name"}]}),queryParam:"search",loadingText:"Looking up tags...",displayField:"name",valueField:"id",typeAhead:false,hiddenName:"tag",hideTrigger:true,minListWidth:300,minChars:2,width:150,editable:true,forceSelection:false,emptyText:"Type a tagname...",listeners:{specialkey:function(B,C){if(C.getKey()==C.ENTER){Ext.getCmp("tag_add_btn").fireEvent("click")}}}});Ext.apply(this,A)};Ext.extend(Testopia.Tags.Lookup,Ext.form.ComboBox);Testopia.Tags.renderer=function(C,H,G,A,D,F,E,B){return'<div style="cursor:pointer" onclick=Testopia.Tags.list("'+E+'",'+B+',"'+G.get("tag_name")+'")>'+C+"</div>"};Testopia.Tags.list=function(D,E,A){var B={title:"Tag Results: "+A,closable:true,id:A+"search"+E,autoScroll:true};var C={product_id:E,tags:A};var F;if(D=="case"){F=new Testopia.TestCase.Grid(C,B)}else{if(D=="plan"){F=new Testopia.TestPlan.Grid(C,B)}else{if(D=="run"){F=new Testopia.TestRun.Grid(C,B)}}}Ext.getCmp("object_panel").add(F);Ext.getCmp("object_panel").activate(A+"search"+E)};Testopia.Tags.ObjectTags=function(D,A){this.orig_id=A;this.obj_id=A;this.store=new Ext.data.JsonStore({url:"tr_tags.cgi",listeners:{exception:Testopia.Util.loadError},baseParams:{action:"gettags",type:D},root:"tags",id:"tag_id",fields:[{name:"tag_id",mapping:"tag_id"},{name:"tag_name",mapping:"tag_name"},{name:"run_count",mapping:"run_count"},{name:"case_count",mapping:"case_count"},{name:"plan_count",mapping:"plan_count"}]});var C=this.store;this.remove=function(){var F=new Ext.form.BasicForm("testopia_helper_frm",{});F.submit({url:"tr_tags.cgi",params:{action:"removetag",type:D,id:this.obj_id,tag:Testopia.Util.getSelectedObjects(Ext.getCmp(D+"tagsgrid"),"tag_name")},success:function(){C.reload()},failure:Testopia.Util.error})};this.add=function(){var F=new Ext.form.BasicForm("testopia_helper_frm",{});F.submit({url:"tr_tags.cgi",params:{action:"addtag",type:D,id:this.obj_id,tag:Ext.getCmp(D+"tag_lookup").getRawValue()},success:function(){C.reload()},failure:Testopia.Util.error})};this.columns=[{dataIndex:"tag_id",hidden:true,hideable:false},{header:"Name",width:150,dataIndex:"tag_name",id:"tag_name",sortable:true,hideable:false},{header:"Cases",width:35,dataIndex:"case_count",sortable:true,hidden:true,renderer:Testopia.Tags.renderer.createDelegate(this,["case"],true)},{header:"Runs",width:35,dataIndex:"run_count",sortable:true,hidden:true,renderer:Testopia.Tags.renderer.createDelegate(this,["run"],true)},{header:"Plans",width:35,dataIndex:"plan_count",sortable:true,hidden:true,renderer:Testopia.Tags.renderer.createDelegate(this,["plan"],true)}];var B=new Ext.Button({id:"tag_add_btn",icon:"extensions/testopia/img/add.png",iconCls:"img_button_16x",handler:this.add.createDelegate(this)});var E=new Ext.Button({icon:"extensions/testopia/img/delete.png",iconCls:"img_button_16x",handler:this.remove.createDelegate(this)});Testopia.Tags.ObjectTags.superclass.constructor.call(this,{title:"Tags",split:true,region:"east",layout:"fit",width:200,autoExpandColumn:"tag_name",collapsible:true,id:D+"tagsgrid",loadMask:{msg:"Loading "+D+" tags..."},autoScroll:true,sm:new Ext.grid.RowSelectionModel({singleSelect:false}),viewConfig:{forceFit:true},tbar:[new Testopia.Tags.Lookup({id:D+"tag_lookup"}),B,E]});this.on("rowcontextmenu",this.onContextClick,this);this.on("activate",this.onActivate,this)};Ext.extend(Testopia.Tags.ObjectTags,Ext.grid.GridPanel,{onContextClick:function(B,A,C){if(!this.menu){this.menu=new Ext.menu.Menu({id:"tags-ctx-menu",enableScrolling:false,items:[{text:"Remove Selected Tags",icon:"extensions/testopia/img/delete.png",iconCls:"img_button_16x",obj_id:this.obj_id,handler:this.remove},{text:"Refresh List",icon:"extensions/testopia/img/refresh.png",iconCls:"img_button_16x",handler:function(){B.store.reload()}}]})}C.stopEvent();if(B.getSelectionModel().getCount()<1){B.getSelectionModel().selectRow(A)}this.menu.showAt(C.getXY())},onActivate:function(A){if(!this.store.getCount()||this.orig_id!=this.obj_id){this.store.load({params:{id:this.obj_id}})}}});Testopia.Tags.ProductTags=function(F,C,A){var E;this.product_id=A;this.store=new Ext.data.JsonStore({url:"tr_tags.cgi",listeners:{exception:Testopia.Util.loadError},baseParams:{action:"gettags",type:C},root:"tags",id:"tag_id",fields:[{name:"tag_id",mapping:"tag_id"},{name:"tag_name",mapping:"tag_name"},{name:"run_count",mapping:"run_count"},{name:"case_count",mapping:"case_count"},{name:"plan_count",mapping:"plan_count"}]});var D=this.store;this.columns=[{header:"ID",dataIndex:"tag_id",hidden:true},{header:"Name",width:150,dataIndex:"tag_name",id:"tag_name",sortable:true},{header:"Cases",width:35,dataIndex:"case_count",sortable:true,renderer:Testopia.Tags.renderer.createDelegate(this,["case",A],true)},{header:"Runs",width:35,dataIndex:"run_count",sortable:true,renderer:Testopia.Tags.renderer.createDelegate(this,["run",A],true)},{header:"Plans",width:35,dataIndex:"plan_count",sortable:true,renderer:Testopia.Tags.renderer.createDelegate(this,["plan",A],true)}];var B=new Ext.form.TextField({allowBlank:true,id:"rungrid-filter",selectOnFocus:true});Testopia.Tags.ProductTags.superclass.constructor.call(this,{title:F,id:C+"tags",loadMask:{msg:"Loading "+F+" ..."},autoExpandColumn:"tag_name",autoScroll:true,sm:new Ext.grid.RowSelectionModel({singleSelect:false}),viewConfig:{forceFit:true}});this.on("rowcontextmenu",this.onContextClick,this);this.on("activate",this.onActivate,this)};Ext.extend(Testopia.Tags.ProductTags,Ext.grid.GridPanel,{onContextClick:function(B,A,C){if(!this.menu){this.menu=new Ext.menu.Menu({id:"tags-ctx-menu",enableScrolling:false,items:[{text:"Refresh",icon:"extensions/testopia/img/refresh.png",iconCls:"img_button_16x",handler:function(){ds.reload()}}]})}C.stopEvent();this.menu.showAt(C.getXY())},onActivate:function(A){if(!this.store.getCount()){this.store.load({params:{product_id:this.product_id}})}}});Testopia.Tags.update=function(B,A){function C(H,G,E){var F=new Ext.form.BasicForm("testopia_helper_frm",{});F.submit({url:"tr_tags.cgi",params:{action:H,tag:G,type:B,id:Testopia.Util.getSelectedObjects(E,B+"_id")},success:function(){},failure:Testopia.Util.error})}var D=new Ext.Window({title:"Add or Remove Tags",id:"tags_edit_win",layout:"fit",split:true,plain:true,shadow:false,width:350,listeners:{afterlayout:function(){Ext.getCmp("tags_update").focus("",10)}},height:150,items:[new Ext.FormPanel({labelWidth:"40",bodyStyle:"padding: 5px",items:[new Testopia.Tags.Lookup({id:"tags_update",fieldLabel:"Tags"})]})],buttons:[{text:"Add Tag",handler:function(){C("addtag",Ext.getCmp("tag_lookup").getRawValue(),A);D.close()}},{text:"Remove Tag",handler:function(){C("removetag",Ext.getCmp("tag_lookup").getRawValue(),A);D.close()}},{text:"Close",handler:function(){D.close()}}]});D.show()};