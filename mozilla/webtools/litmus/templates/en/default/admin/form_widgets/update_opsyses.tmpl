<script type="text/javascript">
function enableOpsysModeButtons() {
  document.getElementById("edit_opsys_button").disabled=false;
  document.getElementById("delete_opsys_button").disabled=false;
}

function disableOpsysModeButtons() {
  document.getElementById("edit_opsys_button").disabled=true;
  document.getElementById("delete_opsys_button").disabled=true;
}

function loadOpsys() {
  var opsys_select = document.getElementById("opsys_id");

  if (! opsys_select ||
      opsys_select.options[opsys_select.selectedIndex].value=="") {
    disableOpsysModeButtons();
    document.getElementById('edit_opsys_form_div').style.display = 'none';
    disableForm('edit_opsys_form');
    blankOpsysForm('edit_opsys_form');
    return false;
  }

  var opsys_id = opsys_select.options[opsys_select.selectedIndex].value;

  disableForm('edit_opsys_form');
  toggleMessage('loading','Loading Opsys ID# ' + opsys_id + '...');
  var url = 'json.cgi?opsys_id=' + opsys_id;
  fetchJSON(url,populateOpsys);
}

function populateOpsys(data) {
  opsys=data;
  document.getElementById('edit_opsys_form_opsys_id').value = opsys.opsys_id;
  document.getElementById('edit_opsys_form_opsys_id_display').innerHTML = opsys.opsys_id;
  document.getElementById('edit_opsys_form_name').value = opsys.name;
  document.getElementById('edit_opsys_form_detect_regexp').value = opsys.detect_regexp;
  var platform_box = document.getElementById('edit_opsys_form_platform_id');
  var options = platform_box.getElementsByTagName('option');
  var found_platform = 0;
  for (var i=0; i<options.length; i++) {
    if (options[i].value == opsys.platform_id.platform_id) {
      options[i].selected = true;
      found_platform=1;
    } else {
      options[i].selected = false;
    }
    if (found_platform == 0) {
      options[0].selected = true;
    }
  }

  document.getElementById('edit_opsys_form_div').style.display = 'block';
  enableOpsysModeButtons();
}

function blankOpsysForm(formid) {
  blankForm(formid);
  document.getElementById('edit_opsys_form_opsys_id_display').innerHTML = '';
}

function switchOpsysFormToAdd() {
  disableOpsysModeButtons();
  blankOpsysForm('edit_opsys_form');
  document.getElementById('edit_opsys_form_submit').value = 'Add Opsys';
  document.getElementById('edit_opsys_form_mode').value = 'add';
  enableForm('edit_opsys_form');
  document.getElementById('edit_opsys_form_div').style.display = 'block';
}

function switchOpsysFormToEdit() {
  document.getElementById('edit_opsys_form_submit').value = 'Submit Edits';
  document.getElementById('edit_opsys_form_mode').value = 'edit';
  enableForm('edit_opsys_form');
  document.getElementById('edit_opsys_form_div').style.display = 'block';
}


function checkOpsysForm(f) {
  return (
          checkString(f.edit_opsys_form_name,"Operating System Name",false) &&
          checkString(f.edit_opsys_form_detect_regexp,"Operating System Detect Regexp",true) &&
          verifySelected(f.edit_opsys_form_platform_id, "Platform")
         );
}

function resetOpsys() {
  if (document.getElementById('edit_opsys_form_opsys_id').value != '') {
    populateOpsys(opsys);
    switchOpsysFormToEdit();   
  } else {
    switchOpsysFormToAdd();   
  }
}
</script>

<h1 id="opsyses_header" class="firstHeading"><a name="manage_opsyses" class="collapse-link">Manage Operating Sytems&nbsp;&raquo;</a></h1>

<div id="manage_opsyses_div" class="collapsable">
<div class="section-full">
  <div class="section-header">Existing Operating Systems</div>

  <div class="section-content">

    <form id="select_opsys_and_mode_form" name="select_opsys_and_mode_form" method="post" action="manage_categories.cgi">
      <table border="0" cellspacing="0" cellpadding="5">
        <tr>
        <td>
        [% INCLUDE form_widgets/select_opsys_id.tmpl name="opsys_id" placeholder=1 size=5 show_name=1 onChange="loadOpsys();" %]
        </td>
        </tr>
        <tr>
        <td>
        <input id="add_opsys_button" name="add_opsys_button" class="manage" type="button" onClick="switchOpsysFormToAdd();" value="Add new operating system">&nbsp;
        <input id="edit_opsys_button" name="edit_opsys_button" class="manage" type="button" onClick="switchOpsysFormToEdit();" value="Edit operating system" disabled>&nbsp;
        <input id="delete_opsys_button" name="delete_opsys_button" class="manage" type="submit" onClick="return confirm('Really delete this operating system?');" value="Delete operating system" disabled>&nbsp;
        </td>
        </tr>
      </table>
    </form>

  </div> <!--end section-content-->

  <div style="display: none;" id="edit_opsys_form_div">
  <hr />
    <div id="opsys-title" class="section-header">Operating System Info</div>
    <div class="section-content">
      <form id="edit_opsys_form" name="edit_opsys_form" method="post" action="manage_categories.cgi" onSubmit="return checkOpsysForm(this);">
        <input id="edit_opsys_form_mode" name="edit_opsys_form_mode" type="hidden" value="edit">
        <input id="edit_opsys_form_opsys_id" name="edit_opsys_form_opsys_id" type="hidden" value="">

        <table class="manage">
          <tr>
          <td class="headerleft">Operating System ID#:</td>
          <td name="edit_opsys_form_opsys_id_display" id="edit_opsys_form_opsys_id_display"></td>
          </tr>
          <tr>
          <td class="headerleft">Name:</td>
          <td colspan="2"><input name="edit_opsys_form_name"
                                 id="edit_opsys_form_name"
                                 value=""
                                 size="55"/ disabled></td>
          </tr>
	  <tr>
          <td class="headerleft">Platform:</td>
          <td colspan="2">[% INCLUDE form_widgets/select_platform_id.tmpl name="edit_opsys_form_platform_id" placeholder=1 size=1 show_name=1 %]
          </tr>
          <tr>
          <td class="headerleft">Detect Regexp:</td>
          <td colspan="2"><input name="edit_opsys_form_detect_regexp"
                                 id="edit_opsys_form_detect_regexp"
                                 value=""
                                 size="55"/ disabled></td>
          </tr>
	  <tr>
          <td colspan="3" align="right"><input id="edit_opsys_form_reset" class="button" type="button" value="Reset" disabled onClick="resetOpsys();" />&nbsp;<input class="button" type="submit" id="edit_opsys_form_submit" name="edit_opsys_form_submit" value="Submit Edits" disabled /></div>
          </td>
          </tr>
        </table>
      </form>
    </div>
  </div>

</div> <!--end section-full-->
</div>