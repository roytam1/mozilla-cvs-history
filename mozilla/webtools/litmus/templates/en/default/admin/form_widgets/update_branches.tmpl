<script type="text/javascript">
function checkAddBranchForm(f) {
   return (
           checkString(f.new_branch_name,"branch name",false) &&
           checkProduct(f.branch_add_product) &&
           checkString(f.new_branch_detect_regexp,"detect regexp",false)
          );
}

function getBarnchByName(branchName) {
    http.open('get', 'rpc.cgi?action=getBranchByName&branchName='+branchName);
    http.onreadystatechange = updateBranchForm;
    http.send(null);
}

function updateBranchForm() {
    if(http.readyState == 4){
        var response = http.responseText;
        var update = new Array();

        var em = document.getElementById("notification-content")
        if(response.indexOf('|' != -1)) {
            update = response.split('|');
            document.getElementById("modify_branch_id").value = update[0];
            document.getElementById("modify_branch_name").disabled = false;
            document.getElementById("modify_branch_name").value = update[1];
            // lookup product
            document.getElementById("modify_branch_detect_regexp").disabled = false;
            document.getElementById("modify_branch_detect_regexp").value = update[2];
            document.getElementById("delete_branch").disabled = false;
            document.getElementById("update_branch").disabled = false;
        } else {
            document.getElementById("notification").style.display = 'block';
            em.innerHTML = response;
        }
    }
}

</script>

<div id="branches" class="category">

<h2>Branches</h2>

<h3 class="display branch_add"><a name="#branch_add">Add&nbsp;&raquo;</a></h3>
<div id="branch_add" class="collapsable">
<form id="branch_add_form" name="branch_add_form" action="edit_categories.cgi" method="post" onSubmit="checkAddBranchForm(this);">
<table class="category">
<tr>
<td>Name:</td>
<td><input id="new_branch_name" name="new_branch_name" type="text" size="30"></td>
</tr>
<tr>
<td>Product:</td>
<td>
[% INCLUDE form_widgets/select_product.tmpl name="branch_add_product" placeholder=1 %]
</td>
</tr>
<tr>
<td>Detect Regexp:</td>
<td><input id="new_branch_detect_regexp" name="new_branch_detect_regexp" type="text" size="30"></td>
</tr>
<tr>
<td colspan="2" align="right">
<input class="category" name="reset" type="reset" value="Reset">&nbsp;<input class="category" name="add_branch" type="submit" value="Add New Branch">
</td>
</tr>
</table>
</form>
</div>

<h3 class="display branch_modify"><a name="#branch_modify">Modify / Delete&nbsp;&raquo;</a></h3>
<div id="branch_modify" class="collapsable">
<form id="branch_modify_form" name="branch_modify_form" action="edit_categories.cgi" method="post">
<input id="modify_branch_id" name="modify_branch_id" type="hidden" value="">
<table class="category">
<tr>
<td colspan="2" align="left">
Select Existing Branch:<br/>
[% INCLUDE form_widgets/select_branch.tmpl size=5 name="branch_modify_existing" onChange="getBranchByName(this.options[this.selectedIndex].value);" %]
</td>
</tr>
<tr>
<td>Name:</td>
<td><input disabled id="modify_branch_name" name="modify_branch_name" type="text" size="30"></td>
</tr>
<tr>
<td>Product:</td>
<td>
[% INCLUDE form_widgets/select_product.tmpl name="branch_modify_product" placeholder=1 disabled=1 %]
</td>
</tr>
<tr>
<td>Detect Regexp:</td>
<td><input disabled id="modify_branch_detect_regexp" name="modify_branch_detect_regexp" type="text" size="30"></td>
</tr>
<tr>
<td colspan="2" align="right">
<input disabled class="category" name="delete_branch" type="submit" value="Delete Branch">&nbsp;<input disabled class="category" name="update_branch" type="submit" value="Update Branch">
</td>
</tr>
</table>
</form>

</div>

</div>





