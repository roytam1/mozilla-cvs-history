[%# 1.0@bugzilla.org %]
[%# The contents of this file are subject to the Mozilla Public
  # License Version 1.1 (the "License"); you may not use this file
  # except in compliance with the License. You may obtain a copy of
  # the License at http://www.mozilla.org/MPL/
  #
  # Software distributed under the License is distributed on an "AS
  # IS" basis, WITHOUT WARRANTY OF ANY KIND, either express or
  # implied. See the License for the specific language governing
  # rights and limitations under the License.
  #
  # The Original Code is the Bugzilla Bug Tracking System.
  #
  # The Initial Developer of the Original Code is Netscape Communications
  # Corporation. Portions created by Netscape are
  # Copyright (C) 1998 Netscape Communications Corporation. All
  # Rights Reserved.
  #
  # Contributor(s): William Jon McCann <mccann@jhu.edu>
  #%]
[% PROCESS global/variables.none.tmpl %]
BEGIN:VCALENDAR
CALSCALE:GREGORIAN
PRODID:-//Mozilla/Bugzilla [% VERSION %]//EN
VERSION:2.0
[% FOREACH bug = bugs %]
BEGIN:VTODO
UID:[% bug.bug_id %]@[% Param('urlbase') FILTER uri %]
URL;VALUE=URI:[% Param('urlbase') FILTER uri %]show_bug.cgi?id=[% bug.bug_id %]
SUMMARY:[% PROCESS ics_summary %]
STATUS:[% PROCESS ics_status bug_status = bug.bug_status %]
[% IF bug.product %]
X-BUGZILLA-PRODUCT:[% bug.product %]
[% END %]
[% IF bug.component %]
X-BUGZILLA-COMPONENT:[% bug.component %]
[% END %]
[% IF bug.version %]
X-BUGZILLA-VERSION:[% bug.version %]
[% END %]
[% IF bug.keywords %]
X-BUGZILLA-KEYWORDS:[% bug.keywords %]
[% END %]
END:VTODO
[% END %]
END:VCALENDAR

[% BLOCK ics_status %]
    [% status = "" %]
    [% FOREACH state = closedstates %]
        [% IF bug_status == state %]
            [% status = "COMPLETED" %]
            [% LAST %]
        [% END %]
    [% END %]
    [% IF NOT status %]
        [% IF bug_status == 'ASSIGNED' %]
            [% status = "IN-PROGRESS" %]
        [% ELSE %]
            [% status = "NEEDS-ACTION" %]
        [% END %]
    [% END %]
    [% status %]
[% END %]

[% BLOCK ics_summary %]
    [% IF bug.short_desc %]
        [% summary = bug.short_desc %]
    [% ELSIF bug.short_short_desc %]
        [% summary = bug.short_short_desc %]
    [% ELSE %]
        [% summary = "$terms.Bug $bug.bug_id" %]
    [% END %]
    [% summary FILTER remove('\n') FILTER truncate(255) %]
[% END %]
