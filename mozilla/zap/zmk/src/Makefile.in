DEPTH		= ../../..
topsrcdir	= @top_srcdir@
srcdir		= @srcdir@
VPATH		= @srcdir@

include $(DEPTH)/config/autoconf.mk

MODULE		= zmk
XPIDL_MODULE    = zmk
LIBRARY_NAME	= zmk
EXPORT_LIBRARY	= 1
IS_COMPONENT	= 1
MODULE_NAME	= zapMediaModule

REQUIRES	= \
		xpcom \
		string \
		necko \
		zap_base \
		zap_netutils \
		portaudio_v18_1 \
		$(NULL)

CPPSRCS		= \
		zapAudioDevice.cpp \
		zapAudioDeviceManager.cpp \
		zapAudioIn.cpp \
		zapAudioMixer.cpp \
		zapAudioOut.cpp \
		zapAudioReformatter.cpp \
		zapAudioStreamUtils.cpp \
		zapAudioToneFrame.cpp \
		zapClientSink.cpp \
		zapClockReducer.cpp \
		zapDTMFGenerator.cpp \
		zapDataExtractor.cpp \
		zapDatagramFrame.cpp \
		zapFileIn.cpp \
		zapG711Decoder.cpp \
		zapG711Encoder.cpp \
		zapG711RTPDepacketizer.cpp \
		zapG711RTPPacketizer.cpp \
		zapGenericSource.cpp \
		zapMediaGraph.cpp \
		zapMediaModule.cpp \
		zapNullSink.cpp \
		zapPCMPing.cpp \
		zapPacketBuffer.cpp \
		zapPacketBurster.cpp \
		zapPacketPump.cpp \
		zapRTPDemuxer.cpp \
		zapRTPFrame.cpp \
		zapRTPReceiver.cpp \
		zapRTPSession.cpp \
		zapRTPTransmitter.cpp \
		zapRtttlPlayer.cpp \
		zapSpeexAudioProcessor.cpp \
		zapSpeexDecoder.cpp \
		zapSpeexEncoder.cpp \
		zapSpeexRTPDepacketizer.cpp \
		zapSpeexRTPPacketizer.cpp \
		zapSplitter.cpp \
		zapStreamMerger.cpp \
		zapStreamSwitch.cpp \
		zapStreamSyncer.cpp \
		zapStreamTap.cpp \
		zapStunClient.cpp \
		zapStunDemuxer.cpp \
		zapStunFrame.cpp \
		zapStunServer.cpp \
		zapTEventRTPPacketizer.cpp \
		zapTEventToTToneConverter.cpp \
		zapTToneGenerator.cpp \
		zapTToneToPCMConverter.cpp \
		zapTelephoneEventFrame.cpp \
		zapTimestamper.cpp \
		zapTimestampScaler.cpp \
		zapTimestampSyncer.cpp \
		zapTimestampTrigger.cpp \
		zapUDPPacketizer.cpp \
		zapUDPSocket.cpp \
		zapUDPSocketPair.cpp \
#		zapAudioIO.cpp \
		$(NULL)

XPIDLSRCS	= \
		zapIAudioDevice.idl \
		zapIAudioDeviceManager.idl \
		zapIAudioIO.idl \
		zapIAudioIn.idl \
		zapIAudioMixer.idl \
		zapIAudioOut.idl \
		zapIAudioReformatter.idl \
		zapIAudioToneFrame.idl \
		zapIClientSink.idl \
		zapIDTMFGenerator.idl \
		zapIFileIn.idl \
		zapIMediaGraph.idl \
		zapIPacketBuffer.idl \
		zapIPacketBurster.idl \
		zapIPacketPump.idl \
		zapIPortaudioDevice.idl \
		zapIRTPFrame.idl \
		zapISpeexAudioProcessor.idl \
		zapISpeexDecoder.idl \
		zapISpeexEncoder.idl \
		zapIStreamSwitch.idl \
		zapIStreamSyncer.idl \
		zapIStunClient.idl \
		zapIStunClientListener.idl \
		zapIStunServer.idl \
		zapIStunServerListener.idl \
		zapITimestampScaler.idl \
		zapITimestampTrigger.idl \
		zapITToneGenerator.idl \
		zapITelephoneEventFrame.idl \
		zapIUDPSocket.idl \
		zapIUDPSocketPair.idl \
		$(NULL)

SHARED_LIBRARY_LIBS += \
		../portaudio_v18_1/$(LIB_PREFIX)moz_portaudio_v18_1.$(LIB_SUFFIX) \
		../speex-1.1.10/libspeex/$(LIB_PREFIX)moz_speex_v1_1_10.$(LIB_SUFFIX) \
		../ccitt-adpcm/$(LIB_PREFIX)moz_ccitt_adpcm.$(LIB_SUFFIX) \
		../base/$(LIB_PREFIX)zmk_base_s.$(LIB_SUFFIX) \
		$(NULL)

ifeq ($(OS_ARCH),WINNT)
OS_LIBS += dsound.lib winmm.lib
endif

ifeq ($(OS_ARCH),Darwin)
OS_LIBS += -framework CoreAudio  -framework AudioToolbox -framework Carbon
endif


#needed for compiling with speex_echo.h:
DEFINES += -Drestrict=


include $(topsrcdir)/config/rules.mk

EXTRA_DSO_LDOPTS += \
		$(XPCOM_GLUE_LDOPTS) \
		$(NSPR_LIBS) \
		$(NULL)

INCLUDES += 	\
		-I$(srcdir)/../speex-1.1.10/include \
		$(NULL)
