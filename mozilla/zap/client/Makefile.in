DEPTH		= ../..
topsrcdir	= @top_srcdir@
srcdir		= @srcdir@
VPATH		= @srcdir@

include $(DEPTH)/config/autoconf.mk

DIRS 		= profile src components

MODULE		= zap
export XPI_NAME	= zap

PREF_JS_EXPORTS	= $(srcdir)/zap-prefs.js
DIST_FILES	= application.ini

ifneq (,$(filter windows,$(MOZ_WIDGET_TOOLKIT)))
ICONS		= icons/zap.ico
endif
ifneq (,$(filter gtk gtk2,$(MOZ_WIDGET_TOOLKIT)))
ICONS		= icons/zap.xpm icons/zap16.xpm
endif

include $(topsrcdir)/config/rules.mk

ifneq (,$(ICONS))
libs:: $(ICONS)
	$(INSTALL) $^ $(FINAL_TARGET)/chrome/icons/default
endif

ifneq (,$(filter mac cocoa,$(MOZ_WIDGET_TOOLKIT)))

clean clobber ::
	rm -rf $(DIST)/$(APP_NAME).app

CONTENTS_PATH = $(DIST)/zap.app/Contents

libs::
	mkdir -p $(CONTENTS_PATH)
	cp $(srcdir)/macbuild/Info.plist $(CONTENTS_PATH)/
	mkdir -p $(CONTENTS_PATH)/Frameworks/XUL.framework
	rsync -rl $(DIST)/XUL.framework/Versions/Current/* $(CONTENTS_PATH)/Frameworks/XUL.framework
	mkdir -p $(CONTENTS_PATH)/Resources
	rsync -rl $(FINAL_TARGET)/* $(CONTENTS_PATH)/Resources
	mkdir -p $(CONTENTS_PATH)/MacOS

ifdef MOZ_ENABLE_LIBXUL
libs::
	cp $(DIST)/XUL.framework/Versions/Current/xulrunner $(CONTENTS_PATH)/MacOS/
else
libs::
	cp $(DIST)/XUL.framework/Versions/Current/xulrunner $(CONTENTS_PATH)/MacOS/xulrunner-inner
	cp $(srcdir)/macbuild/executable-wrapper $(CONTENTS_PATH)/MacOS/xulrunner
endif

endif
