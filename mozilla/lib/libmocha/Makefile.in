#!gmake
#
# The contents of this file are subject to the Netscape Public
# License Version 1.1 (the "License"); you may not use this file
# except in compliance with the License. You may obtain a copy of
# the License at http://www.mozilla.org/NPL/
#
# Software distributed under the License is distributed on an "AS
# IS" basis, WITHOUT WARRANTY OF ANY KIND, either express or
# implied. See the License for the specific language governing
# rights and limitations under the License.
#
# The Original Code is mozilla.org code.
#
# The Initial Developer of the Original Code is Netscape
# Communications Corporation.  Portions created by Netscape are
# Copyright (C) 1998 Netscape Communications Corporation. All
# Rights Reserved.
#
# Contributor(s): 



DEPTH		= ../..
topsrcdir	= @top_srcdir@
srcdir		= @srcdir@
VPATH		= @srcdir@

include $(DEPTH)/config/autoconf.mk

MODULE		= mocha
LIBRARY_NAME	= mocha

REQUIRES	= lay parse img js style layer applet dbm security \
		  htmldlgs util jtools pref caps java libreg softupdt jsdebug \
		  netcache network httpurl plugin plugimpl mocha oji ojiimpl xpcom \
		  layout rdf

ifdef DOM
EXPORTS		= lm_dom.h                        # required by layout
REQUIRES	+= dom
endif


ifdef MOZ_SECURITY
REQUIRES       += jar
endif

CSRCS		= et_mocha.c \
		  et_moz.c \
		  lm_applt.c \
		  lm_bars.c \
		  lm_cmpnt.c \
		  lm_doc.c \
		  lm_embed.c \
		  lm_event.c \
		  lm_form.c \
		  lm_hardw.c \
		  lm_hist.c \
		  lm_href.c \
		  lm_img.c \
		  lm_init.c \
		  lm_input.c \
		  lm_nav.c \
		  lm_plgin.c \
		  lm_screen.c \
		  lm_supdt.c \
		  lm_taint.c \
                  lm_tree.c \
		  lm_trggr.c \
		  lm_url.c \
		  lm_win.c \
		  lm_wngrp.c \
		  lm_layer.c \
		  lm_bkgrd.c \
		  lm_env.c \
		  $(NULL)


ifdef MOZ_JAVA
CSRCS +=             \
		  lm_jsd.c \
		  $(NULL)
endif

ifdef DOM
CSRCS +=	  lm_dom.c \
		  $(NULL)
endif

EXPORTS := $(addprefix $(srcdir)/, $(EXPORTS))

include $(topsrcdir)/config/rules.mk

ifdef DOM
DEFINES +=	-DDOM
endif 

DEFINES		+= -DDLL_SUFFIX=\"$(DLL_SUFFIX)\"

TAINT_CFLAGS	= $(CFLAGS) -I$(topsrcdir)/lib/libjar -I$(DEPTH)/sun-java/netscape/security/_jri \
		-I$(DEPTH)/dist/public/security

ifneq ($(OS_ARCH),OS2)
$(OBJDIR)/lm_embed.o: lm_embed.c
	@$(MAKE_OBJDIR)
	$(CC) -o $@ -c $(CFLAGS) $<

$(OBJDIR)/lm_taint.o: lm_taint.c
	@$(MAKE_OBJDIR)
	$(CC) -o $@ -c $(TAINT_CFLAGS) $<

else
$(OBJDIR)/lm_embed.o: lm_embed.c
	@$(MAKE_OBJDIR)
	$(CC) -Fo$@ -c $(CFLAGS) $<

$(OBJDIR)/lm_taint.o: lm_taint.c
	@$(MAKE_OBJDIR)
	$(CC) -Fo$@ -c $(TAINT_CFLAGS) $<

endif
