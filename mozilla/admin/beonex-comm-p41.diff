? bc-p40.zip
? fails.txt
? mystuff
? zip
? README/user
? content/base/public/mozISanitizingSerializer.h
? content/base/src/mozSanitizingSerializer.cpp
? content/base/src/mozSanitizingSerializer.h
? extensions/spellcheck
? mailnews/base/resources/content/142471-1.diff
? mailnews/mime/src/mimethpl.cpp
? mailnews/mime/src/mimethpl.h
? mailnews/mime/src/mimethsa.cpp
? mailnews/mime/src/mimethsa.h
Index: allmakefiles.sh
===================================================================
RCS file: /cvsroot/mozilla/allmakefiles.sh,v
retrieving revision 1.356.2.5
diff -u -u -w -r1.356.2.5 allmakefiles.sh
--- allmakefiles.sh	22 Jun 2002 20:41:54 -0000	1.356.2.5
+++ allmakefiles.sh	24 Aug 2002 17:13:04 -0000
@@ -1067,6 +1067,13 @@
             extensions/pref/autoconfig/src/Makefile
             extensions/pref/autoconfig/resources/Makefile
             " ;;
+        spellcheck ) MAKEFILES_extensions="$MAKEFILES_extensions
+            extensions/spellcheck/Makefile
+            extensions/spellcheck/idl/Makefile
+            extensions/spellcheck/myspell/Makefile
+            extensions/spellcheck/myspell/dictionaries/Makefile
+            extensions/spellcheck/src/Makefile
+            " ;;
         transformiix ) MAKEFILES_extensions="$MAKEFILES_extensions
             $MAKEFILES_transformiix"
             ;;
Index: configure
===================================================================
RCS file: /cvsroot/mozilla/configure,v
retrieving revision 1.949.2.10
diff -u -u -w -r1.949.2.10 configure
--- configure	1 Jul 2002 17:52:42 -0000	1.949.2.10
+++ configure	24 Aug 2002 17:13:12 -0000
@@ -203,7 +203,7 @@
   --enable-default-mozilla-five-home
                           Set the default value for MOZILLA_FIVE_HOME"
 ac_help="$ac_help
-  --with-user-appdir=DIR  Set user-specific appdir (default=.mozilla)"
+  --with-user-appdir=DIR  Set user-specific appdir (default=.beonex/comm)"
 ac_help="$ac_help
   --disable-verbose-config-defs
                           Do not output the contents of config-defs.h"
@@ -2942,7 +2942,7 @@
   echo "$ac_t""no" 1>&6
 fi
 
-for ac_prog in gawk mawk nawk awk
+for ac_prog in mawk gawk nawk awk
 do
 # Extract the first word of "$ac_prog", so it can be a program name with args.
 set dummy $ac_prog; ac_word=$2
@@ -11255,7 +11255,7 @@
 
 
 
-MOZ_EXTENSIONS_DEFAULT=" cookie wallet content-packs xml-rpc xmlextras help pref transformiix venkman inspector irc universalchardet"
+MOZ_EXTENSIONS_DEFAULT=" cookie wallet content-packs pref transformiix irc spellcheck"
 
 if test -n "$SUNCTL"; then
   MOZ_EXTENSIONS_DEFAULT="$MOZ_EXTENSIONS_DEFAULT ctl"
@@ -12187,7 +12187,7 @@
 fi
 else
   cat >> confdefs.h <<\EOF
-#define MOZ_USER_DIR ".mozilla"
+#define MOZ_USER_DIR ".beonex/comm"
 EOF
  
 fi
@@ -14032,9 +14032,11 @@
 elif test "$OS_ARCH" = "BeOS"; then
   cat >> confdefs.h <<\EOF
 #define XP_BEOS 1
+#define MOZ_USER_DIR "beonex/comm"
 EOF
 
   MOZ_MOVEMAIL=1
+
 elif test "$OS_ARCH" = "Darwin"; then
   cat >> confdefs.h <<\EOF
 #define XP_UNIX 1
Index: configure.in
===================================================================
RCS file: /cvsroot/mozilla/configure.in,v
retrieving revision 1.1031.2.12
diff -u -u -w -r1.1031.2.12 configure.in
--- configure.in	1 Jul 2002 17:52:59 -0000	1.1031.2.12
+++ configure.in	24 Aug 2002 17:13:14 -0000
@@ -3225,7 +3225,8 @@
 dnl = Enable compilation of specific extension modules
 dnl ========================================================
 
-MOZ_EXTENSIONS_DEFAULT=" cookie wallet content-packs xml-rpc xmlextras help pref transformiix venkman inspector irc universalchardet"
+MOZ_EXTENSIONS_DEFAULT=" cookie wallet content-packs pref transformiix irc spellcheck"
+dnl MOZ_EXTENSIONS_DEFAULT=" cookie wallet content-packs xml-rpc xmlextras help pref transformiix venkman inspector irc universalchardet"
 
 dnl Check if Thai Rendering Extension needs to be enabled
 if test -n "$SUNCTL"; then
@@ -3770,14 +3771,14 @@
 dnl = Location of the mozilla user directory (default is ~/.mozilla).],
 dnl ========================================================
 MOZ_ARG_WITH_STRING(user-appdir,
-[  --with-user-appdir=DIR  Set user-specific appdir (default=.mozilla)],
+[  --with-user-appdir=DIR  Set user-specific appdir (default=.beonex/comm)],
 [ val=`echo $withval`
 if echo "$val" | grep "\/" >/dev/null; then
     AC_MSG_ERROR("Homedir must be single relative path.")
 else 
     AC_DEFINE_UNQUOTED(MOZ_USER_DIR,"$val")
 fi], 
-    AC_DEFINE(MOZ_USER_DIR,".mozilla") )
+    AC_DEFINE(MOZ_USER_DIR,".beonex/comm") )
 
 dnl Need the contents of config-defs.h in the build logs
 VERBOSE_CONFIG_DEFS=1
@@ -4568,6 +4569,7 @@
   AC_DEFINE(XP_PC)
 elif test "$OS_ARCH" = "BeOS"; then
   AC_DEFINE(XP_BEOS)
+  AC_DEFINE(MOZ_USER_DIR,"beonex/comm")
   MOZ_MOVEMAIL=1
 elif test "$OS_ARCH" = "Darwin"; then
   AC_DEFINE(XP_UNIX)
Index: build/mac/build_scripts/MozillaBuildFlags.txt
===================================================================
RCS file: /cvsroot/mozilla/build/mac/build_scripts/MozillaBuildFlags.txt,v
retrieving revision 1.54.2.3
diff -u -u -w -r1.54.2.3 MozillaBuildFlags.txt
--- build/mac/build_scripts/MozillaBuildFlags.txt	17 Apr 2002 14:11:36 -0000	1.54.2.3
+++ build/mac/build_scripts/MozillaBuildFlags.txt	24 Aug 2002 17:13:15 -0000
@@ -41,7 +41,7 @@
 chrome_files    0
 use_jars        1
 transformiix    1
-mathml          0      MOZ_MATHML
+mathml          1      MOZ_MATHML
 svg             0      MOZ_SVG
 # svg requires libart, which is an lgpl library. You need to pull it 
 # explicitly.
Index: build/mac/build_scripts/MozillaBuildList.pm
===================================================================
RCS file: /cvsroot/mozilla/build/mac/build_scripts/MozillaBuildList.pm,v
retrieving revision 1.198.2.11
diff -u -u -w -r1.198.2.11 MozillaBuildList.pm
--- build/mac/build_scripts/MozillaBuildList.pm	24 Jul 2002 04:48:17 -0000	1.198.2.11
+++ build/mac/build_scripts/MozillaBuildList.pm	24 Aug 2002 17:13:16 -0000
@@ -684,8 +684,8 @@
 
     BuildEmbeddingPackage();
 
-    # Set the default skin to be classic
-    SetDefaultSkin("classic/1.0"); 
+    # Set the default skin
+    SetDefaultSkin("modern/1.0");
 
     EndBuildModule("resources");
 }
Index: config/config.mak
===================================================================
RCS file: /cvsroot/mozilla/config/config.mak,v
retrieving revision 3.134.2.1
diff -u -u -w -r3.134.2.1 config.mak
--- config/config.mak	10 Apr 2002 02:28:31 -0000	3.134.2.1
+++ config/config.mak	24 Aug 2002 17:13:18 -0000
@@ -376,6 +376,11 @@
 
 CFLAGS=$(CFLAGS) -DUSE_IMG2 -DNS_PRINT_PREVIEW
 
+!ifndef MOZ_USER_DIR
+MOZ_USER_DIR=Mozilla
+!endif
+CFLAGS=$(CFLAGS) -DMOZ_USER_DIR=\"$(MOZ_USER_DIR)\"
+
 !ifdef MOZ_STATIC_COMPONENT_LIBS
 CFLAGS=$(CFLAGS) -DXPCOM_TRANSLATE_NSGM_ENTRY_POINT -DMOZ_STATIC_COMPONENT_LIBS
 !endif
@@ -392,6 +397,7 @@
 PERL = perl.exe
 
 #if MOZILLA_OFFICIAL is set, then define splitsym
+#XXX bug 27316?
 !if defined (MOZILLA_OFFICIAL)
 SPLITSYM = $(MOZ_TOOLS)\bin\splitsym
 !endif
Index: config/rules.mk
===================================================================
RCS file: /cvsroot/mozilla/config/rules.mk,v
retrieving revision 3.347.2.3
diff -u -u -w -r3.347.2.3 rules.mk
--- config/rules.mk	13 Jun 2002 11:00:30 -0000	3.347.2.3
+++ config/rules.mk	24 Aug 2002 17:13:18 -0000
@@ -68,6 +68,10 @@
 topsrcdir		= $(DEPTH)
 endif
 
+CXX=gcc
+LDFLAGS += -Wl,-Bstatic -Wl,-lstdc++ -Wl,-Bdynamic
+
+
 ifndef MOZILLA_DIR
 MOZILLA_DIR = $(topsrcdir)
 endif
Index: content/base/public/MANIFEST
===================================================================
RCS file: /cvsroot/mozilla/content/base/public/MANIFEST,v
retrieving revision 1.12.2.1
diff -u -u -w -r1.12.2.1 MANIFEST
--- content/base/public/MANIFEST	10 Apr 2002 02:28:50 -0000	1.12.2.1
+++ content/base/public/MANIFEST	24 Aug 2002 17:13:18 -0000
@@ -27,3 +27,4 @@
 nsIStyleSheetLinkingElement.h
 nsITextContent.h
 nsIContentList.h
+mozISanitizingSerializer.h
Index: content/base/public/Makefile.in
===================================================================
RCS file: /cvsroot/mozilla/content/base/public/Makefile.in,v
retrieving revision 1.18.2.1
diff -u -u -w -r1.18.2.1 Makefile.in
--- content/base/public/Makefile.in	10 Apr 2002 02:28:51 -0000	1.18.2.1
+++ content/base/public/Makefile.in	24 Aug 2002 17:13:18 -0000
@@ -55,6 +55,7 @@
 nsIPrivateDOMImplementation.h \
 nsIContentSerializer.h \
 nsIHTMLToTextSink.h \
+mozISanitizingSerializer.h \
 nsIContentList.h \
 $(NULL)
 
Index: content/base/public/makefile.win
===================================================================
RCS file: /cvsroot/mozilla/content/base/public/Attic/makefile.win,v
retrieving revision 1.17.2.1
diff -u -u -w -r1.17.2.1 makefile.win
--- content/base/public/makefile.win	10 Apr 2002 02:28:51 -0000	1.17.2.1
+++ content/base/public/makefile.win	24 Aug 2002 17:13:18 -0000
@@ -47,6 +47,7 @@
 	nsIPrivateDOMImplementation.h	\
 	nsIContentSerializer.h		\
 	nsIHTMLToTextSink.h		\
+	mozISanitizingSerializer.h	\
 	nsIContentList.h		\
 	$(NULL)
 
Index: content/base/public/nsIHTMLToTextSink.h
===================================================================
RCS file: /cvsroot/mozilla/content/base/public/nsIHTMLToTextSink.h,v
retrieving revision 1.4.2.1
diff -u -u -w -r1.4.2.1 nsIHTMLToTextSink.h
--- content/base/public/nsIHTMLToTextSink.h	10 Apr 2002 02:28:52 -0000	1.4.2.1
+++ content/base/public/nsIHTMLToTextSink.h	24 Aug 2002 17:13:18 -0000
@@ -59,6 +59,7 @@
 
   NS_IMETHOD Initialize(nsAString* aOutString,
                         PRUint32 aFlags, PRUint32 aWrapCol) = 0;
+     // This function violates string ownership rules, see impl.
 };
 
 #endif
Index: content/base/src/Makefile.in
===================================================================
RCS file: /cvsroot/mozilla/content/base/src/Makefile.in,v
retrieving revision 1.35.2.4
diff -u -u -w -r1.35.2.4 Makefile.in
--- content/base/src/Makefile.in	26 Jun 2002 08:07:54 -0000	1.35.2.4
+++ content/base/src/Makefile.in	24 Aug 2002 17:13:18 -0000
@@ -92,6 +92,7 @@
 		nsHTMLContentSerializer.cpp \
 		nsParserUtils.cpp \
 		nsPlainTextSerializer.cpp \
+		mozSanitizingSerializer.cpp \
 		nsScriptLoader.cpp \
 		nsStyleLinkElement.cpp \
 		nsContentAreaDragDrop.cpp \
Index: content/base/src/makefile.win
===================================================================
RCS file: /cvsroot/mozilla/content/base/src/Attic/makefile.win,v
retrieving revision 1.30.2.4
diff -u -u -w -r1.30.2.4 makefile.win
--- content/base/src/makefile.win	26 Jun 2002 08:08:44 -0000	1.30.2.4
+++ content/base/src/makefile.win	24 Aug 2002 17:13:18 -0000
@@ -91,6 +91,7 @@
 	.\$(OBJDIR)\nsHTMLContentSerializer.obj	\
 	.\$(OBJDIR)\nsParserUtils.obj           \
 	.\$(OBJDIR)\nsPlainTextSerializer.obj   \
+	.\$(OBJDIR)\mozSanitizingSerializer.obj   \
 	.\$(OBJDIR)\nsContentUtils.obj   \
 	.\$(OBJDIR)\nsScriptLoader.obj   \
 	.\$(OBJDIR)\nsStyleLinkElement.obj   \
Index: content/build/nsContentCID.h
===================================================================
RCS file: /cvsroot/mozilla/content/build/nsContentCID.h,v
retrieving revision 1.10.2.1
diff -u -u -w -r1.10.2.1 nsContentCID.h
--- content/build/nsContentCID.h	10 Apr 2002 02:29:09 -0000	1.10.2.1
+++ content/build/nsContentCID.h	24 Aug 2002 17:13:20 -0000
@@ -220,6 +220,10 @@
 #define NS_HTMLCONTENTSERIALIZER_CID \
 { 0x9d3f70da, 0x86e9, 0x11d4, { 0x95, 0xec, 0x00, 0xb0, 0xd0, 0x3e, 0x37, 0xb7 } }
 
+// {feca3c34-205e-4ae5-bd1c-03c686ff012b}
+#define MOZ_SANITIZINGHTMLSERIALIZER_CID \
+{ 0xfeca3c34, 0x205e, 0x4ae5, { 0xbd, 0x1c, 0x03, 0xc6, 0x86, 0xff, 0x01, 0x2b  } }
+
 // {6030f7ef-32ed-46a7-9a63-6a5d3f90445f}
 #define NS_PLAINTEXTSERIALIZER_CID \
 { 0x6030f7ef, 0x32ed, 0x46a7, { 0x9a, 0x63, 0x6a, 0x5d, 0x3f, 0x90, 0x44, 0x5f } }
Index: content/build/nsContentModule.cpp
===================================================================
RCS file: /cvsroot/mozilla/content/build/nsContentModule.cpp,v
retrieving revision 1.45.2.1
diff -u -u -w -r1.45.2.1 nsContentModule.cpp
--- content/build/nsContentModule.cpp	10 Apr 2002 02:29:09 -0000	1.45.2.1
+++ content/build/nsContentModule.cpp	24 Aug 2002 17:13:20 -0000
@@ -99,6 +99,7 @@
 #include "nsIXBLService.h"
 #include "nsLayoutAtoms.h"
 #include "nsPlainTextSerializer.h"
+#include "mozSanitizingSerializer.h"
 #include "nsRange.h"
 #include "nsXMLContentSerializer.h"
 #include "nsRuleNode.h"
@@ -343,6 +344,7 @@
 MAKE_CTOR(CreateXMLContentSerializer,     nsIContentSerializer,        NS_NewXMLContentSerializer)
 MAKE_CTOR(CreateHTMLContentSerializer,    nsIContentSerializer,        NS_NewHTMLContentSerializer)
 MAKE_CTOR(CreatePlainTextSerializer,      nsIContentSerializer,        NS_NewPlainTextSerializer)
+MAKE_CTOR(CreateSanitizingHTMLSerializer, nsIContentSerializer,        NS_NewSanitizingHTMLSerializer)
 MAKE_CTOR(CreateXBLService,               nsIXBLService,               NS_NewXBLService)
 MAKE_CTOR(CreateBindingManager,           nsIBindingManager,           NS_NewBindingManager)
 MAKE_CTOR(CreateContentPolicy,            nsIContentPolicy,            NS_NewContentPolicy)
@@ -719,6 +721,11 @@
     NS_PLAINTEXTSERIALIZER_CID,
     NS_PLAINTEXTSINK_CONTRACTID,
     CreatePlainTextSerializer },
+
+  { "HTML sanitizing content serializer",
+    MOZ_SANITIZINGHTMLSERIALIZER_CID,
+    MOZ_SANITIZINGHTMLSERIALIZER_CONTRACTID,
+    CreateSanitizingHTMLSerializer },
 
   { "XBL Service",
     NS_XBLSERVICE_CID,
Index: content/macbuild/content.xml
===================================================================
RCS file: /cvsroot/mozilla/content/macbuild/content.xml,v
retrieving revision 1.22.2.2
diff -u -u -w -r1.22.2.2 content.xml
--- content/macbuild/content.xml	7 Jun 2002 01:46:43 -0000	1.22.2.2
+++ content/macbuild/content.xml	24 Aug 2002 17:13:22 -0000
@@ -2424,6 +2424,13 @@
                 </FILE>
                 <FILE>
                     <PATHTYPE>Name</PATHTYPE>
+                    <PATH>mozSanitizingSerializer.cpp</PATH>
+                    <PATHFORMAT>MacOS</PATHFORMAT>
+                    <FILEKIND>Text</FILEKIND>
+                    <FILEFLAGS>Debug</FILEFLAGS>
+                </FILE>
+                <FILE>
+                    <PATHTYPE>Name</PATHTYPE>
                     <PATH>nsDOMCSSRGBColor.cpp</PATH>
                     <PATHFORMAT>MacOS</PATHFORMAT>
                     <FILEKIND>Text</FILEKIND>
@@ -3513,6 +3520,11 @@
                 </FILEREF>
                 <FILEREF>
                     <PATHTYPE>Name</PATHTYPE>
+                    <PATH>mozSanitizingSerializer.cpp</PATH>
+                    <PATHFORMAT>MacOS</PATHFORMAT>
+                </FILEREF>
+                <FILEREF>
+                    <PATHTYPE>Name</PATHTYPE>
                     <PATH>nsDOMCSSRGBColor.cpp</PATH>
                     <PATHFORMAT>MacOS</PATHFORMAT>
                 </FILEREF>
@@ -5889,6 +5901,13 @@
                 </FILE>
                 <FILE>
                     <PATHTYPE>Name</PATHTYPE>
+                    <PATH>mozSanitizingSerializer.cpp</PATH>
+                    <PATHFORMAT>MacOS</PATHFORMAT>
+                    <FILEKIND>Text</FILEKIND>
+                    <FILEFLAGS>Debug</FILEFLAGS>
+                </FILE>
+                <FILE>
+                    <PATHTYPE>Name</PATHTYPE>
                     <PATH>nsDOMCSSRGBColor.cpp</PATH>
                     <PATHFORMAT>MacOS</PATHFORMAT>
                     <FILEKIND>Text</FILEKIND>
@@ -6978,6 +6997,11 @@
                 </FILEREF>
                 <FILEREF>
                     <PATHTYPE>Name</PATHTYPE>
+                    <PATH>mozSanitizingSerializer.cpp</PATH>
+                    <PATHFORMAT>MacOS</PATHFORMAT>
+                </FILEREF>
+                <FILEREF>
+                    <PATHTYPE>Name</PATHTYPE>
                     <PATH>nsDOMCSSRGBColor.cpp</PATH>
                     <PATHFORMAT>MacOS</PATHFORMAT>
                 </FILEREF>
@@ -7200,6 +7224,12 @@
                 <TARGETNAME>content.shlb</TARGETNAME>
                 <PATHTYPE>Name</PATHTYPE>
                 <PATH>nsContentAreaDragDrop.cpp</PATH>
+                <PATHFORMAT>MacOS</PATHFORMAT>
+            </FILEREF>
+            <FILEREF>
+                <TARGETNAME>content.shlb</TARGETNAME>
+                <PATHTYPE>Name</PATHTYPE>
+                <PATH>mozSanitizingSerializer.cpp</PATH>
                 <PATHFORMAT>MacOS</PATHFORMAT>
             </FILEREF>
         </GROUP>
Index: docshell/base/nsDocShell.cpp
===================================================================
RCS file: /cvsroot/mozilla/docshell/base/nsDocShell.cpp,v
retrieving revision 1.442.2.12
diff -u -u -w -r1.442.2.12 nsDocShell.cpp
--- docshell/base/nsDocShell.cpp	21 Aug 2002 04:25:19 -0000	1.442.2.12
+++ docshell/base/nsDocShell.cpp	24 Aug 2002 17:13:26 -0000
@@ -5986,7 +5986,18 @@
     NS_ENSURE_STATE(mGlobalHistory);
 
     nsCAutoString spec;
+    nsCAutoString pw;
+    nsCAutoString blankpw("");
+    nsresult rv = aURI->GetPassword(pw);
+    if (pw.Length()) {
+       aURI->SetPassword(blankpw);
+    }
+
     NS_ENSURE_SUCCESS(aURI->GetSpec(spec), NS_ERROR_FAILURE);
+    if (pw.Length()) {
+       aURI->SetPassword(pw);
+    }
+
 
     NS_ENSURE_SUCCESS(mGlobalHistory->AddPage(spec.get()), NS_ERROR_FAILURE);
 
Index: editor/ui/composer/content/TextEditorAppShell.xul
===================================================================
RCS file: /cvsroot/mozilla/editor/ui/composer/content/TextEditorAppShell.xul,v
retrieving revision 1.74.2.2
diff -u -u -w -r1.74.2.2 TextEditorAppShell.xul
--- editor/ui/composer/content/TextEditorAppShell.xul	15 May 2002 00:37:53 -0000	1.74.2.2
+++ editor/ui/composer/content/TextEditorAppShell.xul	24 Aug 2002 17:13:28 -0000
@@ -56,7 +56,7 @@
 
   <script type="application/x-javascript" src="chrome://editor/content/editor.js"/>
   <script type="application/x-javascript" src="chrome://editor/content/ComposerCommands.js"/>
-  <script type="application/x-javascript" src="chrome://editor/content/EditorCommandsDebug.js"/>
+<!--  <script type="application/x-javascript" src="chrome://editor/content/EditorCommandsDebug.js"/>-->
   <script type="application/x-javascript" src="chrome://global/content/nsTransferable.js"/>
   <script type="application/x-javascript" src="chrome://global/content/nsDragAndDrop.js"/>
   <script type="application/x-javascript" src="chrome://communicator/content/contentAreaDD.js"/>
@@ -113,9 +113,9 @@
       <!-- tasks menu filled from tasksOverlay -->
       <menu accesskey="t" id="tasksMenu"/>
 
-      <!-- DEBUG only -->
-      <!-- <menu id="debugMenu" /> -->
-      <!-- end DEBUG only -->
+      <!-- DEBUG only
+      <menu id="debugMenu" />
+      end DEBUG only -->
 
       <!-- help menu filled from globalOverlay -->
       <menu accesskey="h" id="menu_Help"/>
Index: editor/ui/composer/content/editor.xul
===================================================================
RCS file: /cvsroot/mozilla/editor/ui/composer/content/editor.xul,v
retrieving revision 1.132.2.5
diff -u -u -w -r1.132.2.5 editor.xul
--- editor/ui/composer/content/editor.xul	7 Jun 2002 05:24:00 -0000	1.132.2.5
+++ editor/ui/composer/content/editor.xul	24 Aug 2002 17:13:28 -0000
@@ -64,7 +64,9 @@
         persist="screenX screenY width height sizemode">
 
   <script type="application/x-javascript" src="chrome://editor/content/editor.js"/>
+<!--
   <script type="application/x-javascript" src="chrome://editor/content/EditorCommandsDebug.js"/>
+-->
   <script type="application/x-javascript" src="chrome://editor/content/EditorContextMenu.js"/>
   <script type="application/x-javascript" src="chrome://editor/content/editorApplicationOverlay.js"/>
   <script type="application/x-javascript" src="chrome://editor/content/publishprefs.js"/>
@@ -153,11 +155,9 @@
 
     <menu id="windowMenu"/>
 
-    <!-- DEBUG only -->
-<!-- Removing debug menu
+    <!-- DEBUG only
     <menu id="debugMenu" /> 
-  -->
-    <!-- end DEBUG only -->
+    end DEBUG only -->
   
     <!-- help menu filled from globalOverlay -->
     <menu id="menu_Help"/>
Index: editor/ui/composer/content/editorOverlay.xul
===================================================================
RCS file: /cvsroot/mozilla/editor/ui/composer/content/editorOverlay.xul,v
retrieving revision 1.203.2.7
diff -u -u -w -r1.203.2.7 editorOverlay.xul
--- editor/ui/composer/content/editorOverlay.xul	19 Jun 2002 21:48:44 -0000	1.203.2.7
+++ editor/ui/composer/content/editorOverlay.xul	24 Aug 2002 17:13:28 -0000
@@ -186,7 +186,7 @@
     <command id="cmd_italic"        state="false"     oncommand="goDoCommand('cmd_italic')"/>
     <command id="cmd_underline"     state="false"     oncommand="goDoCommand('cmd_underline')"/>
     <command id="cmd_tt"            state="false"     oncommand="goDoCommand('cmd_tt')"/>
-    <command id="cmd_smiley"        state=""  />
+<!--    <command id="cmd_smiley"        state=""  />-->
 
     <command id="cmd_strikethrough" state="false"     oncommand="goDoCommand('cmd_strikethrough')"/>
     <command id="cmd_superscript"   state="false"     oncommand="goDoCommand('cmd_superscript')"/>
@@ -611,6 +611,7 @@
 
 
   <!-- smiley menu -->
+<!--
   <toolbarbutton type="menu" id="smileButtonMenu"
                  observes="cmd_smiley"
                  tooltiptext="&SmileButton.tooltip;">
@@ -631,6 +632,7 @@
 						oncommand="doStatefulCommand('cmd_smiley', ':-\\' )" />           
        </menupopup>
    </toolbarbutton>
+-->
 
   <!-- this is only used in messengercompose.xul -->
   <toolbarbutton type="menu" id="AlignPopupButton" observes="cmd_align"
@@ -847,8 +849,7 @@
    -->
   <menuitem id="menu_pasteQuote" accesskey="&editpastequotation.accesskey;" observes="cmd_pasteQuote"/>
 
-  <!-- DEBUG only -->
-<!--
+  <!-- DEBUG only
   <menu id="debugMenu" label="&debugMenu.label;">
   <menupopup>
     <menuitem label="&newEditorTestPage.label;" oncommand="window.openDialog('chrome://editor/content','_blank','chrome,all,dialog=no','chrome://editor/content/EditorInitPage.html')"/>
@@ -915,7 +916,6 @@
             oncommand="window.focus()"/>
   </menupopup>
   </menu>
--->
-  <!-- end DEBUG only -->
+  end DEBUG only -->
 
 </overlay>
Index: editor/ui/composer/locale/en-US/region.properties
===================================================================
RCS file: /cvsroot/mozilla/editor/ui/composer/locale/en-US/region.properties,v
retrieving revision 1.1.116.1
diff -u -u -w -r1.1.116.1 region.properties
--- editor/ui/composer/locale/en-US/region.properties	10 Apr 2002 02:35:37 -0000	1.1.116.1
+++ editor/ui/composer/locale/en-US/region.properties	24 Aug 2002 17:13:28 -0000
@@ -1,4 +1,4 @@
 #
 # editor.js
 # editor.properties
-editor.throbber.url=http://www.mozilla.org/
+editor.throbber.url=about:welcome
Index: extensions/makefile.win
===================================================================
RCS file: /cvsroot/mozilla/extensions/Attic/makefile.win,v
retrieving revision 1.22.2.1
diff -u -u -w -r1.22.2.1 makefile.win
--- extensions/makefile.win	10 Apr 2002 02:38:54 -0000	1.22.2.1
+++ extensions/makefile.win	24 Aug 2002 17:13:29 -0000
@@ -24,13 +24,13 @@
 
 DIRS = wallet \
 	cookie \
-	inspector \
+#	inspector \
 	irc \
 !if !defined(DISABLE_JSD) && !defined(DISABLE_VENKMAN)
     venkman \
 !endif
 	content-packs \
-	help \
+#	help \
 !if defined(MOZ_ENABLE_P3P)
   p3p \
 !endif
@@ -39,11 +39,12 @@
 	transformiix \
 !endif 
 	universalchardet \
-	xml-rpc \
+#	xml-rpc \
 !if defined(MOZ_ENABLE_IIX)
     interfaceinfo \
 !endif
-	xmlextras \
+#	xmlextras \
+	spellcheck \
 	$(NULL)
 
 
Index: extensions/cookie/resources/content/pref-images.xul
===================================================================
RCS file: /cvsroot/mozilla/extensions/cookie/resources/content/pref-images.xul,v
retrieving revision 1.20.10.3
diff -u -u -w -r1.20.10.3 pref-images.xul
--- extensions/cookie/resources/content/pref-images.xul	8 Aug 2002 20:46:31 -0000	1.20.10.3
+++ extensions/cookie/resources/content/pref-images.xul	24 Aug 2002 17:13:29 -0000
@@ -120,13 +120,12 @@
     </radiogroup>
 
     <separator id="networkImagesBehaviorSeparator" observes="haveImageBlockingOrMailnews"/>
-<!--
-    <vbox align="start">
+    <hbox align="start" hidden="true">
       <checkbox id="networkImageWarnAboutImages" label="&warnAboutImages.label;"
                 accesskey="&warnAboutImages.accesskey;" observes="haveImageBlocking"
                 prefstring="network.image.warnAboutImages"/>
-    </vbox>
--->
+    </hbox>
+
     <separator observes="haveImageBlocking"/>
 
     <hbox pack="end">
Index: extensions/irc/xul/content/chatzillaOverlay.xul
===================================================================
RCS file: /cvsroot/mozilla/extensions/irc/xul/content/chatzillaOverlay.xul,v
retrieving revision 1.14.2.2
diff -u -u -w -r1.14.2.2 chatzillaOverlay.xul
--- extensions/irc/xul/content/chatzillaOverlay.xul	1 May 2002 23:06:12 -0000	1.14.2.2
+++ extensions/irc/xul/content/chatzillaOverlay.xul	24 Aug 2002 17:13:31 -0000
@@ -2,7 +2,7 @@
 
 <!DOCTYPE window SYSTEM "chrome://chatzilla/locale/chatzillaOverlay.dtd" >
 
-<!-- This is the overlay that addes "Chatzilla" to the (global) task menu. -->
+<!-- This is the overlay that adds "Chatzilla" to the (global) task menu. -->
 
 <?xml-stylesheet href="chrome://chatzilla/skin/chatzillaOverlay.css" type="text/css"?> 
 
Index: extensions/irc/xul/content/static.js
===================================================================
RCS file: /cvsroot/mozilla/extensions/irc/xul/content/static.js,v
retrieving revision 1.51.2.3
diff -u -u -w -r1.51.2.3 static.js
--- extensions/irc/xul/content/static.js	15 May 2002 23:34:38 -0000	1.51.2.3
+++ extensions/irc/xul/content/static.js	24 Aug 2002 17:13:32 -0000
@@ -209,13 +209,8 @@
     if (client.CHARSET)
         setCharset(client.CHARSET);
     
-    var ary = navigator.userAgent.match (/;\s*([^;\s]+\s*)\).*\/(\d+)/);
-    if (ary)
-        client.userAgent = "ChatZilla " + client.version + " [Mozilla " + 
-            ary[1] + "/" + ary[2] + "]";
-    else
-        client.userAgent = "ChatZilla " + client.version + " [" + 
-            navigator.userAgent + "]";
+    client.userAgent = "ChatZilla " + client.version +
+                       " in Beonex Communicator";
 
     obj = document.getElementById("input");
     obj.addEventListener("keypress", onInputKeyPress, false);
Index: extensions/irc/xul/locale/en-US/chatzillaOverlay.dtd
===================================================================
RCS file: /cvsroot/mozilla/extensions/irc/xul/locale/en-US/chatzillaOverlay.dtd,v
retrieving revision 1.3.74.1
diff -u -u -w -r1.3.74.1 chatzillaOverlay.dtd
--- extensions/irc/xul/locale/en-US/chatzillaOverlay.dtd	10 Apr 2002 02:41:02 -0000	1.3.74.1
+++ extensions/irc/xul/locale/en-US/chatzillaOverlay.dtd	24 Aug 2002 17:13:32 -0000
@@ -1,3 +1,3 @@
-<!ENTITY ircCmd.label		"IRC Chat">  
+<!ENTITY ircCmd.label		"ChatZilla">
 <!ENTITY ircCmd.accesskey	"i">  
 <!ENTITY ircCmd.commandkey	"3">  
Index: layout/html/document/src/html.css
===================================================================
RCS file: /cvsroot/mozilla/layout/html/document/src/html.css,v
retrieving revision 3.149.4.7
diff -u -u -w -r3.149.4.7 html.css
--- layout/html/document/src/html.css	24 Jul 2002 04:48:22 -0000	3.149.4.7
+++ layout/html/document/src/html.css	24 Aug 2002 17:13:40 -0000
@@ -311,7 +311,7 @@
 }
 
 blink {
-  text-decoration: blink;
+  font-weight: bolder;
 }
 
 big {
@@ -557,15 +557,8 @@
   }
 }
 
-/* emulation of non-standard HTML <marquee> tag */
+/* marquee is a Microsoft extension to HTML. Set it to display: block for
+   graceful degradation */
 marquee {
-  -moz-binding: url('chrome://xbl-marquee/content/xbl-marquee.xml#marquee-horizontal');
-}
-
-marquee[direction="up"], marquee[direction="down"] {
-  -moz-binding: url('chrome://xbl-marquee/content/xbl-marquee.xml#marquee-vertical');
-}
-
-@media print {
-  marquee { -moz-binding: none; }
+  display: block;
 }
Index: mailnews/base/prefs/resources/content/mailPrefsOverlay.xul
===================================================================
RCS file: /cvsroot/mozilla/mailnews/base/prefs/resources/content/mailPrefsOverlay.xul,v
retrieving revision 1.14.2.6
diff -u -u -w -r1.14.2.6 mailPrefsOverlay.xul
--- mailnews/base/prefs/resources/content/mailPrefsOverlay.xul	16 Jun 2002 19:44:32 -0000	1.14.2.6
+++ mailnews/base/prefs/resources/content/mailPrefsOverlay.xul	24 Aug 2002 17:13:43 -0000
@@ -34,7 +34,11 @@
 
   <!-- javascript toggle for mail/news -->
   <groupbox id="javascriptPreferences">
-    <checkbox id="javascriptAllowMailNews"
+    <hbox align="start" class="indent"
+          insertafter="javascriptAllowNavigator">
+      <description>&noJSInMailnews.label;</description>
+    </hbox>
+    <checkbox id="javascriptAllowMailNews" hidden="true"
               label="&enbJsCheckMailNews.label;" accesskey="&enbJsCheckMailNews.accesskey;"
               pref="true" preftype="bool" prefstring="javascript.allow.mailnews"
               prefattribute="checked" oncommand="javascriptEnabledChange();" insertafter="javascriptAllowNavigator"/>
@@ -56,7 +60,11 @@
   </groupbox>
   <!--- cookie toggle for mail/news -->
   <page id="cookiesPanel">
-    <checkbox id="networkDisableCookieForMailNews"
+    <hbox align="start" class="indent"
+          insertafter="networkCookieBehaviorSeparator">
+      <description>&noCookiesInMailnews.label;</description>
+    </hbox>
+    <checkbox id="networkDisableCookieForMailNews" hidden="true"
               label="&disableCookieForMailNews.label;" accesskey="&disableCookieForMailNews.accesskey;"
               preftype="bool" prefstring="network.cookie.disableCookieForMailNews"
               insertafter="networkCookieBehaviorSeparator"/>
Index: mailnews/base/prefs/resources/content/pref-advanced_overlay.xul
===================================================================
RCS file: /cvsroot/mozilla/mailnews/base/prefs/resources/content/pref-advanced_overlay.xul,v
retrieving revision 1.5.28.1
diff -u -u -w -r1.5.28.1 pref-advanced_overlay.xul
--- mailnews/base/prefs/resources/content/pref-advanced_overlay.xul	10 Apr 2002 03:03:09 -0000	1.5.28.1
+++ mailnews/base/prefs/resources/content/pref-advanced_overlay.xul	24 Aug 2002 17:13:43 -0000
@@ -17,7 +17,7 @@
   <vbox id="contentEnablingBox">
     <checkbox id="javascriptAllowMailNews" position="3"
               label="&enbJsCheckMailNews.label;" accesskey="&enbJsCheckMailNews.accesskey;"
-              prefstring="javascript.allow.mailnews"/>
+              prefstring="javascript.allow.mailnews" hidden="true" />
   </vbox>
     
          
Index: mailnews/base/prefs/resources/locale/en-US/mailPrefsOverlay.dtd
===================================================================
RCS file: /cvsroot/mozilla/mailnews/base/prefs/resources/locale/en-US/mailPrefsOverlay.dtd,v
retrieving revision 1.10.2.4
diff -u -u -w -r1.10.2.4 mailPrefsOverlay.dtd
--- mailnews/base/prefs/resources/locale/en-US/mailPrefsOverlay.dtd	7 Jun 2002 13:41:06 -0000	1.10.2.4
+++ mailnews/base/prefs/resources/locale/en-US/mailPrefsOverlay.dtd	24 Aug 2002 17:13:43 -0000
@@ -1,16 +1,14 @@
-
-<!ENTITY enbJsCheckMailNews.label     "Mail &amp; Newsgroups">
+<!ENTITY enbJsCheckMailNews.label     "Mailnews">
 <!ENTITY enbJsCheckMailNews.accesskey "m">
-<!ENTITY enbPluginCheckMailNews.label     "Mail &amp; Newsgroups">
-<!ENTITY enbPluginCheckMailNews.accesskey "p">
-
-<!ENTITY disableCookieForMailNews.label "Disable cookies in Mail &amp; Newsgroups">
+<!ENTITY noJSInMailnews.label "Mailnews (always disabled)">
+<!ENTITY noCookiesInMailnews.label "Cookies are always disabled in Mailnews">
+<!ENTITY disableCookieForMailNews.label "Disable cookies in Mailnews">
 <!ENTITY disableCookieForMailNews.accesskey "m">
-
-<!ENTITY disableImageInMailNews.label       "Do not load remote images in Mail &amp; Newsgroup messages">
+<!ENTITY enbPluginCheckMailNews.label     "Mailnews">
+<!ENTITY enbPluginCheckMailNews.accesskey "p">
+<!ENTITY disableImageInMailNews.label       "Do not load remote images in email and newsgroup messages">
 <!ENTITY disableImageInMailNews.accesskey   "i">
-
-<!ENTITY mail.label "Mail &amp; Newsgroups">
+<!ENTITY mail.label "Mailnews">
 <!ENTITY mail.accesskey "m">
 <!ENTITY address.label "Addressing">
 <!ENTITY viewingMessages.label "Message Display">
Index: mailnews/base/prefs/resources/locale/en-US/pref-viewing_messages.dtd
===================================================================
RCS file: /cvsroot/mozilla/mailnews/base/prefs/resources/locale/en-US/pref-viewing_messages.dtd,v
retrieving revision 1.14.34.1
diff -u -u -w -r1.14.34.1 pref-viewing_messages.dtd
--- mailnews/base/prefs/resources/locale/en-US/pref-viewing_messages.dtd	10 Apr 2002 03:03:15 -0000	1.14.34.1
+++ mailnews/base/prefs/resources/locale/en-US/pref-viewing_messages.dtd	24 Aug 2002 17:13:43 -0000
@@ -34,12 +34,12 @@
 <!ENTITY color.label                      "Color:">
 <!ENTITY color.accesskey                  "c">
 <!ENTITY displayWidth.label               "Plain Text Messages">
-<!ENTITY plainText.label				  "Use this font when displaying plain text messages:">
-<!ENTITY displayText.label				  "Use the following settings when  displaying quoted plain text messages:">
-<!ENTITY viewingPlainText.label			  "When viewing plain text messages:">
+<!ENTITY plainText.label                  "">
+<!ENTITY displayText.label                "Quotes">
+<!ENTITY viewingPlainText.label           "">
 <!ENTITY languagesTitle.label			  "Languages">
-<!ENTITY coding.label					  "Use the following character coding as the default for viewing messages:">
-<!ENTITY sendDefaultCharset.label         "Character Coding:">
+<!ENTITY coding.label                     "">
+<!ENTITY sendDefaultCharset.label         "Default Character Coding:">
 <!ENTITY sendDefaultCharset.accesskey	  "h">
 <!ENTITY forceCharsetOverride.label       "Apply default to all messages (ignore character coding specified by MIME header)">
 <!ENTITY forceCharsetOverride.accesskey   "p">
Index: mailnews/base/resources/content/mailWindowOverlay.js
===================================================================
RCS file: /cvsroot/mozilla/mailnews/base/resources/content/mailWindowOverlay.js,v
retrieving revision 1.118.2.5
diff -u -u -w -r1.118.2.5 mailWindowOverlay.js
--- mailnews/base/resources/content/mailWindowOverlay.js	21 Jun 2002 21:31:47 -0000	1.118.2.5
+++ mailnews/base/resources/content/mailWindowOverlay.js	24 Aug 2002 17:13:43 -0000
@@ -49,6 +49,11 @@
   }
 }
 
+var disallow_classes_no_html = 1; /* the user preference,
+     if HTML is not allowed. I assume, that the user could have set this to a
+     value > 1 in his prefs.js or user.js, but that the value will not
+     change during runtime other than through the MsgBody*() functions below.*/
+
 // Disable the new account menu item if the account preference is locked.
 // Two other affected areas are the account central and the account manager
 // dialog.
@@ -297,6 +302,55 @@
     menuitem.setAttribute("checked", "true"); 
 }
 
+function InitViewBodyMenu()
+{
+  var html_as = 0;
+  var prefer_plaintext = false;
+  var disallow_classes = 0;
+  try
+  {
+    prefer_plaintext = pref.getBoolPref("mailnews.display.prefer_plaintext");
+    html_as = pref.getIntPref("mailnews.display.html_as");
+    disallow_classes =
+                    pref.getIntPref("mailnews.display.disallow_mime_handlers");
+    if (disallow_classes > 0)
+      disallow_classes_no_html = disallow_classes;
+    // else disallow_classes_no_html keeps its inital value (see top)
+  }
+  catch (ex)
+  {
+    dump("failed to get the body plaintext vs. HTML prefs\n");
+  }
+
+  var AllowHTML_checked = false;
+  var Sanitized_checked = false;
+  var AsPlaintext_checked = false;
+  if (prefer_plaintext == false && html_as == 0 && disallow_classes == 0)
+    AllowHTML_checked = true;
+  else if (prefer_plaintext == false && html_as == 3 && disallow_classes > 0)
+    Sanitized_checked = true;
+  else if (prefer_plaintext == true && html_as == 1 && disallow_classes > 0)
+    AsPlaintext_checked = true;
+  // else (the user edited prefs/user.js) check none of the radio menu items
+
+  var AllowHTML_menuitem = document.getElementById("bodyAllowHTML");
+  var Sanitized_menuitem = document.getElementById("bodySanitized");
+  var AsPlaintext_menuitem = document.getElementById("bodyAsPlaintext");
+  if (AllowHTML_menuitem
+      && Sanitized_menuitem
+      && AsPlaintext_menuitem)
+  {
+    AllowHTML_menuitem.setAttribute("checked",
+                                    AllowHTML_checked ? "true" : "false");
+    Sanitized_menuitem.setAttribute("checked",
+                                      Sanitized_checked ? "true" : "false");
+    AsPlaintext_menuitem.setAttribute("checked",
+                                      AsPlaintext_checked ? "true" : "false");
+  }
+  else
+    dump("Where is my View|Body menu?\n");
+}
+
 function IsNewsMessage(messageUri)
 {
     if (!messageUri) return false;
@@ -1121,6 +1175,35 @@
 function MsgViewBriefHeaders()
 {
     gPrefs.setIntPref("mail.show_headers",0);
+    MsgReload();
+    return true;
+}
+
+function MsgBodyAllowHTML()
+{
+    gPrefs.setBoolPref("mailnews.display.prefer_plaintext", false);
+    gPrefs.setIntPref("mailnews.display.html_as", 0);
+    gPrefs.setIntPref("mailnews.display.disallow_mime_handlers", 0);
+    MsgReload();
+    return true;
+}
+
+function MsgBodySanitized()
+{
+    gPrefs.setBoolPref("mailnews.display.prefer_plaintext", false);
+    gPrefs.setIntPref("mailnews.display.html_as", 3);
+    gPrefs.setIntPref("mailnews.display.disallow_mime_handlers",
+                      disallow_classes_no_html);
+    MsgReload();
+    return true;
+}
+
+function MsgBodyAsPlaintext()
+{
+    gPrefs.setBoolPref("mailnews.display.prefer_plaintext", true);
+    gPrefs.setIntPref("mailnews.display.html_as", 1);
+    gPrefs.setIntPref("mailnews.display.disallow_mime_handlers",
+                      disallow_classes_no_html);
     MsgReload();
     return true;
 }
Index: mailnews/base/resources/content/mailWindowOverlay.xul
===================================================================
RCS file: /cvsroot/mozilla/mailnews/base/resources/content/mailWindowOverlay.xul,v
retrieving revision 1.199.2.5
diff -u -u -w -r1.199.2.5 mailWindowOverlay.xul
--- mailnews/base/resources/content/mailWindowOverlay.xul	16 Jun 2002 19:45:10 -0000	1.199.2.5
+++ mailnews/base/resources/content/mailWindowOverlay.xul	24 Aug 2002 17:13:43 -0000
@@ -1102,6 +1102,30 @@
            oncommand="MsgViewNormalHeaders();"/>
         </menupopup>
       </menu>
+      <menu id="viewBodyMenu"
+       accesskey="&bodyMenu.accesskey;"
+       label="&bodyMenu.label;">
+        <menupopup onpopupshowing="InitViewBodyMenu()">
+          <menuitem id="bodyAllowHTML"
+           type="radio"
+           name="bodyPlaintextVsHTMLPref"
+           label="&bodyAllowHTML.label;"
+           accesskey="&bodyAllowHTML.accesskey;"
+           oncommand="MsgBodyAllowHTML()"/>
+          <menuitem id="bodySanitized"
+           type="radio"
+           name="bodyPlaintextVsHTMLPref"
+           label="&bodySanitized.label;"
+           accesskey="&bodySanitized.accesskey;"
+           oncommand="MsgBodySanitized()"/>
+          <menuitem id="bodyAsPlaintext"
+           type="radio"
+           name="bodyPlaintextVsHTMLPref"
+           label="&bodyAsPlaintext.label;"
+           accesskey="&bodyAsPlaintext.accesskey;"
+           oncommand="MsgBodyAsPlaintext()"/>
+        </menupopup>
+      </menu>
       <menuseparator/>
       <menuitem id="stopMenuitem" label="&stopCmd.label;" accesskey="&stopCmd.accesskey;" key="key_stop" disabled="true" command="cmd_stop"/>
       <menuitem label="&reloadCmd.label;" accesskey="&reloadCmd.accesskey;" observes="cmd_reload"/>
@@ -1422,6 +1446,7 @@
       <toolbarbutton class="toolbarbutton-1" id="button-replyall" label="&replyAllButton.label;" tooltiptext="&replyAllButton.tooltip;" observes="button_replyall" oncommand="MsgReplyToAllMessage(event)"/>
       <toolbarbutton class="toolbarbutton-1" id="button-forward" label="&forwardButton.label;" tooltiptext="&forwardButton.tooltip;" observes="button_forward" oncommand="MsgForwardMessage(event)"/>
       <toolbarseparator class="toolbarseparator-primary"/>
+<!--
       <toolbarbutton type="menu" id="button-file" class="toolbarbutton-1" 
                   label="&fileButton.label;" observes="button_file"
                   datasources="rdf:null" 
@@ -1460,11 +1485,8 @@
             </menupopup>
           </rule>
           <rule nc:CanFileMessagesOnServer="false">
-            <!-- don't show servers (nntp & any others) which does not allow message filing -->
-            <!-- File, Move & Copy menus -->
           </rule>
           <rule nc:CanFileMessages="false" iscontainer="true" isempty="false">
-          <!-- note, there is no "file here" -->
             <menupopup>
               <menu uri="..."  class="folderMenuItem menu-iconic" label="rdf:http://home.netscape.com/NC-rdf#Name"
                SpecialFolder="rdf:http://home.netscape.com/NC-rdf#SpecialFolder"
@@ -1489,6 +1511,7 @@
         </template>
         <menupopup/>
       </toolbarbutton>
+-->
       <toolbarbutton class="toolbarbutton-1" id="button-next" label="&nextButton.label;" oncommand="goDoCommand('button_next')" tooltiptext="&nextButton.tooltip;" observes="button_next"/>
       <toolbarbutton class="toolbarbutton-1" id="button-delete" label="&deleteButton.label;" tooltiptext="&deleteButton.tooltip;" observes="button_delete" oncommand="goDoCommand('button_delete')"/>
       <toolbarbutton type="menu-button" id="button-mark" class="toolbarbutton-1" label="&markButton.label;" hidden="true" oncommand="goDoCommand('button_mark')"
@@ -1501,7 +1524,7 @@
                 <menuitem type="checkbox" id="markFlaggedToolbarItem" label="&markFlaggedCmd.label;" accesskey="&markFlaggedCmd.accesskey;" observes="cmd_markAsFlagged"/>
             </menupopup>
       </toolbarbutton>
-      <toolbarbutton id="button-print" type="menu-button" class="toolbarbutton-1" label="&printButton.label;" 
+      <toolbarbutton hidden="true" id="button-print" type="menu-button" class="toolbarbutton-1" label="&printButton.label;" 
                   observes="button_print" oncommand="goDoCommand('cmd_print')" tooltiptext="&printButton.tooltip;">  
         <menupopup id="printMenu">
           <menuitem label="&printCmd.label;" accesskey="&printCmd.accesskey;" default="true"/>
Index: mailnews/base/resources/content/msgHdrViewOverlay.js
===================================================================
RCS file: /cvsroot/mozilla/mailnews/base/resources/content/msgHdrViewOverlay.js,v
retrieving revision 1.87.2.2
diff -u -u -w -r1.87.2.2 msgHdrViewOverlay.js
--- mailnews/base/resources/content/msgHdrViewOverlay.js	24 Jun 2002 20:31:13 -0000	1.87.2.2
+++ mailnews/base/resources/content/msgHdrViewOverlay.js	24 Aug 2002 17:13:44 -0000
@@ -89,6 +89,7 @@
 // We also have an expanded header view. This shows many of your more common (and useful) headers.
 var gExpandedHeaderList = [ {name:"subject"}, 
                             {name:"from", outputFunction:OutputEmailAddresses},
+                            {name:"organization"},
                             {name:"reply-to", isEmailAddress:true, outputFunction:OutputEmailAddresses},
                             {name:"date"},
                             {name:"to", useToggle:true, outputFunction:OutputEmailAddresses},
Index: mailnews/base/resources/content/msgHdrViewOverlay.xul
===================================================================
RCS file: /cvsroot/mozilla/mailnews/base/resources/content/msgHdrViewOverlay.xul,v
retrieving revision 1.50.2.1
diff -u -u -w -r1.50.2.1 msgHdrViewOverlay.xul
--- mailnews/base/resources/content/msgHdrViewOverlay.xul	10 Apr 2002 03:03:28 -0000	1.50.2.1
+++ mailnews/base/resources/content/msgHdrViewOverlay.xul	24 Aug 2002 17:13:44 -0000
@@ -97,6 +97,7 @@
     <mail-toggle-headerfield id="expandedsubjectBox" class="subjectvalue" label="&subjectField.label;" ontwistyclick="ToggleHeaderView();" collapsed="true"/>
     
     <mail-emailheaderfield id="expandedfromBox" label="&fromField.label;" collapsed="true"/>
+    <mail-headerfield id="expandedorganizationBox" label="&organizationField.label;" collapsed="true"/>
     <mail-emailheaderfield id="expandedreply-toBox" label="&replyToField.label;" collapsed="true"/>
 
     <mail-headerfield id="expandeddateBox" label="&dateField.label;" collapsed="true"/>
Index: mailnews/base/resources/content/threadPane.js
===================================================================
RCS file: /cvsroot/mozilla/mailnews/base/resources/content/threadPane.js,v
retrieving revision 1.46.2.2
diff -u -u -w -r1.46.2.2 threadPane.js
--- mailnews/base/resources/content/threadPane.js	30 May 2002 20:23:01 -0000	1.46.2.2
+++ mailnews/base/resources/content/threadPane.js	24 Aug 2002 17:13:44 -0000
@@ -79,7 +79,6 @@
 
   displayMessageChanged : function(aFolder, aSubject)
   {
-    setTitleFromFolder(aFolder, aSubject);
     gHaveLoadedMessage = true;
   },
 
Index: mailnews/base/resources/locale/en-US/mailTasksOverlay.dtd
===================================================================
RCS file: /cvsroot/mozilla/mailnews/base/resources/locale/en-US/mailTasksOverlay.dtd,v
retrieving revision 1.12.2.1
diff -u -u -w -r1.12.2.1 mailTasksOverlay.dtd
--- mailnews/base/resources/locale/en-US/mailTasksOverlay.dtd	10 Apr 2002 03:03:37 -0000	1.12.2.1
+++ mailnews/base/resources/locale/en-US/mailTasksOverlay.dtd	24 Aug 2002 17:13:44 -0000
@@ -1,6 +1,6 @@
 
 <!-- LOCALIZATION NOTE (messengerCmd.label): DONT_TRANSLATE -->
-<!ENTITY messengerCmd.label					"Mail &amp; Newsgroups">
+<!ENTITY messengerCmd.label					"Mailnews">
 <!ENTITY messengerCmd.accesskey				"m">
 <!ENTITY messengerCmd.commandkey			"2">
 <!ENTITY addressBookCmd.label				"Address Book">  
Index: mailnews/base/resources/locale/en-US/messenger.dtd
===================================================================
RCS file: /cvsroot/mozilla/mailnews/base/resources/locale/en-US/messenger.dtd,v
retrieving revision 1.141.2.3
diff -u -u -w -r1.141.2.3 messenger.dtd
--- mailnews/base/resources/locale/en-US/messenger.dtd	8 Jun 2002 00:12:05 -0000	1.141.2.3
+++ mailnews/base/resources/locale/en-US/messenger.dtd	24 Aug 2002 17:13:44 -0000
@@ -198,6 +198,14 @@
 <!ENTITY headersNormalCmd.accesskey "N">
 <!ENTITY headersBriefCmd.label ".Brief">
 <!ENTITY headersBriefCmd.accesskey "B">
+<!ENTITY bodyMenu.label "Body">
+<!ENTITY bodyMenu.accesskey "O">
+<!ENTITY bodyAllowHTML.label "Original HTML">
+<!ENTITY bodyAllowHTML.accesskey "H">
+<!ENTITY bodySanitized.label "Simple HTML">
+<!ENTITY bodySanitized.accesskey "S">
+<!ENTITY bodyAsPlaintext.label "As Plain Text">
+<!ENTITY bodyAsPlaintext.accesskey "P">
 <!ENTITY viewAttachmentsInlineCmd.label ".View Attachments Inline">
 <!ENTITY viewAttachmentsInlineCmd.accesskey "A">
 <!ENTITY reloadCmd.label "Reload">
Index: mailnews/base/resources/locale/en-US/msgHdrViewOverlay.dtd
===================================================================
RCS file: /cvsroot/mozilla/mailnews/base/resources/locale/en-US/msgHdrViewOverlay.dtd,v
retrieving revision 1.7.14.1
diff -u -u -w -r1.7.14.1 msgHdrViewOverlay.dtd
--- mailnews/base/resources/locale/en-US/msgHdrViewOverlay.dtd	10 Apr 2002 03:03:38 -0000	1.7.14.1
+++ mailnews/base/resources/locale/en-US/msgHdrViewOverlay.dtd	24 Aug 2002 17:13:44 -0000
@@ -20,6 +20,7 @@
 
 <!ENTITY toField.label "To: ">
 <!ENTITY fromField.label "From: ">
+<!ENTITY organizationField.label "Organization: ">
 <!ENTITY replyToField.label "Reply-To: ">
 
 <!ENTITY subjectField.label "Subject: ">
Index: mailnews/base/resources/locale/en-US/region.properties
===================================================================
RCS file: /cvsroot/mozilla/mailnews/base/resources/locale/en-US/region.properties,v
retrieving revision 1.3.2.1
diff -u -u -w -r1.3.2.1 region.properties
--- mailnews/base/resources/locale/en-US/region.properties	10 Apr 2002 03:03:38 -0000	1.3.2.1
+++ mailnews/base/resources/locale/en-US/region.properties	24 Aug 2002 17:13:44 -0000
@@ -1,10 +1,10 @@
 #
 # messenger.properties
 # mailnews.js
-mailnews.start_page.url=http://www.mozilla.org/mailnews/start.html
-messenger.throbber.url=http://www.mozilla.org/
-compose.throbber.url=http://www.mozilla.org/
-addressbook.throbber.url=http://www.mozilla.org/
+mailnews.start_page.url=about:blank
+messenger.throbber.url=about:welcome
+compose.throbber.url=about:welcome
+addressbook.throbber.url=about:welcome
 # To make mapit buttons to disappear in the addressbook, specify empty string.  For example:
 # mail.addr_book.mapit_url.format=
 # The format for "mail.addr_book.mapit_url.format" is:
@@ -14,4 +14,4 @@
 # @ST == state
 # @ZI == zip code
 # @CO == country
-mail.addr_book.mapit_url.format=http://www.mapquest.com/maps/map.adp?country=@CO&address=@A1%20@A2&city=@CI&state=@ST&zipcode=@ZI
+mail.addr_book.mapit_url.format=http://maps.yahoo.com/py/maps.py?Pyt=Tmap&Country=@CO&addr=@A1%20@A2&csz=@CI,%20@ST%20@ZI
Index: mailnews/compose/resources/content/messengercompose.xul
===================================================================
RCS file: /cvsroot/mozilla/mailnews/compose/resources/content/messengercompose.xul,v
retrieving revision 1.244.2.2
diff -u -u -w -r1.244.2.2 messengercompose.xul
--- mailnews/compose/resources/content/messengercompose.xul	24 Apr 2002 21:32:12 -0000	1.244.2.2
+++ mailnews/compose/resources/content/messengercompose.xul	24 Aug 2002 17:13:44 -0000
@@ -367,7 +367,7 @@
           <menuitem label="&attachVCardCmd.label;" disabled="true" accesskey="&attachVCardCmd.accesskey;" oncommand="AttachVCard()"/-->     
         </menupopup>
       </menu>
-      <!--menu id="debugMenu"/-->
+      <!--<menu id="debugMenu"/>-->
       <menu id="tasksMenu"/>
       <menu id="windowMenu"/>
       <menu id="menu_Help"/>
@@ -466,7 +466,7 @@
       <toolbarseparator class="toolbarseparator-standard"/>
       <toolbarbutton id="AlignPopupButton"/>
       <toolbarbutton id="InsertPopupButton"/>
-      <toolbarbutton id="smileButtonMenu" padwithspace="true"/>
+<!--      <toolbarbutton id="smileButtonMenu" padwithspace="true"/>-->
       <spacer flex="1"/>
     </toolbar>
   </toolbox>
Index: mailnews/extensions/smime/resources/locale/en-US/msgCompSMIMEOverlay.dtd
===================================================================
RCS file: /cvsroot/mozilla/mailnews/extensions/smime/resources/locale/en-US/msgCompSMIMEOverlay.dtd,v
retrieving revision 1.5.2.3
diff -u -u -w -r1.5.2.3 msgCompSMIMEOverlay.dtd
--- mailnews/extensions/smime/resources/locale/en-US/msgCompSMIMEOverlay.dtd	3 Jun 2002 03:17:08 -0000	1.5.2.3
+++ mailnews/extensions/smime/resources/locale/en-US/msgCompSMIMEOverlay.dtd	24 Aug 2002 17:13:44 -0000
@@ -1,7 +1,7 @@
 <!--LOCALIZATION NOTE msgCompSMIMEOverlay.dtd UI for s/mime hooks in message composition -->
 
-<!ENTITY securityMenu.label "Security">
-<!ENTITY securityMenu.accesskey "e">
+<!ENTITY securityMenu.label "Cryptography">
+<!ENTITY securityMenu.accesskey "C">
 
 <!ENTITY menu_securityEncryptIfPossible.label "Encrypt if Possible">
 <!ENTITY menu_securityEncryptIfPossible.accesskey "P">
@@ -18,8 +18,8 @@
 <!ENTITY menu_securityStatus.label "View Security Info">
 <!ENTITY menu_securityStatus.accesskey "I">
 
-<!ENTITY securityButton.label "Security">
-<!ENTITY securityButton.tooltip "View or change security settings">
+<!ENTITY securityButton.label "Crypto">
+<!ENTITY securityButton.tooltip "View or change settings for cryptographic security">
 
 <!ENTITY menu_viewSecurityStatus.label "Message Security Info">
 <!ENTITY menu_viewSecurityStatus.accesskey "I">
Index: mailnews/mime/emitters/src/nsMimeBaseEmitter.cpp
===================================================================
RCS file: /cvsroot/mozilla/mailnews/mime/emitters/src/nsMimeBaseEmitter.cpp,v
retrieving revision 1.71.2.1
diff -u -u -w -r1.71.2.1 nsMimeBaseEmitter.cpp
--- mailnews/mime/emitters/src/nsMimeBaseEmitter.cpp	10 Apr 2002 03:07:30 -0000	1.71.2.1
+++ mailnews/mime/emitters/src/nsMimeBaseEmitter.cpp	24 Aug 2002 17:13:47 -0000
@@ -443,6 +443,10 @@
   nsresult rv = NS_OK;
   PRUint32            needToWrite;
 
+#ifdef DEBUG_BenB
+  // If you want to see libmime output...
+  printf("%s", buf);
+#endif
 
   PR_LOG(gMimeEmitterLogModule, PR_LOG_ALWAYS, (buf));
   //
Index: mailnews/mime/emitters/src/nsMimeHtmlEmitter.cpp
===================================================================
RCS file: /cvsroot/mozilla/mailnews/mime/emitters/src/nsMimeHtmlEmitter.cpp,v
retrieving revision 1.60.20.1
diff -u -u -w -r1.60.20.1 nsMimeHtmlEmitter.cpp
--- mailnews/mime/emitters/src/nsMimeHtmlEmitter.cpp	10 Apr 2002 03:07:30 -0000	1.60.20.1
+++ mailnews/mime/emitters/src/nsMimeHtmlEmitter.cpp	24 Aug 2002 17:13:47 -0000
@@ -218,7 +218,7 @@
               nsCRT::strcasecmp("cc", headerInfo->name) && nsCRT::strcasecmp("newsgroups", headerInfo->name) &&
               nsCRT::strcasecmp("bcc", headerInfo->name) && nsCRT::strcasecmp("followup-to", headerInfo->name) &&
               nsCRT::strcasecmp("reply-to", headerInfo->name) && nsCRT::strcasecmp("subject", headerInfo->name) &&
-              nsCRT::strcasecmp("user-agent", headerInfo->name))
+              nsCRT::strcasecmp("organization", headerInfo->name) && nsCRT::strcasecmp("user-agent", headerInfo->name))
                 continue;
         }
 
Index: mailnews/mime/macbuild/mime.xml
===================================================================
RCS file: /cvsroot/mozilla/mailnews/mime/macbuild/mime.xml,v
retrieving revision 1.2.18.1
diff -u -u -w -r1.2.18.1 mime.xml
--- mailnews/mime/macbuild/mime.xml	10 Apr 2002 03:07:32 -0000	1.2.18.1
+++ mailnews/mime/macbuild/mime.xml	24 Aug 2002 17:13:48 -0000
@@ -1307,6 +1307,20 @@
                     <FILEKIND>Text</FILEKIND>
                     <FILEFLAGS>Debug</FILEFLAGS>
                 </FILE>
+                <FILE>
+                    <PATHTYPE>Name</PATHTYPE>
+                    <PATH>mimethpl.cpp</PATH>
+                    <PATHFORMAT>MacOS</PATHFORMAT>
+                    <FILEKIND>Text</FILEKIND>
+                    <FILEFLAGS>Debug</FILEFLAGS>
+                </FILE>
+                <FILE>
+                    <PATHTYPE>Name</PATHTYPE>
+                    <PATH>mimethsa.cpp</PATH>
+                    <PATHFORMAT>MacOS</PATHFORMAT>
+                    <FILEKIND>Text</FILEKIND>
+                    <FILEFLAGS>Debug</FILEFLAGS>
+                </FILE>
             </FILELIST>
             <LINKORDER>
                 <FILEREF>
@@ -1564,6 +1578,16 @@
                     <PATH>mimecryp.cpp</PATH>
                     <PATHFORMAT>MacOS</PATHFORMAT>
                 </FILEREF>
+                <FILEREF>
+                    <PATHTYPE>Name</PATHTYPE>
+                    <PATH>mimethpl.cpp</PATH>
+                    <PATHFORMAT>MacOS</PATHFORMAT>
+                </FILEREF>
+                <FILEREF>
+                    <PATHTYPE>Name</PATHTYPE>
+                    <PATH>mimethsa.cpp</PATH>
+                    <PATHFORMAT>MacOS</PATHFORMAT>
+                </FILEREF>
             </LINKORDER>
         </TARGET>
         <TARGET>
@@ -2820,6 +2844,20 @@
                     <FILEKIND>Text</FILEKIND>
                     <FILEFLAGS>Debug</FILEFLAGS>
                 </FILE>
+                <FILE>
+                    <PATHTYPE>Name</PATHTYPE>
+                    <PATH>mimethpl.cpp</PATH>
+                    <PATHFORMAT>MacOS</PATHFORMAT>
+                    <FILEKIND>Text</FILEKIND>
+                    <FILEFLAGS>Debug</FILEFLAGS>
+                </FILE>
+                <FILE>
+                    <PATHTYPE>Name</PATHTYPE>
+                    <PATH>mimethsa.cpp</PATH>
+                    <PATHFORMAT>MacOS</PATHFORMAT>
+                    <FILEKIND>Text</FILEKIND>
+                    <FILEFLAGS>Debug</FILEFLAGS>
+                </FILE>
             </FILELIST>
             <LINKORDER>
                 <FILEREF>
@@ -3077,6 +3115,16 @@
                     <PATH>mimecryp.cpp</PATH>
                     <PATHFORMAT>MacOS</PATHFORMAT>
                 </FILEREF>
+                <FILEREF>
+                    <PATHTYPE>Name</PATHTYPE>
+                    <PATH>mimethpl.cpp</PATH>
+                    <PATHFORMAT>MacOS</PATHFORMAT>
+                </FILEREF>
+                <FILEREF>
+                    <PATHTYPE>Name</PATHTYPE>
+                    <PATH>mimethsa.cpp</PATH>
+                    <PATHFORMAT>MacOS</PATHFORMAT>
+                </FILEREF>
             </LINKORDER>
         </TARGET>
     </TARGETLIST>
@@ -3282,6 +3330,18 @@
                 <TARGETNAME>MimeDebug.shlb</TARGETNAME>
                 <PATHTYPE>Name</PATHTYPE>
                 <PATH>mimetext.cpp</PATH>
+                <PATHFORMAT>MacOS</PATHFORMAT>
+            </FILEREF>
+            <FILEREF>
+                <TARGETNAME>MimeDebug.shlb</TARGETNAME>
+                <PATHTYPE>Name</PATHTYPE>
+                <PATH>mimethpl.cpp</PATH>
+                <PATHFORMAT>MacOS</PATHFORMAT>
+            </FILEREF>
+            <FILEREF>
+                <TARGETNAME>MimeDebug.shlb</TARGETNAME>
+                <PATHTYPE>Name</PATHTYPE>
+                <PATH>mimethsa.cpp</PATH>
                 <PATHFORMAT>MacOS</PATHFORMAT>
             </FILEREF>
             <FILEREF>
Index: mailnews/mime/src/Makefile.in
===================================================================
RCS file: /cvsroot/mozilla/mailnews/mime/src/Makefile.in,v
retrieving revision 1.55.2.1
diff -u -u -w -r1.55.2.1 Makefile.in
--- mailnews/mime/src/Makefile.in	10 Apr 2002 03:07:39 -0000	1.55.2.1
+++ mailnews/mime/src/Makefile.in	24 Aug 2002 17:13:48 -0000
@@ -62,7 +62,11 @@
 		  nkcache \
 		  pipnss \
 		  imglib2 \
+		  content \
+		  htmlparser \
+		  layout \
 		  $(NULL)
+#content, htmlparser and layout are for HTML2Plaintext in mimemoz2.cpp.
 
 ifdef BUILD_SMIME
 REQUIRES += \
@@ -96,6 +100,8 @@
 		mimetenr.cpp \
 		mimetext.cpp \
 		mimethtm.cpp \
+		mimethpl.cpp \
+		mimethsa.cpp \
 		mimetpla.cpp \
 		mimetpfl.cpp \
 		mimetric.cpp \
Index: mailnews/mime/src/makefile.win
===================================================================
RCS file: /cvsroot/mozilla/mailnews/mime/src/Attic/makefile.win,v
retrieving revision 1.57.2.1
diff -u -u -w -r1.57.2.1 makefile.win
--- mailnews/mime/src/makefile.win	10 Apr 2002 03:07:39 -0000	1.57.2.1
+++ mailnews/mime/src/makefile.win	24 Aug 2002 17:13:48 -0000
@@ -49,11 +49,15 @@
 		  nkcache \
 		  xpconnect \
 		  pipnss \
+		  content \
+		  htmlparser \
+		  layout \
 !if defined(BUILD_SMIME)
 		  msgsmime	\
 !endif
 		  imglib2 \
 		  $(NULL)
+#content, htmlparser and layout are for HTML2Plaintext in mimemoz2.cpp.
 
 include <$(DEPTH)\config\config.mak>
 
@@ -127,6 +131,8 @@
 		.\$(OBJDIR)\mimetenr.obj			\
 		.\$(OBJDIR)\mimetext.obj			\
 		.\$(OBJDIR)\mimethtm.obj			\
+		.\$(OBJDIR)\mimethpl.obj			\
+		.\$(OBJDIR)\mimethsa.obj			\
 		.\$(OBJDIR)\mimetpla.obj			\
 		.\$(OBJDIR)\mimetpfl.obj			\
 		.\$(OBJDIR)\mimetric.obj			\
Index: mailnews/mime/src/mimei.cpp
===================================================================
RCS file: /cvsroot/mozilla/mailnews/mime/src/mimei.cpp,v
retrieving revision 1.49.2.3
diff -u -u -w -r1.49.2.3 mimei.cpp
--- mailnews/mime/src/mimei.cpp	24 Apr 2002 22:56:42 -0000	1.49.2.3
+++ mailnews/mime/src/mimei.cpp	24 Aug 2002 17:13:49 -0000
@@ -45,22 +45,23 @@
 #ifdef ENABLE_SMIME
 #include "mimecms.h"	/*   |     |     |--- MimeEncryptedPKCS7			*/
 #endif
-
 #include "mimemsg.h"	/*   |     |--- MimeMessage							*/
 #include "mimeunty.h"	/*   |     |--- MimeUntypedText						*/
 #include "mimeleaf.h"	/*   |--- MimeLeaf (abstract)						*/
 #include "mimetext.h"	/*   |     |--- MimeInlineText (abstract)			*/
 #include "mimetpla.h"	/*   |     |     |--- MimeInlineTextPlain			*/
+#include "mimethpl.h"	/*   |     |     |     |--- M.I.TextHTMLAsPlaintext */
 #include "mimetpfl.h" /*   |     |     |--- MimeInlineTextPlainFlowed         */
 #include "mimethtm.h"	/*   |     |     |--- MimeInlineTextHTML			*/
+#include "mimethsa.h"	/*   |     |     |     |--- M.I.TextHTMLSanitized   */
 #include "mimetric.h"	/*   |     |     |--- MimeInlineTextRichtext		*/
 #include "mimetenr.h"	/*   |     |     |     |--- MimeInlineTextEnriched	*/
-/* SUPPORTED VIA PLUGIN    |     |     |--------- MimeInlineTextCalendar  */
-
-#include "nsIPref.h"
+/* SUPPORTED VIA PLUGIN      |     |     |--- MimeInlineTextVCard           */
+/* SUPPORTED VIA PLUGIN      |     |     |--- MimeInlineTextCalendar        */
 #include "mimeiimg.h"	/*   |     |--- MimeInlineImage						*/
 #include "mimeeobj.h"	/*   |     |--- MimeExternalObject					*/
 #include "mimeebod.h"	/*   |--- MimeExternalBody							*/
+                        /* If you add classes here,also add them to mimei.h */
 #include "prlog.h"
 #include "prmem.h"
 #include "prenv.h"
@@ -78,6 +79,7 @@
 #include "nsMimeStringResources.h"
 #include "nsMimeTypes.h"
 #include "nsMsgUtils.h"
+#include "nsIPref.h"
 #include "imgILoader.h"
 
 #define	IMAP_EXTERNAL_CONTENT_HEADER "X-Mozilla-IMAP-Part"
@@ -288,6 +290,75 @@
   PR_Free(object);
 }
 
+
+PRBool mime_is_allowed_class(const MimeObjectClass *clazz,
+                             PRInt32 types_of_classes_to_disallow)
+{
+  if (types_of_classes_to_disallow == 0)
+    return PR_TRUE;
+  PRBool avoid_html = (types_of_classes_to_disallow >= 1);
+  PRBool avoid_images = (types_of_classes_to_disallow >= 2);
+  PRBool avoid_strange_content = (types_of_classes_to_disallow >= 3);
+  PRBool allow_only_vanilla_classes = (types_of_classes_to_disallow == 100);
+
+  if (allow_only_vanilla_classes)
+    /* A "safe" class is one that is unlikely to have security bugs or to
+       allow security exploits or one that is essential for the usefulness
+       of the application, even for paranoid users.
+       What's included here is more personal judgement than following
+       strict rules, though, unfortunately.
+       The function returns true only for known good classes, i.e. is a
+       "whitelist" in this case.
+       This idea comes from Georgi Guninski.
+    */
+    return
+      (
+        clazz == (MimeObjectClass *)&mimeInlineTextPlainClass ||
+        clazz == (MimeObjectClass *)&mimeInlineTextPlainFlowedClass ||
+        clazz == (MimeObjectClass *)&mimeInlineTextHTMLSanitizedClass ||
+        clazz == (MimeObjectClass *)&mimeInlineTextHTMLAsPlaintextClass ||
+           /* The latter 2 classes bear some risk, because they use the Gecko
+              HTML parser, but the user has the option to make an explicit
+              choice in this case, via html_as. */
+        clazz == (MimeObjectClass *)&mimeMultipartMixedClass ||
+        clazz == (MimeObjectClass *)&mimeMultipartAlternativeClass ||
+        clazz == (MimeObjectClass *)&mimeMultipartDigestClass ||
+        clazz == (MimeObjectClass *)&mimeMultipartAppleDoubleClass ||
+        clazz == (MimeObjectClass *)&mimeMessageClass ||
+        clazz == (MimeObjectClass *)&mimeExternalObjectClass ||
+                               /*    mimeUntypedTextClass? -- does uuencode */
+#ifdef ENABLE_SMIME
+        clazz == (MimeObjectClass *)&mimeMultipartSignedCMSClass ||
+        clazz == (MimeObjectClass *)&mimeEncryptedCMSClass ||
+#endif
+        clazz == 0
+      );
+
+  /* Contrairy to above, the below code is a "blacklist", i.e. it
+     *excludes* some "bad" classes. */
+  return
+     !(
+        (avoid_html
+         && (
+              clazz == (MimeObjectClass *)&mimeInlineTextHTMLClass
+                         /* Should not happen - we protect against that in
+                            mime_find_class(). Still for safety... */
+            )) ||
+        (avoid_images
+         && (
+              clazz == (MimeObjectClass *)&mimeInlineImageClass
+            )) ||
+        (avoid_strange_content
+         && (
+              clazz == (MimeObjectClass *)&mimeInlineTextEnrichedClass ||
+              clazz == (MimeObjectClass *)&mimeInlineTextRichtextClass ||
+              clazz == (MimeObjectClass *)&mimeSunAttachmentClass ||
+              clazz == (MimeObjectClass *)&mimeExternalBodyClass
+            ))
+      );
+}
+
+
 MimeObjectClass *
 mime_find_class (const char *content_type, MimeHeaders *hdrs,
 				 MimeDisplayOptions *opts, PRBool exact_match_p)
@@ -296,6 +367,32 @@
   MimeObjectClass *tempClass = 0;
   contentTypeHandlerInitStruct  ctHandlerInfo;
 
+  // Read some prefs
+  nsIPref *pref = GetPrefServiceManager(opts); 
+  PRInt32 html_as = 0;  // def. see below
+  PRInt32 types_of_classes_to_disallow = 0;  /* Let only a few libmime classes
+       process incoming data. This protects from bugs (e.g. buffer overflows)
+       and from security loopholes (e.g. allowing unchecked HTML in some
+       obscure classes, although the user has html_as > 0).
+       This option is mainly for the UI of html_as.
+       0 = allow all available classes
+       1 = Use hardcoded blacklist to avoid rendering (incoming) HTML
+       2 = ... and images
+       3 = ... and some other uncommon content types
+       100 = Use hardcoded whitelist to avoid even more bugs(buffer overflows).
+           This mode will limit the features available (e.g. uncommon
+           attachment types and inline images) and is for paranoid users.
+       */
+  if (pref)
+  {
+    pref->GetIntPref("mailnews.display.html_as", &html_as);
+    pref->GetIntPref("mailnews.display.disallow_mime_handlers",
+                     &types_of_classes_to_disallow);
+    if (types_of_classes_to_disallow > 0 && html_as == 0)
+         // We have non-sensical prefs. Do some fixup.
+      html_as = 1;
+  }
+
   /* 
   * What we do first is check for an external content handler plugin. 
   * This will actually extend the mime handling by calling a routine 
@@ -305,6 +402,19 @@
   */
   if ((tempClass = mime_locate_external_content_handler(content_type, &ctHandlerInfo)) != NULL)
   {
+    if (types_of_classes_to_disallow > 0
+        && (!nsCRT::strncasecmp(content_type, "text/x-vcard", 12) ||
+            !nsCRT::strncasecmp(content_type, "text/calendar", 13))
+       )
+      /* Use a little hack to prevent some dangerous plugins, which ship
+         with Mozilla, to run.
+         For the truely user-installed plugins, we rely on the judgement
+         of the user. */
+    {
+      if (!exact_match_p)
+        clazz = (MimeObjectClass *)&mimeExternalObjectClass; // As attachment
+    }
+    else
     clazz = (MimeObjectClass *)tempClass;
   }
   else
@@ -318,7 +428,33 @@
     else if (!nsCRT::strncasecmp(content_type,			"text/", 5))
     {
       if      (!nsCRT::strcasecmp(content_type+5,		"html"))
+      {
+        if (opts
+            && opts->format_out == nsMimeOutput::nsMimeMessageSaveAs)
+          // SaveAs in new modes doesn't work yet.
+        {
+          clazz = (MimeObjectClass *)&mimeInlineTextHTMLClass;
+          types_of_classes_to_disallow = 0;
+        }
+        else if (html_as == 0) // Render sender's HTML
         clazz = (MimeObjectClass *)&mimeInlineTextHTMLClass;
+        else if (html_as == 1) // convert HTML to plaintext
+          // Do a HTML->TXT->HTML conversion, see mimethpl.h.
+          clazz = (MimeObjectClass *)&mimeInlineTextHTMLAsPlaintextClass;
+        else if (html_as == 2) // display HTML source
+          /* This is for the freaks. Treat HTML as plaintext,
+             which will cause the HTML source to be displayed.
+             Not very user-friendly, but some seem to want this. */
+          clazz = (MimeObjectClass *)&mimeInlineTextPlainClass;
+        else if (html_as == 3) // Sanitize
+          // Strip all but allowed HTML
+          clazz = (MimeObjectClass *)&mimeInlineTextHTMLSanitizedClass;
+        else // Goofy pref
+          /* User has an unknown pref value. Maybe he used a newer Mozilla
+             with a new alternative to avoid HTML. Defaulting to option 1,
+             which is less dangerous than defaulting to the raw HTML. */
+          clazz = (MimeObjectClass *)&mimeInlineTextHTMLAsPlaintextClass;
+      }
       else if (!nsCRT::strcasecmp(content_type+5,		"enriched"))
         clazz = (MimeObjectClass *)&mimeInlineTextEnrichedClass;
       else if (!nsCRT::strcasecmp(content_type+5,		"richtext"))
@@ -331,10 +467,8 @@
         clazz = (MimeObjectClass *)&mimeInlineTextPlainClass;
 
         PRBool disable_format_flowed = PR_FALSE;
-        nsIPref *pref = GetPrefServiceManager(opts); 
         if (pref)
-          (void)pref->GetBoolPref(
-                           "mailnews.display.disable_format_flowed_support",
+          pref->GetBoolPref("mailnews.display.disable_format_flowed_support",
                            &disable_format_flowed);
         
         if(!disable_format_flowed)
@@ -402,8 +536,10 @@
           ? MimeHeaders_get_parameter(ct, PARAM_MICALG, NULL, NULL)
           : 0);
         
-          if (proto && (!nsCRT::strcasecmp(proto, APPLICATION_XPKCS7_SIGNATURE) &&
-                          micalg && (!nsCRT::strcasecmp(micalg, PARAM_MICALG_MD5) ||
+          if (proto
+              && (!nsCRT::strcasecmp(proto, APPLICATION_XPKCS7_SIGNATURE)
+                  && micalg
+                  && (!nsCRT::strcasecmp(micalg, PARAM_MICALG_MD5) ||
                                                  !nsCRT::strcasecmp(micalg, PARAM_MICALG_SHA1) ||
                                                  !nsCRT::strcasecmp(micalg, PARAM_MICALG_SHA1_2) ||
                                                  !nsCRT::strcasecmp(micalg, PARAM_MICALG_SHA1_3) ||
@@ -472,6 +608,16 @@
     */
     else if (!exact_match_p)
       clazz = (MimeObjectClass *)&mimeExternalObjectClass;  
+
+    if (!mime_is_allowed_class(clazz, types_of_classes_to_disallow))
+    {
+      /* Do that check here (not after the if block), because we want to allow
+         user-installed plugins. */
+      if(!exact_match_p)
+        clazz = (MimeObjectClass *)&mimeExternalObjectClass;
+      else
+        clazz = 0;
+    }
   }
 
  if (!exact_match_p)
@@ -617,6 +763,8 @@
           (clazz != (MimeObjectClass *)&mimeInlineTextPlainClass) &&
           (clazz != (MimeObjectClass *)&mimeInlineTextPlainFlowedClass) &&
           (clazz != (MimeObjectClass *)&mimeInlineTextHTMLClass) &&
+          (clazz != (MimeObjectClass *)&mimeInlineTextHTMLSanitizedClass) &&
+          (clazz != (MimeObjectClass *)&mimeInlineTextHTMLAsPlaintextClass) &&
           (clazz != (MimeObjectClass *)&mimeInlineTextRichtextClass) &&
           (clazz != (MimeObjectClass *)&mimeInlineTextEnrichedClass) &&
           (clazz != (MimeObjectClass *)&mimeMessageClass) &&
Index: mailnews/mime/src/mimei.h
===================================================================
RCS file: /cvsroot/mozilla/mailnews/mime/src/mimei.h,v
retrieving revision 1.12.16.1
diff -u -u -w -r1.12.16.1 mimei.h
--- mailnews/mime/src/mimei.h	10 Apr 2002 03:07:42 -0000	1.12.16.1
+++ mailnews/mime/src/mimei.h	24 Aug 2002 17:13:49 -0000
@@ -57,57 +57,68 @@
 
      MimeObject (abstract)
       |
-      |--- MimeContainer (abstract)
+      +--- MimeContainer (abstract)
       |     |
-      |     |--- MimeMultipart (abstract)
+      |     +--- MimeMultipart (abstract)
       |     |     |
-      |     |     |--- MimeMultipartMixed
+      |     |     +--- MimeMultipartMixed
       |     |     |
-      |     |     |--- MimeMultipartDigest
+      |     |     +--- MimeMultipartDigest
       |     |     |
-      |     |     |--- MimeMultipartParallel
+      |     |     +--- MimeMultipartParallel
       |     |     |
-      |     |     |--- MimeMultipartAlternative
+      |     |     +--- MimeMultipartAlternative
       |     |     |
-      |     |     |--- MimeMultipartRelated
+      |     |     +--- MimeMultipartRelated
       |     |     |
-      |     |     |--- MimeMultipartAppleDouble
+      |     |     +--- MimeMultipartAppleDouble
       |     |     |
-      |     |     |--- MimeSunAttachment
+      |     |     +--- MimeSunAttachment
       |     |     |
-      |     |     |--- MimeMultipartSigned (abstract)
+      |     |     \--- MimeMultipartSigned (abstract)
       |     |          |
-      |     |          |--- MimeMultipartSigned
+      |     |          \--- MimeMultipartSignedCMS
       |     |
-      |     |--- MimeXlateed (abstract)
+      |     +--- MimeEncrypted (abstract)
       |     |     |
-      |     |     |--- MimeXlateed
+      |     |     \--- MimeEncryptedPKCS7
       |     |
-      |     |--- MimeMessage
+      |     +--- MimeXlateed (abstract)
+      |     |     |
+      |     |     \--- MimeXlateed
+      |     |
+      |     +--- MimeMessage
       |     |
-      |     |--- MimeUntypedText
+      |     \--- MimeUntypedText
       |
-      |--- MimeLeaf (abstract)
+      +--- MimeLeaf (abstract)
       |     |
-      |     |--- MimeInlineText (abstract)
+      |     +--- MimeInlineText (abstract)
       |     |     |
-      |     |     |--- MimeInlineTextPlain
+      |     |     +--- MimeInlineTextPlain
+      |     |     |     |
+      |     |     |     \--- MimeInlineTextHTMLAsPlaintext
       |     |     |
-      |     |     |--- MimeInlineTextHTML
+      |     |     +--- MimeInlineTextPlainFlowed
       |     |     |
-      |     |     |--- MimeInlineTextRichtext
+      |     |     +--- MimeInlineTextHTML
       |     |     |     |
-      |     |     |     |--- MimeInlineTextEnriched
+      |     |     |     \--- MimeInlineTextHTMLSanitized
       |     |	    |
-      |     |	    |--- MimeInlineTextVCard
+      |     |     +--- MimeInlineTextRichtext
+      |     |     |     |
+      |     |     |     \--- MimeInlineTextEnriched
       |     |	    |
-      |     |	    |--- MimeInlineTextCalendar
+      |     |	  +--- MimeInlineTextVCard
+      |     |     |
+      |     |	  \--- MimeInlineTextCalendar
       |     |
-      |     |--- MimeInlineImage
+      |     +--- MimeInlineImage
       |     |
-      |     |--- MimeExternalObject
+      |     \--- MimeExternalObject
       |
-      |--- MimeExternalBody
+      \--- MimeExternalBody
+
 
   =========================================================================
   The definition of these classes is somewhat idiosyncratic, since I defined
@@ -213,6 +224,10 @@
         parentClass.whatnot.object.finalize(object);             //  (works...)
         object->clazz->superclass->finalize(object);             //  WRONG!!
       }
+
+  If you write a libmime content type handler, libmime might create several
+  instances of your class at once and call e.g. the same finalize code for
+  3 different objects in a row.
  */
 
 #include "mimehdrs.h"
Index: mailnews/mime/src/mimemalt.cpp
===================================================================
RCS file: /cvsroot/mozilla/mailnews/mime/src/mimemalt.cpp,v
retrieving revision 1.12.2.3
diff -u -u -w -r1.12.2.3 mimemalt.cpp
--- mailnews/mime/src/mimemalt.cpp	16 May 2002 23:56:57 -0000	1.12.2.3
+++ mailnews/mime/src/mimemalt.cpp	24 Aug 2002 17:13:49 -0000
@@ -20,6 +20,7 @@
  * the Initial Developer. All Rights Reserved.
  *
  * Contributor(s):
+ *    Ben Bucksch <mozilla@bucksch.org>
  *
  * Alternatively, the contents of this file may be used under the terms of
  * either the GNU General Public License Version 2 or later (the "GPL"), or 
@@ -42,6 +43,10 @@
 #include "nsCRT.h"
 #include "nsMimeTypes.h"
 #include "nsMimeStringResources.h"
+#include "nsIPref.h"
+#include "mimemoz2.h" // for prefs
+
+static NS_DEFINE_CID(kPrefCID, NS_PREF_CID);
 
 extern "C" MimeObjectClass mimeMultipartRelatedClass;
 
@@ -229,6 +234,29 @@
    that, without descending into it to determine if any of its sub-parts
    are themselves unknown.
    */
+
+  // prefer_plaintext pref
+  nsIPref *pref = GetPrefServiceManager(self->options); 
+  PRBool prefer_plaintext = PR_FALSE;
+  if (pref)
+    (void)pref->GetBoolPref("mailnews.display.prefer_plaintext",
+                            &prefer_plaintext);
+  if (prefer_plaintext
+      && self->options->format_out != nsMimeOutput::nsMimeMessageSaveAs
+      && (!nsCRT::strncasecmp(ct, "text/html", 9) ||
+          !nsCRT::strncasecmp(ct, "text/enriched", 13) ||
+          !nsCRT::strncasecmp(ct, "text/richtext", 13))
+     )
+    // if the user prefers plaintext and this is the "rich" (e.g. HTML) part...
+  {
+#if DEBUG
+    printf ("Ignoring %s alternative\n", ct);
+#endif
+    return PR_FALSE;
+  }
+#if DEBUG
+  printf ("Considering %s alternative\n", ct);
+#endif
 
   MimeObjectClass *clazz = mime_find_class (ct, sub_hdrs, self->options, PR_TRUE);
   PRBool result = (clazz
Index: mailnews/mime/src/mimemoz2.cpp
===================================================================
RCS file: /cvsroot/mozilla/mailnews/mime/src/mimemoz2.cpp,v
retrieving revision 1.180.2.2
diff -u -u -w -r1.180.2.2 mimemoz2.cpp
--- mailnews/mime/src/mimemoz2.cpp	4 May 2002 01:29:31 -0000	1.180.2.2
+++ mailnews/mime/src/mimemoz2.cpp	24 Aug 2002 17:13:50 -0000
@@ -86,10 +86,26 @@
 #include "nsITransport.h"
 #include "mimeebod.h"
 #include "mimeeobj.h"
+// <for functions="HTML2Plaintext,HTMLSantinize">
+#include "nsXPCOM.h"
+#include "nsParserCIID.h"
+#include "nsIParser.h"
+#include "nsIHTMLContentSink.h"
+#include "nsIContentSerializer.h"
+#include "nsLayoutCID.h"
+#include "nsIComponentManager.h"
+#include "nsReadableUtils.h"
+#include "nsIHTMLToTextSink.h"
+#include "mozISanitizingSerializer.h"
+// </for>
 
 
 static NS_DEFINE_CID(kPrefCID, NS_PREF_CID);
 static NS_DEFINE_CID(kIOServiceCID, NS_IOSERVICE_CID);
+// <for functions="HTML2Plaintext,HTMLSantinize">
+static NS_DEFINE_CID(kParserCID, NS_PARSER_CID);
+static NS_DEFINE_CID(kNavDTDCID, NS_CNAVDTD_CID);
+// </for>
 
 #ifdef HAVE_MIME_DATA_SLOT
 #define LOCK_LAST_CACHED_MESSAGE
@@ -1212,27 +1228,6 @@
   return size;
 }
 
-// 
-// Utility for finding HTML part.
-//
-static MimeObject*
-mime_find_text_html_part_1(MimeObject* obj)
-{
-  if (mime_subclass_p(obj->clazz,
-                      (MimeObjectClass*) &mimeInlineTextHTMLClass)) {
-    return obj;
-  }
-  if (mime_subclass_p(obj->clazz, (MimeObjectClass*) &mimeContainerClass)) {
-    MimeContainer* cobj = (MimeContainer*) obj;
-    PRInt32 i;
-    for (i=0 ; i<cobj->nchildren ; i++) {
-      MimeObject* result = mime_find_text_html_part_1(cobj->children[i]);
-      if (result) return result;
-    }
-  }
-  return NULL;
-}
-
 MimeObject*
 mime_get_main_object(MimeObject* obj)
 {
@@ -2107,4 +2102,132 @@
   }
 
   return NS_OK;
+}
+
+/* This function syncronously converts an HTML document (as string)
+   to plaintext (as string) using the Gecko converter.
+
+   flags: see nsIDocumentEncoder.h
+*/
+// TODO: |printf|s?
+/* <copy from="mozilla/htmlparser/test/outsinks/Convert.cpp"
+         author="akk"
+         adapted-by="Ben Bucksch"
+         comment=" 'This code would not have been possible without akk.' ;-P.
+                   No, really. "
+   > */
+nsresult
+HTML2Plaintext(const nsString& inString, nsString& outString,
+               PRUint32 flags, PRUint32 wrapCol)
+{
+  nsresult rv = NS_OK;
+
+#if DEBUG_BenB
+  printf("Converting HTML to plaintext\n");
+  char* charstar = ToNewUTF8String(inString);
+  printf("HTML source is:\n--------------------\n%s--------------------\n",
+         charstar);
+  delete[] charstar;
+#endif
+
+  // Create a parser
+  nsCOMPtr<nsIParser> parser = do_CreateInstance(kParserCID);
+  NS_ENSURE_TRUE(parser, NS_ERROR_FAILURE);
+
+  // Create the appropriate output sink
+  nsCOMPtr<nsIContentSink> sink =
+                               do_CreateInstance(NS_PLAINTEXTSINK_CONTRACTID);
+  NS_ENSURE_TRUE(sink, NS_ERROR_FAILURE);
+
+  nsCOMPtr<nsIHTMLToTextSink> textSink(do_QueryInterface(sink));
+  NS_ENSURE_TRUE(textSink, NS_ERROR_FAILURE);
+
+  textSink->Initialize(&outString, flags, wrapCol);
+
+  parser->SetContentSink(sink);
+  nsCOMPtr<nsIDTD> dtd = do_CreateInstance(kNavDTDCID);
+  NS_ENSURE_TRUE(dtd, NS_ERROR_FAILURE);
+
+  parser->RegisterDTD(dtd);
+
+  rv = parser->Parse(inString, 0, NS_LITERAL_CSTRING("text/html"),
+                     PR_FALSE, PR_TRUE);
+
+  // Aah! How can NS_ERROR and NS_ABORT_IF_FALSE be no-ops in release builds???
+  if (NS_FAILED(rv))
+  {
+    NS_ERROR("Parse() failed!");
+    return rv;
+  }
+
+#if DEBUG_BenB
+  charstar = ToNewUTF8String(outString);
+  printf("Plaintext is:\n--------------------\n%s--------------------\n",
+         charstar);
+  delete[] charstar;
+#endif
+
+  return rv;
+}
+// </copy>
+
+
+
+/* This function syncronously sanitizes an HTML document (string->string)
+   using the Gecko ContentSink mozISanitizingHTMLSerializer.
+
+   flags: currently unused
+   allowedTags: see mozSanitizingHTMLSerializer::ParsePrefs()
+*/
+// copied from HTML2Plaintext above
+nsresult
+HTMLSanitize(const nsString& inString, nsString& outString,
+             PRUint32 flags, const nsAString& allowedTags)
+{
+  nsresult rv = NS_OK;
+
+#if DEBUG_BenB
+  printf("Sanitizing HTML\n");
+  char* charstar = ToNewUTF8String(inString);
+  printf("Original HTML is:\n--------------------\n%s--------------------\n",
+         charstar);
+  delete[] charstar;
+#endif
+
+  // Create a parser
+  nsCOMPtr<nsIParser> parser = do_CreateInstance(kParserCID);
+  NS_ENSURE_TRUE(parser, NS_ERROR_FAILURE);
+
+  // Create the appropriate output sink
+  nsCOMPtr<nsIContentSink> sink =
+                    do_CreateInstance(MOZ_SANITIZINGHTMLSERIALIZER_CONTRACTID);
+  NS_ENSURE_TRUE(sink, NS_ERROR_FAILURE);
+
+  nsCOMPtr<mozISanitizingHTMLSerializer> sanSink(do_QueryInterface(sink));
+  NS_ENSURE_TRUE(sanSink, NS_ERROR_FAILURE);
+
+  sanSink->Initialize(&outString, flags, allowedTags);
+
+  parser->SetContentSink(sink);
+  nsCOMPtr<nsIDTD> dtd = do_CreateInstance(kNavDTDCID);
+  NS_ENSURE_TRUE(dtd, NS_ERROR_FAILURE);
+
+  parser->RegisterDTD(dtd);
+
+  rv = parser->Parse(inString, 0, NS_LITERAL_CSTRING("text/html"),
+                     PR_FALSE, PR_TRUE);
+  if (NS_FAILED(rv))
+  {
+    NS_ERROR("Parse() failed!");
+    return rv;
+  }
+
+#if DEBUG_BenB
+  charstar = ToNewUTF8String(outString);
+  printf("Sanitized HTML is:\n--------------------\n%s--------------------\n",
+         charstar);
+  delete[] charstar;
+#endif
+
+  return rv;
 }
Index: mailnews/mime/src/mimemoz2.h
===================================================================
RCS file: /cvsroot/mozilla/mailnews/mime/src/mimemoz2.h,v
retrieving revision 1.41.2.2
diff -u -u -w -r1.41.2.2 mimemoz2.h
--- mailnews/mime/src/mimemoz2.h	9 Jul 2002 19:07:11 -0000	1.41.2.2
+++ mailnews/mime/src/mimemoz2.h	24 Aug 2002 17:13:50 -0000
@@ -200,6 +200,13 @@
 // Get the text converter...
 mozITXTToHTMLConv           *GetTextConverter(MimeDisplayOptions *opt);
 
+nsresult
+HTML2Plaintext(const nsString& inString, nsString& outString,
+               PRUint32 flags, PRUint32 wrapCol);
+nsresult
+HTMLSanitize(const nsString& inString, nsString& outString,
+             PRUint32 flags, const nsAString& allowedTags);
+
 /* This is the next generation string retrieval call */
 extern "C" char             *MimeGetStringByID(PRInt32 stringID);
 
Index: mailnews/mime/src/mimethtm.cpp
===================================================================
RCS file: /cvsroot/mozilla/mailnews/mime/src/mimethtm.cpp,v
retrieving revision 1.29.8.1
diff -u -u -w -r1.29.8.1 mimethtm.cpp
--- mailnews/mime/src/mimethtm.cpp	10 Apr 2002 03:07:46 -0000	1.29.8.1
+++ mailnews/mime/src/mimethtm.cpp	24 Aug 2002 17:13:50 -0000
@@ -180,8 +180,6 @@
         (cp = PL_strncasestr(cp, "CHARSET=", length - (int)(cp - line))) 
         ) 
     {
-      if (cp)
-      {
         char* cp1 = cp + 8;  //8 for the length of "CHARSET="
         char* cp2 = PL_strnpbrk(cp1, " \"\'", length - (int)(cp1 - line));
         if (cp2)
@@ -214,17 +212,11 @@
         }
       }
     }
-  }
 
   // Now, just write out the data...
   return MimeObject_write(obj, line, length, PR_TRUE);
 }
 
-/* This method is the same as that of MimeInlineTextRichtext (and thus
-   MimeInlineTextEnriched); maybe that means that MimeInlineTextHTML
-   should share a common parent with them which is not also shared by
-   MimeInlineTextPlain?
- */
 static int
 MimeInlineTextHTML_parse_eof (MimeObject *obj, PRBool abort_p)
 {
Index: mailnews/mime/src/mimetpla.h
===================================================================
RCS file: /cvsroot/mozilla/mailnews/mime/src/mimetpla.h,v
retrieving revision 1.5.36.1
diff -u -u -w -r1.5.36.1 mimetpla.h
--- mailnews/mime/src/mimetpla.h	10 Apr 2002 03:07:46 -0000	1.5.36.1
+++ mailnews/mime/src/mimetpla.h	24 Aug 2002 17:13:50 -0000
@@ -35,14 +35,14 @@
  *
  * ***** END LICENSE BLOCK ***** */
 
+/* The MimeInlineTextPlain class implements the text/plain MIME content type,
+   and is also used for all otherwise-unknown text/ subtypes.
+ */
+
 #ifndef _MIMETPLA_H_
 #define _MIMETPLA_H_
 
 #include "mimetext.h"
-
-/* The MimeInlineTextHTML class implements the text/plain MIME content type,
-   and is also used for all otherwise-unknown text/ subtypes.
- */
 
 typedef struct MimeInlineTextPlainClass MimeInlineTextPlainClass;
 typedef struct MimeInlineTextPlain      MimeInlineTextPlain;
Index: mailnews/mime/src/mimetric.cpp
===================================================================
RCS file: /cvsroot/mozilla/mailnews/mime/src/mimetric.cpp,v
retrieving revision 1.10.8.1
diff -u -u -w -r1.10.8.1 mimetric.cpp
--- mailnews/mime/src/mimetric.cpp	10 Apr 2002 03:07:46 -0000	1.10.8.1
+++ mailnews/mime/src/mimetric.cpp	24 Aug 2002 17:13:50 -0000
@@ -351,10 +351,6 @@
 }
 
 
-/* This method is largely the same as that of MimeInlineTextHTML; maybe that
-   means that MimeInlineTextRichtext and MimeInlineTextEnriched should share
-   a common parent with it which is not also shared by MimeInlineTextPlain?
- */
 static int
 MimeInlineTextRichtext_parse_eof (MimeObject *obj, PRBool abort_p)
 {
Index: modules/libpref/src/beos/beos.js
===================================================================
RCS file: /cvsroot/mozilla/modules/libpref/src/beos/beos.js,v
retrieving revision 1.12.14.1
diff -u -u -w -r1.12.14.1 beos.js
--- modules/libpref/src/beos/beos.js	10 Apr 2002 03:09:12 -0000	1.12.14.1
+++ modules/libpref/src/beos/beos.js	24 Aug 2002 17:13:51 -0000
@@ -41,7 +41,7 @@
 pref("intl.font_spec_list", "");
 pref("mail.signature_date", 0);
 
-pref("font.default", "serif");
+pref("font.default", "sans-serif");
 pref("font.size.variable.ar", 16);
 pref("font.size.fixed.ar", 13);
 
Index: modules/libpref/src/init/all.js
===================================================================
RCS file: /cvsroot/mozilla/modules/libpref/src/init/all.js,v
retrieving revision 3.367.2.29
diff -u -u -w -r3.367.2.29 all.js
--- modules/libpref/src/init/all.js	20 Aug 2002 05:11:25 -0000	3.367.2.29
+++ modules/libpref/src/init/all.js	24 Aug 2002 17:13:51 -0000
@@ -38,12 +38,18 @@
 // SYNTAX HINTS:  dashes are delimiters.  Use underscores instead.
 //  The first character after a period must be alphabetic.
 
-pref("network.search.url","http://cgi.netscape.com/cgi-bin/url_search.cgi?search=");
+pref("general.useragent.misc", "Stable");
+// Separate the ever-changing version info to avoid merge conflicts
 
-pref("keyword.URL", "http://keyword.netscape.com/keyword/");
-pref("keyword.enabled", false);
-pref("general.useragent.locale", "chrome://navigator/locale/navigator.properties");
-pref("general.useragent.misc", "rv:1.0.1");
+// see <http://www.mozilla.org/build/revised-user-agent-strings.html>
+pref("general.useragent.locale", "en");
+pref("general.useragent.vendor", "Beonex");
+pref("general.useragent.vendorSub", "0.8.1-stable");
+
+pref("network.search.url","http://www.google.com/search?q=");
+
+pref("keyword.URL", "http://www.google.com/search?btnI=I%27m+Feeling+Lucky&q="); //XXX permanent?
+pref("keyword.enabled", true);
 
 pref("general.startup.browser",             true);
 pref("general.startup.mail",                false);
@@ -61,7 +67,8 @@
 pref("browser.startup.page",                1);
 pref("browser.startup.homepage",	   "chrome://navigator-region/locale/region.properties");
 // "browser.startup.homepage_override" was for 4.x
-pref("browser.startup.homepage_override.1", true);
+pref("browser.startup.homepage_override.beonex.0-8.1", true);
+
 pref("browser.startup.autoload_homepage",   true);
 
 pref("browser.cache.enable",                true); // see also network.http.use-cache
@@ -109,12 +116,12 @@
 pref("browser.chrome.toolbar_tips",         true);
 pref("browser.chrome.toolbar_style",        2);
 
-pref("browser.toolbars.showbutton.bookmarks", true);
+pref("browser.toolbars.showbutton.bookmarks", false);
 pref("browser.toolbars.showbutton.go",      false);
 pref("browser.toolbars.showbutton.home",    true);
-pref("browser.toolbars.showbutton.mynetscape", true);
-pref("browser.toolbars.showbutton.net2phone", true);
-pref("browser.toolbars.showbutton.print",   true);
+pref("browser.toolbars.showbutton.mynetscape", false);
+pref("browser.toolbars.showbutton.net2phone", false);
+pref("browser.toolbars.showbutton.print",   false);
 pref("browser.toolbars.showbutton.search",  true);
 
 pref("browser.turbo.enabled", false);
@@ -141,7 +148,7 @@
 pref("browser.search.defaulturl", "chrome://navigator-region/locale/region.properties");
 pref("browser.search.opensidebarsearchpanel", true);
 pref("browser.search.last_search_category", "NC:SearchCategory?category=urn:search:category:1");
-pref("browser.search.mode", 0);
+pref("browser.search.mode", 1);
 pref("browser.search.powermode", 0);
 // basic search popup constraint: minimum sherlock plugin version displayed
 // (note: must be a string representation of a float or it'll default to 0.0)
@@ -163,7 +170,7 @@
 pref("browser.PICS.pages_must_be_rated", false);
 pref("browser.PICS.disable_for_this_session", false);
 pref("browser.PICS.reenable_for_this_session", false);
-pref("browser.PICS.service.http___home_netscape_com_default_rating.service_enabled", true);
+pref("browser.PICS.service.http___home_netscape_com_default_rating.service_enabled", false);
 pref("browser.PICS.service.http___home_netscape_com_default_rating.s", 0);
 
 // loading and rendering of framesets and iframes
@@ -205,11 +212,11 @@
 pref("application.use_ns_plugin_finder", false);
 
 // Smart Browsing prefs
-pref("browser.related.enabled", true);
+pref("browser.related.enabled", false);
 pref("browser.related.autoload", 1);  // 0 = Always, 1 = After first use, 2 = Never
-pref("browser.related.provider", "http://www-rl.netscape.com/wtgn?");
+pref("browser.related.provider", "http://www-rl.netscape.com/wtgn?"); //XXX
 pref("browser.related.disabledForDomains", "");
-pref("browser.goBrowsing.enabled", true);
+pref("browser.goBrowsing.enabled", false);
 
 // URI fixup prefs
 pref("browser.fixup.alternate.enabled", true);
@@ -358,9 +365,9 @@
 pref("dom.disable_cookie_set",              false);
 pref("dom.disable_image_src_set",           false);
 pref("dom.disable_open_during_load",        false);
-pref("dom.disable_window_flip",             false);
-pref("dom.disable_window_move_resize",      false);
-pref("dom.disable_window_status_change",    false);
+pref("dom.disable_window_flip",             true);
+pref("dom.disable_window_move_resize",      true);
+pref("dom.disable_window_status_change",    true);
 
 pref("dom.disable_window_open_feature.status",      false);
 
@@ -372,7 +379,7 @@
 
 // advanced prefs
 pref("advanced.always_load_images",         true);
-pref("security.enable_java",                true);
+pref("security.enable_java",                false);
 pref("css.allow",                           true);
 pref("advanced.mailftp",                    false);
 pref("image.animation_mode",                "normal");
@@ -444,7 +451,20 @@
 // Headers
 pref("network.http.accept.default", "text/xml,application/xml,application/xhtml+xml,text/html;q=0.9,text/plain;q=0.8,video/x-mng,image/png,image/jpeg,image/gif;q=0.2,text/css,*/*;q=0.1");
 
-pref("network.http.sendRefererHeader",      2); // 0=don't send any, 1=send only on clicks, 2=send on image requests as well
+
+// Controls how and when the referrer header will be sent:
+//  0 - never send the referrer
+//  1 - send only on HTTP link clicks
+//  2 - send for both HTTP link clicks and inlines (images)
+//  3 - not currently used
+//  4 - send the referrer only to the same home, otherwise none
+//  5 - send the referrer to the same host, otherwise send a faked referrer
+//  6 - always send a faked referrer (base URL of target server)
+pref("network.http.sendRefererHeader", 5);
+
+// If true, the modified referrer will be sent for schemes which
+// normally wouldn't send a referrer, such as file: and resource: and imap:
+pref("network.http.referrerSchemeOverride", false);
 
 // Maximum number of consecutive redirects before aborting.
 pref("network.http.redirection-limit", 10);
@@ -493,8 +513,7 @@
 pref("network.hosts.socks_conf",            "");
 pref("network.image.imageBehavior",         0); // 0-Accept, 1-dontAcceptForeign, 2-dontUse
 pref("network.image.warnAboutImages",       false);
-pref("network.proxy.autoconfig_url",        "");
-pref("network.proxy.type",                  0);
+pref("network.proxy.type",                  0); // 0=Direct, 1=Manual, 2=autoconfig
 pref("network.proxy.ftp",                   "");
 pref("network.proxy.ftp_port",              0);
 pref("network.proxy.gopher",                "");
@@ -511,21 +530,38 @@
 pref("network.proxy.socks_port",            0);
 pref("network.proxy.socks_version",         5);
 pref("network.proxy.no_proxies_on",         "");
+pref("network.proxy.autoconfig_url",        "");
 pref("network.online",                      true); //online/offline
 pref("network.accept_cookies",              0);     // 0 = Always, 1 = warn, 2 = never
-pref("network.foreign_cookies",             0); // 0 = Accept, 1 = Don't accept
-pref("network.cookie.cookieBehavior",       3); // 0-Accept, 1-dontAcceptForeign, 2-dontUse, 3-p3p
+pref("network.foreign_cookies",             1); // 0=Accept, 1=Don't accept
+pref("network.cookie.cookieBehavior",       1); // 0=Accept, 1=dontAcceptForeign, 2=dontUse, 3=p3p
 pref("network.cookie.disableCookieForMailNews", true); // disable all cookies for mail
 pref("network.cookie.warnAboutCookies",     false);
-pref("network.cookie.lifetime.enabled",     false);
-pref("network.cookie.lifetime.behavior",    0);
+pref("network.cookie.lifetime.enabled",     true);
+pref("network.cookie.lifetime.behavior",    0); // 0-session, 1-days
 pref("network.cookie.lifetime.days",        90);
-
-// The following default value is for p3p medium mode.
+/* morse, why did you break backwards-compatibility and made the pref more
+   inflexible, just to make the implementation of the prefs forntend easier??*/
+/* network.cookie.p3plevel consists of 8 characters having the
+ * following interpretation:
+ *   [0]: first-party cookies when site has no privacy policy
+ *   [1]: third-party cookies when site has no privacy policy
+ *   [2]: first-party cookies when site uses PII with no user consent
+ *   [3]: third-party cookies when site uses PII with no user consent
+ *   [4]: first-party cookies when site uses PII with implicit consent only
+ *   [5]: third-party cookies when site uses PII with implicit consent only
+ *   [6]: first-party cookies when site uses PII with explicit consent
+ *   [7]: third-party cookies when site uses PII with explicit consent
+ * PII = personally identifiable information
+ *
+ * each of the eight characters can be one of the following
+ *   'a': accept the cookie
+ *   'd': accept the cookie but downgrade it to a session cookie
+ *   'r': reject the cookie
+ */
+pref("network.cookie.p3p",                  "drrrrrdr");
+pref("network.cookie.p3plevel",             3);  // 0=low, 1=medium, 2=high, 3=custom
 // See extensions/cookie/resources/content/p3p.xul for the definitions of low/medium/hi
-pref("network.cookie.p3p",                  "ffffaaaa");
-pref("network.cookie.p3plevel",             1); // 0=low, 1=medium, 2=high, 3=custom
-
 pref("signon.rememberSignons",              true);
 pref("signon.expireMasterPassword",         false);
 pref("network.enablePad",                   false); // Allow client to do proxy autodiscovery
@@ -635,9 +671,12 @@
 // Customizable toolbar stuff
 pref("custtoolbar.personal_toolbar_folder", "");
 
-pref("sidebar.customize.all_panels.url", "http://sidebar-rdf.netscape.com/%LOCALE%/sidebar-rdf/%SIDEBAR_VERSION%/all-panels.rdf");
-pref("sidebar.customize.directory.url", "http://dmoz.org/Netscape/Sidebar/");
-pref("sidebar.customize.more_panels.url", "http://dmoz.org/Netscape/Sidebar/");
+//pref("sidebar.customize.all_panels.url", "chrome://communicator/locale/sidebar/net-panels.rdf");
+//pref("sidebar.customize.all_panels.url", "http://sidebar-rdf.netscape.com/%LOCALE%/sidebar-rdf/%SIDEBAR_VERSION%/all-panels.rdf");
+pref("sidebar.customize.all_panels.url", "");
+//pref("sidebar.customize.directory.url", "http://dmoz.org/Netscape/Sidebar/");
+pref("sidebar.customize.directory.url", "http://www.beonex.com/communicator/redir/panel");
+pref("sidebar.customize.more_panels.url", "http://www.beonex.com/communicator/redir/panel");
 pref("sidebar.num_tabs_in_view", 8);
 
 pref("prefs.converted-to-utf8",false);
@@ -715,7 +754,7 @@
 
 // update notifications prefs
 pref("update_notifications.enabled", true);
-pref("update_notifications.provider.0.frequency", 7); // number of days
+pref("update_notifications.provider.0.frequency", 1); // number of days
 pref("update_notifications.provider.0.datasource", "chrome://communicator-region/locale/region.properties");
 
 // 0 opens the download manager
Index: modules/libpref/src/init/editor.js
===================================================================
RCS file: /cvsroot/mozilla/modules/libpref/src/init/editor.js,v
retrieving revision 3.25.2.1
diff -u -u -w -r3.25.2.1 editor.js
--- modules/libpref/src/init/editor.js	10 Apr 2002 03:09:13 -0000	3.25.2.1
+++ modules/libpref/src/init/editor.js	24 Aug 2002 17:13:51 -0000
@@ -55,7 +55,7 @@
 
 pref("editor.table.maintain_structure", true);
 
-pref("editor.prettyprint", true);
+pref("editor.prettyprint", false);
 
 pref("editor.htmlWrapColumn", 72);
 
Index: modules/libpref/src/init/mailnews.js
===================================================================
RCS file: /cvsroot/mozilla/modules/libpref/src/init/mailnews.js,v
retrieving revision 3.148.2.7
diff -u -u -w -r3.148.2.7 mailnews.js
--- modules/libpref/src/init/mailnews.js	4 Jul 2002 03:34:08 -0000	3.148.2.7
+++ modules/libpref/src/init/mailnews.js	24 Aug 2002 17:13:53 -0000
@@ -66,7 +66,7 @@
 pref("mailnews.headers.showUserAgent",       false);
 
 // Mail server preferences, pop by default
-pref("mail.server_type",	0); 	// 0 pop, 1 imap,
+pref("mail.server_type",	1); 	// 0 pop, 1 imap,
 					// (Unix only:)
 					// 2 movemail, 3 inbox          
 pref("mail.auth_login", true);
@@ -91,6 +91,7 @@
 pref("mail.imap.mime_parts_on_demand",      true);
 pref("mail.imap.mime_parts_on_demand_max_depth", 15);
 pref("mail.imap.mime_parts_on_demand_threshold", 30000);
+//pref("mail.imap.noop_check_count",          1); //XXX should we?
 pref("mail.thread_without_re",	            true);
 pref("mail.leave_on_server",                false);
 pref("mail.default_cc",                     "");
@@ -267,8 +268,9 @@
 
 pref("mailnews.confirm.moveFoldersToTrash", true);
 
-pref("mailnews.start_page.url", "chrome://messenger-region/locale/region.properties");
-pref("mailnews.start_page.enabled", true);
+pref("mailnews.start_page.url", "about:blank");
+pref("mailnews.start_page.enabled", false);
+
 
 pref("mailnews.account_central_page.url", "chrome://messenger/locale/messenger.properties");
 
@@ -286,7 +288,7 @@
 pref("mail.identity.default.overrideGlobal_Pref", false);
 
 
-pref("mail.collect_email_address_incoming", true);
+pref("mail.collect_email_address_incoming", false);
 pref("mail.collect_email_address_outgoing", true);
 pref("mail.collect_email_address_newsgroup", false);
 pref("mail.collect_email_address_enable_size_limit", true);
@@ -330,9 +332,24 @@
 pref("mail.smtpserver.default.auth_method", 1); // auth any
 pref("mail.smtpserver.default.try_ssl", 0);
 
-pref("mail.display_glyph", true);   // see <http://www.bucksch.org/1/projects/mozilla/16507>
-pref("mail.display_struct", true);  // ditto
-pref("mail.send_struct", false);   // ditto
+// For the next 3 prefs, see <http://www.bucksch.org/1/projects/mozilla/16507>
+pref("mail.display_glyph", true);   // TXT->HTML :-) etc. in viewer
+pref("mail.display_struct", true);  // TXT->HTML *bold* etc. in viewer; ditto
+pref("mail.send_struct", false);   // HTML->HTML *bold* etc. during Send; ditto
+// For the next 4 prefs, see <http://www.bucksch.org/1/projects/mozilla/108153>
+pref("mailnews.display.prefer_plaintext", false);  // Ignore HTML parts in multipart/alternative
+pref("mailnews.display.html_as", 3);  // How to display HTML parts. 0 = Render the sender's HTML; 1 = HTML->TXT->HTML; 2 = Show HTML source; 3 = Sanitize HTML
+pref("mailnews.display.html_sanitizer.allowed_tags", "html head title body p br div(lang,title) h1 h2 h3 h4 h5 h6 ul ol li(value,start,compact) dl dt dd blockquote(type,cite) pre noscript noframes strong em sub sup span(lang,title) acronym(title) abbr(title) del(title,cite,datetime) ins(title,cite,datetime) q(cite) a(href,name,title) img(alt,title,longdesc) base(href) area(alt) applet(alt) object(alt) var samp dfn address kbd code cite s strike tt b i table(align) caption tr(align,valign) td(rowspan,colspan,align,valign) th(rowspan,colspan,align,valign)");
+pref("mailnews.display.disallow_mime_handlers", 3);  /* Let only a few classes process incoming data. This protects from bugs (e.g. buffer overflows) and from security loopholes (e.g. allowing unchecked HTML in some obscure classes, although the user has html_as > 0).
+This option is mainly for the UI of html_as.
+0 = allow all available classes
+1 = Use hardcoded blacklist to avoid rendering (incoming) HTML
+2 = ... and inline images
+3 = ... and some other uncommon content types
+100 = Use hardcoded whitelist to avoid even more bugs(buffer overflows).
+      This mode will limit the features available (e.g. uncommon
+      attachment types and inline images) and is for paranoid users.
+*/
 
 pref("mail.forward_message_mode", 0); // 0=default as attachment 2=forward as inline with attachments, (obsolete 4.x value)1=forward as quoted (mapped to 2 in mozilla)
 
@@ -442,5 +459,5 @@
 pref("mailnews.fakeaccount.server", "");
 
 // message display properties
-pref("mailnews.message_display.disable_remote_image", false);
-pref("mailnews.message_display.allow.plugins", true);
+pref("mailnews.message_display.disable_remote_image", true);
+pref("mailnews.message_display.allow.plugins", false);
Index: modules/libpref/src/mac/macprefs.js
===================================================================
RCS file: /cvsroot/mozilla/modules/libpref/src/mac/macprefs.js,v
retrieving revision 3.19.14.1
diff -u -u -w -r3.19.14.1 macprefs.js
--- modules/libpref/src/mac/macprefs.js	10 Apr 2002 03:09:15 -0000	3.19.14.1
+++ modules/libpref/src/mac/macprefs.js	24 Aug 2002 17:13:55 -0000
@@ -139,7 +139,7 @@
 pref("font.name.cursive.zh-TW", "XXX.cursive");
 pref("font.name.fantasy.zh-TW", "XXX.fantasy");
 
-pref("font.default", "serif");
+pref("font.default", "sans-serif");
 pref("font.size.variable.ar", 16);
 pref("font.size.fixed.ar", 13);
 
Index: modules/libpref/src/os2/os2pref.js
===================================================================
RCS file: /cvsroot/mozilla/modules/libpref/src/os2/os2pref.js,v
retrieving revision 3.21.14.4
diff -u -u -w -r3.21.14.4 os2pref.js
--- modules/libpref/src/os2/os2pref.js	30 Jun 2002 04:54:35 -0000	3.21.14.4
+++ modules/libpref/src/os2/os2pref.js	24 Aug 2002 17:13:55 -0000
@@ -111,7 +111,7 @@
 pref("font.name.sans-serif.zh-TW", "Helv");
 pref("font.name.monospace.zh-TW", "Courier");
 
-pref("font.default", "serif");
+pref("font.default", "sans-serif");
 pref("font.size.variable.ar", 16);
 pref("font.size.fixed.ar", 13);
 
Index: modules/libpref/src/unix/unix.js
===================================================================
RCS file: /cvsroot/mozilla/modules/libpref/src/unix/unix.js,v
retrieving revision 3.69.2.7
diff -u -u -w -r3.69.2.7 unix.js
--- modules/libpref/src/unix/unix.js	31 Jul 2002 06:33:50 -0000	3.69.2.7
+++ modules/libpref/src/unix/unix.js	24 Aug 2002 17:13:55 -0000
@@ -58,7 +58,7 @@
 
 // Middle-mouse handling
 pref("middlemouse.paste", true);
-pref("middlemouse.contentLoadURL", true);
+pref("middlemouse.contentLoadURL", false);
 pref("middlemouse.openNewWindow", true);
 pref("middlemouse.scrollbarPosition", true);
 
@@ -176,7 +176,7 @@
 
 // zh-TW
 
-pref("font.default", "serif");
+pref("font.default", "sans-serif");
 pref("font.size.variable.ar", 16);
 pref("font.size.fixed.ar", 12);
 
@@ -208,10 +208,10 @@
 pref("font.size.fixed.x-cyrillic", 12);
 
 pref("font.size.variable.x-unicode", 16);
-pref("font.size.fixed.x-unicode", 12);
+pref("font.size.fixed.x-unicode", 14);
 
 pref("font.size.variable.x-western", 16);
-pref("font.size.fixed.x-western", 12);
+pref("font.size.fixed.x-western", 14);
 
 pref("font.size.variable.zh-CN", 16);
 pref("font.size.fixed.zh-CN", 16);
Index: modules/libpref/src/win/winpref.js
===================================================================
RCS file: /cvsroot/mozilla/modules/libpref/src/win/winpref.js,v
retrieving revision 3.35.14.2
diff -u -u -w -r3.35.14.2 winpref.js
--- modules/libpref/src/win/winpref.js	2 May 2002 20:39:19 -0000	3.35.14.2
+++ modules/libpref/src/win/winpref.js	24 Aug 2002 17:13:55 -0000
@@ -117,7 +117,7 @@
 pref("font.name-list.sans-serif.zh-TW", "MingLiU"); 
 pref("font.name-list.monospace.zh-TW", "MingLiU"); 
 
-pref("font.default", "serif");
+pref("font.default", "sans-serif");
 pref("font.size.variable.ar", 16);
 pref("font.size.fixed.ar", 13);
 
Index: netwerk/base/public/nsNetUtil.h
===================================================================
RCS file: /cvsroot/mozilla/netwerk/base/public/nsNetUtil.h,v
retrieving revision 1.51.2.5
diff -u -u -w -r1.51.2.5 nsNetUtil.h
--- netwerk/base/public/nsNetUtil.h	25 Jun 2002 04:21:42 -0000	1.51.2.5
+++ netwerk/base/public/nsNetUtil.h	24 Aug 2002 17:13:58 -0000
@@ -111,7 +111,7 @@
           nsIURI* baseURI = nsnull,
           nsIIOService* ioService = nsnull)     // pass in nsIIOService to optimize callers
 {
-    return NS_NewURI(result, NS_ConvertUCS2toUTF8(spec), charset, baseURI, ioService);
+    return NS_NewURI(result, NS_ConvertUCS2toUTF8(spec), "UTF-8", baseURI, ioService);
 }
 
 inline nsresult
Index: netwerk/base/public/security-prefs.js
===================================================================
RCS file: /cvsroot/mozilla/netwerk/base/public/security-prefs.js,v
retrieving revision 1.9.58.1
diff -u -u -w -r1.9.58.1 security-prefs.js
--- netwerk/base/public/security-prefs.js	10 Apr 2002 03:13:34 -0000	1.9.58.1
+++ netwerk/base/public/security-prefs.js	24 Aug 2002 17:13:58 -0000
@@ -28,7 +28,7 @@
 pref("security.warn_entering_weak",      true);
 pref("security.warn_leaving_secure",     true);
 pref("security.warn_viewing_mixed",      true);
-pref("security.warn_submit_insecure",    true);
+pref("security.warn_submit_insecure",    false);
 
 pref("security.OCSP.enabled",		0);
 
Index: netwerk/base/src/nsIOService.cpp
===================================================================
RCS file: /cvsroot/mozilla/netwerk/base/src/nsIOService.cpp,v
retrieving revision 1.142.2.3
diff -u -u -w -r1.142.2.3 nsIOService.cpp
--- netwerk/base/src/nsIOService.cpp	9 Jul 2002 23:38:21 -0000	1.142.2.3
+++ netwerk/base/src/nsIOService.cpp	24 Aug 2002 17:13:58 -0000
@@ -417,6 +417,7 @@
     if (NS_SUCCEEDED(rv)) return NS_OK;
 
     PRBool externalProtocol = PR_FALSE;
+    PRBool useAnyExternal = PR_TRUE;
     nsCOMPtr<nsIPrefBranch> prefBranch;
     GetPrefBranch(getter_AddRefs(prefBranch));
     if (prefBranch) {
@@ -425,26 +426,34 @@
         rv = prefBranch->GetBoolPref(externalProtocolPref.get(), &externalProtocol);
         if (NS_FAILED(rv))
             externalProtocol = PR_FALSE;
+
+        rv = prefBranch->GetBoolPref("network.protocol-handler.useAnyExternal",
+                                     &useAnyExternal);
     }
 
+    nsresult gotHandler = NS_ERROR_UNEXPECTED;
+
     if (!externalProtocol) {
         nsCAutoString contractID(NS_NETWORK_PROTOCOL_CONTRACTID_PREFIX);
         contractID += scheme;
         ToLowerCase(contractID);
 
-        rv = CallGetService(contractID.get(), result);
+        gotHandler = CallGetService(contractID.get(), result);
     }
     
-    if (externalProtocol || NS_FAILED(rv)) 
+    if (externalProtocol || (NS_FAILED(gotHandler) && useAnyExternal))
     {
       // okay we don't have a protocol handler to handle this url type, so use the default protocol handler.
       // this will cause urls to get dispatched out to the OS ('cause we can't do anything with them) when 
       // we try to read from a channel created by the default protocol handler.
 
-      rv = CallGetService(NS_NETWORK_PROTOCOL_CONTRACTID_PREFIX"default",
+      gotHandler = CallGetService(
+                             NS_NETWORK_PROTOCOL_CONTRACTID_PREFIX"default",
                           result);
-      if (NS_FAILED(rv)) return NS_ERROR_UNKNOWN_PROTOCOL;
     }
+
+    if (NS_FAILED(gotHandler))
+        return NS_ERROR_UNKNOWN_PROTOCOL;
 
     CacheProtocolHandler(scheme, *result);
 
Index: netwerk/build/nsNetModule.cpp
===================================================================
RCS file: /cvsroot/mozilla/netwerk/build/nsNetModule.cpp,v
retrieving revision 1.67.8.2
diff -u -u -w -r1.67.8.2 nsNetModule.cpp
--- netwerk/build/nsNetModule.cpp	5 May 2002 17:55:18 -0000	1.67.8.2
+++ netwerk/build/nsNetModule.cpp	24 Aug 2002 17:13:58 -0000
@@ -976,6 +976,16 @@
       NS_ABOUT_MODULE_CONTRACTID_PREFIX "credits",
       nsAboutRedirector::Create
     },
+    { "about:licence",
+      NS_ABOUT_REDIRECTOR_MODULE_CID,
+      NS_ABOUT_MODULE_CONTRACTID_PREFIX "licence",
+      nsAboutRedirector::Create
+    },
+    { "about:welcome",
+      NS_ABOUT_REDIRECTOR_MODULE_CID,
+      NS_ABOUT_MODULE_CONTRACTID_PREFIX "welcome",
+      nsAboutRedirector::Create
+    },
     { "about:plugins",
       NS_ABOUT_REDIRECTOR_MODULE_CID,
       NS_ABOUT_MODULE_CONTRACTID_PREFIX "plugins",
Index: netwerk/protocol/about/src/nsAboutRedirector.cpp
===================================================================
RCS file: /cvsroot/mozilla/netwerk/protocol/about/src/nsAboutRedirector.cpp,v
retrieving revision 1.9.2.1
diff -u -u -w -r1.9.2.1 nsAboutRedirector.cpp
--- netwerk/protocol/about/src/nsAboutRedirector.cpp	10 Apr 2002 03:14:29 -0000	1.9.2.1
+++ netwerk/protocol/about/src/nsAboutRedirector.cpp	24 Aug 2002 17:13:59 -0000
@@ -66,12 +66,14 @@
   before adding new map entries with dropChromePrivs == PR_FALSE.
  */
 static RedirEntry kRedirMap[] = {
-    { "credits", "http://www.mozilla.org/credits/", PR_TRUE },
+    { "credits", "chrome://global/content/credits.html", PR_TRUE },
+    { "welcome", "chrome://communicator/locale/welcome.html", PR_TRUE },
+    { "licence", "chrome://global/locale/license.html", PR_TRUE },
     { "mozilla", "chrome://global/content/mozilla.html", PR_TRUE },
     { "plugins", "chrome://global/content/plugins.html", PR_TRUE },
     { "config", "chrome://global/content/config.xul", PR_FALSE }
 };
-static const int kRedirTotal = 4; // sizeof(kRedirMap)/sizeof(*kRedirMap)
+static const int kRedirTotal = 6; // sizeof(kRedirMap)/sizeof(*kRedirMap)
 
 NS_IMETHODIMP
 nsAboutRedirector::NewChannel(nsIURI *aURI, nsIChannel **result)
Index: netwerk/protocol/http/public/nsIHttpChannel.idl
===================================================================
RCS file: /cvsroot/mozilla/netwerk/protocol/http/public/nsIHttpChannel.idl,v
retrieving revision 1.8.2.2
diff -u -u -w -r1.8.2.2 nsIHttpChannel.idl
--- netwerk/protocol/http/public/nsIHttpChannel.idl	30 Apr 2002 01:11:01 -0000	1.8.2.2
+++ netwerk/protocol/http/public/nsIHttpChannel.idl	24 Aug 2002 17:13:59 -0000
@@ -42,17 +42,20 @@
     /**
      * Get/set the referrer URI on the request.  This is the address (URI) of
      * the resource from which this channel's URI was obtained (see RFC2616
-     * section 14.36).  The referrer type may be used to block the referrer
-     * from being sent in certain cases.
+     * section 14.36).  The referrer type may be used to block or modify the 
+     * referrer in certain cases.
      */
     readonly attribute nsIURI referrer;
     void setReferrer(in nsIURI referrer, in unsigned long referrerType);
 
     /* possible values for the referrerType */
     const unsigned long REFERRER_NONE = 0;
-    const unsigned long REFERRER_LINK_CLICK = 1; // http link clicks
-    const unsigned long REFERRER_INLINES = 2;    // images and other inlines
-    const unsigned long REFERRER_NON_HTTP = 3;   // e.g. news or FTP clicks
+    const unsigned long REFERRER_LINK_CLICK                 = 1;   /* http link clicks */
+    const unsigned long REFERRER_INLINES                    = 2;   /* images and other inlines */
+    const unsigned long REFERRER_NON_HTTP                   = 3;   /* e.g. news or FTP clicks */
+    const unsigned long REFERRER_SAME_HOST_ONLY             = 4;   /* Send the referrer only for requests from the same host, otherwise send no referrer. */
+    const unsigned long REFERRER_3RDPARTY_PREPATH           = 5;   /* Send the referrer only for requests from the same host, otherwise send target URI's pre-path as the referrer. */
+    const unsigned long REFERRER_PREPATH_URI_ALWAYS         = 6;   /* Always send the target URI's pre-path as the referrer. */
 
     /**
      * An http channel can own a reference to the document URI
Index: netwerk/protocol/http/src/nsHttpChannel.cpp
===================================================================
RCS file: /cvsroot/mozilla/netwerk/protocol/http/src/nsHttpChannel.cpp,v
retrieving revision 1.108.2.11
diff -u -u -w -r1.108.2.11 nsHttpChannel.cpp
--- netwerk/protocol/http/src/nsHttpChannel.cpp	8 Aug 2002 04:58:04 -0000	1.108.2.11
+++ netwerk/protocol/http/src/nsHttpChannel.cpp	24 Aug 2002 17:13:59 -0000
@@ -2435,87 +2435,127 @@
         "file",
         "mailbox",
         "imap",
+        "imaps",
         "news",
         "snews",
-        "imaps",
         "data",
         nsnull
     };
 
+
     NS_ENSURE_TRUE(!mIsPending, NS_ERROR_IN_PROGRESS);
 
-    if (nsHttpHandler::get()->ReferrerLevel() < referrerType)
+    // Clear the old referer first.
+    mRequestHead.SetHeader(nsHttp::Referer, NS_LITERAL_CSTRING(""));
+
+    PRUint8 referrerLevel = nsHttpHandler::get()->ReferrerLevel();
+
+    // Maintain compatability with the original (pre 1.0) usage of referrer levels.
+    if (referrerLevel == REFERRER_NONE || (referrerLevel <= REFERRER_NON_HTTP && referrerLevel < referrerType))
         return NS_OK;
 
-    // don't remember this referrer if it's on our black list....
-    if (referrer) {
-        PRBool match = PR_FALSE;
 
+    if (!referrer || !mURI)
+        return NS_ERROR_FAILURE;
+
+    // Don't send the referrer if it has a scheme in the above blacklist.
+    PRBool match = PR_FALSE;
         const char *const *scheme = invalidReferrerSchemes;
         for (; *scheme && !match; ++scheme)
             referrer->SchemeIs(*scheme, &match);
-
-        if (match)
-            return NS_OK; // kick out....
+    if (match) {
+        // If the user has configured the referrer override, force the referrer 
+        // type to send the target URI's pre-path (REFERRER_PREPATH_URI_ALWAYS), 
+        // even for schemes that normally wouldn't be allowed to send referrers.
+        if(nsHttpHandler::get()->ReferrerSchemeOverride())
+            referrerLevel = REFERRER_PREPATH_URI_ALWAYS;
+        else
+            return NS_OK;
     }
 
+
+    nsCAutoString referrerHost, host;
+    nsresult rv;
+
+    rv = referrer->GetAsciiHost(referrerHost);
+    if (NS_FAILED(rv))
+        return rv;
+    rv = mURI->GetAsciiHost(host);
+    if (NS_FAILED(rv)) 
+        return rv;
+
     // Handle secure referrals.
-    // Support referrals from a secure server if this is a secure site
+    // Support referrals from a secure server only if this is a secure site
     // and the host names are the same.
-    if (referrer) {
         PRBool isHTTPS = PR_FALSE;
         referrer->SchemeIs("https", &isHTTPS);
         if (isHTTPS) {
-            nsCAutoString referrerHost;
-            nsCAutoString host;
-
-            referrer->GetAsciiHost(referrerHost);
-            mURI->GetAsciiHost(host);
             mURI->SchemeIs("https", &isHTTPS);
 
-            if (!isHTTPS)
-                return NS_OK;
-
-            if ((nsCRT::strcasecmp(referrerHost.get(), host.get()) != 0) &&
+        if ((!isHTTPS || nsCRT::strcasecmp(referrerHost.get(), host.get()) != 0) &&
                 (!nsHttpHandler::get()->SendSecureXSiteReferrer()))
                 return NS_OK;
-
-        }
     }
 
+
     // save a copy of the referrer so we can return it if requested
     mReferrer = referrer;
 
     // save a copy of the referrer type for redirects
     mReferrerType = (PRUint8) referrerType;
 
-    // clear the old referer first
-    mRequestHead.SetHeader(nsHttp::Referer, NS_LITERAL_CSTRING(""));
-
-    if (referrer) {
-        nsCAutoString spec;
-        referrer->GetAsciiSpec(spec);
-        if (!spec.IsEmpty()) {
-            // strip away any userpass; we don't want to be giving out passwords ;-)
-            nsCAutoString userpass;
-            referrer->GetUserPass(userpass);
-            if (!userpass.IsEmpty()) {
-                // userpass is UTF8 encoded and spec is ASCII, so we might not find
-                // userpass as a substring of spec.
-                nsCOMPtr<nsIURI> clone;
-                nsresult rv = referrer->Clone(getter_AddRefs(clone));
-                if (NS_FAILED(rv)) return rv;
 
-                rv = clone->SetUserPass(NS_LITERAL_CSTRING(""));
-                if (NS_FAILED(rv)) return rv;
+    nsIURI *refPtr = referrer;
+    PRBool sendURIPath = PR_TRUE;
 
-                rv = clone->GetAsciiSpec(spec);
-                if (NS_FAILED(rv)) return rv;
+    switch(referrerLevel) {
+        // Send the referrer only for requests from the same host, otherwise send no referrer. 
+        case REFERRER_SAME_HOST_ONLY:
+            if (nsCRT::strcasecmp(referrerHost.get(), host.get()) == 0)
+                refPtr = referrer;  // Hosts match, so send the real referrer.
+            else 
+                return NS_OK;       // No match, send no referrer.
+        break;
+
+        // Send the referrer only for requests from the same host, otherwise send target URI's pre-path as the referrer.
+        case REFERRER_3RDPARTY_PREPATH:
+            if (nsCRT::strcasecmp(referrerHost.get(), host.get()) == 0)
+                refPtr = referrer;  // Hosts match, so send the real referrer.
+            else {
+                refPtr = mURI;      // Hosts do not match - send the target URI's pre-path.
+                sendURIPath = PR_FALSE;
+            }
+        break;
+
+        // Always send the target URI's pre-path as the referrer.
+        case REFERRER_PREPATH_URI_ALWAYS:
+            refPtr = mURI;
+            sendURIPath = PR_FALSE;
+        break;
             }
+
+
+    if (!refPtr)
+        return NS_ERROR_FAILURE;
+
+    nsCOMPtr<nsIURI> theReferrer;  
+    rv = refPtr->Clone(getter_AddRefs(theReferrer));
+    if (NS_FAILED(rv) || !theReferrer)
+        return rv;
+
+    // Never send usernames & passwords!
+    theReferrer->SetUserPass(NS_LITERAL_CSTRING(""));
+
+    if (!sendURIPath)
+        theReferrer->SetPath(NS_LITERAL_CSTRING(""));
+
+    // Set the referrer header.
+    nsCAutoString spec;
+    rv = theReferrer->GetAsciiSpec(spec);
+    if (NS_SUCCEEDED(rv))
             mRequestHead.SetHeader(nsHttp::Referer, spec);
-        }
-    }
-    return NS_OK;
+
+    return rv;
 }
 
 NS_IMETHODIMP
Index: netwerk/protocol/http/src/nsHttpHandler.cpp
===================================================================
RCS file: /cvsroot/mozilla/netwerk/protocol/http/src/nsHttpHandler.cpp,v
retrieving revision 1.54.2.5
diff -u -u -w -r1.54.2.5 nsHttpHandler.cpp
--- netwerk/protocol/http/src/nsHttpHandler.cpp	8 Jun 2002 17:08:26 -0000	1.54.2.5
+++ netwerk/protocol/http/src/nsHttpHandler.cpp	24 Aug 2002 17:13:59 -0000
@@ -104,7 +104,8 @@
     , mProxyHttpVersion(NS_HTTP_VERSION_1_1)
     , mCapabilities(NS_HTTP_ALLOW_KEEPALIVE)
     , mProxyCapabilities(NS_HTTP_ALLOW_KEEPALIVE)
-    , mReferrerLevel(0xff) // by default we always send a referrer
+    , mReferrerLevel(2)    // 2 == REFERRER_INLINES - by default, always send the referrer
+    , mReferrerSchemeOverride(PR_FALSE)
     , mIdleTimeout(10)
     , mMaxRequestAttempts(10)
     , mMaxRequestDelay(10)
@@ -1188,36 +1189,15 @@
     OSVERSIONINFO info = { sizeof OSVERSIONINFO };
     if (GetVersionEx(&info)) {
         if (info.dwPlatformId == VER_PLATFORM_WIN32_NT) {
-            if (info.dwMajorVersion      == 3)
-                mOscpu.Adopt(nsCRT::strdup("WinNT3.51"));
-            else if (info.dwMajorVersion == 4)
-                mOscpu.Adopt(nsCRT::strdup("WinNT4.0"));
-            else {
-                char *buf = PR_smprintf("Windows NT %ld.%ld",
-                                        info.dwMajorVersion,
-                                        info.dwMinorVersion);
-                if (buf) {
-                    mOscpu.Adopt(nsCRT::strdup(buf));
-                    PR_smprintf_free(buf);
-                }
-            }
+          mOscpu.Adopt(nsCRT::strdup("WinNT"));
         } else if (info.dwPlatformId == VER_PLATFORM_WIN32_WINDOWS &&
                    info.dwMajorVersion == 4) {
-            if (info.dwMinorVersion == 90)
-                mOscpu.Adopt(nsCRT::strdup("Win 9x 4.90"));  // Windows Me
-            else if (info.dwMinorVersion > 0)
-                mOscpu.Adopt(nsCRT::strdup("Win98"));
-            else
-                mOscpu.Adopt(nsCRT::strdup("Win95"));
+          mOscpu.Adopt(nsCRT::strdup("Win9x"));
         } else {
-            char *buf = PR_smprintf("Windows %ld.%ld",
-                                    info.dwMajorVersion,
-                                    info.dwMinorVersion);
-            if (buf) {
-                mOscpu.Adopt(nsCRT::strdup(buf));
-                PR_smprintf_free(buf);
-            }
+          mOscpu.Adopt(nsCRT::strdup("Win"));
         }
+    } else {
+      mOscpu.Adopt(nsCRT::strdup("Win"));
     }
 #elif defined (XP_UNIX) || defined (XP_BEOS)
     struct utsname name;
@@ -1246,6 +1226,7 @@
 {
     nsresult rv = NS_OK;
     PRInt32 val;
+    PRBool cVar = PR_FALSE;
 
     LOG(("nsHttpHandler::PrefsChanged [pref=%s]\n", pref));
 
@@ -1303,20 +1284,8 @@
         mUserAgentIsDirty = PR_TRUE;
     }
 
-    // Gather locale.
-    if (PREF_CHANGED(UA_PREF("locale"))) {
-        nsCOMPtr<nsIPrefLocalizedString> pls;
-        prefs->GetComplexValue(UA_PREF("locale"),
-                                NS_GET_IID(nsIPrefLocalizedString),
-                                getter_AddRefs(pls));
-        if (pls) {
-            nsXPIDLString uval;
-            pls->ToString(getter_Copies(uval));
-            if (uval)
-                mLanguage.Adopt(ToNewUTF8String(nsDependentString(uval)));
-        } 
-        mUserAgentIsDirty = PR_TRUE;
-    }
+    // Set locale.
+    mLanguage.Adopt(nsCRT::strdup("en"));
 
     // general.useragent.override
     if (PREF_CHANGED(UA_PREF("override"))) {
@@ -1377,6 +1346,12 @@
             mReferrerLevel = (PRUint8) CLAMP(val, 0, 0xff);
     }
 
+    if (PREF_CHANGED(HTTP_PREF("referrerSchemeOverride"))) {
+        rv = prefs->GetBoolPref(HTTP_PREF("referrerSchemeOverride"), &cVar);
+        if (NS_SUCCEEDED(rv))
+            mReferrerSchemeOverride = cVar;
+    }
+
     if (PREF_CHANGED(HTTP_PREF("redirection-limit"))) {
         rv = prefs->GetIntPref(HTTP_PREF("redirection-limit"), &val);
         if (NS_SUCCEEDED(rv))
@@ -1407,8 +1382,6 @@
             // it does not make sense to issue a HTTP/0.9 request to a proxy server
         }
     }
-
-    PRBool cVar = PR_FALSE;
 
     if (PREF_CHANGED(HTTP_PREF("keep-alive"))) {
         rv = prefs->GetBoolPref(HTTP_PREF("keep-alive"), &cVar);
Index: netwerk/protocol/http/src/nsHttpHandler.h
===================================================================
RCS file: /cvsroot/mozilla/netwerk/protocol/http/src/nsHttpHandler.h,v
retrieving revision 1.25.2.3
diff -u -u -w -r1.25.2.3 nsHttpHandler.h
--- netwerk/protocol/http/src/nsHttpHandler.h	8 Jun 2002 17:03:29 -0000	1.25.2.3
+++ netwerk/protocol/http/src/nsHttpHandler.h	24 Aug 2002 17:13:59 -0000
@@ -90,6 +90,7 @@
     nsHttpVersion  HttpVersion()             { return mHttpVersion; }
     nsHttpVersion  ProxyHttpVersion()        { return mProxyHttpVersion; }
     PRUint8        ReferrerLevel()           { return mReferrerLevel; }
+    PRBool         ReferrerSchemeOverride()  { return mReferrerSchemeOverride; }
     PRBool         SendSecureXSiteReferrer() { return mSendSecureXSiteReferrer; }
     PRUint8        RedirectionLimit()        { return mRedirectionLimit; }
     PRUint16       IdleTimeout()             { return mIdleTimeout; }
@@ -258,10 +259,11 @@
     //
 
     PRUint8  mHttpVersion;
+    PRUint8  mReferrerLevel;
+    PRPackedBool mReferrerSchemeOverride;
     PRUint8  mProxyHttpVersion;
     PRUint8  mCapabilities;
     PRUint8  mProxyCapabilities;
-    PRUint8  mReferrerLevel;
 
     PRUint16 mIdleTimeout;
     PRUint16 mMaxRequestAttempts;
Index: netwerk/streamconv/converters/mozTXTToHTMLConv.cpp
===================================================================
RCS file: /cvsroot/mozilla/netwerk/streamconv/converters/mozTXTToHTMLConv.cpp,v
retrieving revision 1.57.4.3
diff -u -u -w -r1.57.4.3 mozTXTToHTMLConv.cpp
--- netwerk/streamconv/converters/mozTXTToHTMLConv.cpp	21 May 2002 20:17:42 -0000	1.57.4.3
+++ netwerk/streamconv/converters/mozTXTToHTMLConv.cpp	24 Aug 2002 17:14:00 -0000
@@ -220,7 +220,9 @@
          aInString[PRUint32(i)] == '.'
          ); i--)
       ;
-    if (++i >= 0 && i < pos && nsCRT::IsAsciiAlpha(aInString[PRUint32(i)]))
+    if (++i >= 0
+        && i < PRInt32(pos)
+        && nsCRT::IsAsciiAlpha(aInString[PRUint32(i)]))
     {
       start = PRUint32(i);
       return PR_TRUE;
@@ -243,7 +245,8 @@
       ;
     if
       (
-        ++i >= 0 && i < pos
+        ++i >= 0
+        && i < PRInt32(pos)
           &&
           (
             nsCRT::IsAsciiAlpha(aInString[PRUint32(i)]) ||
@@ -1123,7 +1126,8 @@
 }
 
 void
-mozTXTToHTMLConv::ScanHTML(nsString& aInString, PRUint32 whattodo, nsString &aOutString)
+mozTXTToHTMLConv::ScanHTML(nsString& aInString, PRUint32 whattodo,
+                           nsString &aOutString)
 { 
   // some common variables we were recalculating
   // every time inside the for loop...
@@ -1138,7 +1142,7 @@
   /* Skip all tags ("<[...]>") and content in an a tag ("<a[...]</a>")
      or in a tag ("<!--[...]-->").
      Unescape the rest (text between tags) and pass it to ScanTXT. */
-  for (PRInt32 i = 0; PRUint32(i) < lengthOfInString;)
+  for (PRInt32 i = 0; i < lengthOfInString;)
   {
     if (aInString[i] == '<')  // html tag
     {
Index: netwerk/streamconv/public/mozITXTToHTMLConv.idl
===================================================================
RCS file: /cvsroot/mozilla/netwerk/streamconv/public/mozITXTToHTMLConv.idl,v
retrieving revision 1.4.16.1
diff -u -u -w -r1.4.16.1 mozITXTToHTMLConv.idl
--- netwerk/streamconv/public/mozITXTToHTMLConv.idl	10 Apr 2002 03:15:45 -0000	1.4.16.1
+++ netwerk/streamconv/public/mozITXTToHTMLConv.idl	24 Aug 2002 17:14:00 -0000
@@ -24,7 +24,7 @@
  * License for the specific language governing rights and limitations
  * under the License.
  * 
- * The Original Code is the Text to HTML converter code.
+ * The Original Code is the Mozilla Text to HTML converter code.
  * 
  * The Initial Developer of the Original Code is Ben Bucksch
  * <http://www.bucksch.org>. Portions created by Ben Bucksch are Copyright
Index: profile/defaults/bookmarks.html
===================================================================
RCS file: /cvsroot/mozilla/profile/defaults/bookmarks.html,v
retrieving revision 1.10.28.1
diff -u -u -w -r1.10.28.1 bookmarks.html
--- profile/defaults/bookmarks.html	10 Apr 2002 03:21:54 -0000	1.10.28.1
+++ profile/defaults/bookmarks.html	24 Aug 2002 17:14:01 -0000
@@ -7,66 +7,16 @@
 <H1>Bookmarks</H1>
 
 <DL><p>
-    <DT><H3 ADD_DATE="961112773" LAST_MODIFIED="0" PERSONAL_TOOLBAR_FOLDER="true" ID="NC:PersonalToolbarFolder">Personal Toolbar Folder</H3>
+    <DT><H3 PERSONAL_TOOLBAR_FOLDER="true" ID="NC:PersonalToolbarFolder">Personal Toolbar Folder</H3>
     <DL><p>
-        <DT><A HREF="http://www.mozilla.org/" ADD_DATE="961112911" LAST_VISIT="0" LAST_MODIFIED="0" LAST_CHARSET="ISO-8859-1">mozilla.org</A>
-        <DT><A HREF="http://ftp.mozilla.org/pub/mozilla/nightly/latest/" ADD_DATE="961112935" LAST_VISIT="0" LAST_MODIFIED="0" LAST_CHARSET="ISO-8859-1">Latest Builds</A>
-    </DL><p>
-    <HR>
-    <DT><H3 ADD_DATE="961099767" LAST_MODIFIED="0">Mozilla Project</H3>
-    <DL><p>
-        <DT><H3 ADD_DATE="961099767" LAST_MODIFIED="0" ID="NC:BookmarksRoot#$7a37f5df">mozilla.org</H3>
-        <DL><p>
-            <DT><A HREF="http://www.mozilla.org/" ADD_DATE="961099870" LAST_VISIT="0" LAST_MODIFIED="0" LAST_CHARSET="ISO-8859-1">The Mozilla Organization</A>
-            <DT><A HREF="http://www.mozilla.org/status/" ADD_DATE="961099993" LAST_VISIT="0" LAST_MODIFIED="0" LAST_CHARSET="ISO-8859-1">Weekly Status Update</A>
-            <DT><A HREF="http://www.mozilla.org/feedback.html" ADD_DATE="961100017" LAST_VISIT="0" LAST_MODIFIED="0" LAST_CHARSET="ISO-8859-1">Feedback</A>
-        </DL><p>
-        <DT><H3 ADD_DATE="961102203" LAST_MODIFIED="0" ID="NC:BookmarksRoot#$b742f58">Developer Information</H3>
-        <DL><p>
-            <DT><A HREF="http://www.mozilla.org/get-involved.html" ADD_DATE="961102879">Getting Involved</A>
-            <DT><A HREF="http://www.mozilla.org/docs/" ADD_DATE="961102901">Documentation</A>
-            <DT><A HREF="http://www.mozilla.org/source.html" ADD_DATE="961105505" LAST_VISIT="0" LAST_MODIFIED="0" LAST_CHARSET="ISO-8859-1">Download Source Code</A>
-            <DT><H3 ADD_DATE="961102925" LAST_MODIFIED="0" ID="NC:BookmarksRoot#$b742f59">Standards</H3>
-            <DL><p>
-                <DT><A HREF="http://www.w3c.org/" ADD_DATE="961102978">World Wide Web Consortium</A>
-                <DT><A HREF="http://www.faqs.org/rfcs/" ADD_DATE="961104168">RFC Archive</A>
-            </DL><p>
-            <DT><H3 ADD_DATE="961103100" LAST_MODIFIED="0" ID="NC:BookmarksRoot#$b742f5b">User interface design</H3>
-            <DL><p>
-                <DT><A HREF="http://developer.apple.com/techpubs/mac/HIGuidelines/HIGuidelines-2.html" ADD_DATE="961104987">Macintosh Human Interface Guidelines</A>
-                <DT><A HREF="http://www-3.ibm.com/ibm/easy/eou_ext.nsf/Publish/561" ADD_DATE="961105043">IBM/Ease of Use/Design</A>
-                <DT><A HREF="http://msdn.microsoft.com/ui/" ADD_DATE="961104948">Microsoft User Experience and Interface Design Resources</A>
-                <DT><A HREF="http://developer.kde.org/documentation/standards/kde/style/basics/" ADD_DATE="961105043">KDE User Interface Guidelines</A>
-            </DL><p>
-        </DL><p>
-        <DT><H3 ADD_DATE="961105105" LAST_MODIFIED="0" ID="NC:BookmarksRoot#$b8619366">Webtools</H3>
-        <DL><p>
-            <DT><A HREF="http://lxr.mozilla.org/" ADD_DATE="961105149" LAST_VISIT="0" LAST_MODIFIED="0" LAST_CHARSET="ISO-8859-1">lxr - Mozilla Cross-Reference</A>
-            <DT><A HREF="http://bonsai.mozilla.org/" ADD_DATE="961105218" LAST_MODIFIED="0">bonsai - CVS Tree Control</A>
-            <DT><A HREF="http://tinderbox.mozilla.org/showbuilds.cgi" ADD_DATE="961105359">tinderbox - Tree Status</A>
-            <DT><A HREF="http://bugzilla.mozilla.org/" ADD_DATE="961105401">bugzilla - Bug-Tracking System</A>
-        </DL><p>
-        <DT><H3 ADD_DATE="961111855" LAST_MODIFIED="0" ID="NC:BookmarksRoot#$ebf1a63">Community</H3>
-        <DL><p>
-            <DT><A HREF="http://www.mozilla.org/community.html" ADD_DATE="961111887" LAST_VISIT="0" LAST_MODIFIED="0">Newsgroups</A>
-            <DT><A HREF="http://www.mozillazine.org/" ADD_DATE="961111887" LAST_VISIT="0" LAST_MODIFIED="0" LAST_CHARSET="ISO-8859-1">MozillaZine</A>
-            <DT><A HREF="http://www.mozdev.org/" ADD_DATE="961112176" LAST_VISIT="0" LAST_MODIFIED="0" LAST_CHARSET="ISO-8859-1">Alphanumerica's Mozilla Development Projects</A>
-            <DT><A HREF="http://www.gerbilbox.com/newzilla/" ADD_DATE="961112731">NewZilla - the Unofficial Netscape 6 and Mozilla FAQ</A>
-        </DL><p>
-        <DT><H3 ADD_DATE="961106554" LAST_MODIFIED="0" ID="NC:BookmarksRoot#$ebf1a62">Third-Party Tools</H3>
-        <DL><p>
-            <DT><A HREF="http://aphrodite.mozdev.org/total_recall.html" ADD_DATE="961106831">Crash Recovery - Alphanumerica's Total Recall</A>
-        </DL><p>
-        <DT><H3 ADD_DATE="968309291">Technology Demonstration</H3>
-        <DL><p>
-            <DT><H3 ADD_DATE="916354466">SmartFind queries</H3>
-            <DL><p>
-    	    <DT><A HREF="find:datasource=rdf:bookmarks&match=http://home.netscape.com/NC-rdf#Name&method=contains&text=Mozilla" ADD_DATE="0" LAST_VISIT="0" LAST_MODIFIED="0">Bookmark Names containing 'Mozilla'</A>
-    	    <DT><A HREF="find:datasource=rdf:bookmarks&match=http://home.netscape.com/NC-rdf#Name&method=startswith&text=M" ADD_DATE="0" LAST_VISIT="0" LAST_MODIFIED="0">Bookmark Names starting with 'M'</A>
-    	    <DT><A HREF="find:datasource=rdf:bookmarks&match=http://home.netscape.com/NC-rdf#Name&method=endswith&text=Reference" ADD_DATE="0" LAST_VISIT="0" LAST_MODIFIED="0">Bookmark Names ending with 'Reference'</A>
-    	    <DT><A HREF="find:datasource=rdf:bookmarks&match=http://home.netscape.com/NC-rdf#URL&method=contains&text=.org" ADD_DATE="0" LAST_VISIT="0" LAST_MODIFIED="0">Bookmark URLs containing '.org'</A>
-            </DL><p>
-        </DL><p>
+        <DT><A HREF="http://www.beonex.com">Beonex</A>
     </DL><p>
     <HR>
+<!--
+    <DT><A HREF="http://www.beonex.com/communicator/version/0.8/release-notes/security-alert/latest" ADD_DATE="994541583" LAST_MODIFIED="994541824" SCHEDULE="0123456|0-24|1440|icon,sound,open" LAST_PING="994541639" PING_ETAG=""122824-512-3b42dbcb"" PING_LAST_MODIFIED="Wed, 04 Jul 2001 09:03:07 GMT" LAST_CHARSET="ISO-8859-1" PING_CONTENT_LEN="1298">Beonex Communicator Security Alert</A>
+<DD>This bookmark notifies you when
+Beonex releases a new security alert.
+See the &quot;Disable&quot; link on that page
+for more information.
+-->
 </DL><p>
Index: profile/defaults/localstore.rdf
===================================================================
RCS file: /cvsroot/mozilla/profile/defaults/localstore.rdf,v
retrieving revision 1.14.8.1
diff -u -u -w -r1.14.8.1 localstore.rdf
--- profile/defaults/localstore.rdf	10 Apr 2002 03:21:54 -0000	1.14.8.1
+++ profile/defaults/localstore.rdf	24 Aug 2002 17:14:01 -0000
@@ -1,107 +1,254 @@
 <?xml version="1.0"?>
-<RDF:RDF
-     xmlns:NC="http://home.netscape.com/NC-rdf#"
+<RDF:RDF xmlns:NC="http://home.netscape.com/NC-rdf#"
      xmlns:RDF="http://www.w3.org/1999/02/22-rdf-syntax-ns#">
-  <RDF:Description about="chrome://messenger/content/messenger.xul#flaggedCol">
-    <hidden>true</hidden>
-  </RDF:Description>
-  <RDF:Description about="chrome://messenger/content/messenger.xul#unreadCol">
-    <hidden>true</hidden>
-  </RDF:Description>
-  <RDF:Description about="chrome://messenger/content/messenger.xul#totalCol">
-    <hidden>true</hidden>
-  </RDF:Description>
-  <RDF:Description about="chrome://messenger/content/messenger.xul#OrderReceivedColumn">
-    <hidden>true</hidden>
-  </RDF:Description>
-  <RDF:Description about="chrome://messenger/content/messenger.xul#statusCol">
-    <hidden>true</hidden>
-  </RDF:Description>
-  <RDF:Description about="chrome://messenger/content/messenger.xul#sizeCol">
-    <hidden>true</hidden>
+  <RDF:Description about="chrome://navigator/content/navigator.xul#main-window"
+                   sizemode="normal" />
+  <RDF:Description about="chrome://editor/content/editor.xul#editorWindow"
+                   sizemode="normal" />
+  <RDF:Description about="chrome://messenger/content/addressbook/addressbook.xul#addressbookWindow"
+                   sizemode="normal" />
+  <RDF:Description about="chrome://messenger/content/messenger.xul#messengerWindow"
+                   sizemode="normal" />
+  <RDF:Description about="chrome://chatzilla/content/chatzilla.xul#chatzilla-window" />
+  <RDF:Description about="chrome://messenger/content/AccountWizard.xul#AccountWizard" />
+
+<!--what's above is hand-edited -->
+
+  <RDF:Description about="chrome://navigator/content/navigator.xul">
+    <NC:persist resource="chrome://navigator/content/navigator.xul#print-button"/>
+    <NC:persist resource="chrome://navigator/content/navigator.xul#main-window"/>
+    <NC:persist resource="chrome://navigator/content/navigator.xul#PersonalToolbar"/>
+    <NC:persist resource="chrome://navigator/content/navigator.xul#cmd_viewpersonaltoolbar"/>
+    <NC:persist resource="chrome://navigator/content/navigator.xul#sidebar-panels"/>
+    <NC:persist resource="chrome://navigator/content/navigator.xul#sidebar-splitter"/>
+    <NC:persist resource="chrome://navigator/content/navigator.xul#sidebar-box"/>
+    <NC:persist resource="chrome://navigator/content/navigator.xul#sidebar-title-box"/>
+    <NC:persist resource="chrome://navigator/content/navigator.xul#sidebar-panels-splitter-box"/>
+    <NC:persist resource="chrome://navigator/content/navigator.xul#bookmarks-button"/>
+    <NC:persist resource="chrome://navigator/content/navigator.xul#linktoolbar"/>
+  </RDF:Description>
+  <RDF:Description about="chrome://messenger/content/messenger.xul#statusCol"
+                   hidden="true"
+                   ordinal="13" />
+  <RDF:Description about="chrome://messenger/content/AccountWizard.xul">
+    <NC:persist resource="chrome://messenger/content/AccountWizard.xul#AccountWizard"/>
+  </RDF:Description>
+  <RDF:Description about="chrome://messenger/content/addressbook/addressbook.xul#FaxNumber"
+                   ordinal="13"
+                   hidden="true" />
+  <RDF:Description about="chrome://editor/content/editor.xul#taskbar"
+                   hidden="true" />
+  <RDF:Description about="chrome://messenger/content/messengercompose/messengercompose.xul#menu_showTaskbar"
+                   checked="false" />
+  <RDF:Description about="chrome://messenger/content/messenger.xul#subjectCol"
+                   ordinal="5" />
+  <RDF:Description about="chrome://messenger/content/messageWindow.xul#taskbar"
+                   hidden="true" />
+  <RDF:Description about="chrome://messenger/content/messenger.xul#menu_showTaskbar"
+                   checked="false" />
+  <RDF:Description about="chrome://messenger/content/addressbook/addressbook.xul#WorkPhone"
+                   ordinal="5" />
+  <RDF:Description about="chrome://messenger/content/addressbook/addressbook.xul#abResultsOutliner"
+                   height="94" />
+  <RDF:Description about="chrome://messenger/content/messenger.xul#labelCol"
+                   hidden="true"
+                   ordinal="19" />
+  <RDF:Description about="chrome://messenger/content/addressbook/addressbook.xul#CellularNumber"
+                   ordinal="17"
+                   hidden="true" />
+  <RDF:Description about="chrome://messenger/content/messengercompose/messengercompose.xul">
+    <NC:persist resource="chrome://messenger/content/messengercompose/messengercompose.xul#taskbar"/>
+    <NC:persist resource="chrome://messenger/content/messengercompose/messengercompose.xul#menu_showTaskbar"/>
+  </RDF:Description>
+  <RDF:Description about="chrome://messenger/content/messenger.xul#taskbar"
+                   hidden="true" />
+  <RDF:Description about="chrome://editor/content/editor.xul#sidebar-title-box"
+                   hidden="true" />
+  <RDF:Description about="chrome://messenger/content/addressbook/addressbook.xul#Company"
+                   ordinal="7" />
+  <RDF:Description about="chrome://navigator/content/navigator.xul#bookmarks-button"
+                   hidden="true" />
+  <RDF:Description about="chrome://messenger/content/messenger.xul#sidebar-title-box"
+                   hidden="true" />
+  <RDF:Description about="chrome://messenger/content/messageWindow.xul">
+    <NC:persist resource="chrome://messenger/content/messageWindow.xul#taskbar"/>
+    <NC:persist resource="chrome://messenger/content/messageWindow.xul#menu_showTaskbar"/>
+  </RDF:Description>
+  <RDF:Description about="chrome://messenger/content/addressbook/addressbook.xul#sidebar-panels-splitter-box"
+                   hidden="true" />
+  <RDF:Description about="chrome://editor/content/editor.xul#sidebar-panels-splitter-box"
+                   hidden="true" />
+  <RDF:Description about="chrome://navigator/content/navigator.xul#sidebar-box"
+                   state="open"
+                   hidden="true"
+                   width="190" />
+  <RDF:Description about="chrome://navigator/content/navigator.xul#component-bar"
+                   hidden="true" />
+  <RDF:Description about="chrome://messenger/content/messenger.xul#priorityCol"
+                   ordinal="21" />
+  <RDF:Description about="chrome://navigator/content/navigator.xul#cmd_viewcomponentbar"
+                   checked="false" />
+  <RDF:Description about="chrome://messenger/content/messenger.xul#OrderReceivedColumn"
+                   hidden="true" />
+  <RDF:Description about="chrome://navigator/content/navigator.xul#linktoolbar"
+                   hidden="maybe" />
+  <RDF:Description about="chrome://messenger/content/addressbook/addressbook.xul#SecondEmail"
+                   ordinal="19"
+                   hidden="true" />
+  <RDF:Description about="chrome://messenger/content/messenger.xul#totalCol"
+                   hidden="true"
+                   ordinal="25" />
+  <RDF:Description about="chrome://chatzilla/content/chatzilla.xul">
+    <NC:persist resource="chrome://chatzilla/content/chatzilla.xul#chatzilla-window"/>
+  </RDF:Description>
+  <RDF:Description about="chrome://messenger/content/addressbook/addressbook.xul#HomePhone"
+                   ordinal="11"
+                   hidden="true" />
+  <RDF:Description about="chrome://messenger/content/messenger.xul#flaggedCol"
+                   hidden="true"
+                   ordinal="17" />
+  <RDF:Description about="chrome://messenger/content/messenger.xul#unreadCol"
+                   hidden="true"
+                   ordinal="23" />
+  <RDF:Description about="chrome://navigator/content/navigator.xul#sidebar-splitter"
+                   state="open"
+                   hidden="true" />
+  <RDF:Description about="chrome://messenger/content/addressbook/addressbook.xul#GeneratedName"
+                   ordinal="1" />
+  <RDF:Description about="chrome://messenger/content/messenger.xul#senderOrRecipientCol"
+                   ordinal="7" />
+  <RDF:Description about="mailbox://browser@etzu"
+                   open="true" />
+  <RDF:Description about="chrome://navigator/content/navigator.xul#sidebar-panels"
+                   last-selected-panel="urn:sidebar:panel:search" />
+  <RDF:Description about="chrome://messenger/content/messenger.xul#StatusColumn"
+                   hidden="true" />
+  <RDF:Description about="chrome://navigator/content/navigator.xul#PersonalToolbar"
+                   hidden="true" />
+  <RDF:Description about="chrome://editor/content/editor.xul#sidebar-splitter"
+                   hidden="true" />
+  <RDF:Description about="chrome://navigator/content/navigator.xul#cmd_viewpersonaltoolbar"
+                   checked="false" />
+  <RDF:Description about="chrome://navigator/content/navigator.xul#status-bar"
+                   hidden="false" />
+  <RDF:Description about="chrome://editor/content/editor.xul">
+    <NC:persist resource="chrome://editor/content/editor.xul#sidebar-panels"/>
+    <NC:persist resource="chrome://editor/content/editor.xul#main-window"/>
+    <NC:persist resource="chrome://editor/content/editor.xul#sidebar-box"/>
+    <NC:persist resource="chrome://editor/content/editor.xul#sidebar-splitter"/>
+    <NC:persist resource="chrome://editor/content/editor.xul#sidebar-title-box"/>
+    <NC:persist resource="chrome://editor/content/editor.xul#sidebar-panels-splitter-box"/>
+    <NC:persist resource="chrome://editor/content/editor.xul#taskbar"/>
+    <NC:persist resource="chrome://editor/content/editor.xul#cmd_viewtaskbar"/>
+    <NC:persist resource="chrome://editor/content/editor.xul#editorWindow"/>
   </RDF:Description>
   <RDF:Description about="chrome://messenger/content/addressbook/addressbook.xul">
-    <NC:persist resource="chrome://messenger/content/addressbook/addressbook.xul#abResultsOutliner"/>
-    <NC:persist resource="chrome://messenger/content/addressbook/addressbook.xul#sidebar-panels-splitter-box"/>
+    <NC:persist resource="chrome://messenger/content/addressbook/addressbook.xul#sidebar-panels"/>
+    <NC:persist resource="chrome://messenger/content/addressbook/addressbook.xul#addressbookWindow"/>
     <NC:persist resource="chrome://messenger/content/addressbook/addressbook.xul#sidebar-title-box"/>
-  </RDF:Description>
-  <RDF:Description about="chrome://messenger/content/addressbook/addressbook.xul#abResultsOutliner" height="94" />
-  <RDF:Description about="chrome://messenger/content/addressbook/addressbook.xul#sidebar-panels-splitter-box">
-    <collapsed>true</collapsed>
-  </RDF:Description>
-  <RDF:Description about="chrome://messenger/content/addressbook/addressbook.xul#sidebar-title-box">
-    <hidden>true</hidden>
-  </RDF:Description>
+    <NC:persist resource="chrome://messenger/content/addressbook/addressbook.xul#sidebar-panels-splitter-box"/>
+    <NC:persist resource="chrome://messenger/content/addressbook/addressbook.xul#sidebar-box"/>
+    <NC:persist resource="chrome://messenger/content/addressbook/addressbook.xul#taskbar"/>
+    <NC:persist resource="chrome://messenger/content/addressbook/addressbook.xul#menu_showTaskbar"/>
+    <NC:persist resource="chrome://messenger/content/addressbook/addressbook.xul#abResultsOutliner"/>
+    <NC:persist resource="chrome://messenger/content/addressbook/addressbook.xul#GeneratedName"/>
+    <NC:persist resource="chrome://messenger/content/addressbook/addressbook.xul#PrimaryEmail"/>
+    <NC:persist resource="chrome://messenger/content/addressbook/addressbook.xul#WorkPhone"/>
+    <NC:persist resource="chrome://messenger/content/addressbook/addressbook.xul#Company"/>
+    <NC:persist resource="chrome://messenger/content/addressbook/addressbook.xul#NickName"/>
+    <NC:persist resource="chrome://messenger/content/addressbook/addressbook.xul#HomePhone"/>
+    <NC:persist resource="chrome://messenger/content/addressbook/addressbook.xul#FaxNumber"/>
+    <NC:persist resource="chrome://messenger/content/addressbook/addressbook.xul#PagerNumber"/>
+    <NC:persist resource="chrome://messenger/content/addressbook/addressbook.xul#CellularNumber"/>
+    <NC:persist resource="chrome://messenger/content/addressbook/addressbook.xul#SecondEmail"/>
+    <NC:persist resource="chrome://messenger/content/addressbook/addressbook.xul#JobTitle"/>
+    <NC:persist resource="chrome://messenger/content/addressbook/addressbook.xul#Department"/>
+  </RDF:Description>
+  <RDF:Description about="chrome://messenger/content/messageWindow.xul#menu_showTaskbar"
+                   checked="false" />
+  <RDF:Description about="chrome://messenger/content/messenger.xul#dateCol"
+                   ordinal="11" />
+  <RDF:Description about="chrome://messenger/content/messengercompose/messengercompose.xul#taskbar"
+                   hidden="true" />
+  <RDF:Description about="chrome://messenger/content/messenger.xul#threadCol"
+                   ordinal="1" />
+  <RDF:Description about="chrome://navigator/content/navigator.xul#cmd_viewtaskbar"
+                   checked="false" />
+  <RDF:Description about="chrome://messenger/content/addressbook/addressbook.xul#JobTitle"
+                   ordinal="21"
+                   hidden="true" />
+  <RDF:Description about="chrome://messenger/content/addressbook/addressbook.xul#PrimaryEmail"
+                   ordinal="3" />
+  <RDF:Seq about="nc:urlbar-history">
+  </RDF:Seq>
+  <RDF:Description about="chrome://messenger/content/messenger.xul#folderTotalCol"
+                   hidden="true" />
+  <RDF:Description about="chrome://messenger/content/addressbook/addressbook.xul#PagerNumber"
+                   ordinal="15"
+                   hidden="true" />
+  <RDF:Description about="chrome://messenger/content/messenger.xul#sidebar-panels-splitter-box"
+                   height="288"
+                   hidden="true" />
+  <RDF:Description about="chrome://messenger/content/addressbook/addressbook.xul#Department"
+                   ordinal="23"
+                   hidden="true" />
+  <RDF:Description about="chrome://messenger/content/addressbook/addressbook.xul#sidebar-title-box"
+                   hidden="true" />
+  <RDF:Description about="chrome://messenger/content/addressbook/addressbook.xul#NickName"
+                   ordinal="9"
+                   hidden="true" />
+  <RDF:Description about="chrome://navigator/content/navigator.xul#print-button"
+                   hidden="true" />
   <RDF:Description about="chrome://messenger/content/messenger.xul">
-    <NC:persist resource="chrome://messenger/content/messenger.xul#statusCol"/>
-    <NC:persist resource="chrome://messenger/content/messenger.xul#sizeCol"/>
-    <NC:persist resource="chrome://messenger/content/messenger.xul#unreadCol"/>
-    <NC:persist resource="chrome://messenger/content/messenger.xul#totalCol"/>
+    <NC:persist resource="chrome://messenger/content/messenger.xul#StatusColumn"/>
+    <NC:persist resource="chrome://messenger/content/messenger.xul#SizeColumn"/>
+    <NC:persist resource="chrome://messenger/content/messenger.xul#UnreadColumn"/>
+    <NC:persist resource="chrome://messenger/content/messenger.xul#TotalColumn"/>
     <NC:persist resource="chrome://messenger/content/messenger.xul#OrderReceivedColumn"/>
-    <NC:persist resource="chrome://messenger/content/messenger.xul#flaggedCol"/>
+    <NC:persist resource="chrome://messenger/content/messenger.xul#FlaggedButtonColumn"/>
     <NC:persist resource="chrome://messenger/content/messenger.xul#messengerWindow"/>
     <NC:persist resource="chrome://messenger/content/messenger.xul#sidebar-panels"/>
     <NC:persist resource="chrome://messenger/content/messenger.xul#sidebar-panels-splitter-box"/>
-    <NC:persist resource="chrome://messenger/content/messenger.xul#threadOutliner"/>
-  </RDF:Description>
-  <RDF:Description about="chrome://messenger/content/messenger.xul#messengerWindow">
-    <screenX>4</screenX>
-    <screenY>4</screenY>
-    <width>632</width>
-    <height>450</height>
-  </RDF:Description>
-  <RDF:Description about="chrome://messenger/content/messenger.xul#sidebar-panels">
-    <last-selected-panel>urn:sidebar:panel:bookmarks</last-selected-panel>
-    <hidden>true</hidden>
-  </RDF:Description>
-  <RDF:Description about="chrome://messenger/content/messenger.xul#sidebar-panels-splitter-box">
-    <height>288</height>
-    <hidden>true</hidden>
-  </RDF:Description>
-  <RDF:Description about="chrome://messenger/content/messenger.xul#threadOutliner" height="94" />
-  <RDF:Description about="chrome://messenger/content/mail3PaneWindowVertLayout.xul">
-    <NC:persist resource="chrome://messenger/content/mail3PaneWindowVertLayout.xul#sidebar-panels-splitter-box"/>
-    <NC:persist resource="chrome://messenger/content/mail3PaneWindowVertLayout.xul#sidebar-panels"/>
-    <NC:persist resource="chrome://messenger/content/mail3PaneWindowVertLayout.xul#threadOutliner"/>
-  </RDF:Description>
-  <RDF:Description about="chrome://messenger/content/mail3PaneWindowVertLayout.xul#sidebar-panels-splitter-box">
-    <hidden>true</hidden>
-  </RDF:Description>
-  <RDF:Description about="chrome://messenger/content/mail3PaneWindowVertLayout.xul#sidebar-panels">
-    <hidden>true</hidden>
-  </RDF:Description>
-  <RDF:Description about="chrome://messenger/content/mail3PaneWindowVertLayout.xul#threadOutliner" height="94" />
-  <RDF:Description about="chrome://navigator/content/navigator.xul#sidebar-panels">
-    <last-selected-panel>urn:sidebar:panel:bookmarks</last-selected-panel>
-  </RDF:Description>
-  <RDF:Description about="chrome://navigator/content/navigator.xul">
-    <NC:persist resource="chrome://navigator/content/navigator.xul#sidebar-panels"/>
-  </RDF:Description>
-
-  <RDF:Description about="chrome://messenger/content/mail3PaneWindowVertLayout.xul#flaggedCol">
-    <hidden>true</hidden>
-  </RDF:Description>
-  <RDF:Description about="chrome://messenger/content/mail3PaneWindowVertLayout.xul#unreadCol">
-    <hidden>true</hidden>
-  </RDF:Description>
-  <RDF:Description about="chrome://messenger/content/mail3PaneWindowVertLayout.xul#totalCol">
-    <hidden>true</hidden>
-  </RDF:Description>
-  <RDF:Description about="chrome://messenger/content/mail3PaneWindowVertLayout.xul#OrderReceivedColumn">
-    <hidden>true</hidden>
-  </RDF:Description>
-  <RDF:Description about="chrome://messenger/content/mail3PaneWindowVertLayout.xul#statusCol">
-    <hidden>true</hidden>
-  </RDF:Description>
-  <RDF:Description about="chrome://messenger/content/mail3PaneWindowVertLayout.xul#sizeCol">
-    <hidden>true</hidden>
-  </RDF:Description>
-  <RDF:Description about="chrome://messenger/content/mail3PaneWindowVertLayout.xul">
-    <NC:persist resource="chrome://messenger/content/mail3PaneWindowVertLayout.xul#statusCol"/>
-    <NC:persist resource="chrome://messenger/content/mail3PaneWindowVertLayout.xul#sizeCol"/>
-    <NC:persist resource="chrome://messenger/content/mail3PaneWindowVertLayout.xul#unreadCol"/>
-    <NC:persist resource="chrome://messenger/content/mail3PaneWindowVertLayout.xul#totalCol"/>
-    <NC:persist resource="chrome://messenger/content/mail3PaneWindowVertLayout.xul#OrderReceivedColumn"/>
-    <NC:persist resource="chrome://messenger/content/mail3PaneWindowVertLayout.xul#flaggedCol"/>
-  </RDF:Description>
+    <NC:persist resource="chrome://messenger/content/messenger.xul#sidebar-title-box"/>
+    <NC:persist resource="chrome://messenger/content/messenger.xul#sidebar-box"/>
+    <NC:persist resource="chrome://messenger/content/messenger.xul#taskbar"/>
+    <NC:persist resource="chrome://messenger/content/messenger.xul#menu_showTaskbar"/>
+    <NC:persist resource="mailbox://browser@etzu"/>
+    <NC:persist resource="chrome://messenger/content/messenger.xul#totalCol"/>
+    <NC:persist resource="chrome://messenger/content/messenger.xul#unreadCol"/>
+    <NC:persist resource="chrome://messenger/content/messenger.xul#statusCol"/>
+    <NC:persist resource="chrome://messenger/content/messenger.xul#flaggedCol"/>
+    <NC:persist resource="chrome://messenger/content/messenger.xul#threadCol"/>
+    <NC:persist resource="chrome://messenger/content/messenger.xul#subjectCol"/>
+    <NC:persist resource="chrome://messenger/content/messenger.xul#senderOrRecipientCol"/>
+    <NC:persist resource="chrome://messenger/content/messenger.xul#unreadButtonColHeader"/>
+    <NC:persist resource="chrome://messenger/content/messenger.xul#dateCol"/>
+    <NC:persist resource="chrome://messenger/content/messenger.xul#sizeCol"/>
+    <NC:persist resource="chrome://messenger/content/messenger.xul#labelCol"/>
+    <NC:persist resource="chrome://messenger/content/messenger.xul#priorityCol"/>
+    <NC:persist resource="chrome://messenger/content/messenger.xul#folderUnreadCol"/>
+    <NC:persist resource="chrome://messenger/content/messenger.xul#folderTotalCol"/>
+  </RDF:Description>
+  <RDF:Description about="chrome://messenger/content/messenger.xul#unreadButtonColHeader"
+                   ordinal="9" />
+  <RDF:Description about="chrome://messenger/content/messenger.xul#TotalColumn"
+                   hidden="true" />
+  <RDF:Description about="chrome://editor/content/editor.xul#cmd_viewtaskbar"
+                   checked="false" />
+  <RDF:Description about="chrome://messenger/content/messenger.xul#sizeCol"
+                   ordinal="15" />
+  <RDF:Description about="chrome://messenger/content/addressbook/addressbook.xul#taskbar"
+                   hidden="true" />
+  <RDF:Description about="chrome://messenger/content/messenger.xul#UnreadColumn"
+                   hidden="true" />
+  <RDF:Description about="chrome://editor/content/editor.xul#sidebar-box"
+                   hidden="true" />
+  <RDF:Description about="chrome://messenger/content/messenger.xul#folderUnreadCol"
+                   hidden="true" />
+  <RDF:Description about="chrome://messenger/content/addressbook/addressbook.xul#menu_showTaskbar"
+                   checked="false" />
+  <RDF:Description about="chrome://messenger/content/messenger.xul#FlaggedButtonColumn"
+                   hidden="true" />
+  <RDF:Description about="chrome://messenger/content/messenger.xul#SizeColumn"
+                   hidden="true" />
 </RDF:RDF>
Index: profile/defaults/panels.rdf
===================================================================
RCS file: /cvsroot/mozilla/profile/defaults/panels.rdf,v
retrieving revision 1.17.72.2
diff -u -u -w -r1.17.72.2 panels.rdf
--- profile/defaults/panels.rdf	29 May 2002 18:20:19 -0000	1.17.72.2
+++ profile/defaults/panels.rdf	24 Aug 2002 17:14:01 -0000
@@ -13,17 +13,12 @@
   <RDF:Description about="urn:sidebar:current-panel-list">
     <NC:panel-list>
       <RDF:Seq>
-        <RDF:li resource="urn:sidebar:panel:whats-related"/>
         <RDF:li resource="urn:sidebar:panel:search"/>
         <RDF:li resource="urn:sidebar:panel:bookmarks"/>
         <RDF:li resource="urn:sidebar:panel:history"/>
       </RDF:Seq>
     </NC:panel-list>
     <NC:version>0.1</NC:version>
-  </RDF:Description>
-  <RDF:Description about="urn:sidebar:panel:whats-related">
-    <NC:title>&sidebar.whats-related.label;</NC:title>
-    <NC:content>chrome://communicator/content/related/related-panel.xul</NC:content>
   </RDF:Description>
   <RDF:Description about="urn:sidebar:panel:search">
     <NC:title>&sidebar.search.label;</NC:title>
Index: profile/defaults/search.rdf
===================================================================
RCS file: /cvsroot/mozilla/profile/defaults/search.rdf,v
retrieving revision 1.7.138.1
diff -u -u -w -r1.7.138.1 search.rdf
--- profile/defaults/search.rdf	10 Apr 2002 03:21:54 -0000	1.7.138.1
+++ profile/defaults/search.rdf	24 Aug 2002 17:14:01 -0000
@@ -23,8 +23,9 @@
 
 <!DOCTYPE RDF 
 [
-<!ENTITY search.category.mozilla	"Mozilla">
+<!ENTITY search.category.news	        "News">
 <!ENTITY search.category.web		"Web">
+<!ENTITY search.category.special	"Specialized">
 ]
 >
 
@@ -38,8 +39,12 @@
 
   <RDF:Seq about="NC:SearchCategoryRoot">
   	<RDF:li>
+  		<RDF:Description about="urn:search:category:3">
+			<NC:title>&search.category.special;</NC:title>
+  		</RDF:Description>
+
   		<RDF:Description about="urn:search:category:2">
-			<NC:title>&search.category.mozilla;</NC:title>
+			<NC:title>&search.category.news;</NC:title>
   		</RDF:Description>
 
   		<RDF:Description about="urn:search:category:1">
@@ -53,15 +58,18 @@
 
 
   <RDF:Seq about="NC:SearchCategory?category=urn:search:category:1">
-  	<RDF:li resource="NC:SearchCategory?engine=urn:search:engine:NetscapeSearch.src" />
-    <RDF:li resource="NC:SearchCategory?engine=urn:search:engine:google.src" />
   	<RDF:li resource="NC:SearchCategory?engine=urn:search:engine:dmoz.src" />
+        <RDF:li resource="NC:SearchCategory?engine=urn:search:engine:google.src" />
+        <RDF:li resource="NC:SearchCategory?engine=urn:search:engine:Excite.src" />
+        <RDF:li resource="NC:SearchCategory?engine=urn:search:engine:Lycos.src" />
+        <RDF:li resource="NC:SearchCategory?engine=urn:search:engine:HotBot.src" />
   </RDF:Seq>
-
-  <RDF:Seq about="NC:SearchCategory?category=urn:search:category:2">
-  	<RDF:li resource="NC:SearchCategory?engine=urn:search:engine:mozilla.src" />
-  	<RDF:li resource="NC:SearchCategory?engine=urn:search:engine:bugzilla.src" />
-  	<RDF:li resource="NC:SearchCategory?engine=urn:search:engine:lxrmozilla.src" />
+  <RDF:Seq about="NC:SearchCategory?category=urn:search:category:3">
+  	<RDF:li resource="NC:SearchCategory?engine=urn:search:engine:ICQ.src" />
+  	<RDF:li resource="NC:SearchCategory?engine=urn:search:engine:monster.src" />
+  	<RDF:li resource="NC:SearchCategory?engine=urn:search:engine:eBay.src" />
+  	<RDF:li resource="NC:SearchCategory?engine=urn:search:engine:dictionary.src" />
+  	<RDF:li resource="NC:SearchCategory?engine=urn:search:engine:thesaurus.src" />
   </RDF:Seq>
 
 </RDF:RDF>
Index: profile/resources/content/confirmMigration.xul
===================================================================
RCS file: /cvsroot/mozilla/profile/resources/content/confirmMigration.xul,v
retrieving revision 1.13.28.1
diff -u -u -w -r1.13.28.1 confirmMigration.xul
--- profile/resources/content/confirmMigration.xul	10 Apr 2002 03:22:14 -0000	1.13.28.1
+++ profile/resources/content/confirmMigration.xul	24 Aug 2002 17:14:01 -0000
@@ -1,6 +1,7 @@
 <?xml version="1.0"?> 
 
 
+<?xml-stylesheet href="chrome://communicator/skin/" type="text/css"?>
 <?xml-stylesheet href="chrome://communicator/skin/profile/profile.css" type="text/css"?>
 <?xul-overlay href="chrome://global/content/dialogOverlay.xul"?>
 
Index: profile/resources/locale/en-US/profileSelection.dtd
===================================================================
RCS file: /cvsroot/mozilla/profile/resources/locale/en-US/profileSelection.dtd,v
retrieving revision 1.12.22.1
diff -u -u -w -r1.12.22.1 profileSelection.dtd
--- profile/resources/locale/en-US/profileSelection.dtd	10 Apr 2002 03:22:18 -0000	1.12.22.1
+++ profile/resources/locale/en-US/profileSelection.dtd	24 Aug 2002 17:14:01 -0000
@@ -41,7 +41,7 @@
 
 <!ENTITY            manageprofiles.label  "Manage Profiles">
 
-<!ENTITY            start.label           "Start &vendorShortName;">
+<!ENTITY            start.label           "Start &brandShortName;">
 <!ENTITY            exit.label            "Exit">
 <!ENTITY            manage.label          "Manage Profiles...">
 
Index: security/nss/cmd/modutil/specification.html
===================================================================
RCS file: /cvsroot/mozilla/security/nss/cmd/modutil/specification.html,v
retrieving revision 1.1.160.1
diff -u -u -w -r1.1.160.1 specification.html
--- security/nss/cmd/modutil/specification.html	10 Apr 2002 03:25:27 -0000	1.1.160.1
+++ security/nss/cmd/modutil/specification.html	24 Aug 2002 17:14:03 -0000
@@ -139,7 +139,7 @@
 otherwise, the password will be obtained interactively.
 <b>Storing passwords in a file is much less secure than supplying them
 interactively.</b>
-<p>The password on the Netscape internal module cannot be changed if
+<p>The password on the NSS internal module cannot be changed if
 the <code>-nocertdb</code> option is specified.
 </td>
 </tr>
@@ -240,7 +240,7 @@
 
 Listing of PKCS #11 Modules
 -----------------------------------------------------------
-  1. Netscape Internal PKCS #11 Module
+  1. NSS Internal PKCS #11 Module
          slots: 2 slots attached
         status: loaded
 
@@ -256,13 +256,13 @@
 and its slots and tokens.
 <blockquote>
 <pre>
-% <b>modutil -list "Netscape Internal PKCS #11 Module"</b>
+% <b>modutil -list "NSS Internal PKCS #11 Module"</b>
 Using database directory /u/nicolson/.netscape...
 
 -----------------------------------------------------------
-Name: Netscape Internal PKCS #11 Module
+Name: NSS Internal PKCS #11 Module
 Library file: **Internal ONLY module**
-Manufacturer: Netscape Communications Corp    
+Manufacturer: mozilla.org
 Description: Communicator Internal Crypto Svc
 PKCS #11 Version 2.0
 Library Version: 4.0
@@ -270,13 +270,13 @@
 Default Mechanism Flags: RSA:DSA:RC2:RC4:DES:SHA1:MD5:MD2
 
   Slot: Communicator Internal Cryptographic Services Version 4.0
-  Manufacturer: Netscape Communications Corp    
+  Manufacturer: mozilla.org
   Type: Software
   Version Number: 4.1
   Firmware Version: 0.0
   Status: Enabled
   Token Name: Communicator Generic Crypto Svcs
-  Token Manufacturer: Netscape Communications Corp    
+  Token Manufacturer: mozilla.org
   Token Model: Libsec 4.0      
   Token Serial Number: 0000000000000000
   Token Version: 4.0
@@ -286,13 +286,13 @@
   User Pin: NOT Initialized
 
   Slot: Communicator User Private Key and Certificate Services
-  Manufacturer: Netscape Communications Corp    
+  Manufacturer: mozilla.org
   Type: Software
   Version Number: 3.0
   Firmware Version: 0.0
   Status: Enabled
   Token Name: Communicator Certificate DB     
-  Token Manufacturer: Netscape Communications Corp    
+  Token Manufacturer: mozilla.org
   Token Model: Libsec 4.0      
   Token Serial Number: 0000000000000000
   Token Version: 7.0
@@ -340,7 +340,7 @@
 With the <code>-create</code> command, this means that only a secmod.db file
 will be created; cert7.db and key3.db will not be created.  With the
 <code>-jar</code> command, signatures on the JAR file will not be checked.
-With the <code>-changepw</code> command, the password on the Netscape internal 
+With the <code>-changepw</code> command, the password on the NSS internal 
 module cannot be set or changed, since this password is stored in key3.db.
 </td>
 </tr>
Index: security/nss/lib/softoken/pkcs11.c
===================================================================
RCS file: /cvsroot/mozilla/security/nss/lib/softoken/pkcs11.c,v
retrieving revision 1.38.6.3
diff -u -u -w -r1.38.6.3 pkcs11.c
--- security/nss/lib/softoken/pkcs11.c	4 Jun 2002 20:35:14 -0000	1.38.6.3
+++ security/nss/lib/softoken/pkcs11.c	24 Aug 2002 17:14:04 -0000
@@ -2046,7 +2046,7 @@
 	 "NSS User Private Key and Certificate Services                   ";
     case FIPS_SLOT_ID:
         return 
-         "Netscape FIPS-140-1 User Private Key Services                   ";
+         "NSS FIPS-140-1 User Private Key Services                        ";
     default:
 	break;
     }
Index: themes/Makefile.in
===================================================================
RCS file: /cvsroot/mozilla/themes/Makefile.in,v
retrieving revision 1.5.108.1
diff -u -u -w -r1.5.108.1 Makefile.in
--- themes/Makefile.in	10 Apr 2002 03:30:32 -0000	1.5.108.1
+++ themes/Makefile.in	24 Aug 2002 17:14:05 -0000
@@ -28,5 +28,8 @@
 
 DIRS		= classic modern 
 
-include $(topsrcdir)/config/rules.mk
 
+#default-theme:
+#	echo "skin,install,select,modern/1.0" >> $(DIST)/bin/chrome/installed-chrome.txt
+
+include $(topsrcdir)/config/rules.mk
Index: themes/makefile.win
===================================================================
RCS file: /cvsroot/mozilla/themes/Attic/makefile.win,v
retrieving revision 1.6.108.1
diff -u -u -w -r1.6.108.1 makefile.win
--- themes/makefile.win	10 Apr 2002 03:30:32 -0000	1.6.108.1
+++ themes/makefile.win	24 Aug 2002 17:14:05 -0000
@@ -25,6 +25,6 @@
 
 include <$(DEPTH)\config\rules.mak>
 
-# choose Classic skin as default
+# choose Modern skin as default
 chrome::
-    echo skin,install,select,classic/1.0 >>$(DIST)\bin\chrome\installed-chrome.txt
+    echo skin,install,select,modern/1.0 >>$(DIST)\bin\chrome\installed-chrome.txt
Index: themes/classic/communicator/brand/throbber-anim.gif
===================================================================
RCS file: /cvsroot/mozilla/themes/classic/communicator/brand/throbber-anim.gif,v
retrieving revision 1.1.16.1
diff -u -u -w -r1.1.16.1 throbber-anim.gif
Binary files /tmp/cvsr.wJ__ and throbber-anim.gif differ
Index: themes/classic/communicator/brand/throbber-single.gif
===================================================================
RCS file: /cvsroot/mozilla/themes/classic/communicator/brand/throbber-single.gif,v
retrieving revision 1.1.16.1
diff -u -u -w -r1.1.16.1 throbber-single.gif
Binary files /tmp/cvsf9Hi8_ and throbber-single.gif differ
Index: themes/modern/communicator/brand/throbber-anim.gif
===================================================================
RCS file: /cvsroot/mozilla/themes/modern/communicator/brand/throbber-anim.gif,v
retrieving revision 1.2.66.1
diff -u -u -w -r1.2.66.1 throbber-anim.gif
Binary files /tmp/cvs0.bA6y and throbber-anim.gif differ
Index: themes/modern/communicator/brand/throbber-single.gif
===================================================================
RCS file: /cvsroot/mozilla/themes/modern/communicator/brand/throbber-single.gif,v
retrieving revision 1.2.66.1
diff -u -u -w -r1.2.66.1 throbber-single.gif
Binary files /tmp/cvs021cOt and throbber-single.gif differ
Index: themes/modern/messenger/messageBody.css
===================================================================
RCS file: /cvsroot/mozilla/themes/modern/messenger/messageBody.css,v
retrieving revision 1.5.14.2
diff -u -u -w -r1.5.14.2 messageBody.css
--- themes/modern/messenger/messageBody.css	22 May 2002 20:50:37 -0000	1.5.14.2
+++ themes/modern/messenger/messageBody.css	24 Aug 2002 17:14:07 -0000
@@ -49,7 +49,7 @@
   overflow: auto;
 }
 
-html|html {
+html|html, body {
   /* XXX Doesn't seem to work. (Same with "html|body".) */
   background-color: white;
 }
Index: widget/src/gtksuperwin/Makefile.in
===================================================================
RCS file: /cvsroot/mozilla/widget/src/gtksuperwin/Makefile.in,v
retrieving revision 1.6.28.1
diff -u -u -w -r1.6.28.1 Makefile.in
--- widget/src/gtksuperwin/Makefile.in	10 Apr 2002 03:35:09 -0000	1.6.28.1
+++ widget/src/gtksuperwin/Makefile.in	24 Aug 2002 17:14:09 -0000
@@ -49,6 +49,9 @@
 DEFINES		+= -D_BSD_SOURCE
 endif
 
+CXX=gcc
+LDFLAGS += -Wl,-Bstatic -Wl,-lstdc++ -Wl,-Bdynamic
+
 INCLUDES	+= \
 		-I$(srcdir) \
 		$(NULL)
Index: widget/src/gtkxtbin/Makefile.in
===================================================================
RCS file: /cvsroot/mozilla/widget/src/gtkxtbin/Makefile.in,v
retrieving revision 1.7.28.1
diff -u -u -w -r1.7.28.1 Makefile.in
--- widget/src/gtkxtbin/Makefile.in	10 Apr 2002 03:35:11 -0000	1.7.28.1
+++ widget/src/gtkxtbin/Makefile.in	24 Aug 2002 17:14:09 -0000
@@ -47,6 +47,9 @@
 DEFINES		+= -D_BSD_SOURCE
 endif
 
+CXX=gcc
+LDFLAGS += -Wl,-Bstatic -Wl,-lstdc++ -Wl,-Bdynamic
+
 INCLUDES	+= \
 		-I$(srcdir) \
 		$(NULL)
Index: xpcom/components/nsComponentManager.h
===================================================================
RCS file: /cvsroot/mozilla/xpcom/components/nsComponentManager.h,v
retrieving revision 1.74.16.1
diff -u -u -w -r1.74.16.1 nsComponentManager.h
--- xpcom/components/nsComponentManager.h	10 Apr 2002 03:36:29 -0000	1.74.16.1
+++ xpcom/components/nsComponentManager.h	24 Aug 2002 17:14:09 -0000
@@ -238,32 +238,6 @@
 
 #define NS_ERROR_IS_DIR NS_ERROR_GENERATE_FAILURE(NS_ERROR_MODULE_XPCOM, 24)
 
-#if defined(XP_UNIX) && !defined(XP_MACOSX)
-/* The default registry on the unix system is $HOME/.mozilla/registry per
- * vr_findGlobalRegName(). vr_findRegFile() will create the registry file
- * if it doesn't exist. But it wont create directories.
- *
- * Hence we need to create the directory if it doesn't exist already.
- *
- * Why create it here as opposed to the app ?
- * ------------------------------------------
- * The app cannot create the directory in main() as most of the registry
- * and initialization happens due to use of static variables.
- * And we dont want to be dependent on the order in which
- * these static stuff happen.
- *
- * Permission for the $HOME/.mozilla will be Read,Write,Execute
- * for user only. Nothing to group and others.
- */
-#define NS_MOZILLA_DIR_NAME		".mozilla"
-#define NS_MOZILLA_DIR_PERMISSION	00700
-#endif /* XP_UNIX */
-
-#ifdef XP_BEOS
-#define NS_MOZILLA_DIR_NAME		"mozilla"
-#define NS_MOZILLA_DIR_PERMISSION	00700
-#endif /* XP_BEOS */
-
 /**
  * When using the registry we put a version number in it.
  * If the version number that is in the registry doesn't match
Index: xpcom/components/nsRegistry.cpp
===================================================================
RCS file: /cvsroot/mozilla/xpcom/components/nsRegistry.cpp,v
retrieving revision 1.66.26.2
diff -u -u -w -r1.66.26.2 nsRegistry.cpp
--- xpcom/components/nsRegistry.cpp	13 May 2002 22:08:59 -0000	1.66.26.2
+++ xpcom/components/nsRegistry.cpp	24 Aug 2002 17:14:09 -0000
@@ -452,6 +452,7 @@
 static void
 EnsureDefaultRegistryDirectory() {
     #if defined(XP_UNIX) && !defined(XP_MACOSX)
+#define NS_MOZILLA_DIR_PERMISSION	00700
     // Create ~/.mozilla as that is the default place for the registry file
 
     /* The default registry on the unix system is $HOME/.mozilla/registry per
@@ -475,7 +476,7 @@
     {
         char dotMozillaDir[1024];
         PR_snprintf(dotMozillaDir, sizeof(dotMozillaDir),
-                    "%s/" NS_MOZILLA_DIR_NAME, home);
+                    "%s/" MOZ_USER_DIR, home);
         if (PR_Access(dotMozillaDir, PR_ACCESS_EXISTS) != PR_SUCCESS)
         {
             PR_MkDir(dotMozillaDir, NS_MOZILLA_DIR_PERMISSION);
@@ -486,13 +487,14 @@
 #endif /* XP_UNIX */
 
 #ifdef XP_BEOS
+#define NS_MOZILLA_DIR_PERMISSION	00700
     BPath p;
     const char *settings = "/boot/home/config/settings";
     if(find_directory(B_USER_SETTINGS_DIRECTORY, &p) == B_OK)
         settings = p.Path();
     char settingsMozillaDir[1024];
     PR_snprintf(settingsMozillaDir, sizeof(settingsMozillaDir),
-                "%s/" NS_MOZILLA_DIR_NAME, settings);
+                "%s/" MOZ_USER_DIR, settings);
     if (PR_Access(settingsMozillaDir, PR_ACCESS_EXISTS) != PR_SUCCESS) {
         PR_MkDir(settingsMozillaDir, NS_MOZILLA_DIR_PERMISSION);
         printf("nsComponentManager: Creating Directory %s\n", settingsMozillaDir);
Index: xpcom/io/nsAppFileLocationProvider.cpp
===================================================================
RCS file: /cvsroot/mozilla/xpcom/io/nsAppFileLocationProvider.cpp,v
retrieving revision 1.34.2.4
diff -u -u -w -r1.34.2.4 nsAppFileLocationProvider.cpp
--- xpcom/io/nsAppFileLocationProvider.cpp	27 Jun 2002 22:46:21 -0000	1.34.2.4
+++ xpcom/io/nsAppFileLocationProvider.cpp	24 Aug 2002 17:14:09 -0000
@@ -70,10 +70,11 @@
 #endif
 
 // define default product directory
-#if defined(XP_WIN) || defined(XP_MAC) || defined(XP_OS2) || defined(XP_BEOS)
-#define DEFAULT_PRODUCT_DIR NS_LITERAL_CSTRING("Mozilla")
-#elif defined (XP_UNIX)
-#define DEFAULT_PRODUCT_DIR NS_LITERAL_CSTRING(".mozilla")
+#if defined(XP_MAC) || defined(XP_OS2)
+// bug 58327
+#define DEFAULT_PRODUCT_DIR "Beonex::Communicator"
+#elif defined (XP_UNIX) || defined(XP_BEOS) || defined(XP_WIN)
+#define DEFAULT_PRODUCT_DIR MOZ_USER_DIR
 #endif
 
 // Locally defined keys used by nsAppDirectoryEnumerator
@@ -375,7 +376,8 @@
 #error dont_know_how_to_get_product_dir_on_your_platform
 #endif
 
-    rv = localDir->AppendRelativeNativePath(DEFAULT_PRODUCT_DIR);
+    rv = localDir->AppendRelativeNativePath
+                                    (NS_LITERAL_CSTRING(DEFAULT_PRODUCT_DIR));
     if (NS_FAILED(rv)) return rv;
     rv = localDir->Exists(&exists);
     if (NS_SUCCEEDED(rv) && !exists)
Index: xpcom/io/nsDirectoryService.cpp
===================================================================
RCS file: /cvsroot/mozilla/xpcom/io/nsDirectoryService.cpp,v
retrieving revision 1.43.18.5
diff -u -u -w -r1.43.18.5 nsDirectoryService.cpp
--- xpcom/io/nsDirectoryService.cpp	16 Jul 2002 03:31:06 -0000	1.43.18.5
+++ xpcom/io/nsDirectoryService.cpp	24 Aug 2002 17:14:09 -0000
@@ -107,13 +107,6 @@
 #define HOME_DIR NS_BEOS_HOME_DIR
 #endif
 
-// define default product directory
-#if defined(XP_WIN) || defined(XP_MAC) || defined(XP_OS2) || defined(XP_BEOS)
-#define DEFAULT_PRODUCT_DIR "Mozilla"
-#elif defined (XP_UNIX) || defined(XP_MACOSX)
-#define DEFAULT_PRODUCT_DIR ".mozilla"
-#endif
-
 //----------------------------------------------------------------------------------------
 nsresult 
 nsDirectoryService::GetCurrentProcessDirectory(nsILocalFile** aFile)
Index: xpfe/bootstrap/Makefile.in
===================================================================
RCS file: /cvsroot/mozilla/xpfe/bootstrap/Makefile.in,v
retrieving revision 1.177.2.5
diff -u -u -w -r1.177.2.5 Makefile.in
--- xpfe/bootstrap/Makefile.in	24 May 2002 22:43:14 -0000	1.177.2.5
+++ xpfe/bootstrap/Makefile.in	24 Aug 2002 17:14:10 -0000
@@ -139,6 +139,11 @@
 CPPSRCS += nsNativeAppSupportBase.cpp
 endif
 
+install:: $(topsrcdir)/README/user/unix-tarball.txt $(topsrcdir)/LICENSE
+# Can't use nsinstall, because I want a different filename
+	cp $(topsrcdir)/README/user/unix-tarball.txt $(DIST)/bin/README
+	cp $(topsrcdir)/LICENSE $(DIST)/bin/LICENSE
+
 ifeq ($(MOZ_WIDGET_TOOLKIT),photon)
 CPPSRCS += nsNativeAppSupportPh.cpp
 LIBS += -lphexlib -lph
Index: xpfe/bootstrap/makefile.win
===================================================================
RCS file: /cvsroot/mozilla/xpfe/bootstrap/Attic/makefile.win,v
retrieving revision 1.64.2.2
diff -u -u -w -r1.64.2.2 makefile.win
--- xpfe/bootstrap/makefile.win	16 Apr 2002 02:18:08 -0000	1.64.2.2
+++ xpfe/bootstrap/makefile.win	24 Aug 2002 17:14:10 -0000
@@ -49,6 +49,8 @@
 		  $(NULL)
 include <$(DEPTH)/config/config.mak>
 
+DIRS=icons
+
 DEFINES=-DWIN32_LEAN_AND_MEAN
 
 !if defined(MOZ_STATIC_COMPONENT_LIBS) && !defined(MOZ_GECKO_DLL)
@@ -70,7 +72,7 @@
  $(NULL)
 
 MAKE_OBJ_TYPE = EXE
-PROGRAM = .\$(OBJDIR)\mozilla.exe
+PROGRAM = .\$(OBJDIR)\beonex-comm.exe
 RCINCLUDE = splash.rc
 
 LCFLAGS = \
@@ -174,5 +176,10 @@
 libs:: $(PROGRAM)
 	$(MAKE_INSTALL) $(PROGRAM) $(DIST)\bin
 
+#install:: $(topsrcdir)\README\user\win32.txt $(topsrcdir)\LICENSE
+# Can't use install, because I want a different filename
+#	copy $(topsrcdir)\README\user\win32.txt $(DIST)\bin\README.txt
+#	copy $(topsrcdir)\LICENSE $(DIST)\bin\LICENSE.txt
+
 clobber::
-	rm -f $(DIST)\bin\mozilla.exe
+	rm -f $(DIST)\bin\beonex-comm.exe
Index: xpfe/browser/resources/content/navigator.js
===================================================================
RCS file: /cvsroot/mozilla/xpfe/browser/resources/content/navigator.js,v
retrieving revision 1.447.2.12
diff -u -u -w -r1.447.2.12 navigator.js
--- xpfe/browser/resources/content/navigator.js	12 Jul 2002 20:00:58 -0000	1.447.2.12
+++ xpfe/browser/resources/content/navigator.js	24 Aug 2002 17:14:12 -0000
@@ -828,6 +828,8 @@
   } catch (ex) {
   }
 
+  debug("Search defaultSearchURL: " + defaultSearchURL + "\n");
+
   // Fallback to a default url (one that we can get sidebar search results for)
   if (!defaultSearchURL)
     defaultSearchURL = fallbackDefaultSearchURL;
@@ -1664,6 +1666,16 @@
   return false;
 }
 
+function PageProxyClickHandler(aEvent)
+{
+  if (aEvent.button == 1)
+    // load url/keyword from clipboard
+    return middleMousePaste();
+  else
+    // popup "file bookmark" dialog
+    return BookmarksUtils.addBookmarkForBrowser(getBrowser().webNavigation, true);
+}
+
 function updateComponentBarBroadcaster()
 { 
   var compBarBroadcaster = document.getElementById('cmd_viewcomponentbar');
@@ -1800,5 +1812,4 @@
   }
 
 }
-
 
Index: xpfe/browser/resources/content/navigator.xul
===================================================================
RCS file: /cvsroot/mozilla/xpfe/browser/resources/content/navigator.xul,v
retrieving revision 1.373.2.8
diff -u -u -w -r1.373.2.8 navigator.xul
--- xpfe/browser/resources/content/navigator.xul	12 Jul 2002 20:00:59 -0000	1.373.2.8
+++ xpfe/browser/resources/content/navigator.xul	24 Aug 2002 17:14:12 -0000
@@ -25,6 +25,7 @@
 
 <?xul-overlay href="chrome://navigator/content/navigatorOverlay.xul"?>
 <?xul-overlay href="chrome://navigator/content/navExtraOverlay.xul"?>
+<?xul-overlay href="chrome://navigator/content/linkToolbarOverlay.xul"?>
 <?xul-overlay href="chrome://communicator/content/sidebar/sidebarOverlay.xul"?>
 <?xul-overlay href="chrome://communicator/content/securityOverlay.xul"?>
 <?xul-overlay href="chrome://communicator/content/communicatorOverlay.xul"?>
@@ -171,11 +172,11 @@
                  onblur="URLBarBlurHandler(event);">
           <deck id="page-proxy-deck">
             <image id="page-proxy-button"
-                   onclick="BookmarksUtils.addBookmarkForBrowser(getBrowser().webNavigation, true);"
+                   onclick="PageProxyClickHandler(event);"
                    ondraggesture="PageProxyDragGesture(event);"
                    tooltiptext="&proxyIcon.tooltip;"/>
             <image id="page-proxy-favicon" validate="never"
-                   onclick="BookmarksUtils.addBookmarkForBrowser(getBrowser().webNavigation, true);"
+                   onclick="PageProxyClickHandler(event);"
                    ondraggesture="PageProxyDragGesture(event);"
                    onload="this.parentNode.selectedIndex = 1;
                            event.stopPropagation();
Index: xpfe/browser/resources/content/navigatorOverlay.xul
===================================================================
RCS file: /cvsroot/mozilla/xpfe/browser/resources/content/navigatorOverlay.xul,v
retrieving revision 1.255.2.5
diff -u -u -w -r1.255.2.5 navigatorOverlay.xul
--- xpfe/browser/resources/content/navigatorOverlay.xul	25 Jun 2002 06:37:44 -0000	1.255.2.5
+++ xpfe/browser/resources/content/navigatorOverlay.xul	24 Aug 2002 17:14:12 -0000
@@ -149,6 +149,7 @@
              accesskey="&addCurPageAsCmd.accesskey;"
              oncommand="addBookmarkAs();"/>
     <command id="Browser:AddGroupmarkAs" label="&addCurTabsAsCmd.label;"
+             hidden="true"
              accesskey="&addCurTabsAsCmd.accesskey;"
              oncommand="addGroupmarkAs(); event.preventBubble();"/>
     <command id="Browser:ManageBookmark" label="&manBookmarksCmd.label;" accesskey="&manBookmarksCmd.accesskey;" 
@@ -177,7 +178,14 @@
   <menubar id="main-menubar" class="chromeclass-menubar">
     <menu id="menu_File">
       <menupopup id="menu_FilePopup" onpopupshowing="getContentAreaFrameCount();">
-        <menu id="menu_New">
+        <menuitem id="menu_newNavigator" command="cmd_newNavigator"
+                  key="key_newNavigator"
+                  label="&browserCmd.label;"
+                  accesskey="&browserCmd.accesskey;"/>
+        <menuitem id="menu_newNavigatorTab" command="cmd_newNavigatorTab"
+                  key="key_newNavigatorTab"
+                  label="&newtabCmd.label;" accesskey="&tabCmd.accesskey;"/>
+        <menu hidden="true" id="menu_New">
           <menupopup id="menu_NewPopup">
             <!-- From utilityOverlay.xul -->
             <menuitem id="menu_newNavigator" command="cmd_newNavigator"/>
@@ -256,8 +264,8 @@
         <menuseparator />
         <menuitem accesskey="&pageSourceCmd.accesskey;" label="&pageSourceCmd.label;" key="key_viewSource" command="View:PageSource"/>
         <menuitem accesskey="&pageInfoCmd.accesskey;"   label="&pageInfoCmd.label;"   key="key_viewInfo"   command="View:PageInfo"/>
-        <menuseparator />
-        <menu label="&applyTheme.label;" accesskey="&applyTheme.accesskey;">
+        <menuseparator hidden="true"/>
+        <menu hidden="true" label="&applyTheme.label;" accesskey="&applyTheme.accesskey;">
           <menupopup datasources="rdf:chrome" ref="urn:mozilla:skin:root" oncommand="applyTheme(event.target)">
             <menuitem label="&themePreferencesCmd.label;" accesskey="&themePreferencesCmd.accesskey;"
                       oncommand="goPreferences('appearance','chrome://communicator/content/pref/pref-themes.xul', 'themes-panel')"/>
@@ -353,7 +361,8 @@
   <menu id="windowMenu"/>
   
   <menu accesskey="&helpMenuCmd.accesskey;" id="menu_Help"/>
-
+  <!-- Menu for testing.
+-->
 </menubar>
 
 </overlay>
Index: xpfe/browser/resources/locale/en-US/navigator.dtd
===================================================================
RCS file: /cvsroot/mozilla/xpfe/browser/resources/locale/en-US/navigator.dtd,v
retrieving revision 1.152.2.5
diff -u -u -w -r1.152.2.5 navigator.dtd
--- xpfe/browser/resources/locale/en-US/navigator.dtd	11 Jun 2002 06:44:36 -0000	1.152.2.5
+++ xpfe/browser/resources/locale/en-US/navigator.dtd	24 Aug 2002 17:14:12 -0000
@@ -3,10 +3,27 @@
 <!-- LOCALIZATION NOTE : FILE This file contains the browser main menu items --> 
 <!-- LOCALIZATION NOTE : FILE Do not translate accesskey and commandkey --> 
 
+
+
+<!-- Could you please decide, where to place that? Finally? -->
+
+<!-- LOCALIZATION NOTE (mainWindow.title): DONT_TRANSLATE --> 
+<!ENTITY mainWindow.title "&brandShortName;"> 
+<!-- LOCALIZATION NOTE (mainWindow.titlemodifier) : DONT_TRANSLATE --> 
+<!ENTITY mainWindow.titlemodifier "&brandShortName;"> 
+<!-- LOCALIZATION NOTE (mainWindow.titlemodifiermenuseparator): DONT_TRANSLATE -->
+<!ENTITY mainWindow.titlemodifiermenuseparator " - ">
+<!ENTITY viewsourcetitle.preface "Source for: ">
+
+<!-- end removed stuff -->
+
+
+
 <!ENTITY nothingAvailable.label "(Nothing Available)">
 
-<!ENTITY browserCmd.label	"New Navigator Window">
+<!ENTITY browserCmd.label	"New Window">
 <!ENTITY browserCmd.accesskey	"N">
+<!ENTITY newtabCmd.label "New Tab">
 <!ENTITY tabCmd.label "Navigator Tab">
 <!ENTITY tabCmd.accesskey "T">
 <!ENTITY tabCmd.commandkey "t">
@@ -142,7 +159,7 @@
 
 <!ENTITY bookmarksMenu.label "Bookmarks">
 <!ENTITY bookmarksMenu.accesskey "B">
-<!ENTITY addCurPageCmd.label "Bookmark This Page">
+<!ENTITY addCurPageCmd.label "Add to Bookmarks">
 <!ENTITY addCurPageCmd.accesskey "B">
 <!ENTITY addCurPageCmd.commandkey "d">
 <!ENTITY addCurPageAsCmd.label "File Bookmark...">
@@ -177,15 +194,15 @@
 
 <!-- Toolbar items --> 
 <!ENTITY backButton.label             "Back">
-<!ENTITY backButton.tooltip           "Go back one page">
+<!ENTITY backButton.tooltip           "Go back one page in browsing history">
 <!ENTITY forwardButton.label          "Forward">
-<!ENTITY forwardButton.tooltip        "Go forward one page">
+<!ENTITY forwardButton.tooltip        "Go forward one page in browsing history">
 <!ENTITY reloadButton.label           "Reload">
-<!ENTITY reloadButton.tooltip         "Reload current page">
+<!ENTITY reloadButton.tooltip         "Reload current page. Use SHIFT-click to circumvent cache.">
 <!ENTITY stopButton.label             "Stop">
 <!ENTITY stopButton.tooltip           "Stop loading this page">
-<!ENTITY searchButton.label           "Search">
-<!ENTITY searchButton.tooltip         "Type a word in the field to the left, then click Search">
+<!ENTITY searchButton.label           "">
+<!ENTITY searchButton.tooltip         "Type a word in the field to the left, then click this button to search for the word using your favorite search engine">
 <!ENTITY goButton.label               "Go">
 <!ENTITY goButton.tooltip             "Type a location in the field to the left, then click Go">
 <!ENTITY printButton.label            "Print">
Index: xpfe/browser/resources/locale/en-US/region.properties
===================================================================
RCS file: /cvsroot/mozilla/xpfe/browser/resources/locale/en-US/region.properties,v
retrieving revision 1.4.36.3
diff -u -u -w -r1.4.36.3 region.properties
--- xpfe/browser/resources/locale/en-US/region.properties	7 May 2002 22:16:13 -0000	1.4.36.3
+++ xpfe/browser/resources/locale/en-US/region.properties	24 Aug 2002 17:14:12 -0000
@@ -1,23 +1,24 @@
 # navigator.properties
-homePageDefault=http://www.mozilla.org/
+homePageDefault=about:welcome
+keywordList=http://www.beonex.com/communicator/redir/keyword
+webmailKeyword=http://www.beonex.com/communicator/redir/webmail
+fallbackDefaultSearchURL=http://www.google.com/search?q=
+otherSearchURL=http://www.google.com/
+
+careerKeyword=keyword:[Your city] careers
 shopKeyword=keyword:shop [Product]
 quoteKeyword=keyword:quote [Enter symbol here]
 localKeyword=keyword:zip [Your zip code]
-keywordList=http://home.netscape.com/escapes/keywords
-webmailKeyword=http://webmail.netscape.com
-careerKeyword=keyword:[Your city] careers
-fallbackDefaultSearchURL=http://search.netscape.com/cgi-bin/search?charset=UTF-8&search=
-otherSearchURL=http://home.netscape.com/bookmark/6_0/tsearch.html
 #
 # all.js
 #
-browser.startup.homepage=http://www.mozilla.org/start/1.0/
-browser.throbber.url=http://www.mozilla.org/
-browser.search.defaulturl=http://search.netscape.com/cgi-bin/search?search=
+browser.startup.homepage=about:welcome
+browser.throbber.url=about:welcome
+browser.search.defaulturl=http://www.google.com/search?q=
 
 wallet.Server=http://www.mozilla.org/wallet/tables/
 wallet.Samples=http://www.mozilla.org/wallet/samples/
 
 #config.js
 #
-startup.homepage_override_url=http://www.mozilla.org/start/1.0/
+startup.homepage_override_url=about:welcome
Index: xpfe/communicator/jar.mn
===================================================================
RCS file: /cvsroot/mozilla/xpfe/communicator/jar.mn,v
retrieving revision 1.21.8.1
diff -u -u -w -r1.21.8.1 jar.mn
--- xpfe/communicator/jar.mn	10 Apr 2002 03:40:31 -0000	1.21.8.1
+++ xpfe/communicator/jar.mn	24 Aug 2002 17:14:12 -0000
@@ -31,6 +31,7 @@
     content/communicator/printPreviewBindings.xml        (resources/content/printPreviewBindings.xml)
 
 en-US.jar:
+	  		locale/en-US/communicator/welcome.html                      (resources/locale/en-US/welcome.html)
         locale/en-US/communicator/contents.rdf                      (resources/locale/en-US/contents.rdf)
         locale/en-US/communicator/utilityOverlay.dtd                (resources/locale/en-US/utilityOverlay.dtd) 
         locale/en-US/communicator/utilityOverlay.properties         (resources/locale/en-US/utilityOverlay.properties) 
Index: xpfe/communicator/resources/content/nsContextMenu.js
===================================================================
RCS file: /cvsroot/mozilla/xpfe/communicator/resources/content/nsContextMenu.js,v
retrieving revision 1.63.2.4
diff -u -u -w -r1.63.2.4 nsContextMenu.js
--- xpfe/communicator/resources/content/nsContextMenu.js	9 Jun 2002 08:31:25 -0000	1.63.2.4
+++ xpfe/communicator/resources/content/nsContextMenu.js	24 Aug 2002 17:14:12 -0000
@@ -104,7 +104,7 @@
         //this.setItemAttrFromNode( "context-stop", "disabled", "canStop" );
     },
     initSaveItems : function () {
-        this.showItem( "context-savepage", !( this.inDirList || this.isTextSelected || this.onTextInput ) && !( this.onLink && this.onImage ) );
+        this.showItem( "context-savepage", !( this.inDirList || this.isTextSelected || this.onTextInput || this.onLink ) );
 
         // Save link depends on whether we're in a link.
         this.showItem( "context-savelink", this.onSaveableLink );
@@ -140,7 +140,7 @@
     },
     initMiscItems : function () {
         // Use "Bookmark This Link" if on a link.
-        this.showItem( "context-bookmarkpage", !( this.isTextSelected || this.onTextInput ) );
+        this.showItem( "context-bookmarkpage", !( this.isTextSelected || this.onTextInput || this.onLink || this.onImage ) );
         this.showItem( "context-bookmarklink", this.onLink && !this.onMailtoLink );
         this.showItem( "context-searchselect", this.isTextSelected );
         this.showItem( "frame", this.inFrame );
Index: xpfe/communicator/resources/content/utilityOverlay.xul
===================================================================
RCS file: /cvsroot/mozilla/xpfe/communicator/resources/content/utilityOverlay.xul,v
retrieving revision 1.33.10.1
diff -u -u -w -r1.33.10.1 utilityOverlay.xul
--- xpfe/communicator/resources/content/utilityOverlay.xul	10 Apr 2002 03:40:36 -0000	1.33.10.1
+++ xpfe/communicator/resources/content/utilityOverlay.xul	24 Aug 2002 17:14:12 -0000
@@ -230,11 +230,15 @@
         label="&helpMenu.label;"
         accesskey="&helpMenu.accesskey;">
     <menupopup id="helpPopup">
+ 			<menuitem accesskey="&welcomeCommCmd.accesskey;"
+                label="&welcomeCommCmd.label;"
+                oncommand="openTopWin('about:welcome')"/>
       <menuitem accesskey="&releaseCmd.accesskey;"
                 label="&releaseCmd.label;"
                 id="releaseUrl"
-                oncommand="openTopWin('&releaseURL;');"/>
+                oncommand="openTopWin('&releaseURL;')"/>
 
+<!--
       <menuseparator/>
 
       <menuitem class="about"
@@ -242,6 +246,7 @@
                 label="&aboutCommPluginsCmd.label;"
                 id="pluginInfo"
                 oncommand="openTopWin('about:plugins')"/>
+-->
       <menuitem accesskey="&aboutCmd.accesskey;"
                 label="&aboutCmd.label;"
                 id="aboutName"
Index: xpfe/communicator/resources/locale/en-US/MANIFEST
===================================================================
RCS file: /cvsroot/mozilla/xpfe/communicator/resources/locale/en-US/MANIFEST,v
retrieving revision 1.5.120.1
diff -u -u -w -r1.5.120.1 MANIFEST
--- xpfe/communicator/resources/locale/en-US/MANIFEST	10 Apr 2002 03:40:45 -0000	1.5.120.1
+++ xpfe/communicator/resources/locale/en-US/MANIFEST	24 Aug 2002 17:14:12 -0000
@@ -5,3 +5,4 @@
 taskbar.rdf
 taskbarOverlay.dtd
 tasksOverlay.dtd
+welcome.html
Index: xpfe/communicator/resources/locale/en-US/region.properties
===================================================================
RCS file: /cvsroot/mozilla/xpfe/communicator/resources/locale/en-US/region.properties,v
retrieving revision 1.4.8.1
diff -u -u -w -r1.4.8.1 region.properties
--- xpfe/communicator/resources/locale/en-US/region.properties	10 Apr 2002 03:40:46 -0000	1.4.8.1
+++ xpfe/communicator/resources/locale/en-US/region.properties	24 Aug 2002 17:14:12 -0000
@@ -1,7 +1,7 @@
 # search-panel.properties
 #   Localizable URLs
-defaultSearchURL=http://search.netscape.com/cgi-bin/search?charset=UTF-8&search=
-browser.search.defaultenginename=Netscape Search
+defaultSearchURL=http://www.google.com/search?q=
+browser.search.defaultenginename=Google
 
 # sidebar customize/more... panel locale
 intl.content.langcode=en-US
Index: xpfe/communicator/resources/locale/en-US/taskbar.rdf
===================================================================
RCS file: /cvsroot/mozilla/xpfe/communicator/resources/locale/en-US/taskbar.rdf,v
retrieving revision 1.1.178.1
diff -u -u -w -r1.1.178.1 taskbar.rdf
--- xpfe/communicator/resources/locale/en-US/taskbar.rdf	10 Apr 2002 03:40:46 -0000	1.1.178.1
+++ xpfe/communicator/resources/locale/en-US/taskbar.rdf	24 Aug 2002 17:14:12 -0000
@@ -1,18 +1,5 @@
 <?xml version="1.0"?>
-<!DOCTYPE RDF 
-[
-<!-- LOCALIZATION NOTE  (mozillaButton.label): DONT_TRANSLATE -->
-<!ENTITY  mozillaButton.label "Mozilla">
-<!ENTITY  mozillaTooltip.label  "Links to mozilla.org webtools">
-<!-- taskbar popups -->
-<!-- LOCALIZATION NOTE  (bugzillaButton.label): Do NOT translate "Bugzilla" -->
-<!ENTITY  bugzillaButton.label "Go to Bugzilla">
-<!ENTITY  tinderboxButton.label "Look at Tinderbox">
-<!-- LOCALIZATION NOTE  (bonsai.label): Do NOT translate "Bonsai" -->
-<!ENTITY  bonsai.label "Look at Bonsai">
-
-]
->
+<!DOCTYPE RDF [] >
 <RDF:RDF xmlns:RDF="http://www.w3.org/1999/02/22-rdf-syntax-ns#"
          xmlns:NC="http://home.netscape.com/NC-rdf#">
 
@@ -20,9 +7,9 @@
   <RDF:Seq ID="root">
 
     <RDF:li>
-      <RDF:Seq about="urn:taskbar:mozilla-group">
-        <RDF:li resource="urn:taskbar:mozilla-group:bonsai" />
-        <RDF:li resource="urn:taskbar:mozilla-group:bugzilla" />
+      <RDF:Seq about="urn:taskbar:beonex-group">
+        <RDF:li resource="urn:taskbar:beonex-group:homepage" />
+        <RDF:li resource="urn:taskbar:beonex-group:support" />
      </RDF:Seq>
     </RDF:li>
 
@@ -30,18 +17,18 @@
 <!-- root end -->
 
 <!-- Description -->
-<RDF:Description about="urn:taskbar:mozilla-group">
-    <NC:title>&mozillaButton.label;</NC:title>
-    <NC:tooltip>&mozillaTooltip.label;</NC:tooltip>
+<RDF:Description about="urn:taskbar:beonex-group">
+    <NC:title>Beonex</NC:title>
+    <NC:tooltip>Links to the Beonex website</NC:tooltip>
 </RDF:Description>
 
-  <RDF:Description about="urn:taskbar:mozilla-group:bonsai">
-    <NC:title>&bonsai.label;</NC:title> 
-    <NC:content>openTopWin('http://bonsai.mozilla.org/toplevel.cgi?treeid=SeaMonkey')</NC:content>
+  <RDF:Description about="urn:taskbar:beonex-group:homepage">
+    <NC:title>Beonex Homepage</NC:title>
+    <NC:content>openTopWin('http://www.beonex.com')</NC:content>
   </RDF:Description>
 
-  <RDF:Description about="urn:taskbar:mozilla-group:bugzilla">
-    <NC:title>&bugzillaButton.label;</NC:title> 
-    <NC:content>openTopWin('http://bugzilla.mozilla.org')</NC:content>
+  <RDF:Description about="urn:taskbar:beonex-group:support">
+    <NC:title>Support</NC:title>
+    <NC:content>openTopWin('http://www.beonex.com/communicator/support')</NC:content>
   </RDF:Description>
 </RDF:RDF>
Index: xpfe/communicator/resources/locale/en-US/utilityOverlay.dtd
===================================================================
RCS file: /cvsroot/mozilla/xpfe/communicator/resources/locale/en-US/utilityOverlay.dtd,v
retrieving revision 1.19.2.2
diff -u -u -w -r1.19.2.2 utilityOverlay.dtd
--- xpfe/communicator/resources/locale/en-US/utilityOverlay.dtd	15 Apr 2002 14:41:13 -0000	1.19.2.2
+++ xpfe/communicator/resources/locale/en-US/utilityOverlay.dtd	24 Aug 2002 17:14:12 -0000
@@ -85,9 +85,11 @@
 <!ENTITY newTutorCmd.label				"New to The Net Tutorial">  
 <!ENTITY supportChannelCmd.label			"Technical Support"> 
 <!ENTITY interUsersCmd.label				"International Users">  
-<!-- LOCALIZATION NOTE  (helpAtCmd.label): Do NOT translate "Netscape.com" -->
-<!ENTITY helpAtCmd.label				"Help at Netscape.com">
-<!ENTITY releaseCmd.label				"Release Notes">
+<!ENTITY docCommCmd.label			"Documentation">
+<!ENTITY docCommCmd.accesskey	                "d">
+<!ENTITY welcomeCommCmd.label			"Welcome">
+<!ENTITY welcomeCommCmd.accesskey		"w">
+<!ENTITY releaseCmd.label				"Release-Notes">
 <!ENTITY releaseCmd.accesskey				"r">
 <!ENTITY aboutCmd.label					"About &brandShortName;">
 <!ENTITY aboutCmd.accesskey				"A">
Index: xpfe/communicator/resources/locale/en-US/unix/platformCommunicatorOverlay.dtd
===================================================================
RCS file: /cvsroot/mozilla/xpfe/communicator/resources/locale/en-US/unix/platformCommunicatorOverlay.dtd,v
retrieving revision 1.1.20.1
diff -u -u -w -r1.1.20.1 platformCommunicatorOverlay.dtd
--- xpfe/communicator/resources/locale/en-US/unix/platformCommunicatorOverlay.dtd	10 Apr 2002 03:40:53 -0000	1.1.20.1
+++ xpfe/communicator/resources/locale/en-US/unix/platformCommunicatorOverlay.dtd	24 Aug 2002 17:14:12 -0000
@@ -1,12 +1,12 @@
 <!-- unix -->
 <!-- LOCALIZATION NOTE : FILE Do not translate all the Cmd.key and accesskey --> 
 
-<!ENTITY closeCmd.label			"Close">  
+<!ENTITY closeCmd.label			"Close Window">  
 <!ENTITY closeCmd.key			"W">  
 <!ENTITY closeCmd.accesskey		"c">
 
-<!ENTITY quitApplicationCmd.label	"Quit"> 
-<!ENTITY quitApplicationCmd.key		"Q"> 
+<!ENTITY quitApplicationCmd.label	"Quit Communicator"> 
+<!ENTITY quitApplicationCmd.key		""> 
 <!ENTITY quitApplicationCmd.accesskey	"q">
 
 <!ENTITY redoCmd.label			"Redo">  
Index: xpfe/communicator/resources/locale/en-US/win/platformCommunicatorOverlay.dtd
===================================================================
RCS file: /cvsroot/mozilla/xpfe/communicator/resources/locale/en-US/win/platformCommunicatorOverlay.dtd,v
retrieving revision 1.1.20.1
diff -u -u -w -r1.1.20.1 platformCommunicatorOverlay.dtd
--- xpfe/communicator/resources/locale/en-US/win/platformCommunicatorOverlay.dtd	10 Apr 2002 03:40:54 -0000	1.1.20.1
+++ xpfe/communicator/resources/locale/en-US/win/platformCommunicatorOverlay.dtd	24 Aug 2002 17:14:12 -0000
@@ -1,12 +1,12 @@
 <!-- win -->
 <!-- LOCALIZATION NOTE : FILE Do not translate all the Cmd.key and accesskey --> 
 
-<!ENTITY closeCmd.label			"Close">  
+<!ENTITY closeCmd.label			"Close Window">  
 <!ENTITY closeCmd.key			"W">  
 <!ENTITY closeCmd.accesskey		"c">
 
-<!ENTITY quitApplicationCmd.label	"Exit"> 
-<!ENTITY quitApplicationCmd.key		"Q"> 
+<!ENTITY quitApplicationCmd.label	"Exit Communicator"> 
+<!ENTITY quitApplicationCmd.key		""> 
 <!ENTITY quitApplicationCmd.accesskey	"x">
 
 <!ENTITY redoCmd.label			"Redo">  
Index: xpfe/components/jar.mn
===================================================================
RCS file: /cvsroot/mozilla/xpfe/components/jar.mn,v
retrieving revision 1.54.2.4
diff -u -u -w -r1.54.2.4 jar.mn
--- xpfe/components/jar.mn	8 Jun 2002 20:41:04 -0000	1.54.2.4
+++ xpfe/components/jar.mn	24 Aug 2002 17:14:12 -0000
@@ -37,6 +37,7 @@
     content/communicator/pref/pref-history.xul                  (prefwindow/resources/content/pref-history.xul)
     content/communicator/pref/pref-http.xul                     (prefwindow/resources/content/pref-http.xul)
     content/communicator/pref/pref-http.js                      (prefwindow/resources/content/pref-http.js)
+    content/communicator/pref/pref-referrer.xul                 (prefwindow/resources/content/pref-referrer.xul)
     content/communicator/pref/pref-languages.xul                (prefwindow/resources/content/pref-languages.xul)
     content/communicator/pref/pref-languages-add.xul            (prefwindow/resources/content/pref-languages-add.xul)
     content/communicator/pref/pref-languages.js                 (prefwindow/resources/content/pref-languages.js)
@@ -124,6 +125,7 @@
     locale/en-US/communicator/pref/pref-fonts.dtd               (prefwindow/resources/locale/en-US/pref-fonts.dtd)
     locale/en-US/communicator/pref/pref-history.dtd             (prefwindow/resources/locale/en-US/pref-history.dtd)
     locale/en-US/communicator/pref/pref-http.dtd                (prefwindow/resources/locale/en-US/pref-http.dtd)
+    locale/en-US/communicator/pref/pref-referrer.dtd            (prefwindow/resources/locale/en-US/pref-referrer.dtd)
     locale/en-US/communicator/pref/pref-languages.dtd           (prefwindow/resources/locale/en-US/pref-languages.dtd)
     locale/en-US/communicator/pref/pref-languages.properties    (prefwindow/resources/locale/en-US/pref-languages.properties)
     locale/en-US/communicator/pref/pref-navigator.dtd           (prefwindow/resources/locale/en-US/pref-navigator.dtd)
Index: xpfe/components/bookmarks/resources/addBookmark.xul
===================================================================
RCS file: /cvsroot/mozilla/xpfe/components/bookmarks/resources/addBookmark.xul,v
retrieving revision 1.23.2.1
diff -u -u -w -r1.23.2.1 addBookmark.xul
--- xpfe/components/bookmarks/resources/addBookmark.xul	10 Apr 2002 03:41:15 -0000	1.23.2.1
+++ xpfe/components/bookmarks/resources/addBookmark.xul	24 Aug 2002 17:14:13 -0000
@@ -36,7 +36,7 @@
 %addBookmarkDTD;
 ]>
 
-<dialog id="newBookmarkDialog" style="width: 36em;"
+<dialog id="newBookmarkDialog" style="width: 36em; height: 36em;"
         xmlns="http://www.mozilla.org/keymaster/gatekeeper/there.is.only.xul"
         ondialogaccept="return onOK(event)"
         title="&newBookmark.title;" title-selectFolder="&selectFolder.label;"
Index: xpfe/components/prefwindow/resources/content/pref-advanced.xul
===================================================================
RCS file: /cvsroot/mozilla/xpfe/components/prefwindow/resources/content/pref-advanced.xul,v
retrieving revision 1.70.2.2
diff -u -u -w -r1.70.2.2 pref-advanced.xul
--- xpfe/components/prefwindow/resources/content/pref-advanced.xul	26 May 2002 16:37:09 -0000	1.70.2.2
+++ xpfe/components/prefwindow/resources/content/pref-advanced.xul	24 Aug 2002 17:14:13 -0000
@@ -136,6 +136,8 @@
                 prefstring="security.enable_java"/>
       <checkbox id="advancedXSLTAllow" label="XSLT" preftype="bool" pref="true" prefstring="xslt.enabled"/>
     </vbox>
+
+    <vbox hidden="true">
     <vbox>
       <separator/>
       <description>&description.label;</description>
@@ -153,7 +155,13 @@
                flex="2"/>
     </hbox>
     </vbox>
+    <vbox>
+      <separator/>
+      <html>&description.label;</html>
     <separator/>
+    </vbox>
+    <separator/>
+    </vbox>
   </groupbox>
   <groupbox id="perfSettings">
     <caption id="perfLabel" label="&perfTitle.label;"/>
Index: xpfe/components/prefwindow/resources/content/pref-smartupdate.xul
===================================================================
RCS file: /cvsroot/mozilla/xpfe/components/prefwindow/resources/content/pref-smartupdate.xul,v
retrieving revision 1.43.2.1
diff -u -u -w -r1.43.2.1 pref-smartupdate.xul
--- xpfe/components/prefwindow/resources/content/pref-smartupdate.xul	10 Apr 2002 03:42:29 -0000	1.43.2.1
+++ xpfe/components/prefwindow/resources/content/pref-smartupdate.xul	24 Aug 2002 17:14:13 -0000
@@ -18,28 +18,33 @@
         getService(Components.interfaces.nsIPrefBranch);
       if (!prefs.getBoolPref("update_notifications.enabled"))
       {
-        // disable frequency radiogroup
-        var freqWeekly = document.getElementById("freqWeekly");
-        var freqMonthly = document.getElementById("freqMonthly");
-        freqWeekly.setAttribute("disabled", "true");
-        freqMonthly.setAttribute("disabled", "true");
+        enableFrequency(false);
       }
     }
 
     function toggleFrequency()
     {
       var enabled = document.getElementById("updateNotificationsEnabled");
+      enableFrequency(enabled.getAttribute("checked") == "true");
+    }
+
+    function enableFrequency(enable)
+    {
+      var freqDaily = document.getElementById("freqDaily");
       var freqWeekly = document.getElementById("freqWeekly");
       var freqMonthly = document.getElementById("freqMonthly");
-      if (enabled.getAttribute("checked") == "true")
+
+      if (enable)
       {
         // enable frequency radiogroup
+        freqDaily.removeAttribute("disabled");
         freqWeekly.removeAttribute("disabled");
         freqMonthly.removeAttribute("disabled");
       }
       else
       {
         // disable frequency radiogroup
+        freqDaily.setAttribute("disabled", "true");
         freqWeekly.setAttribute("disabled", "true");
         freqMonthly.setAttribute("disabled", "true");
       }
@@ -60,8 +65,9 @@
               accesskey="&enableUN.accesskey;" oncommand="toggleFrequency();"
               prefstring="update_notifications.enabled"/>
     <radiogroup id="updateFrequency" orient="horizontal" 
-                prefstring="update_notifications.provider.0.frequency"
-                prefdefval="7">
+                prefstring="update_notifications.provider.0.frequency">
+      <radio id="freqDaily" label="&daily.label;" 
+             accesskey="&daily.accesskey;" value="1"/>
       <radio id="freqWeekly" label="&weekly.label;" 
              accesskey="&weekly.accesskey;" value="7"/>
       <radio id="freqMonthly" label="&monthly.label;" 
Index: xpfe/components/prefwindow/resources/content/preftree.xul
===================================================================
RCS file: /cvsroot/mozilla/xpfe/components/prefwindow/resources/content/preftree.xul,v
retrieving revision 1.93.2.5
diff -u -u -w -r1.93.2.5 preftree.xul
--- xpfe/components/prefwindow/resources/content/preftree.xul	8 Jun 2002 20:41:08 -0000	1.93.2.5
+++ xpfe/components/prefwindow/resources/content/preftree.xul	24 Aug 2002 17:14:13 -0000
@@ -119,7 +119,13 @@
       <treerow>
         <treecell url="chrome://communicator/content/pref/pref-security.xul" label="&security.label;" />
       </treerow>
-      <treechildren id="securityChildren"/>
+      <treechildren id="securityChildren">
+        <treeitem>
+          <treerow>
+            <treecell url="chrome://communicator/content/pref/pref-referrer.xul" label="&referrer.label;"/>
+          </treerow>
+        </treeitem>
+      </treechildren>
     </treeitem>
 
     <treeitem container="true" id="advancedItem">
@@ -159,6 +165,9 @@
         </treeitem> 
       </treechildren>
     </treeitem>
+
+<!-- debug stuff
+-->
 
     <treeitem id="offlineItem">
       <treerow>
Index: xpfe/components/prefwindow/resources/locale/en-US/pref-advanced.dtd
===================================================================
RCS file: /cvsroot/mozilla/xpfe/components/prefwindow/resources/locale/en-US/pref-advanced.dtd,v
retrieving revision 1.23.2.1
diff -u -u -w -r1.23.2.1 pref-advanced.dtd
--- xpfe/components/prefwindow/resources/locale/en-US/pref-advanced.dtd	10 Apr 2002 03:42:37 -0000	1.23.2.1
+++ xpfe/components/prefwindow/resources/locale/en-US/pref-advanced.dtd	24 Aug 2002 17:14:14 -0000
@@ -10,13 +10,16 @@
 <!ENTITY enbJavaCheck.label           "Enable Java">
 <!ENTITY enbJavaCheck.accesskey       "j">
 
+<!ENTITY enbPopupCheck.label          "Disable new popup windows during page (un)load">
+<!ENTITY enbPopupCheck.accesskey      "p">
+
 <!ENTITY sendAddFtpCheck.label        "Send this email address as anonymous FTP password:">
 <!ENTITY sendAddFtpCheck.accesskey    "e">
 
 <!ENTITY imageBlocking.label          "Image Blocking...">
 <!ENTITY imageBlocking.accesskey      "b">
 
-<!ENTITY description.label            "Checked items are automatically enabled when you visit web pages that use them. If you uncheck an item, pages may load faster but some functionality will be limited.">
+<!ENTITY description.label            "Checked items are automatically enabled when you visit content that uses them. If you uncheck an item, it may increase security or privacy, but some functionality will be limited.">
 
 <!ENTITY perfTitle.label              "Enable features that increase performance">
 <!ENTITY enableTurbo.label            "Enable Quick Launch">
Index: xpfe/components/prefwindow/resources/locale/en-US/pref-smart_browsing.dtd
===================================================================
RCS file: /cvsroot/mozilla/xpfe/components/prefwindow/resources/locale/en-US/pref-smart_browsing.dtd,v
retrieving revision 1.26.8.2
diff -u -u -w -r1.26.8.2 pref-smart_browsing.dtd
--- xpfe/components/prefwindow/resources/locale/en-US/pref-smart_browsing.dtd	20 Jun 2002 01:30:36 -0000	1.26.8.2
+++ xpfe/components/prefwindow/resources/locale/en-US/pref-smart_browsing.dtd	24 Aug 2002 17:14:14 -0000
@@ -5,7 +5,7 @@
 
 <!--LOCALIZATION NOTE (internetKeywordsHeader.label): DONT_TRANSLATE -->
 <!ENTITY  internetKeywordsHeader.label          "Internet Keywords">
-<!ENTITY  internetKeywordsDescription.label     "&brandShortName; Internet Keywords enables fast access to services such as stock quotes, search and other information from the Location bar.">
+<!ENTITY  internetKeywordsDescription.label     "Internet Keywords enable fast access to services such as stock quotes, search and other information from the Location bar.">
 <!ENTITY  moreInformation.label                 "More Information...">
 <!ENTITY  moreInformation.accesskey             "m">
 <!--LOCALIZATION NOTE (enableKeyCheck.label): Do not translate 'Internet Keywords' -->
Index: xpfe/components/prefwindow/resources/locale/en-US/pref-smartupdate.dtd
===================================================================
RCS file: /cvsroot/mozilla/xpfe/components/prefwindow/resources/locale/en-US/pref-smartupdate.dtd,v
retrieving revision 1.12.8.1
diff -u -u -w -r1.12.8.1 pref-smartupdate.dtd
--- xpfe/components/prefwindow/resources/locale/en-US/pref-smartupdate.dtd	10 Apr 2002 03:42:39 -0000	1.12.8.1
+++ xpfe/components/prefwindow/resources/locale/en-US/pref-smartupdate.dtd	24 Aug 2002 17:14:14 -0000
@@ -1,7 +1,7 @@
 <!--LOCALIZATION NOTE : FILE UI for Software Updates prefs -->
 <!ENTITY lHeader                              "Software Installation">
 <!ENTITY smartTitle.label                     "Manage Software Installations and Updates">
-<!ENTITY enableSU.label                       "Enable software installation. (You will be prompted for each update.)">
+<!ENTITY enableSU.label                       "Enable software installation. (You will be prompted before each update.)">
 
 <!ENTITY enableSU.accesskey                   "e">
 <!ENTITY enableNotification.label             "Notify me when new and updated software is available">
@@ -11,11 +11,12 @@
 <!ENTITY selectUninstall.label                "To uninstall, select from the following list and click the uninstall button">
 <!ENTITY uninstallButton.label                "Uninstall">
 <!ENTITY uninstallButton.accesskey            "u">
-
 <!ENTITY updateNotifications.label            "Update Notifications">
 <!ENTITY updateNotifications.desc             "Check for new versions of this software.  No information about you or your computer will be revealed during this operation.">
 <!ENTITY enableUN.label                       "Check for updates:">
 <!ENTITY enableUN.accesskey                   "c">
+<!ENTITY daily.label                          "daily">
+<!ENTITY daily.accesskey                      "d">
 <!ENTITY weekly.label                         "weekly">
 <!ENTITY weekly.accesskey                     "w">
 <!ENTITY monthly.label                        "monthly">
Index: xpfe/components/prefwindow/resources/locale/en-US/preftree.dtd
===================================================================
RCS file: /cvsroot/mozilla/xpfe/components/prefwindow/resources/locale/en-US/preftree.dtd,v
retrieving revision 1.46.2.5
diff -u -u -w -r1.46.2.5 preftree.dtd
--- xpfe/components/prefwindow/resources/locale/en-US/preftree.dtd	8 Jun 2002 20:41:11 -0000	1.46.2.5
+++ xpfe/components/prefwindow/resources/locale/en-US/preftree.dtd	24 Aug 2002 17:14:14 -0000
@@ -21,6 +21,7 @@
 <!ENTITY publish.label "Publish">
 <!ENTITY offline.label "Offline &amp; Disk Space">
 <!ENTITY security.label "Privacy &amp; Security">
+<!ENTITY referrer.label "HTTP Referrer">
 <!ENTITY advance.label "Advanced">
 <!ENTITY down.label "Download">
 <!ENTITY cache.label "Cache">
Index: xpfe/components/search/datasets/MANIFEST
===================================================================
RCS file: /cvsroot/mozilla/xpfe/components/search/datasets/MANIFEST,v
retrieving revision 1.21.140.1
diff -u -u -w -r1.21.140.1 MANIFEST
--- xpfe/components/search/datasets/MANIFEST	10 Apr 2002 03:42:59 -0000	1.21.140.1
+++ xpfe/components/search/datasets/MANIFEST	24 Aug 2002 17:14:14 -0000
@@ -1,12 +1,16 @@
-bugzilla.gif
-bugzilla.src
-dmoz.gif
-dmoz.src
+ICQ.gif
+ICQ.src
 google.gif
 google.src
-lxrmozilla.gif
-lxrmozilla.src
-mozilla.gif
-mozilla.src
-NetscapeSearch.gif
-NetscapeSearch.src
+Lycos.gif
+Lycos.src
+HotBot.gif
+HotBot.src
+Excite.gif
+Excite.src
+eBay.gif
+eBay.src
+monster.gif
+monster.src
+dmoz.gif
+dmoz.src
Index: xpfe/components/search/datasets/Makefile.in
===================================================================
RCS file: /cvsroot/mozilla/xpfe/components/search/datasets/Makefile.in,v
retrieving revision 1.28.16.2
diff -u -u -w -r1.28.16.2 Makefile.in
--- xpfe/components/search/datasets/Makefile.in	24 May 2002 22:43:24 -0000	1.28.16.2
+++ xpfe/components/search/datasets/Makefile.in	24 Aug 2002 17:14:14 -0000
@@ -27,18 +27,22 @@
 include $(DEPTH)/config/autoconf.mk
 
 FILES		= \
-	bugzilla.gif        \
-	bugzilla.src        \
-	dmoz.gif            \
-	dmoz.src            \
+ICQ.gif \
+ICQ.src \
 	google.gif          \
 	google.src          \
-	lxrmozilla.gif      \
-	lxrmozilla.src      \
-	mozilla.gif         \
-	mozilla.src         \
-	NetscapeSearch.gif  \
-	NetscapeSearch.src  \
+Lycos.gif \
+Lycos.src \
+HotBot.gif \
+HotBot.src \
+Excite.gif \
+Excite.src \
+eBay.gif \
+eBay.src \
+monster.gif \
+monster.src \
+dmoz.gif \
+dmoz.src \
 	$(NULL)
 
 include $(topsrcdir)/config/rules.mk
Index: xpfe/components/search/datasets/NetscapeSearch.src
===================================================================
RCS file: /cvsroot/mozilla/xpfe/components/search/datasets/NetscapeSearch.src,v
retrieving revision 1.12.20.1
diff -u -u -w -r1.12.20.1 NetscapeSearch.src
--- xpfe/components/search/datasets/NetscapeSearch.src	10 Apr 2002 03:42:59 -0000	1.12.20.1
+++ xpfe/components/search/datasets/NetscapeSearch.src	24 Aug 2002 17:14:14 -0000
@@ -1,48 +1,59 @@
-# Netscape Search Sherlock for Netscape 6
-# Copyright (c) 2000 Netscape Communications Corp.
-#
-# The BROWSER alsomatch= tags must be there or the GIF will not update!
-#
+# Netscape Search - Sherlock Plug-in for Navigator 6.0
+# Copyright (C)2000 Netscape Communications Corp.
 
  <SEARCH
    name            = "Netscape Search"
    description     = "Netscape Search"
-   routeType       = "Internet"
    method          = "GET"
-   action          = "http://info.netscape.com/fwd/clk61srsid/http://search.netscape.com/search.psp"
-   actionButton    = "http://info.netscape.com/fwd/clk61srurl1/http://search.netscape.com/search.psp?search="
-   actionBar       = "http://info.netscape.com/fwd/clk61srurl2/http://search.netscape.com/search.psp?search="
+	action="http://info.netscape.com/fwd/sidb_ns/http://search.netscape.com/cgi-bin/search"
+	queryCharset="UTF-8"
  >
 
-<INPUT NAME="search" USER>
+<INPUT NAME="search" user>
+<INPUT NAME="charset" VALUE="UTF-8">
 
+<INTERPRET
+	browserResultType = "result"
+	bannerStart="<!--AD_TAG VENDOR=AOL WIDTH=468 HEIGHT=60-->"
+	bannerEnd="<!--/AD_TAG-->"
+	resultListStart = "<!----**Netcenter**---->"
+	resultListEnd = "Groups of reviewed web sites related to your search term."
+	resultItemStart = "<LI>"
+>
 
-# Search Results
+<INTERPRET
+	browserResultType = "category"
+	bannerStart="<!--AD_TAG VENDOR=AOL WIDTH=468 HEIGHT=60-->"
+	bannerEnd="<!--/AD_TAG-->"
+	resultListStart = "Groups of reviewed web sites related to your search term."
+	resultListEnd = "Web sites reviewed and categorized by a team of editors."
+	resultItemStart = "<LI>"
+	nameStart = '">'
+	nameEnd = "</FONT>"
+>
 
 <INTERPRET
-  charset           = "ISO-8859-1"
   browserResultType = "result"
-  bannerStart       = "<!-- START: AOL BANNER AD -->"
-  bannerEnd         = "<!-- END: AOL BANNER AD -->"
-  resultListStart   = "<!-- BEGIN SEARCH RESULTS-->"
-  resultListEnd     = "<!-- END SEARCH RESULTS -->"
-  resultItemStart   = "<li>"
-  resultItemEnd     = "<br>"
-  relevanceStart    = ""
-  relevanceEnd      = ""
-  resultItemSiteTag = ""
+	bannerStart="<!--AD_TAG VENDOR=AOL WIDTH=468 HEIGHT=60-->"
+	bannerEnd="<!--/AD_TAG-->"
+	resultListStart = "Web sites reviewed and categorized by a team of editors."
+	resultItemStart = "<LI>"
 >
 
+<INTERPRET
+	browserResultType = "result"
+	bannerStart="<!--AD_TAG VENDOR=AOL WIDTH=468 HEIGHT=60-->"
+	bannerEnd="<!--/AD_TAG-->"
+	resultListStart = "The Google search engine found these pages."
+	resultListEnd = "</TD>"
+	resultItemStart = "<LI>"
+>
 
 </SEARCH>
 
-  
-
 <BROWSER
-  alsomatch="http://search.netscape.com/search.psp http://search.netscape.com/cgi-bin/search http://search.netscape.com/search.tmpl http://search.netscape.com/google.tmpl"
-  update          = "http://search.netscape.com/sherlock/SBWeb_01.src" 
-  updateIcon      = "http://search.netscape.com/sherlock/SBWeb_01.gif" 
-  updateCheckDays = "1" 
-
+      alsomatch="http://search.netscape.com/cgi-bin/search http://search.netscape.com/search.tmpl http://google.netscape.com/netscape"
+      update="http://search.netscape.com/sherlock/NetscapeSearch.src" 
+      updateIcon="http://search.netscape.com/sherlock/NetscapeSearch.gif" 
+      updateCheckDays="3"
 >
-
Index: xpfe/components/search/datasets/dmoz.src
===================================================================
RCS file: /cvsroot/mozilla/xpfe/components/search/datasets/dmoz.src,v
retrieving revision 1.1.140.1
diff -u -u -w -r1.1.140.1 dmoz.src
--- xpfe/components/search/datasets/dmoz.src	10 Apr 2002 03:42:59 -0000	1.1.140.1
+++ xpfe/components/search/datasets/dmoz.src	24 Aug 2002 17:14:14 -0000
@@ -4,7 +4,7 @@
 
 <SEARCH
 	name="dmoz.org"
-	description = "dmoz.org"
+	description = "dmoz.org - Directory - Maintained by volunteers, owned by Netscape"
 	method="GET"
 	action="http://search.dmoz.org/cgi-bin/search"
 >
@@ -26,9 +26,3 @@
 >
 
 </SEARCH>
-
-<BROWSER
-      update="http://www.mozilla.org/projects/search/dmoz.src" 
-      updateIcon="http://www.mozilla.org/projects/search/dmoz.gif" 
-      updateCheckDays="3"
->
Index: xpfe/components/search/datasets/google.src
===================================================================
RCS file: /cvsroot/mozilla/xpfe/components/search/datasets/google.src,v
retrieving revision 1.2.2.1
diff -u -u -w -r1.2.2.1 google.src
--- xpfe/components/search/datasets/google.src	10 Apr 2002 03:42:59 -0000	1.2.2.1
+++ xpfe/components/search/datasets/google.src	24 Aug 2002 17:14:14 -0000
@@ -2,11 +2,9 @@
 
 <search 
    name="Google"
-   description="Google Search"
+   description="Google - Web Search"
    method="GET"
    action="http://www.google.com/search"
-   update="http://www.google.com/mozilla/google.src"
-   updateCheckDays=1   
 >
 
 <input name="q" user>
Index: xpfe/components/search/datasets/makefile.win
===================================================================
RCS file: /cvsroot/mozilla/xpfe/components/search/datasets/Attic/makefile.win,v
retrieving revision 1.25.22.1
diff -u -u -w -r1.25.22.1 makefile.win
--- xpfe/components/search/datasets/makefile.win	10 Apr 2002 03:43:00 -0000	1.25.22.1
+++ xpfe/components/search/datasets/makefile.win	24 Aug 2002 17:14:14 -0000
@@ -24,19 +24,23 @@
 include <$(DEPTH)\config\rules.mak>
 
 FILES=\
-	bugzilla.gif        \
-	bugzilla.src        \
-	dmoz.gif            \
-	dmoz.src            \
+ICQ.gif \
+ICQ.src \
 	google.gif          \
 	google.src          \
-	lxrmozilla.gif      \
-	lxrmozilla.src      \
-	mozilla.gif         \
-	mozilla.src         \
-	NetscapeSearch.gif  \
-	NetscapeSearch.src  \
+Lycos.gif \
+Lycos.src \
+HotBot.gif \
+HotBot.src \
+Excite.gif \
+Excite.src \
+eBay.gif \
+eBay.src \
+monster.gif \
+monster.src \
+dmoz.gif \
+dmoz.src \
     $(NULL)
 
-libs:: $(FILES:/=\)
+install:: $(FILES:/=\)
 	!@$(MAKE_INSTALL) $** $(DIST)\bin\searchplugins
Index: xpfe/components/sidebar/resources/local-panels.rdf
===================================================================
RCS file: /cvsroot/mozilla/xpfe/components/sidebar/resources/local-panels.rdf,v
retrieving revision 1.20.52.1
diff -u -u -w -r1.20.52.1 local-panels.rdf
--- xpfe/components/sidebar/resources/local-panels.rdf	10 Apr 2002 03:43:23 -0000	1.20.52.1
+++ xpfe/components/sidebar/resources/local-panels.rdf	24 Aug 2002 17:14:15 -0000
@@ -28,17 +28,12 @@
   <rdf:Description about="urn:sidebar:master-panel-list">
     <nc:panel-list>
       <rdf:Seq>
-        <rdf:li resource="urn:sidebar:panel:whats-related"/>
         <rdf:li resource="urn:sidebar:panel:search"/>
         <rdf:li resource="urn:sidebar:panel:bookmarks"/>
         <rdf:li resource="urn:sidebar:panel:history"/>
         <rdf:li resource="urn:sidebar:panel:addressbook"/>
       </rdf:Seq>
     </nc:panel-list>
-  </rdf:Description>
-  <rdf:Description about="urn:sidebar:panel:whats-related">
-    <nc:title>&sidebar.whats-related.label;</nc:title>
-    <nc:content>chrome://communicator/content/related/related-panel.xul</nc:content>
   </rdf:Description>
   <rdf:Description about="urn:sidebar:panel:search">
     <nc:title>&sidebar.search.label;</nc:title>
Index: xpfe/components/sidebar/resources/sidebarOverlay.js
===================================================================
RCS file: /cvsroot/mozilla/xpfe/components/sidebar/resources/sidebarOverlay.js,v
retrieving revision 1.100.2.4
diff -u -u -w -r1.100.2.4 sidebarOverlay.js
--- xpfe/components/sidebar/resources/sidebarOverlay.js	11 Jun 2002 14:38:02 -0000	1.100.2.4
+++ xpfe/components/sidebar/resources/sidebarOverlay.js	24 Aug 2002 17:14:15 -0000
@@ -398,7 +398,7 @@
         content.removeAttribute('hidden');
         content.removeAttribute('collapsed');
 
-        if (sidebarObj.collapsed && panel.is_sandboxed()) {
+        if (sidebarObj.collapsed) {
           if (!panel.is_persistent()) {
             debug("    set src=about:blank");
             iframe.setAttribute('src', 'about:blank');
@@ -444,10 +444,6 @@
             iframe.setAttribute('loadstate', 'never loaded');
           }
         }
-        if (panel.is_sandboxed()) {
-          if (!panel.is_persistent())
-            iframe.setAttribute('src', 'about:blank');
-        }
       }
     }
   }
@@ -900,7 +896,7 @@
     url = prefs.getCharPref("sidebar.customize.all_panels.url");
     url = url.replace(/%SIDEBAR_VERSION%/g, SIDEBAR_VERSION);
   } catch(ex) {
-    debug("Unable to get remote url pref. What now? "+ex);
+    debug("Unable to get pref |sidebar.customize.all_panels.url|. "+ex);
   }
   try {
     locale = prefs.getComplexValue("intl.content.langcode",
@@ -913,8 +909,14 @@
       locale = prefs.getComplexValue("general.useragent.locale",
                                      Components.interfaces.nsIPrefLocalizedString);
   } catch(ex) {
-      debug("Unable to get system locale. What now? "+ex);
+      locale = "en";
+      debug("Unable to get system locale. Falling back to 'en'. "+ex);
     }
+  }
+  if (!locale || locale == "")
+  {
+    locale = "en";
+    debug("Have empty locale. Falling back to 'en'.");
   }
   locale = locale.data.toLowerCase();
   url = url.replace(/%LOCALE%/g, locale);
Index: xpfe/components/updates/src/nsUpdateNotifier.js
===================================================================
RCS file: /cvsroot/mozilla/xpfe/components/updates/src/nsUpdateNotifier.js,v
retrieving revision 1.3.2.2
diff -u -u -w -r1.3.2.2 nsUpdateNotifier.js
--- xpfe/components/updates/src/nsUpdateNotifier.js	25 Apr 2002 00:52:18 -0000	1.3.2.2
+++ xpfe/components/updates/src/nsUpdateNotifier.js	24 Aug 2002 17:14:16 -0000
@@ -36,7 +36,8 @@
  * ***** END LICENSE BLOCK ***** */
 
 const kDebug               = false;
-const kUpdateCheckDelay    = 5 * 60 * 1000; // 5 minutes
+const kUpdateCheckStartDelay = 5 * 60 * 1000; // 5 minutes after startup
+const kUpdateCheckMinFreq  = 6 * 60 * 60 * 1000; // then every 6 hours
 const kUNEnabledPref       = "update_notifications.enabled";
 const kUNDatasourceURIPref = "update_notifications.provider.0.datasource";
 const kUNFrequencyPref     = "update_notifications.provider.0.frequency";
@@ -75,14 +76,9 @@
 
     if (aTopic == "domwindowopened")
     {
+      this.setTimer(kUpdateCheckStartDelay);
       try 
       {
-        const kIScriptableTimer = Components.interfaces.nsIScriptableTimer;
-        mTimer = Components.classes["@mozilla.org/timer;1"].
-          createInstance(kIScriptableTimer);
-        mTimer.init(this, kUpdateCheckDelay, kIScriptableTimer.PRIORITY_NORMAL,
-          kIScriptableTimer.TYPE_ONE_SHOT);
-
         // we are no longer interested in the ``domwindowopened'' topic
         var observerService = Components.
           classes["@mozilla.org/observer-service;1"].
@@ -91,13 +87,30 @@
       }
       catch (ex)
       {
-        debug("Exception init'ing timer: " + ex);
+        debug("Exception removing observer for update notification: " + ex);
       }
     }
     else if (aTopic == "timer-callback")
     {
       mTimer = null; // free up timer so it can be gc'ed
       this.checkForUpdate();
+      this.setTimer(kUpdateCheckMinFreq);
+    }
+  },
+
+  setTimer: function(delay)
+  {
+    try 
+    {
+      const kIScriptableTimer = Components.interfaces.nsIScriptableTimer;
+      mTimer = Components.classes["@mozilla.org/timer;1"].
+        createInstance(kIScriptableTimer);
+      mTimer.init(this, delay, kIScriptableTimer.PRIORITY_NORMAL,
+        kIScriptableTimer.TYPE_ONE_SHOT);
+    }
+    catch (ex)
+    {
+      debug("Exception init'ing timer: " + ex);
     }
   },
 
Index: xpfe/global/jar.mn
===================================================================
RCS file: /cvsroot/mozilla/xpfe/global/jar.mn,v
retrieving revision 1.56.2.1
diff -u -u -w -r1.56.2.1 jar.mn
--- xpfe/global/jar.mn	10 Apr 2002 03:44:14 -0000	1.56.2.1
+++ xpfe/global/jar.mn	24 Aug 2002 17:14:17 -0000
@@ -16,6 +16,7 @@
         content/global/config.xul                   (resources/content/config.xul) 
         content/global/config.css                   (resources/content/config.css) 
         content/global/config.js                    (resources/content/config.js) 
+        content/global/credits.html                 (resources/content/credits.html) 
         content/global/mozilla.html                 (resources/content/mozilla.html) 
         content/global/plugins.html                 (resources/content/plugins.html) 
         content/global/charsetOverlay.xul           (resources/content/charsetOverlay.xul) 
@@ -96,6 +97,7 @@
     locale/en-US/global/languageNames.properties    (resources/locale/en-US/languageNames.properties) 
     locale/en-US/global/regionNames.properties      (resources/locale/en-US/regionNames.properties) 
     locale/en-US/global/about.html                  (resources/locale/en-US/about.html) 
+    locale/en-US/global/license.html                   (resources/locale/en-US/license.html) 
     locale/en-US/global/commonDialogs.properties    (resources/locale/en-US/commonDialogs.properties) 
     locale/en-US/global/plugins.properties          (resources/locale/en-US/plugins.properties) 
     locale/en-US/global/nsTreeSorting.properties    (resources/locale/en-US/nsTreeSorting.properties)
Index: xpfe/global/resources/content/logo.gif
===================================================================
RCS file: /cvsroot/mozilla/xpfe/global/resources/content/logo.gif,v
retrieving revision 1.4.164.1
diff -u -u -w -r1.4.164.1 logo.gif
Binary files /tmp/cvsWqgv9_ and logo.gif differ
Index: xpfe/global/resources/locale/en-US/MANIFEST
===================================================================
RCS file: /cvsroot/mozilla/xpfe/global/resources/locale/en-US/MANIFEST,v
retrieving revision 1.18.16.1
diff -u -u -w -r1.18.16.1 MANIFEST
--- xpfe/global/resources/locale/en-US/MANIFEST	10 Apr 2002 03:44:37 -0000	1.18.16.1
+++ xpfe/global/resources/locale/en-US/MANIFEST	24 Aug 2002 17:14:17 -0000
@@ -1,5 +1,7 @@
 intl.css
 about.html
+plugins.html
+license.html
 globalOverlay.dtd
 dialogOverlay.dtd
 builtinURLs.rdf
Index: xpfe/global/resources/locale/en-US/about.html
===================================================================
RCS file: /cvsroot/mozilla/xpfe/global/resources/locale/en-US/Attic/about.html,v
retrieving revision 1.13.2.7
diff -u -u -w -r1.13.2.7 about.html
--- xpfe/global/resources/locale/en-US/about.html	1 Jul 2002 17:58:04 -0000	1.13.2.7
+++ xpfe/global/resources/locale/en-US/about.html	24 Aug 2002 17:14:17 -0000
@@ -1,112 +1,35 @@
-<?xml version="1.0" encoding="UTF-8"?>
-<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN"
-    "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">
-
-<!--
-   - The contents of this file are subject to the Netscape Public
-   - License Version 1.1 (the "License"); you may not use this file
-   - except in compliance with the License. You may obtain a copy of
-   - the License at http://www.mozilla.org/NPL/
-   -  
-   - Software distributed under the License is distributed on an "AS
-   - IS" basis, WITHOUT WARRANTY OF ANY KIND, either express or
-   - implied. See the License for the specific language governing
-   - rights and limitations under the License.
-   -  
-   - The Original Code is Mozilla Communicator client code, released
-   - March 31, 1998.
-   - 
-   - The Initial Developer of the Original Code is Netscape
-   - Communications Corporation. Portions created by Netscape are
-   - Copyright (C) 1998-1999 Netscape Communications Corporation. All
-   - Rights Reserved.
-   - 
-   - Contributor(s): 
-   -    Henrik Gemal <mozilla@gemal.dk>
-   -    Daniel Veditz <dveditz@netscape.com>
-   -    Alexey Chernyak <alexeyc@bigfoot.com>
--->
-  
-<html xmlns="http://www.w3.org/1999/xhtml">
+<html>
 <head>
-<title>About:</title>
-<style type="text/css">
-table {
-  margin: auto;
-  text-align: center;
-}
-img {
-  border: 0;
-}
-p {
-  font-size: smaller;
-}
-h1 {
-  margin: 0;
-}
-:link {
-  color: #00e;
-}
-:visited {
-  color: #551a8b;
-}
-:active {
-  color: #f00;
-}
-</style>
+<title>About Beonex Communicator</title>
 </head>
-<body>
-
+<body bgcolor="#FFFFFF" text="#000000" link="#0000EE" vlink="#551A8B" alink="#FF0000">
+<div align="center">
 <table>
-<tbody>
 <tr>
-
-<td>
-<a href="http://www.mozilla.org/">
-<img src="chrome://global/content/logo.gif" alt="Mozilla" width="200" height="200" /></a>
-</td>
-
-<td id="mozver">
+<td align="center">
 <h1>
-<a id="mozlink" href="http://www.mozilla.org/releases/mozilla1.0/">Mozilla </a>
+<a href="http://www.beonex.com/communicator/version/0.8">Beonex Communicator 0.8.1-stable</script></a>
 </h1>
-<script type="application/x-javascript">
-  // using try..catch to handle empty useragents and other cases where the regex fails to apply
-  try {
-    document.getElementById("mozver").appendChild(document.createTextNode(navigator.userAgent));
-    document.getElementById("mozlink").firstChild.appendData(navigator.userAgent.match(/rv:([^;)]+)/)[1]);
-  }
-  catch (e) {}
-</script>
+<!-- work around a "certain" bug
+<script language="JavaScript">document.write(navigator.userAgent);</script>
+-->
+</td>
+<td>
+<a href="http://www.beonex.com"><img src="chrome://global/content/logo.gif" border="0" alt="Beonex"></a>
 </td>
-
 </tr>
-</tbody>
 </table>
-
-<hr />
-
-<ul>
-<li>Copyright &copy; 1998-2002 by <a href="about:credits">Contributors</a> to 
-the Mozilla codebase under the <a href="chrome://global/content/MPL-1.1.html">
-Mozilla Public License</a> and <a href="chrome://global/content/NPL-1.1.html">
-Netscape Public License</a>.  All Rights Reserved.</li>
-<li>Portions of this software are copyright &copy; 1994 The Regents of the 
-University of California.  All Rights Reserved.</li>
-<li>Portions of this software are copyright &copy; 1997-1999 
-<a href="http://www.support.com/">Support.com, Inc.  All Rights Reserved.</a>
-</li>
-</ul>
-
+</div>
+<br>
+<br>
+<p>
+<a href="http://webcab.de/cgi-bin/httph.cgi/c?h=USER_AGENT">Display user-agent identification</a>
+<p>
+Copyright &copy; 1998-2002 by <a href="about:credits">Contributors</a> to the Mozilla codebase under the <a href="about:licence">Mozilla Public License and Netscape Public License</a>.
+<p>
+Beonex is a trademark of <a href="http://www.bucksch.com">Ben Bucksch</a>.
+All other trademarks and service marks are the property of their respective owners.
 <p>
-U.S. GOVERNMENT END USERS. The Software is a &quot;commercial
-item,&quot; as that term is defined in 48 C.F.R. 2.101 (Oct. 1995), consisting
-of &quot;commercial computer software&quot; and &quot;commercial computer software 
-documentation,&quot; as such terms are used in 48 C.F.R. 12.212 (Sept. 1995). 
-Consistent with 48 C.F.R. 12.212 and 48 C.F.R. 227.7202-1 through 227.7202-4
-(June 1995), all U.S. Government End Users acquire the Software with only 
-those rights set forth herein.
-</p>
-
+<a href="about:plugins">About plugins</a>
 </body>
 </html>
Index: xpfe/global/resources/locale/en-US/brand.dtd
===================================================================
RCS file: /cvsroot/mozilla/xpfe/global/resources/locale/en-US/brand.dtd,v
retrieving revision 1.5.8.6
diff -u -u -w -r1.5.8.6 brand.dtd
--- xpfe/global/resources/locale/en-US/brand.dtd	28 Jun 2002 22:36:48 -0000	1.5.8.6
+++ xpfe/global/resources/locale/en-US/brand.dtd	24 Aug 2002 17:14:17 -0000
@@ -1,4 +1,17 @@
+<!-- Separate the ever-changing version info to avoid merge conflicts -->
+
 <!ENTITY  lang.version          "1.0.1rc1">
-<!ENTITY  brandShortName        "Mozilla">
-<!ENTITY  vendorShortName       "Mozilla">
+
+<!-- Mozilla looks here for locale (theme?) versions, and refuses to use
+     the locale, if it doesn't match. -->
+
+
+
+
+<!-- TODO: Maybe change lang.version later, so that nobody installs a Mozilla
+     langpack in Beonex Communicator. -->
+
+<!ENTITY  brandShortName        "Beonex Communicator">
+<!ENTITY  vendorShortName       "Beonex">
+<!ENTITY  vendorLongName        "Ben Bucksch">
 <!ENTITY  sidebarName           "Sidebar">
\ No newline at end of file
Index: xpfe/global/resources/locale/en-US/brand.properties
===================================================================
RCS file: /cvsroot/mozilla/xpfe/global/resources/locale/en-US/brand.properties,v
retrieving revision 1.14.52.1
diff -u -u -w -r1.14.52.1 brand.properties
--- xpfe/global/resources/locale/en-US/brand.properties	10 Apr 2002 03:44:37 -0000	1.14.52.1
+++ xpfe/global/resources/locale/en-US/brand.properties	24 Aug 2002 17:14:17 -0000
@@ -1,3 +1,4 @@
-brandShortName=Mozilla
-vendorShortName=Mozilla
+brandShortName=Beonex Communicator
+vendorShortName=Beonex
+vendorLongName=Ben Bucksch
 sidebarName=Sidebar
Index: xpfe/global/resources/locale/en-US/builtinURLs.rdf
===================================================================
RCS file: /cvsroot/mozilla/xpfe/global/resources/locale/en-US/builtinURLs.rdf,v
retrieving revision 1.7.36.2
diff -u -u -w -r1.7.36.2 builtinURLs.rdf
--- xpfe/global/resources/locale/en-US/builtinURLs.rdf	15 Apr 2002 23:50:16 -0000	1.7.36.2
+++ xpfe/global/resources/locale/en-US/builtinURLs.rdf	24 Aug 2002 17:14:17 -0000
@@ -25,32 +25,32 @@
          xmlns:NC="http://home.netscape.com/NC-rdf#">
 
   <RDF:Description about='urn:clienturl:toolbar:mynetscape'>
-    <NC:title>My Netscape</NC:title>
-    <NC:content>http://my.netscape.com/</NC:content>
+    <NC:title>Support</NC:title>
+    <NC:content>http://www.beonex.com/communicator/support</NC:content>
   </RDF:Description>
 
   <RDF:Description about='urn:clienturl:toolbar:home'>
     <NC:title>Home</NC:title>
-    <NC:content>http://home.netscape.com/</NC:content>
+    <NC:content>about:welcome</NC:content>
   </RDF:Description>
 
   <RDF:Description about='urn:clienturl:toolbar:relnotes'>
     <NC:title>Release Notes</NC:title>
-    <NC:content>http://www.mozilla.org/releases/mozilla1.0/</NC:content>
+    <NC:content>http://www.beonex.com/communicator/version/0.8/release-notes</NC:content>
   </RDF:Description>
 
   <!-- View Menu -->
 
   <RDF:Description about='urn:clienturl:viewmenu:intlwebcontent'>
     <NC:title>International Languages and Web Content</NC:title>
-    <NC:content>http://www.mozilla.org/projects/l10n/mlp_status.html#contrib</NC:content>
+    <NC:content>http://www.beonex.com/communicator/version/0.8/add-ons/l10n</NC:content>
   </RDF:Description>
 
   <!-- Search Menu -->
 
   <RDF:Description about='urn:clienturl:srchmenu:srchinternet'>
-    <NC:title>Search Internet</NC:title>
-    <NC:content>http://home.netscape.com/bookmark/6_0/ssearch.html</NC:content>
+    <NC:title>Search the Web</NC:title>
+    <NC:content>http://www.google.com</NC:content>
   </RDF:Description>
 
   <!-- Composer -->
Index: xpfe/global/resources/locale/en-US/makefile.win
===================================================================
RCS file: /cvsroot/mozilla/xpfe/global/resources/locale/en-US/Attic/makefile.win,v
retrieving revision 1.22.16.1
diff -u -u -w -r1.22.16.1 makefile.win
--- xpfe/global/resources/locale/en-US/makefile.win	10 Apr 2002 03:44:38 -0000	1.22.16.1
+++ xpfe/global/resources/locale/en-US/makefile.win	24 Aug 2002 17:14:17 -0000
@@ -29,6 +29,7 @@
 CHROME_L10N = \
 	.\intl.css \
 	.\about.html \
+	.\license.html \
 	.\globalOverlay.dtd \
 	.\dialogOverlay.dtd \
 	.\builtinURLs.rdf \
Index: xpfe/global/resources/locale/en-US/region.dtd
===================================================================
RCS file: /cvsroot/mozilla/xpfe/global/resources/locale/en-US/region.dtd,v
retrieving revision 1.7.8.8
diff -u -u -w -r1.7.8.8 region.dtd
--- xpfe/global/resources/locale/en-US/region.dtd	28 Jun 2002 22:36:48 -0000	1.7.8.8
+++ xpfe/global/resources/locale/en-US/region.dtd	24 Aug 2002 17:14:17 -0000
@@ -1,5 +1,9 @@
 <!-- brand.dtd -->
-<!ENTITY  vendorURL             "http://www.mozilla.org/">
-<!ENTITY  releaseURL            "http://www.mozilla.org/releases/mozilla1.0/">
-<!ENTITY  getNewThemesURL       "http://mozilla.org/themes/download/">
+<!ENTITY  vendorURL             "http://www.beonex.com">
+<!ENTITY  releaseURL            "http://www.beonex.com/communicator/version/0.8/release-notes">
+<!-- releaseURL is actually release-notes -->
+<!ENTITY  getNewThemesURL       "http://www.beonex.com/communicator/version/0.8/add-ons/themes/">
 <!ENTITY  content.version       "1.0.1rc1">
+<!-- I bet that Mozilla looks here for theme/locale versions, and refuses
+     to use the locale, if we change that. So, keep Mozilla version for
+     compatibility. -->
Index: xpfe/global/resources/locale/en-US/region.properties
===================================================================
RCS file: /cvsroot/mozilla/xpfe/global/resources/locale/en-US/region.properties,v
retrieving revision 1.8.14.2
diff -u -u -w -r1.8.14.2 region.properties
--- xpfe/global/resources/locale/en-US/region.properties	21 May 2002 21:07:17 -0000	1.8.14.2
+++ xpfe/global/resources/locale/en-US/region.properties	24 Aug 2002 17:14:17 -0000
@@ -3,13 +3,13 @@
 #
 #    This is the message for the noDefaultPlugin dialog.  Please note
 #    that the URL must be tweaked.
-noDefaultPluginMessage=Mozilla cannot find the Plugin Downloader Plugin.  Without the Plugin Downloader Plugin, you cannot automatically download and install plugins.  Please visit http://www.netscape.com/ to install the Plugin Downloader Plugin.
+noDefaultPluginMessage=Communicator cannot find the Plugin Downloader Plugin.  Without the Plugin Downloader Plugin, you cannot automatically download and install plugins.  Please visit http://www.netscape.com to install the Plugin Downloader Plugin.
 pluginStartupMessage=Starting Plugin for type
 #
 # brand.properties
 #
-getNewThemesURL=http://mozilla.org/themes/download/
-smartBrowsingURL=http://www.mozilla.org/docs/end-user/internet-keywords.html
+getNewThemesURL=http://www.beonex.com/communicator/version/0.8/add-ons/themes
+smartBrowsingURL=http://www.beonex.com/communicator/redir/smartbrowsing
 
 #
 # fontdownload.properties
Index: xpinstall/packager/packages-mac
===================================================================
RCS file: /cvsroot/mozilla/xpinstall/packager/packages-mac,v
retrieving revision 1.168.2.4
diff -u -u -w -r1.168.2.4 packages-mac
--- xpinstall/packager/packages-mac	28 Jun 2002 00:22:09 -0000	1.168.2.4
+++ xpinstall/packager/packages-mac	24 Aug 2002 17:14:17 -0000
@@ -195,14 +195,8 @@
 viewer:Components:xpinstall.xpt 
 viewer:Components:widget.shlb 
 viewer:Components:autocomplete.xpt 
-viewer:Components:xml-rpc.xpt
 viewer:Components:nsDictionary.js
 viewer:Components:nsProxyAutoConfig.js
-viewer:Components:nsXmlRpcClient.js
-viewer:Components:xmlextras.xpt
-viewer:Components:xmlextras.shlb
-viewer:Components:xmlsoap.xpt
-viewer:Components:xmlschema.xpt
 viewer:Components:nsHelperAppDlg.js
 viewer:Components:nsProgressDialog.js
 viewer:Components:nsDownloadProgressListener.js
Index: xpinstall/packager/packages-unix
===================================================================
RCS file: /cvsroot/mozilla/xpinstall/packager/packages-unix,v
retrieving revision 1.209.2.9
diff -u -u -w -r1.209.2.9 packages-unix
--- xpinstall/packager/packages-unix	28 Jun 2002 00:22:12 -0000	1.209.2.9
+++ xpinstall/packager/packages-unix	24 Aug 2002 17:14:17 -0000
@@ -12,9 +12,7 @@
 ;
 ; en-US
 bin/chrome/en-US.jar
-bin/chrome/en-mac.jar
 bin/chrome/en-unix.jar
-bin/chrome/en-win.jar
 
 [regus]
 ;
@@ -31,6 +29,7 @@
 bin/defaults/profile/localstore.rdf
 bin/defaults/profile/search.rdf
 bin/defaults/profile/mimeTypes.rdf
+bin/defaults/profile/chrome/*
 
 [xpcom]
 bin/libmozjs.so
@@ -46,6 +45,8 @@
 [browser]
 bin/mozilla
 bin/mozilla-bin
+bin/LICENSE
+bin/README
 bin/icons/*
 bin/libgtksuperwin.so
 bin/libgtkxtbin.so
@@ -56,6 +57,9 @@
 bin/regExport
 bin/regxpcom
 bin/regchrome
+bin/component.reg
+bin/components/xpti.dat
+bin/components/xptitemp.dat
 bin/mozilla-xremote-client
 bin/xpicleanup
 bin/res/cmessage.txt
@@ -227,10 +231,8 @@
 bin/components/util.xpt
 bin/components/xpcom_components.xpt
 bin/components/xpcom_threads.xpt
-bin/components/xml-rpc.xpt
 bin/components/nsDictionary.js
 bin/components/nsProxyAutoConfig.js
-bin/components/nsXmlRpcClient.js
 bin/components/libxremote_client.so
 bin/components/libxremoteservice.so
 bin/components/xremoteservice.xpt
@@ -238,10 +240,6 @@
 bin/components/commandhandler.xpt
 bin/components/webbrowserpersist.xpt
 bin/components/windowwatcher.xpt
-bin/components/xmlextras.xpt
-bin/components/libxmlextras.so
-bin/components/xmlsoap.xpt
-bin/components/xmlschema.xpt
 bin/components/nsHelperAppDlg.js
 bin/components/helperAppDlg.xpt
 bin/components/nsProgressDialog.js
@@ -268,6 +266,15 @@
 bin/chrome/classic.jar
 bin/chrome/installed-chrome.txt
 bin/chrome/chromelist.txt
+bin/chrome/user-skins.rdf
+bin/chrome/user-locales.rdf
+bin/chrome/all-locales.rdf
+bin/chrome/all-skins.rdf
+bin/chrome/all-packages.rdf
+bin/chrome/overlayinfo/communicator/content/overlays.rdf
+bin/chrome/overlayinfo/navigator/content/overlays.rdf
+bin/chrome/overlayinfo/editor/content/overlays.rdf
+
 ;-bin/chrome/comm/content/editor/EditorInitPage.html
 ;-bin/chrome/comm/content/editor/content/EditorInitPagePlain.html
 ;Include this for "debug" testing - remove for actual beta release:
@@ -317,7 +324,7 @@
 bin/res/fonts/*
 bin/res/dtd/*
 ;debug menus reference samples dir - remove for actual releases:
-bin/res/samples/*
+;bin/res/samples/*
 bin/res/builtin/htmlBindings.xml
 bin/res/builtin/platformHTMLBindings.xml
 
@@ -336,6 +343,7 @@
 bin/components/libmsgnews.so
 bin/components/libvcard.so
 bin/components/libsmimestb.so
+;XXX libsigned.so?
 bin/components/libimport.so
 bin/components/libimpText.so
 bin/components/libimpComm4xMail.so
@@ -358,6 +366,7 @@
 bin/components/libmsgsmime.so
 bin/components/msgsmime.xpt
 bin/components/smime-service.js
+bin/chrome/overlayinfo/messenger/content/overlays.rdf
 bin/components/libmsgmdn.so
 bin/components/msgmdn.xpt
 bin/components/mdn-service.js
@@ -405,3 +414,9 @@
 bin/defaults/pref/inspector.js
 bin/res/inspector/viewer-registry.rdf
 bin/res/inspector/search-registry.rdf
+
+[spellchecker]
+bin/components/libmyspell.so
+bin/components/libspellchecker.so
+bin/components/spellchecker.xpt
+bin/components/myspell/*
Index: xpinstall/packager/packages-win
===================================================================
RCS file: /cvsroot/mozilla/xpinstall/packager/packages-win,v
retrieving revision 1.207.2.10
diff -u -u -w -r1.207.2.10 packages-win
--- xpinstall/packager/packages-win	18 Jul 2002 07:12:59 -0000	1.207.2.10
+++ xpinstall/packager/packages-win	24 Aug 2002 17:14:17 -0000
@@ -15,17 +15,12 @@
 bin\chrome\en-mac.jar
 bin\chrome\en-unix.jar
 bin\chrome\en-win.jar
-bin\chrome\en-US\*
-bin\chrome\en-win\*
-bin\chrome\en-unix\*
-bin\chrome\en-mac\*
 
 [regus]
 ;
 ; US
 ; If you add a new directory you must explicitly call addDirectory in regus.jst
 bin\chrome\US.jar
-bin\chrome\US\*
 bin\defaults\profile\US\*
 bin\searchplugins\*
 
@@ -61,7 +56,7 @@
 bin\components\gkwidget.dll
 bin\jpeg3250.dll
 bin\jsj3250.dll
-bin\mozilla.exe
+bin\beonex-comm.exe
 bin\mozctl.dll
 bin\mozctlx.dll
 bin\regxpcom.exe
@@ -245,15 +240,9 @@
 bin\components\xppref32.dll
 bin\components\autoconfig.dll
 bin\components\autoconfig.xpt
-bin\components\xml-rpc.xpt
 bin\components\nsDictionary.js
 bin\components\nsProxyAutoConfig.js
-bin\components\nsXmlRpcClient.js
 bin\plugins\npnul32.dll
-bin\components\xmlextras.xpt
-bin\components\xmlextras.dll
-bin\components\xmlsoap.xpt
-bin\components\xmlschema.xpt
 bin\components\nsHelperAppDlg.js
 bin\components\helperAppDlg.xpt
 bin\components\nsKillAll.js
@@ -280,11 +269,38 @@
 bin\chrome\forms.jar
 bin\chrome\modern.jar
 bin\chrome\classic.jar
-bin\chrome\comm\*
-bin\chrome\toolkit\*
-bin\chrome\modern\*
-bin\chrome\classic\*
 bin\chrome\chromelist.txt
+
+; icons
+bin\chrome\icons\abcardWindow.ico
+bin\chrome\icons\addressbookWindow.ico
+bin\chrome\icons\bookmark-window.ico
+bin\chrome\icons\calendar-window.ico
+bin\chrome\icons\chatzilla-window.ico
+bin\chrome\icons\downloadManager.ico
+bin\chrome\icons\editorWindow.ico
+bin\chrome\icons\fullpack.ico
+bin\chrome\icons\gif.ico
+bin\chrome\icons\history-window.ico
+bin\chrome\icons\html.ico
+bin\chrome\icons\jpeg.ico
+bin\chrome\icons\jsconsoleWindow.ico
+bin\chrome\icons\js.ico
+bin\chrome\icons\main-window.ico
+bin\chrome\icons\messengerWindow.ico
+bin\chrome\icons\mng.ico
+bin\chrome\icons\mozapp.ico
+bin\chrome\icons\mozfile.ico
+bin\chrome\icons\mozfiletemplate.ico
+bin\chrome\icons\mozilla.ico
+bin\chrome\icons\msgcomposeWindow.ico
+bin\chrome\icons\png.ico
+bin\chrome\icons\svg.ico
+bin\chrome\icons\venkman-window.ico
+bin\chrome\icons\winInspectorMain.ico
+bin\chrome\icons\xml.ico
+bin\chrome\icons\xul.ico
+
 ;-bin\chrome\comm\content\editor\EditorInitPage.html
 ;-bin\chrome\comm\editor\content\EditorInitPagePlain.html
 ;Include this for "debug" testing - remove for actual beta release:
@@ -334,8 +350,6 @@
 bin\res\rdf\folder-open.gif
 bin\res\rdf\loading.gif
 bin\res\throbber\*
-;debug menus reference samples dir - remove for actual releases:
-bin\res\samples\*
 bin\res\builtin\htmlBindings.xml
 bin\res\builtin\platformHTMLBindings.xml
 
@@ -375,7 +389,6 @@
 bin\components\absync.xpt
 bin\components\nsLDAPPrefsService.js
 bin\chrome\messenger.jar
-bin\chrome\messenger\*
 bin\components\msgsmime.dll
 bin\components\msgsmime.xpt
 bin\components\smime-service.js
@@ -392,7 +405,6 @@
 [chatzilla]
 bin\components\chatzilla-service.js
 bin\chrome\chatzilla.jar
-bin\chrome\chatzilla\*
 
 [venkman]
 bin\components\venkman-service.js
@@ -420,3 +432,9 @@
 bin\defaults\pref\inspector.js
 bin\res\inspector\viewer-registry.rdf
 bin\res\inspector\search-registry.rdf
+
+[spellchecker]
+bin/components/libmyspell.dll
+bin/components/libspellchecker.dll
+bin/components/spellchecker.xpt
+bin/components/myspell/*
Index: xpinstall/packager/windows/config.it
===================================================================
RCS file: /cvsroot/mozilla/xpinstall/packager/windows/config.it,v
retrieving revision 1.103.2.11
diff -u -u -w -r1.103.2.11 config.it
--- xpinstall/packager/windows/config.it	1 Aug 2002 21:28:02 -0000	1.103.2.11
+++ xpinstall/packager/windows/config.it	24 Aug 2002 17:14:18 -0000
@@ -17,7 +17,7 @@
 ;   WINDISK
 ;   WINDIR
 ;   WINSYSDIR
-Path=[PROGRAMFILESDIR]\$CompanyName$\$ProductName$
+Path=[PROGRAMFILESDIR]\$CompanyName$\Communicator
 
 ; Sub Path, when set will indicate to Setup to create a subfolder from
 ; what is offered to the user to change.  It will not be shown to the user
@@ -180,7 +180,7 @@
 C6=Component US region pack
 ; Make sure Component QFA is LAST so 3rd party developers who might not want
 ; this component can easily remove it.
-C7=Component QFA
+;C7=Component QFA
 
 [Setup Type1]
 ;*** LOCALIZE ME BABY ***
@@ -197,14 +197,15 @@
 C3=Component PSM
 C4=Component Uninstaller
 C5=Component Chatzilla
-C6=Component Venkman
-C7=Component US English Profile Defaults
-C8=Component En US lang pack
-C9=Component US region pack
+;C6=Component Venkman
+C6=Component US English Profile Defaults
+C7=Component En US lang pack
+C8=Component US region pack
 ; Make sure Component QFA is LAST so 3rd party developers who might not want
 ; this component can easily remove it.
-C10=Component DOM Inspector
-C11=Component QFA
+;C10=Component DOM Inspector
+;C11=Component QFA
+C12=Component Spellcheck
 
 [Setup Type2]
 ;*** LOCALIZE ME BABY ***
@@ -223,14 +224,15 @@
 C3=Component PSM
 C4=Component Uninstaller
 C5=Component Chatzilla
-C6=Component Venkman
-C7=Component US English Profile Defaults
-C8=Component En US lang pack
-C9=Component US region pack
+;C6=Component Venkman
+C6=Component US English Profile Defaults
+C7=Component En US lang pack
+C8=Component US region pack
 ; Make sure Component QFA is LAST so 3rd party developers who might not want
 ; this component can easily remove it.
-C10=Component DOM Inspector
-C11=Component QFA
+;C10=Component DOM Inspector
+;C11=Component QFA
+C12=Component Spellcheck
 
 
 
@@ -721,6 +723,17 @@
 Attributes=SELECTED|FORCE_UPGRADE
 Force Upgrade File0=[SETUP PATH]\Chrome\inspector.jar
 
+[Component Spellcheck]
+Description Short=Spellchecker
+;*** LOCALIZE ME BABY ***
+Description Long=to check the spelling of your emails and webpages
+Archive=spellcheck.xpi
+$InstallSize$:spellcheck
+$InstallSizeSystem$
+$InstallSizeArchive$:spellcheck.xpi
+Attributes=SELECTED|FORCE_UPGRADE
+Force Upgrade File0=[SETUP PATH]\components\libspellchecker.dll
+
 [Component US English Profile Defaults]
 Description Short=US English profile defaults
 ;*** LOCALIZE ME BABY ***
@@ -876,7 +889,7 @@
 ;Delete FileX sections
 [Delete File0]
 Timing=post download
-Destination=[COMMON_PROGRAMS]\Mozilla Seamonkey\Mozilla AppRunner.lnk
+Destination=[COMMON_PROGRAMS]\Beonex Communicator\Mozilla AppRunner.lnk
 
 [Delete File1]
 Timing=post launchapp
Index: xpinstall/packager/windows/makeall.pl
===================================================================
RCS file: /cvsroot/mozilla/xpinstall/packager/windows/makeall.pl,v
retrieving revision 1.54.2.2
diff -u -u -w -r1.54.2.2 makeall.pl
--- xpinstall/packager/windows/makeall.pl	1 May 2002 21:50:58 -0000	1.54.2.2
+++ xpinstall/packager/windows/makeall.pl	24 Aug 2002 17:14:18 -0000
@@ -76,7 +76,7 @@
 if($inXpiURL eq "")
 {
   # archive url not supplied, set it to default values
-  $inXpiURL      = "ftp://not.supplied.com";
+  $inXpiURL      = "ftp://not.supplied.domain.invalid";
 }
 if($inRedirIniURL eq "")
 {
@@ -114,6 +114,28 @@
 $ENV{WIZ_userAgentShort}       = "$versionMain";
 $ENV{WIZ_xpinstallVersion}     = "$versionMain";
 
+
+
+#Shit, we never submitted the LocalOptions function, did we?
+
+$seiFileNameGeneric   = "nsinstall.exe";
+$seiFileNameSpecific  = "beonex-comm-0.8-dev-1-win32-installer.exe";
+$seiFileNameSpecificStub  = "beonex-comm-0.8-dev-1-win32-stub-installer.exe";
+$seuFileNameSpecific  = "BeonexComm08Uninstall.exe";
+$seuzFileNameSpecific = "BeonexComm08Uninstall.zip";
+
+# set environment vars for use by other .pl scripts called from this script.
+$ENV{WIZ_userAgent}            = "0.8 (en)";
+$ENV{WIZ_userAgentShort}       = "0.8";
+$ENV{WIZ_xpinstallVersion}     = "0.8";
+$ENV{WIZ_nameCompany}          = "Beonex";
+$ENV{WIZ_nameProduct}          = "Beonex Communicator";
+$ENV{WIZ_fileMainExe}          = "beonex-comm.exe";
+$ENV{WIZ_fileUninstall}        = $seuFileNameSpecific;
+$ENV{WIZ_fileUninstallZip}     = $seuzFileNameSpecific;
+
+
+
 # Set the location of the local tmp stage directory
 $gLocalTmpStage = $inStagePath;
 
@@ -128,7 +150,6 @@
                    "browser",
                    "mail",
                    "psm",
-                   "talkback",
                    "chatzilla",
                    "deflenus",
                    "langenus",
@@ -222,6 +243,10 @@
 {
   die "\n Error: copy $ENV{MOZ_SRC}\\mozilla\\LICENSE $inDistPath\\setup\\license.txt\n";
 }
+#if(system("copy $ENV{MOZ_SRC}\\mozilla\\README\\user\\win32.txt $inDistPath\\setup\\readme.txt"))
+#{
+#  die "\n Error: copy $ENV{MOZ_SRC}\\mozilla\\xpfe\\bootstrap\\README-win32.txt $inDistPath\\setup\\readme.txt\n";
+#}
 
 # build the self-extracting .exe (installer) file.
 print "\nbuilding self-extracting stub installer ($seiFileNameSpecificStub)...\n";
Index: xpinstall/res/content/SoftwareUpdate-Source-1.rdf
===================================================================
RCS file: /cvsroot/mozilla/xpinstall/res/content/SoftwareUpdate-Source-1.rdf,v
retrieving revision 1.1.184.1
diff -u -u -w -r1.1.184.1 SoftwareUpdate-Source-1.rdf
--- xpinstall/res/content/SoftwareUpdate-Source-1.rdf	10 Apr 2002 03:45:15 -0000	1.1.184.1
+++ xpinstall/res/content/SoftwareUpdate-Source-1.rdf	24 Aug 2002 17:14:18 -0000
@@ -26,7 +26,7 @@
 
   <RDF:Bag about="http://home.netscape.com/NC-rdf#SoftwareUpdateRoot">
     <RDF:li>
-       <RDF:Bag about="http://home.netscape.com/NC-rdf#SoftwarePackages" NC:title="Test Updates" NC:url="http://www.netscape.com/people/dougt">
+       <RDF:Bag about="http://home.netscape.com/NC-rdf#SoftwarePackages" NC:title="Test Updates" NC:url="http://www.beonex.com/communicator/redir/xpupdate">
 
             <RDF:li>
                 <RDF:Description ID="Update344">
Index: xpinstall/wizard/windows/builder/build.pl
===================================================================
RCS file: /cvsroot/mozilla/xpinstall/wizard/windows/builder/build.pl,v
retrieving revision 1.9.126.1
diff -u -u -w -r1.9.126.1 build.pl
--- xpinstall/wizard/windows/builder/build.pl	10 Apr 2002 03:46:40 -0000	1.9.126.1
+++ xpinstall/wizard/windows/builder/build.pl	24 Aug 2002 17:14:19 -0000
@@ -47,7 +47,7 @@
 if($inXpiURL eq "")
 {
   # archive url not supplied, set it to default values
-  $inXpiURL      = "ftp://not.supplied.com";
+  $inXpiURL      = "ftp://not.supplied.domain.invalid";
 }
 if($inRedirIniURL eq "")
 {
@@ -98,9 +98,9 @@
 print "\n";
 print "**\n";
 print "*\n";
-print "*  A self-extracting installer has been built and delivered:\n";
+print "*  A self-extracting installer has been built and delivered to:\n";
 print "*\n";
-print "*      $cwdDistWin\\install\\mozilla-win32-install.exe\n";
+print "*      $cwdDistWin\\install\\\n";
 print "*\n";
 print "**\n";
 print "\n";
@@ -246,7 +246,7 @@
     $distWinPathName = "Win32_d.obj";
   }
 
-  $fileMozilla = "$depthPath\\dist\\$distWinPathName\\bin\\mozilla.exe";
+  $fileMozilla = "$depthPath\\dist\\$distWinPathName\\bin\\beonex-comm.exe";
   # verify the existance of file
   if(!(-e "$fileMozilla"))
   {
Index: xpinstall/wizard/windows/nsinstall/nsinstall.rc
===================================================================
RCS file: /cvsroot/mozilla/xpinstall/wizard/windows/nsinstall/nsinstall.rc,v
retrieving revision 1.8.114.1
diff -u -u -w -r1.8.114.1 nsinstall.rc
--- xpinstall/wizard/windows/nsinstall/nsinstall.rc	10 Apr 2002 03:46:43 -0000	1.8.114.1
+++ xpinstall/wizard/windows/nsinstall/nsinstall.rc	24 Aug 2002 17:14:19 -0000
@@ -126,3 +126,39 @@
 /////////////////////////////////////////////////////////////////////////////
 #endif    // not APSTUDIO_INVOKED
 
+VS_VERSION_INFO VERSIONINFO
+ FILEVERSION 1,0,0,2
+ PRODUCTVERSION 0,7,0,1
+ FILEFLAGSMASK 0x3fL
+#ifdef _DEBUG
+ FILEFLAGS 0x1L
+#else
+ FILEFLAGS 0x0L
+#endif
+ FILEOS 0x40004L
+ FILETYPE 0x1L
+ FILESUBTYPE 0x0L
+BEGIN
+    BLOCK "StringFileInfo"
+    BEGIN
+        BLOCK "040904b0"
+        BEGIN
+            VALUE "Comments", "\0"
+            VALUE "CompanyName", "Beonex\0"
+            VALUE "FileDescription", "Beonex Communicator Installer\0"
+            VALUE "FileVersion", "1, 0, 0, 2\0"
+            VALUE "InternalName", "install\0"
+            VALUE "LegalCopyright", "Copyright  2001\0"
+            VALUE "LegalTrademarks", "\0"
+            VALUE "OriginalFilename", "install.exe\0"
+            VALUE "PrivateBuild", "\0"
+            VALUE "ProductName", "Beonex Communicator Installer\0"
+            VALUE "ProductVersion", "0, 7, 0, 1\0"
+            VALUE "SpecialBuild", "\0"
+        END
+    END
+    BLOCK "VarFileInfo"
+    BEGIN
+        VALUE "Translation", 0x409, 1200
+    END
+END
Index: xpinstall/wizard/windows/setuprsc/setuprsc.rc
===================================================================
RCS file: /cvsroot/mozilla/xpinstall/wizard/windows/setuprsc/setuprsc.rc,v
retrieving revision 1.54.2.1
diff -u -u -w -r1.54.2.1 setuprsc.rc
--- xpinstall/wizard/windows/setuprsc/setuprsc.rc	10 Apr 2002 03:46:54 -0000	1.54.2.1
+++ xpinstall/wizard/windows/setuprsc/setuprsc.rc	24 Aug 2002 17:14:19 -0000
@@ -424,7 +424,7 @@
 
 IDB_BOX_UNCHECKED       BITMAP  FIXED IMPURE    "box_unch.bmp"
 IDB_BOX_CHECKED         BITMAP  FIXED IMPURE    "box_chec.bmp"
-IDB_BITMAP_WELCOME      BITMAP  DISCARDABLE     "bitmap1.bmp"
+IDB_BITMAP_WELCOME      BITMAP  DISCARDABLE     "dialogsLogo.bmp"
 IDB_BOX_CHECKED_DISABLED BITMAP  FIXED IMPURE    "box_ch_d.bmp"
 IDB_BITMAP_DOWNLOAD_LOGO BITMAP  DISCARDABLE     "downloadLogo.bmp"
 IDB_QUICK_LAUNCH        BITMAP  DISCARDABLE     "turbo-systray.bmp"
@@ -477,3 +477,29 @@
 /////////////////////////////////////////////////////////////////////////////
 #endif    // not APSTUDIO_INVOKED
 
+1 VERSIONINFO 
+FILEVERSION 0, 7, 0, 1
+PRODUCTVERSION 1, 0, 0, 0
+FILEOS VOS_DOS_WINDOWS16
+FILETYPE VFT_APP
+{
+ BLOCK "StringFileInfo"
+ {
+  BLOCK "040904E4"
+  {
+   VALUE "CompanyName", "Beonex\000\000"
+   VALUE "FileDescription", "Beonex Communicator Installer\000"
+   VALUE "FileVersion", "1.0.0.1\000\000"
+   VALUE "InternalName", "mozilla-installer\000"
+   VALUE "LegalCopyright", "Copyright  2001\000\000"
+   VALUE "OriginalFilename", "beonex-comm-installer.exe\000"
+  }
+
+ }
+
+ BLOCK "VarFileInfo"
+ {
+  VALUE "Translation", 0x409, 1252
+ }
+
+}
Index: xpinstall/wizard/windows/uninstall/uninstall.rc
===================================================================
RCS file: /cvsroot/mozilla/xpinstall/wizard/windows/uninstall/uninstall.rc,v
retrieving revision 1.5.96.1
diff -u -u -w -r1.5.96.1 uninstall.rc
--- xpinstall/wizard/windows/uninstall/uninstall.rc	10 Apr 2002 03:46:58 -0000	1.5.96.1
+++ xpinstall/wizard/windows/uninstall/uninstall.rc	24 Aug 2002 17:14:19 -0000
@@ -71,15 +71,15 @@
         BLOCK "040904b0"
         BEGIN
             VALUE "Comments", "\0"
-            VALUE "CompanyName", "mozilla.org\0"
-            VALUE "FileDescription", "uninstall\0"
+            VALUE "CompanyName", "Beonex\0"
+            VALUE "FileDescription", "Uninstaller for Beonex Communicator\0"
             VALUE "FileVersion", "1, 0, 0, 2\0"
             VALUE "InternalName", "uninstall\0"
             VALUE "LegalCopyright", "Copyright  2001\0"
             VALUE "LegalTrademarks", "\0"
             VALUE "OriginalFilename", "uninstall.exe\0"
             VALUE "PrivateBuild", "\0"
-            VALUE "ProductName", "Mozilla uninstaller\0"
+            VALUE "ProductName", "Beonex uninstaller\0"
             VALUE "ProductVersion", "1, 0, 0, 2\0"
             VALUE "SpecialBuild", "\0"
         END
