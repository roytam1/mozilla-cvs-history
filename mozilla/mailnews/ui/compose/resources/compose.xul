<?xml version="1.0"?> 
<?xml-stylesheet href="xul.css" type="text/css"?> 

<!DOCTYPE window> 

<window xmlns:html="http://www.w3.org/TR/REC-html40"
        xmlns="http://www.mozilla.org/keymaster/gatekeeper/there.is.only.xul"
        onload="startup()"> 
  
<html:style>
	#toolbar {
		position: fixed;
		width: 100%;
		height: 60px;
		top: 0;
		right: 0;
		bottom: auto;
		left: 0;
	}
	#body {
        position: fixed;
        width: auto;
        height: auto;
        top: 75px;
        right: 0;
        bottom: 34px;
        left: 0;
        overflow: auto;
        padding: 2px .5em;
        border: solid 0px black;
	}
	#footer {
		position: fixed;
		width: 100%;
		height: 34px;
		top: auto;
		right: 0;
		bottom: 0;
		left: 0;
		margin-top: auto;
	}
</html:style>

<html:script>
	var compAppCore = null;
	var editAppCore = null;

	function startup()
	{
		dump("Compose: StartUp\n");

		editAppCore = XPAppCoresManager.Find("EditorAppCore");  
		dump("Looking up EditorAppCore...\n");
		if (editAppCore == null) {
			dump("Creating EditorAppCore...\n");
			editAppCore = new EditorAppCore();
			if (editAppCore != null) {
				dump("EditorAppCore has been created.\n");
				editAppCore.Init("EditorAppCore");
				editAppCore.setContentWindow(window.frames[0]);
				editAppCore.setWebShellWindow(window);
				editAppCore.setToolbarWindow(window);
				dump("Adding EditorAppCore to AppCoreManager...\n");
				XPAppCoresManager.Add(editAppCore);  
			}
		}
		else {
			dump("EditorAppCore has already been created! Why?\n");
		}

		compAppCore = XPAppCoresManager.Find("ComposeAppCore");  
		if (compAppCore==null) {
			compAppCore = new ComposeAppCore();
			if (compAppCore != null) {
				dump("ComposeAppCore was created!\n");
				compAppCore.Init("ComposeAppCore");
				compAppCore.SetWindow(window);
				compAppCore.SetEditor(editAppCore);
				compAppCore.CompleteCallback("MessageSent();");
				XPAppCoresManager.Add(compAppCore);  
			}
		}

	}

	function EditorGetText()
	{
		if (editAppCore != null) {
			var	outputText = editAppCore.contentsAsText;
			dump(outputText + "\n");
			return outputText;
		} else
			dump("EditorAppCore has not been created!\n");
	}


	function SendMessage()
	{
		dump("SendMessage!\n");
		if (compAppCore != null) {
//			compAppCore.SendMessage(document.getElementById('msgTo').value, 
//					   document.getElementById('msgCc').value, 
//					   document.getElementById('msgBcc').value, 
//					   document.getElementById('msgSubject').value, 
//					   window.parent.frames[0].document.forms["fbody"].elements["body"].value);
//					   EditorGetText());
			compAppCore.SendMessage2();
		}
	}

	function MessageSent()
	{
		dump("MessageSent Callback!\n");

		// Clear Them
		document.getElementById('msgTo').value = "";
		document.getElementById('msgCc').value = "";
		document.getElementById('msgBcc').value = "";
		document.getElementById('msgSubject').value = "";
//		window.parent.frames[0].document.forms["fbody"].elements["body"].value = "";
	}
</html:script>

<menubar>
	<menu name="File">
		<menuitem name="New" cmd="nsCmd:ComposeNew"/>
		<menuitem name="Save" cmd="nsCmd:ComposeSave"/>
		<menuitem name="Save As" cmd="nsCmd:ComposeSaveAs"/>
		<menuitem name="Attach" cmd="nsCmd:ComposeAttach"/>
		<separator/>
		<menuitem name="Send Now" cmd="nsCmd:ComposeSend"/>
		<menuitem name="Send Later" cmd="nsCmd:ComposeSendLater"/>
		<menuitem name="Quote Original Message" cmd="nsCmd:ComposeQuote"/>
		<menuitem name="Select Addresses..." cmd="nsCmd:ComposeAddress"/>
		<separator/>
		<menuitem name="Print Setup" cmd="nsCmd:BrowserPrintSetup"/>
		<menuitem name="Print Preview" cmd="nsCmd:BrowserPrintPreview"/>
		<menuitem name="Print" cmd="nsCmd:BrowserPrint"/>
		<separator/>
		<menuitem name="Close" cmd="nsCmd:BrowserClose"/>
		<menuitem name="Exit" cmd="nsCmd:BrowserExit"/>
	</menu>
    <menu name="Edit">
		<menuitem name="Undo" cmd="nsCmd:ComposeNYI"/>
		<separator/>
		<menuitem name="Cut" cmd="nsCmd:ComposeNYI"/>
		<menuitem name="Copy" cmd="nsCmd:ComposeNYI"/>
		<menuitem name="Paste" cmd="nsCmd:ComposeNYI"/>
		<menuitem name="Paste as Quotation" cmd="nsCmd:ComposeNYI"/>
		<menuitem name="Delete" cmd="nsCmd:ComposeNYI"/>
		<menuitem name="Select All" cmd="nsCmd:ComposeNYI"/>
		<separator/>
		<menuitem name="Find" cmd="nsCmd:ComposeNYI"/>
		<menuitem name="FInd Again" cmd="nsCmd:ComposeNYI"/>
		<separator/>
		<menuitem name="Do Not Complete Address" cmd="nsCmd:ComposeNYI"/>
		<menuitem name="Show Matching Addresses" cmd="nsCmd:ComposeNYI"/>
		<separator/>
		<menuitem name="Preferences..." cmd="nsCmd:ComposeNYI"/>
    </menu>
    <menu name="View">
		<menuitem name="Show" cmd="nsCmd:ComposeNYI"/>
		<separator/>
		<menuitem name="Address" cmd="nsCmd:ComposeNYI"/>
		<menuitem name="Attachments" cmd="nsCmd:ComposeNYI"/>
		<menuitem name="Options" cmd="nsCmd:ComposeNYI"/>
		<separator/>
		<menuitem name="Wrap Long Lines" cmd="nsCmd:ComposeNYI"/>
		<separator/>
		<menuitem name="Character Set" cmd="nsCmd:ComposeNYI"/>
    </menu>
    <menu name="Tools">
		<menuitem name="Check Spelling..." cmd="nsCmd:ComposeSpelling"/>
    </menu>
</menubar>

<html:div id="toolbar">
<toolbox>
	<toolbar>
 		<titledbutton src="resource:/res/toolbar/Mail_SendMsg.gif" align="bottom" value="Send" onClick="SendMessage()">	
		</titledbutton>

 		<titledbutton src="resource:/res/toolbar/Mail_QuoteMsg.gif" align="bottom" value="Quote" onClick="QuoteMessage()">	
		</titledbutton>

 		<titledbutton src="resource:/res/toolbar/Mail_SelectAddress.gif" align="bottom" value="Address" onClick="SelectAddress()">	
		</titledbutton>

 		<titledbutton src="resource:/res/toolbar/Mail_Attach.gif" align="bottom" value="Attach" onClick="AttachFile()">	
		</titledbutton>

 		<titledbutton src="resource:/res/toolbar/Mail_Options.gif" align="bottom" value="Option" onClick="Options()">	
		</titledbutton>

 		<titledbutton src="resource:/res/toolbar/Mail_Spelling.gif" align="bottom" value="Spelling" onClick="Spelling()">	
		</titledbutton>

 		<titledbutton src="resource:/res/toolbar/Mail_Save.gif" align="bottom" value="Save" onClick="SaveMessage()">	
		</titledbutton>

 		<titledbutton src="resource:/res/toolbar/TB_Stop.gif" align="bottom" value="Stop" onClick="Stop()">	
		</titledbutton>
	</toolbar>
	<toolbar>
		To:<html:input id="msgTo" style="vertical-align: center" type="text" 
			style="width:200px;" />   
		<html:br/>
		Cc:<html:input id="msgCc" style="vertical-align: center" type="text" 
			style="width:200px;" />   
		<html:br/>
		Bcc:<html:input id="msgBcc" style="vertical-align: center" type="text" 
			style="width:200px;" />   
	</toolbar>
	<toolbar>
		Subject:<html:input id="msgSubject" style="vertical-align: center" type="text" 
			style="width:500px;" /> 
	</toolbar>
</toolbox>
</html:div>

<html:div id="body">
	<html:iframe src="composebody.html" name="browser.message.body" width="100%" height="400"></html:iframe>
</html:div>

<html:div id="footer">
	<html:iframe src="status.html" name="browser.status" width="100%" height="34px" > </html:iframe>
</html:div>

</window>

