# This is a sample buildmaster config file. It must be installed as
# 'master.cfg' in your buildmaster's base directory (although the filename
# can be changed with the --basedir option to 'mktap buildbot master').

# It has one job: define a dictionary named BuildmasterConfig. This
# dictionary has a variety of keys to control different aspects of the
# buildmaster. They are documented in docs/config.xhtml .

import os.path
# from buildbot.changes.freshcvs import FreshCVSSource
from buildbot.process import factory
from buildbot.scheduler import Scheduler, Periodic
from buildbot.status import html
from buildbot import locks
from buildbot.steps.transfer import FileDownload
from buildbot.steps.shell import ShellCommand

# from auth import authlist, debugPassword

import perfrunner
reload(perfrunner)
from perfrunner import *

###
### Tinderbox builder names and build directories
###
WIN32_TRUNK_BUILDER="WINNT 5.2 fx-win32-tbox Depend Nightly"
WIN32_TRUNK_BUILDDIR="http://ftp.mozilla.org/pub/mozilla.org/firefox/tinderbox-builds/FX-WIN32-TBOX-trunk/"
WIN32_BRANCH_BUILDER="WINNT 5.2 prod-pacifica-vm Depend Fx-Nightly"
WIN32_BRANCH_BUILDDIR="http://ftp.mozilla.org/pub/mozilla.org/firefox/tinderbox-builds/prod-pacifica-vm-mozilla1.8/"
LINUX_TRUNK_BUILDER="Linux fx-linux-tbox Depend Nightly"
LINUX_TRUNK_BUILDDIR="http://ftp.mozilla.org/pub/mozilla.org/firefox/tinderbox-builds/fx-linux-tbox-trunk/"
LINUX_MOZ2_CENTRAL_BUILDER="mozilla-central-linux"
LINUX_MOZ2_CENTRAL_BUILDDIR="http://ftp.mozilla.org/pub/mozilla.org/firefox/tinderbox-builds/mozilla-central-linux/"
LINUX_MOZ2_ACTIONMONKEY_BUILDER="actionmonkey-linux"
LINUX_MOZ2_ACTIONMONKEY_BUILDDIR="http://ftp.mozilla.org/pub/mozilla.org/firefox/tinderbox-builds/actionmonkey-linux/"
LINUX_BRANCH_BUILDER="Linux production-prometheus-vm Depend Fx-Nightly"
LINUX_BRANCH_BUILDDIR="http://ftp.mozilla.org/pub/mozilla.org/firefox/tinderbox-builds/production-prometheus-vm-mozilla1.8/"
MAC_TRUNK_BUILDER="MacOSX Darwin 8.8.4 bm-xserve08 Depend Universal Nightly"
MAC_TRUNK_BUILDDIR="http://ftp.mozilla.org/pub/mozilla.org/firefox/tinderbox-builds/bm-xserve08-trunk/"
MAC_BRANCH_BUILDER="MacOSX Darwin 8.7.0 bm-xserve05 Depend Fx-Nightly"
MAC_BRANCH_BUILDDIR="http://ftp.mozilla.org/pub/mozilla.org/firefox/tinderbox-builds/bm-xserve05-mozilla1.8/"

CVSROOT=":pserver:anonymous@cvs-mirror.mozilla.org:/cvsroot"


# This is the dictionary that the buildmaster pays attention to. We also use
# a shorter alias to save typing.
c = BuildmasterConfig = {}

##
## Misc Config
##

c['debugPassword'] = "mozilla"
#c['manhole'] = Manhole(9999, "admin", "password")
c['projectName'] = "Talos"
c['projectURL'] = "http://quality.mozilla.org/en/projects/automation/talos"
c['buildbotURL'] = "http://qm-buildbot01.mozilla.org:2004"
c['slavePortnum'] = 9988

##
## Slaves
##

c['bots'] = [("qm-mini-xp01", "w1nd3rs"),
             ("qm-mini-xp02", "w1nd3rs"),
             ("qm-mini-xp03", "w1nd3rs"),
             ("qm-mini-xp04", "w1nd3rs"),
             ("qm-mini-xp05", "w1nd3rs"),
             ("qm-mini-xp06", "w1nd3rs"),
             ("qm-mini-xp07", "w1nd3rs"),
             ("qm-mini-xp08", "w1nd3rs"),
             ("qm-mini-vista01", "vist@"),
             ("qm-mini-vista02", "vist@"),
             ("qm-mini-vista03", "vist@"),
             ("qm-mini-vista04", "vist@"),
             ("qm-mini-vista05", "vist@"),
             ("qm-pmac01", "mac1nt0sh"),
             ("qm-pmac02", "mac1nt0sh"),
             ("qm-pmac03", "mac1nt0sh"),
             ("qm-pmac04", "mac1nt0sh"),
             ("qm-pmac05", "mac1nt0sh"),
             ("qm-pmac-trunk04", "mac1nt0sh"),
             ("qm-pmac-trunk05", "mac1nt0sh"),
             ("qm-pmac-trunk06", "mac1nt0sh"),
             ("qm-mini-ubuntu01", "l1nux"),
             ("qm-mini-ubuntu02", "l1nux"),
             ("qm-mini-ubuntu03", "l1nux"),
             ("qm-mini-ubuntu04", "l1nux"),
             ("qm-mini-ubuntu05", "l1nux"),
             ("qm-pxp-fast01", "w1nd3rs"),
             ("qm-pxp-fast02", "w1nd3rs"),
             ("qm-plinux-fast01", "l1nux"),
             ("qm-plinux-fast02", "l1nux"),
             ("qm-pmac-fast01", "mac1nt0sh"),
             ("qm-pmac-fast02", "mac1nt0sh")]

##
## Status
##

c['status'] = []
c['status'].append(html.Waterfall(http_port=2006,
           css="/build/perfmaster/waterfall.css"))

from tinderboxmailnotifier import TinderboxMailNotifier
from buildbot.status import tinderbox
from buildbot.status.mail import MailNotifier

c['status'].append(MailNotifier(
                       fromaddr="talos@qa.mozilla",
                       sendToInterestedUsers=False,
                       extraRecipients=["anodelman@mozilla.com",
                                        "rcampbell@mozilla.com"],
                       mode="failing",
                       builders=None, # send for all builders
                       relayhost="smtp.mozilla.org"))

# this is the local TinderboxMailNotifier
c['status'].append(TinderboxMailNotifier(
                       fromaddr="rcampbell@mozilla.com",
                       tree="Firefox",
                       extraRecipients=["tinderbox-daemon@tinderbox.mozilla.org",],
                       relayhost="smtp.mozilla.org",
                       builders=["WINNT 5.1 mini talos trunk",
                                 "WINNT 5.1 mini talos trunk nochrome",
                                 "WINNT 6.0 talos trunk",
                                 "WINNT 6.0 talos trunk nochrome",
                                 "Linux talos trunk",
                                 "Linux talos trunk nochrome",
                                 "MacOSX Darwin 8.8.1 talos trunk",
                                 "MacOSX Darwin 8.8.1 talos trunk nochrome",
                                 "MacOSX Darwin 9.0.0 talos trunk",
                                 "WINNT 5.1 mini talos trunk fast",
                                 "Linux talos trunk fast",
                                 "MacOSX Darwin 8.8.1 talos trunk fast"],
                       useChangeTime=True,
                       logCompression="bzip2"))

# this is the local TinderboxMailNotifier
c['status'].append(TinderboxMailNotifier(
                       fromaddr="rcampbell@mozilla.com",
                       tree="Mozilla1.8",
                       extraRecipients=["tinderbox-daemon@tinderbox.mozilla.org",],
                       relayhost="smtp.mozilla.org",
                       builders=["WINNT 5.1 mini talos branch",
                                 "WINNT 5.1 mini talos branch fast",
                                 "WINNT 6.0 talos branch",
                                 "Linux talos branch",
                                 "Linux talos branch fast",
                                 "MacOSX Darwin 8.8.1 talos branch",
                                 "MacOSX Darwin 8.8.1 talos branch fast"],
                       useChangeTime=True,
                       logCompression="bzip2"))

##
## Sources
##

from tinderboxpoller import TinderboxPoller

c['sources'] = []

c['sources'].append(TinderboxPoller(
    tinderboxURL = "http://tinderbox.mozilla.org",
    tree = "Mozilla1.8",
    branch = "BRANCH_1_8",
    machine = WIN32_BRANCH_BUILDER,
    pollInterval = 10 * 60)
)

c['sources'].append(TinderboxPoller(
    tinderboxURL = "http://tinderbox.mozilla.org",
    tree = "Firefox",
    branch = "HEAD",
    machine = WIN32_TRUNK_BUILDER,
    pollInterval = 10 * 60)
)

c['sources'].append(TinderboxPoller(
    tinderboxURL = "http://tinderbox.mozilla.org",
    tree = "Firefox",
    branch = "HEAD_LINUX",
    machine = LINUX_TRUNK_BUILDER,
    pollInterval = 10 * 60)
)

c['sources'].append(TinderboxPoller(
    tinderboxURL = "http://tinderbox.mozilla.org",
    tree = "Mozilla2",
    branch = "MOZ2-LINUX-CENTRAL",
    machine = LINUX_MOZ2_CENTRAL_BUILDER,
    pollInterval = 10 * 60)
)

c['sources'].append(TinderboxPoller(
    tinderboxURL = "http://tinderbox.mozilla.org",
    tree = "Mozilla2",
    branch = "MOZ2-LINUX-ACTIONMONKEY",
    machine = LINUX_MOZ2_ACTIONMONKEY_BUILDER,
    pollInterval = 10 * 60)
)

c['sources'].append(TinderboxPoller(
    tinderboxURL = "http://tinderbox.mozilla.org",
    tree = "Mozilla1.8",
    branch = "BRANCH_LINUX",
    machine = LINUX_BRANCH_BUILDER,
    pollInterval = 10 * 60)
)

c['sources'].append(TinderboxPoller(
    tinderboxURL = "http://tinderbox.mozilla.org",
    tree = "Firefox",
    branch = "HEAD-MAC",
    machine = MAC_TRUNK_BUILDER,
    pollInterval = 10 * 60)
)

c['sources'].append(TinderboxPoller(
    tinderboxURL = "http://tinderbox.mozilla.org",
    tree = "Mozilla1.8",
    branch = "BRANCH-MAC",
    machine = MAC_BRANCH_BUILDER,
    pollInterval = 10 * 60)
)

##
## Schedulers
##

c['schedulers'] = []

## WINDOWS
c['schedulers'].append(MultiBuildScheduler(name="head perfrun multi scheduler",
                                 branch="HEAD",
                                 treeStableTimer=5*60,
                                 builderNames=["WINNT 5.1 mini talos trunk",
                                               "WINNT 6.0 talos trunk"]
))
c['schedulers'].append(Scheduler(name="head perfrun scheduler",
                                 branch="HEAD",
                                 treeStableTimer=5*60,
                                 builderNames=["WINNT 5.1 mini talos trunk nochrome",
                                               "WINNT 5.1 mini talos trunk fast",
                                               "WINNT 6.0 talos trunk nochrome"]
))
c['schedulers'].append(Scheduler(name="branch perfrun scheduler",
                                 branch="BRANCH_1_8",
                                 treeStableTimer=5*60,
                                 builderNames=["WINNT 5.1 mini talos branch",
                                               "WINNT 5.1 mini talos branch fast",
                                               "WINNT 6.0 talos branch"]
))
## LINUX
c['schedulers'].append(Scheduler(name="head perfrun linux scheduler",
                                 branch="HEAD_LINUX",
                                 treeStableTimer=5*60,
                                 builderNames=["Linux talos trunk",
                                               "Linux talos trunk nochrome",
                                               "Linux talos trunk fast"]
))
c['schedulers'].append(Scheduler(name="branch perfrun linux scheduler",
                                 branch="BRANCH_LINUX",
                                 treeStableTimer=5*60,
                                 builderNames=["Linux talos branch",
                                               "Linux talos branch fast"]
))

## MAC
c['schedulers'].append(Scheduler(name="head perfrun scheduler mac",
                                 branch="HEAD-MAC",
                                 treeStableTimer=5*60,
                                 builderNames=["MacOSX Darwin 8.8.1 talos trunk",
                                               "MacOSX Darwin 8.8.1 talos trunk nochrome",
                                               "MacOSX Darwin 8.8.1 talos trunk fast",
                                               "MacOSX Darwin 9.0.0 talos trunk"]
))
c['schedulers'].append(Scheduler(name="branch perfrun scheduler mac",
                                 branch="BRANCH-MAC",
                                 treeStableTimer=5*60,
                                 builderNames=["MacOSX Darwin 8.8.1 talos branch",
                                               "MacOSX Darwin 8.8.1 talos branch fast"]
))

# the 'builders' list defines the Builders. Each one is configured with a
# dictionary, using the following keys:
#  name (required): the name used to describe this bilder
#  slavename (required): which slave to use, must appear in c['bots']
#  builddir (required): which subdirectory to run the builder in
#  factory (required): a BuildFactory to define how the build is run
#  periodicBuildTime (optional): if set, force a build every N seconds

win32_trunk_steps = factory.BuildFactory()
win32_trunk_steps.addStep(ShellCommand,
                           workdir=".",
                           description="Cleanup",
                           command=["rm", "-rf", "*.zip", "talos/", "firefox/"],
                           env=MozillaEnvironments['vc8perf'])
win32_trunk_steps.addStep(ShellCommand,
                           command=["cvs", "-d", CVSROOT, "co", "-d", "talos",
                                    "mozilla/testing/performance/talos"],
                           workdir=".",
                           description="checking out talos",
                           haltOnFailure=True,
                           flunkOnFailure=True,
                           env=MozillaEnvironments['vc8perf'])
win32_trunk_steps.addStep(FileDownload,
                           mastersrc="scripts/generate-tpcomponent.py",
                           slavedest="generate-tpcomponent.py",
                           workdir="talos/page_load_test")
win32_trunk_steps.addStep(FileDownload,
                           mastersrc="configs/production.sample.config",
                           slavedest="sample.config",
                           workdir="talos/")
win32_trunk_steps.addStep(ShellCommand,
                           command=["python", "generate-tpcomponent.py"],
                           workdir="talos/page_load_test",
                           description="setting up pageloader",
                           haltOnFailure=True,
                           flunkOnFailure=True,
                           env=MozillaEnvironments['vc8perf'])
win32_trunk_steps.addStep(MozillaWgetLatest,
                           workdir=".",
                           branch="1.9",
                           url=WIN32_TRUNK_BUILDDIR,
                           filenameSearchString="en-US.win32.zip",
                           env=MozillaEnvironments['vc8perf'])
win32_trunk_steps.addStep(MozillaInstallZip,
                           workdir=".",
                           branch="1.9",
                           haltOnFailure=True,
                           env=MozillaEnvironments['vc8perf'])
    # TODO: remove this when msys bug is fixed
win32_trunk_steps.addStep(ShellCommand,
                           workdir="firefox/",
                           description="chmod files (see msys bug)",
                           command=["chmod", "-v", "-R", "a+x", "."],
                           env=MozillaEnvironments['vc8perf'])
win32_trunk_steps.addStep(MozillaUpdateConfig,
                           workdir="talos/",
                           branch="1.9",
                           haltOnFailure=True,
                           executablePath="..\\firefox\\firefox.exe",
                           configPath=".",
                           env=MozillaEnvironments['vc8perf'])
win32_trunk_steps.addStep(MozillaRunPerfTests,
                           workdir="talos/",
                           branch="1.9",
                           timeout=14400,
                           haltOnFailure=True,
                           command=['python', 'run_tests.py', '--noisy'],
                           env=MozillaEnvironments['vc8perf'])

win32_trunk_nochrome_steps = factory.BuildFactory()
win32_trunk_nochrome_steps.addStep(ShellCommand,
                           workdir=".",
                           description="Cleanup",
                           command=["rm", "-rf", "*.zip", "talos/", "firefox/"],
                           env=MozillaEnvironments['vc8perf'])
win32_trunk_nochrome_steps.addStep(ShellCommand,
                           command=["cvs", "-d", CVSROOT, "co", "-d", "talos",
                                    "mozilla/testing/performance/talos"],
                           workdir=".",
                           description="checking out talos",
                           haltOnFailure=True,
                           flunkOnFailure=True,
                           env=MozillaEnvironments['vc8perf'])
win32_trunk_nochrome_steps.addStep(FileDownload,
                           mastersrc="scripts/generate-tpcomponent.py",
                           slavedest="generate-tpcomponent.py",
                           workdir="talos/page_load_test")
win32_trunk_nochrome_steps.addStep(FileDownload,
                           mastersrc="configs/production.sample.config.nochrome",
                           slavedest="sample.config",
                           workdir="talos/")
win32_trunk_nochrome_steps.addStep(ShellCommand,
                           command=["python", "generate-tpcomponent.py"],
                           workdir="talos/page_load_test",
                           description="setting up pageloader",
                           haltOnFailure=True,
                           flunkOnFailure=True,
                           env=MozillaEnvironments['vc8perf'])
win32_trunk_nochrome_steps.addStep(MozillaWgetLatest,
                           workdir=".",
                           branch="1.9",
                           url=WIN32_TRUNK_BUILDDIR,
                           filenameSearchString="en-US.win32.zip",
                           env=MozillaEnvironments['vc8perf'])
win32_trunk_nochrome_steps.addStep(MozillaInstallZip,
                           workdir=".",
                           branch="1.9",
                           haltOnFailure=True,
                           env=MozillaEnvironments['vc8perf'])
    # TODO: remove this when msys bug is fixed
win32_trunk_nochrome_steps.addStep(ShellCommand,
                           workdir="firefox/",
                           description="chmod files (see msys bug)",
                           command=["chmod", "-v", "-R", "a+x", "."],
                           env=MozillaEnvironments['vc8perf'])
win32_trunk_nochrome_steps.addStep(MozillaUpdateConfig,
                           workdir="talos/",
                           branch="1.9",
                           haltOnFailure=True,
                           executablePath="..\\firefox\\firefox.exe",
                           configPath=".",
                           env=MozillaEnvironments['vc8perf'])
win32_trunk_nochrome_steps.addStep(MozillaRunPerfTests,
                           workdir="talos/",
                           branch="1.9",
                           timeout=14400,
                           haltOnFailure=True,
                           command=['python', 'run_tests.py', '--noisy'],
                           env=MozillaEnvironments['vc8perf'])

win32_trunk_fast_steps = factory.BuildFactory()
win32_trunk_fast_steps.addStep(ShellCommand,
                           workdir=".",
                           description="Cleanup",
                           command=["rm", "-rf", "*.zip", "talos/", "firefox/"],
                           env=MozillaEnvironments['vc8perf'])
win32_trunk_fast_steps.addStep(ShellCommand,
                           command=["cvs", "-d", CVSROOT, "co", "-d", "talos",
                                    "mozilla/testing/performance/talos"],
                           workdir=".",
                           description="checking out talos",
                           haltOnFailure=True,
                           flunkOnFailure=True,
                           env=MozillaEnvironments['vc8perf'])
win32_trunk_fast_steps.addStep(FileDownload,
                           mastersrc="scripts/generate-tpcomponent.py",
                           slavedest="generate-tpcomponent.py",
                           workdir="talos/page_load_test")
win32_trunk_fast_steps.addStep(FileDownload,
                           mastersrc="configs/fast.production.sample.config",
                           slavedest="sample.config",
                           workdir="talos/")
win32_trunk_fast_steps.addStep(FileDownload,
                           mastersrc="configs/historic_manifest.txt",
                           slavedest="manifest.txt",
                           workdir="talos/page_load_test")
win32_trunk_fast_steps.addStep(ShellCommand,
                           command=["python", "generate-tpcomponent.py"],
                           workdir="talos/page_load_test",
                           description="setting up pageloader",
                           haltOnFailure=True,
                           flunkOnFailure=True,
                           env=MozillaEnvironments['vc8perf'])
win32_trunk_fast_steps.addStep(MozillaWgetLatest,
                           workdir=".",
                           branch="1.9",
                           url=WIN32_TRUNK_BUILDDIR,
                           filenameSearchString="en-US.win32.zip",
                           env=MozillaEnvironments['vc8perf'])
win32_trunk_fast_steps.addStep(MozillaInstallZip,
                           workdir=".",
                           branch="1.9",
                           haltOnFailure=True,
                           env=MozillaEnvironments['vc8perf'])
    # TODO: remove this when msys bug is fixed
win32_trunk_fast_steps.addStep(ShellCommand,
                           workdir="firefox/",
                           description="chmod files (see msys bug)",
                           command=["chmod", "-v", "-R", "a+x", "."],
                           env=MozillaEnvironments['vc8perf'])
win32_trunk_fast_steps.addStep(MozillaUpdateConfig,
                           workdir="talos/",
                           branch="1.9",
                           haltOnFailure=True,
                           executablePath="..\\firefox\\firefox.exe",
                           configPath=".",
                           env=MozillaEnvironments['vc8perf'])
win32_trunk_fast_steps.addStep(MozillaRunPerfTests,
                           workdir="talos/",
                           branch="1.9",
                           timeout=14400,
                           haltOnFailure=True,
                           command=['python', 'run_tests.py', '--noisy'],
                           env=MozillaEnvironments['vc8perf'])

win32_branch_steps = factory.BuildFactory()
win32_branch_steps.addStep(ShellCommand,
                           workdir=".",
                           description="Cleanup",
                           command=["rm", "-rf", "*.zip", "talos/", "firefox/"],
                           env=MozillaEnvironments['vc8perf'])
win32_branch_steps.addStep(ShellCommand,
                           command=["cvs", "-d", CVSROOT, "co", "-d", "talos",
                                    "mozilla/testing/performance/talos"],
                           workdir=".",
                           description="checking out talos",
                           haltOnFailure=True,
                           flunkOnFailure=True,
                           env=MozillaEnvironments['vc8perf'])
win32_branch_steps.addStep(FileDownload,
                           mastersrc="scripts/generate-tpcomponent.py",
                           slavedest="generate-tpcomponent.py",
                           workdir="talos/page_load_test")
win32_branch_steps.addStep(FileDownload,
                           mastersrc="configs/production.sample.config.nogfx",
                           slavedest="sample.config",
                           workdir="talos/")
win32_branch_steps.addStep(ShellCommand,
                           command=["python", "generate-tpcomponent.py"],
                           workdir="talos/page_load_test",
                           description="setting up pageloader",
                           haltOnFailure=True,
                           flunkOnFailure=True,
                           env=MozillaEnvironments['vc8perf'])
win32_branch_steps.addStep(MozillaWgetLatest,
                           workdir=".",
                           branch="branch",
                           url=WIN32_BRANCH_BUILDDIR,
                           filenameSearchString="en-US.win32.zip",
                           env=MozillaEnvironments['vc8perf'])
win32_branch_steps.addStep(MozillaInstallZip,
                           workdir=".",
                           branch="branch",
                           haltOnFailure=True,
                           env=MozillaEnvironments['vc8perf'])
win32_branch_steps.addStep(MozillaUpdateConfig,
                           workdir="talos/",
                           branch="1.8",
                           haltOnFailure=True,
                           # TODO: when talos supports relative paths on win32
                           # make this a relative path
                           executablePath="..\\firefox\\firefox.exe",
                           configPath=".",
                           env=MozillaEnvironments['vc8perf'])
win32_branch_steps.addStep(MozillaRunPerfTests,
                           workdir="talos/",
                           branch="branch",
                           timeout=14400,
                           haltOnFailure=True,
                           command=['python', 'run_tests.py', '--noisy'],
                           env=MozillaEnvironments['vc8perf'])

win32_branch_fast_steps = factory.BuildFactory()
win32_branch_fast_steps.addStep(ShellCommand,
                           workdir=".",
                           description="Cleanup",
                           command=["rm", "-rf", "*.zip", "talos/", "firefox/"],
                           env=MozillaEnvironments['vc8perf'])
win32_branch_fast_steps.addStep(ShellCommand,
                           command=["cvs", "-d", CVSROOT, "co", "-d", "talos",
                                    "mozilla/testing/performance/talos"],
                           workdir=".",
                           description="checking out talos",
                           haltOnFailure=True,
                           flunkOnFailure=True,
                           env=MozillaEnvironments['vc8perf'])
win32_branch_fast_steps.addStep(FileDownload,
                           mastersrc="scripts/generate-tpcomponent.py",
                           slavedest="generate-tpcomponent.py",
                           workdir="talos/page_load_test")
win32_branch_fast_steps.addStep(FileDownload,
                           mastersrc="configs/fast.production.sample.config",
                           slavedest="sample.config",
                           workdir="talos/")
win32_branch_fast_steps.addStep(FileDownload,
                           mastersrc="configs/historic_manifest.txt",
                           slavedest="manifest.txt",
                           workdir="talos/page_load_test")
win32_branch_fast_steps.addStep(ShellCommand,
                           command=["python", "generate-tpcomponent.py"],
                           workdir="talos/page_load_test",
                           description="setting up pageloader",
                           haltOnFailure=True,
                           flunkOnFailure=True,
                           env=MozillaEnvironments['vc8perf'])
win32_branch_fast_steps.addStep(MozillaWgetLatest,
                           workdir=".",
                           branch="branch",
                           url=WIN32_BRANCH_BUILDDIR,
                           filenameSearchString="en-US.win32.zip",
                           env=MozillaEnvironments['vc8perf'])
win32_branch_fast_steps.addStep(MozillaInstallZip,
                           workdir=".",
                           branch="branch",
                           haltOnFailure=True,
                           env=MozillaEnvironments['vc8perf'])
win32_branch_fast_steps.addStep(MozillaUpdateConfig,
                           workdir="talos/",
                           branch="1.8",
                           haltOnFailure=True,
                           # TODO: when talos supports relative paths on win32
                           # make this a relative path
                           executablePath="..\\firefox\\firefox.exe",
                           configPath=".",
                           env=MozillaEnvironments['vc8perf'])
win32_branch_fast_steps.addStep(MozillaRunPerfTests,
                           workdir="talos/",
                           branch="branch",
                           timeout=14400,
                           haltOnFailure=True,
                           command=['python', 'run_tests.py', '--noisy'],
                           env=MozillaEnvironments['vc8perf'])

vista_trunk_steps = factory.BuildFactory()
vista_trunk_steps.addStep(ShellCommand,
                           workdir=".",
                           description="Cleanup",
                           command=["rm", "-rf", "*.zip", "talos/", "firefox/"],
                           env=MozillaEnvironments['vc8perf'])
vista_trunk_steps.addStep(ShellCommand,
                           command=["cvs", "-d", CVSROOT, "co", "-d", "talos",
                                    "mozilla/testing/performance/talos"],
                           workdir=".",
                           description="checking out talos",
                           haltOnFailure=True,
                           flunkOnFailure=True,
                           env=MozillaEnvironments['vc8perf'])
vista_trunk_steps.addStep(FileDownload,
                           mastersrc="scripts/generate-tpcomponent.py",
                           slavedest="generate-tpcomponent.py",
                           workdir="talos/page_load_test")
vista_trunk_steps.addStep(FileDownload,
                           mastersrc="configs/production.sample.config",
                           slavedest="sample.config",
                           workdir="talos/")
vista_trunk_steps.addStep(ShellCommand,
                           command=["python", "generate-tpcomponent.py"],
                           workdir="talos/page_load_test",
                           description="setting up pageloader",
                           haltOnFailure=True,
                           flunkOnFailure=True,
                           env=MozillaEnvironments['vc8perf'])
vista_trunk_steps.addStep(MozillaWgetLatest,
                           workdir=".",
                           branch="1.9",
                           url=WIN32_TRUNK_BUILDDIR,
                           filenameSearchString="en-US.win32.zip",
                           env=MozillaEnvironments['vc8perf'])
vista_trunk_steps.addStep(MozillaInstallZip,
                           workdir=".",
                           branch="1.9",
                           haltOnFailure=True,
                           env=MozillaEnvironments['vc8perf']),
vista_trunk_steps.addStep(ShellCommand,
                           workdir="firefox/",
                           flunkOnFailure=False,
                           warnOnFailure=False,
                           description="chmod files (see msys bug)",
                           command=["chmod", "-v", "-R", "a+x", "."],
                           env=MozillaEnvironments['vc8perf'])
vista_trunk_steps.addStep(MozillaUpdateConfig,
                           workdir="talos/",
                           branch="1.9",
                           haltOnFailure=True,
                           executablePath="..\\firefox\\firefox.exe",
                           configPath=".",
                           env=MozillaEnvironments['vc8perf'])
vista_trunk_steps.addStep(MozillaRunPerfTests,
                           workdir="talos/",
                           branch="1.9",
                           timeout=14000,
                           haltOnFailure=True,
                           command=['python', 'run_tests.py', '--noisy'],
                           env=MozillaEnvironments['vc8perf'])

vista_trunk_nochrome_steps = factory.BuildFactory()
vista_trunk_nochrome_steps.addStep(ShellCommand,
                           workdir=".",
                           description="Cleanup",
                           command=["rm", "-rf", "*.zip", "talos/", "firefox/"],
                           env=MozillaEnvironments['vc8perf'])
vista_trunk_nochrome_steps.addStep(ShellCommand,
                           command=["cvs", "-d", CVSROOT, "co", "-d", "talos",
                                    "mozilla/testing/performance/talos"],
                           workdir=".",
                           description="checking out talos",
                           haltOnFailure=True,
                           flunkOnFailure=True,
                           env=MozillaEnvironments['vc8perf'])
vista_trunk_nochrome_steps.addStep(FileDownload,
                           mastersrc="scripts/generate-tpcomponent.py",
                           slavedest="generate-tpcomponent.py",
                           workdir="talos/page_load_test")
vista_trunk_nochrome_steps.addStep(FileDownload,
                           mastersrc="configs/production.sample.config.nochrome",
                           slavedest="sample.config",
                           workdir="talos/")
vista_trunk_nochrome_steps.addStep(ShellCommand,
                           command=["python", "generate-tpcomponent.py"],
                           workdir="talos/page_load_test",
                           description="setting up pageloader",
                           haltOnFailure=True,
                           flunkOnFailure=True,
                           env=MozillaEnvironments['vc8perf'])
vista_trunk_nochrome_steps.addStep(MozillaWgetLatest,
                           workdir=".",
                           branch="1.9",
                           url=WIN32_TRUNK_BUILDDIR,
                           filenameSearchString="en-US.win32.zip",
                           env=MozillaEnvironments['vc8perf'])
vista_trunk_nochrome_steps.addStep(MozillaInstallZip,
                           workdir=".",
                           branch="1.9",
                           haltOnFailure=True,
                           env=MozillaEnvironments['vc8perf']),
vista_trunk_nochrome_steps.addStep(ShellCommand,
                           workdir="firefox/",
                           flunkOnFailure=False,
                           warnOnFailure=False,
                           description="chmod files (see msys bug)",
                           command=["chmod", "-v", "-R", "a+x", "."],
                           env=MozillaEnvironments['vc8perf'])
vista_trunk_nochrome_steps.addStep(MozillaUpdateConfig,
                           workdir="talos/",
                           branch="1.9",
                           haltOnFailure=True,
                           executablePath="..\\firefox\\firefox.exe",
                           configPath=".",
                           env=MozillaEnvironments['vc8perf'])
vista_trunk_nochrome_steps.addStep(MozillaRunPerfTests,
                           workdir="talos/",
                           branch="1.9",
                           timeout=14000,
                           haltOnFailure=True,
                           command=['python', 'run_tests.py', '--noisy'],
                           env=MozillaEnvironments['vc8perf'])

vista_branch_steps = factory.BuildFactory()
vista_branch_steps.addStep(ShellCommand,
                           workdir=".",
                           description="Cleanup",
                           command=["rm", "-rf", "*.zip", "talos/", "firefox/"],
                           env=MozillaEnvironments['vc8perf'])
vista_branch_steps.addStep(ShellCommand,
                           command=["cvs", "-d", CVSROOT, "co", "-d", "talos",
                                    "mozilla/testing/performance/talos"],
                           workdir=".",
                           description="checking out talos",
                           haltOnFailure=True,
                           flunkOnFailure=True,
                           env=MozillaEnvironments['vc8perf'])
vista_branch_steps.addStep(FileDownload,
                           mastersrc="scripts/generate-tpcomponent.py",
                           slavedest="generate-tpcomponent.py",
                           workdir="talos/page_load_test")
vista_branch_steps.addStep(FileDownload,
                           mastersrc="configs/production.sample.config.nogfx",
                           slavedest="sample.config",
                           workdir="talos/")
vista_branch_steps.addStep(ShellCommand,
                           command=["python", "generate-tpcomponent.py"],
                           workdir="talos/page_load_test",
                           description="setting up pageloader",
                           haltOnFailure=True,
                           flunkOnFailure=True,
                           env=MozillaEnvironments['vc8perf'])
vista_branch_steps.addStep(MozillaWgetLatest,
                           workdir=".",
                           branch="branch",
                           url=WIN32_BRANCH_BUILDDIR,
                           filenameSearchString="en-US.win32.zip",
                           env=MozillaEnvironments['vc8perf'])
vista_branch_steps.addStep(MozillaInstallZip,
                           workdir=".",
                           branch="branch",
                           haltOnFailure=True,
                           env=MozillaEnvironments['vc8perf']),
vista_branch_steps.addStep(ShellCommand,
                           workdir="firefox/",
                           flunkOnFailure=False,
                           warnOnFailure=False,
                           description="chmod files (see msys bug)",
                           command=["chmod", "-v", "-R", "a+x", "."],
                           env=MozillaEnvironments['vc8perf'])
vista_branch_steps.addStep(MozillaUpdateConfig,
                           workdir="talos/",
                           branch="1.8",
                           haltOnFailure=True,
                           # TODO: when talos supports relative paths on win32
                           # make this a relative path
                           executablePath="..\\firefox\\firefox.exe",
                           configPath=".",
                           env=MozillaEnvironments['vc8perf'])
vista_branch_steps.addStep(MozillaRunPerfTests,
                           workdir="talos/",
                           branch="branch",
                           timeout=14400,
                           haltOnFailure=True,
                           command=['python', 'run_tests.py', '--noisy'],
                           env=MozillaEnvironments['vc8perf'])

linux_trunk_steps = factory.BuildFactory()
linux_trunk_steps.addStep(ShellCommand,
                           workdir=".",
                           description="Cleanup",
                           command=["rm", "-rf", "*.bz2", "talos/", "firefox/"],
                           env=MozillaEnvironments['linux'])
linux_trunk_steps.addStep(ShellCommand,
                           command=["cvs", "-d", CVSROOT, "co", "-d", "talos",
                                    "mozilla/testing/performance/talos"],
                           workdir=".",
                           description="checking out talos",
                           haltOnFailure=True,
                           flunkOnFailure=True,
                           env=MozillaEnvironments['linux'])
linux_trunk_steps.addStep(FileDownload,
                           mastersrc="scripts/generate-tpcomponent.py",
                           slavedest="generate-tpcomponent.py",
                           workdir="talos/page_load_test")
linux_trunk_steps.addStep(FileDownload,
                           mastersrc="configs/production.sample.config",
                           slavedest="sample.config",
                           workdir="talos/")
linux_trunk_steps.addStep(ShellCommand,
                           command=["python", "generate-tpcomponent.py"],
                           workdir="talos/page_load_test",
                           description="setting up pageloader",
                           haltOnFailure=True,
                           flunkOnFailure=True,
                           env=MozillaEnvironments['linux'])
linux_trunk_steps.addStep(MozillaWgetLatest,
                           workdir=".",
                           branch="LINUX-PL",
                           url=LINUX_TRUNK_BUILDDIR,
                           filenameSearchString="en-US.linux-i686.tar.bz2",
                           env=MozillaEnvironments['linux'])
linux_trunk_steps.addStep(MozillaInstallTarBz2,
                           workdir=".",
                           branch="LINUX-PL",
                           haltOnFailure=True,
                           env=MozillaEnvironments['linux'])
linux_trunk_steps.addStep(MozillaUpdateConfig,
                           workdir="talos/",
                           branch="1.9",
                           haltOnFailure=True,
                           # TODO: when talos supports relative paths on win32
                           # make this a relative path
                           executablePath="../firefox/firefox",
                           configPath=".",
                           env=MozillaEnvironments['linux'])
linux_trunk_steps.addStep(MozillaRunPerfTests,
                           workdir="talos/",
                           branch="LINUX-PL",
                           timeout=21600,
                           haltOnFailure=True,
                           command=['python', 'run_tests.py', '--noisy'],
                           env=MozillaEnvironments['linux'])

linux_trunk_nochrome_steps = factory.BuildFactory()
linux_trunk_nochrome_steps.addStep(ShellCommand,
                           workdir=".",
                           description="Cleanup",
                           command=["rm", "-rf", "*.bz2", "talos/", "firefox/"],
                           env=MozillaEnvironments['linux'])
linux_trunk_nochrome_steps.addStep(ShellCommand,
                           command=["cvs", "-d", CVSROOT, "co", "-d", "talos",
                                    "mozilla/testing/performance/talos"],
                           workdir=".",
                           description="checking out talos",
                           haltOnFailure=True,
                           flunkOnFailure=True,
                           env=MozillaEnvironments['linux'])
linux_trunk_nochrome_steps.addStep(FileDownload,
                           mastersrc="scripts/generate-tpcomponent.py",
                           slavedest="generate-tpcomponent.py",
                           workdir="talos/page_load_test")
linux_trunk_nochrome_steps.addStep(FileDownload,
                           mastersrc="configs/production.sample.config.nochrome",
                           slavedest="sample.config",
                           workdir="talos/")
linux_trunk_nochrome_steps.addStep(ShellCommand,
                           command=["python", "generate-tpcomponent.py"],
                           workdir="talos/page_load_test",
                           description="setting up pageloader",
                           haltOnFailure=True,
                           flunkOnFailure=True,
                           env=MozillaEnvironments['linux'])
linux_trunk_nochrome_steps.addStep(MozillaWgetLatest,
                           workdir=".",
                           branch="LINUX-PL",
                           url=LINUX_TRUNK_BUILDDIR,
                           filenameSearchString="en-US.linux-i686.tar.bz2",
                           env=MozillaEnvironments['linux'])
linux_trunk_nochrome_steps.addStep(MozillaInstallTarBz2,
                           workdir=".",
                           branch="LINUX-PL",
                           haltOnFailure=True,
                           env=MozillaEnvironments['linux'])
linux_trunk_nochrome_steps.addStep(MozillaUpdateConfig,
                           workdir="talos/",
                           branch="1.9",
                           haltOnFailure=True,
                           # TODO: when talos supports relative paths on win32
                           # make this a relative path
                           executablePath="../firefox/firefox",
                           configPath=".",
                           env=MozillaEnvironments['linux'])
linux_trunk_nochrome_steps.addStep(MozillaRunPerfTests,
                           workdir="talos/",
                           branch="LINUX-PL",
                           timeout=21600,
                           haltOnFailure=True,
                           command=['python', 'run_tests.py', '--noisy'],
                           env=MozillaEnvironments['linux'])

linux_trunk_fast_steps = factory.BuildFactory()
linux_trunk_fast_steps.addStep(ShellCommand,
                           workdir=".",
                           description="Cleanup",
                           command=["rm", "-rf", "*.bz2", "talos/", "firefox/"],
                           env=MozillaEnvironments['linux'])
linux_trunk_fast_steps.addStep(ShellCommand,
                           command=["cvs", "-d", CVSROOT, "co", "-d", "talos",
                                    "mozilla/testing/performance/talos"],
                           workdir=".",
                           description="checking out talos",
                           haltOnFailure=True,
                           flunkOnFailure=True,
                           env=MozillaEnvironments['linux'])
linux_trunk_fast_steps.addStep(FileDownload,
                           mastersrc="scripts/generate-tpcomponent.py",
                           slavedest="generate-tpcomponent.py",
                           workdir="talos/page_load_test")
linux_trunk_fast_steps.addStep(FileDownload,
                           mastersrc="configs/fast.production.sample.config",
                           slavedest="sample.config",
                           workdir="talos/")
linux_trunk_fast_steps.addStep(FileDownload,
                           mastersrc="configs/historic_manifest.txt",
                           slavedest="manifest.txt",
                           workdir="talos/page_load_test")
linux_trunk_fast_steps.addStep(ShellCommand,
                           command=["python", "generate-tpcomponent.py"],
                           workdir="talos/page_load_test",
                           description="setting up pageloader",
                           haltOnFailure=True,
                           flunkOnFailure=True,
                           env=MozillaEnvironments['linux'])
linux_trunk_fast_steps.addStep(MozillaWgetLatest,
                           workdir=".",
                           branch="LINUX-PL",
                           url=LINUX_TRUNK_BUILDDIR,
                           filenameSearchString="en-US.linux-i686.tar.bz2",
                           env=MozillaEnvironments['linux'])
linux_trunk_fast_steps.addStep(MozillaInstallTarBz2,
                           workdir=".",
                           branch="LINUX-PL",
                           haltOnFailure=True,
                           env=MozillaEnvironments['linux'])
linux_trunk_fast_steps.addStep(MozillaUpdateConfig,
                           workdir="talos/",
                           branch="1.9",
                           haltOnFailure=True,
                           # TODO: when talos supports relative paths on win32
                           # make this a relative path
                           executablePath="../firefox/firefox",
                           configPath=".",
                           env=MozillaEnvironments['linux'])
linux_trunk_fast_steps.addStep(MozillaRunPerfTests,
                           workdir="talos/",
                           branch="LINUX-PL",
                           timeout=21600,
                           haltOnFailure=True,
                           command=['python', 'run_tests.py', '--noisy'],
                           env=MozillaEnvironments['linux'])

linux_branch_steps = factory.BuildFactory()
linux_branch_steps.addStep(ShellCommand,
                           workdir=".",
                           description="Cleanup",
                           command=["rm", "-rf", "*.bz2", "talos/", "firefox/"],
                           env=MozillaEnvironments['linux'])
linux_branch_steps.addStep(ShellCommand,
                           command=["cvs", "-d", CVSROOT, "co", "-d", "talos",
                                    "mozilla/testing/performance/talos"],
                           workdir=".",
                           description="checking out talos",
                           haltOnFailure=True,
                           flunkOnFailure=True,
                           env=MozillaEnvironments['linux'])
linux_branch_steps.addStep(FileDownload,
                           mastersrc="scripts/generate-tpcomponent.py",
                           slavedest="generate-tpcomponent.py",
                           workdir="talos/page_load_test")
linux_branch_steps.addStep(FileDownload,
                           mastersrc="configs/production.sample.config.nogfx",
                           slavedest="sample.config",
                           workdir="talos/")
linux_branch_steps.addStep(ShellCommand,
                           command=["python", "generate-tpcomponent.py"],
                           workdir="talos/page_load_test",
                           description="setting up pageloader",
                           haltOnFailure=True,
                           flunkOnFailure=True,
                           env=MozillaEnvironments['linux'])
linux_branch_steps.addStep(MozillaWgetLatest,
                           workdir=".",
                           branch="LINUX-PL",
                           url=LINUX_BRANCH_BUILDDIR,
                           filenameSearchString="en-US.linux-i686.tar.gz",
                           env=MozillaEnvironments['linux'])
linux_branch_steps.addStep(MozillaInstallTarGz,
                           workdir=".",
                           branch="LINUX-PL",
                           haltOnFailure=True,
                           env=MozillaEnvironments['linux'])
linux_branch_steps.addStep(MozillaUpdateConfig,
                           workdir="talos/",
                           branch="1.8",
                           haltOnFailure=True,
                           executablePath="../firefox/firefox",
                           configPath=".",
                           env=MozillaEnvironments['linux'])
linux_branch_steps.addStep(MozillaRunPerfTests,
                           workdir="talos/",
                           branch="LINUX-PL",
                           timeout=14400,
                           haltOnFailure=True,
                           command=['python', 'run_tests.py', '--noisy'],
                           env=MozillaEnvironments['linux'])

linux_branch_fast_steps = factory.BuildFactory()
linux_branch_fast_steps.addStep(ShellCommand,
                           workdir=".",
                           description="Cleanup",
                           command=["rm", "-rf", "*.bz2", "talos/", "firefox/"],
                           env=MozillaEnvironments['linux'])
linux_branch_fast_steps.addStep(ShellCommand,
                           command=["cvs", "-d", CVSROOT, "co", "-d", "talos",
                                    "mozilla/testing/performance/talos"],
                           workdir=".",
                           description="checking out talos",
                           haltOnFailure=True,
                           flunkOnFailure=True,
                           env=MozillaEnvironments['linux'])
linux_branch_fast_steps.addStep(FileDownload,
                           mastersrc="scripts/generate-tpcomponent.py",
                           slavedest="generate-tpcomponent.py",
                           workdir="talos/page_load_test")
linux_branch_fast_steps.addStep(FileDownload,
                           mastersrc="configs/fast.production.sample.config",
                           slavedest="sample.config",
                           workdir="talos/")
linux_branch_fast_steps.addStep(FileDownload,
                           mastersrc="configs/historic_manifest.txt",
                           slavedest="manifest.txt",
                           workdir="talos/page_load_test")
linux_branch_fast_steps.addStep(ShellCommand,
                           command=["python", "generate-tpcomponent.py"],
                           workdir="talos/page_load_test",
                           description="setting up pageloader",
                           haltOnFailure=True,
                           flunkOnFailure=True,
                           env=MozillaEnvironments['linux'])
linux_branch_fast_steps.addStep(MozillaWgetLatest,
                           workdir=".",
                           branch="LINUX-PL",
                           url=LINUX_BRANCH_BUILDDIR,
                           filenameSearchString="en-US.linux-i686.tar.gz",
                           env=MozillaEnvironments['linux'])
linux_branch_fast_steps.addStep(MozillaInstallTarGz,
                           workdir=".",
                           branch="LINUX-PL",
                           haltOnFailure=True,
                           env=MozillaEnvironments['linux'])
linux_branch_fast_steps.addStep(MozillaUpdateConfig,
                           workdir="talos/",
                           branch="1.8",
                           haltOnFailure=True,
                           executablePath="../firefox/firefox",
                           configPath=".",
                           env=MozillaEnvironments['linux'])
linux_branch_fast_steps.addStep(MozillaRunPerfTests,
                           workdir="talos/",
                           branch="LINUX-PL",
                           timeout=14400,
                           haltOnFailure=True,
                           command=['python', 'run_tests.py', '--noisy'],
                           env=MozillaEnvironments['linux'])

mac_trunk_steps = factory.BuildFactory()
mac_trunk_steps.addStep(ShellCommand,
                    workdir=".",
                    description="Cleanup",
                    command="rm -vrf *",
                    env=MozillaEnvironments['mac'])
mac_trunk_steps.addStep(ShellCommand,
                           command=["cvs", "-d", CVSROOT, "co", "-d", "talos",
                                    "mozilla/testing/performance/talos"],
                           workdir=".",
                           description="checking out talos",
                           haltOnFailure=True,
                           flunkOnFailure=True,
                           env=MozillaEnvironments['mac'])
mac_trunk_steps.addStep(FileDownload,
                           mastersrc="scripts/generate-tpcomponent.py",
                           slavedest="generate-tpcomponent.py",
                           workdir="talos/page_load_test")
mac_trunk_steps.addStep(FileDownload,
                           mastersrc="scripts/installdmg.sh",
                           slavedest="installdmg.sh",
                           workdir=".")
mac_trunk_steps.addStep(FileDownload,
                           mastersrc="configs/production.sample.config",
                           slavedest="sample.config",
                           workdir="talos/")
mac_trunk_steps.addStep(ShellCommand,
                           command=["python", "generate-tpcomponent.py"],
                           workdir="talos/page_load_test",
                           description="setting up pageloader",
                           haltOnFailure=True,
                           flunkOnFailure=True,
                           env=MozillaEnvironments['mac'])
mac_trunk_steps.addStep(MozillaWgetLatest,
                           workdir=".",
                           branch="MAC-PL",
                           url=MAC_TRUNK_BUILDDIR,
                           filenameSearchString="en-US.mac.dmg",
                           env=MozillaEnvironments['mac'])
mac_trunk_steps.addStep(MozillaInstallDmg,
                           workdir=".",
                           branch="MAC-PL",
                           haltOnFailure=True,
                           env=MozillaEnvironments['mac'])
mac_trunk_steps.addStep(MozillaUpdateConfig,
                           workdir="talos/",
                           branch="1.9",
                           haltOnFailure=True,
                           executablePath="../Minefield.app/Contents/MacOS/firefox",
                           configPath=".",
                           env=MozillaEnvironments['mac'])
mac_trunk_steps.addStep(MozillaRunPerfTests,
                           workdir="talos/",
                           branch="MAC-PL",
                           timeout=21600,
                           haltOnFailure=True,
                           command=['python', 'run_tests.py', '--noisy'],
                           env=MozillaEnvironments['mac'])

mac_trunk_nochrome_steps = factory.BuildFactory()
mac_trunk_nochrome_steps.addStep(ShellCommand,
                    workdir=".",
                    description="Cleanup",
                    command="rm -vrf *",
                    env=MozillaEnvironments['mac'])
mac_trunk_nochrome_steps.addStep(ShellCommand,
                           command=["cvs", "-d", CVSROOT, "co", "-d", "talos",
                                    "mozilla/testing/performance/talos"],
                           workdir=".",
                           description="checking out talos",
                           haltOnFailure=True,
                           flunkOnFailure=True,
                           env=MozillaEnvironments['mac'])
mac_trunk_nochrome_steps.addStep(FileDownload,
                           mastersrc="scripts/generate-tpcomponent.py",
                           slavedest="generate-tpcomponent.py",
                           workdir="talos/page_load_test")
mac_trunk_nochrome_steps.addStep(FileDownload,
                           mastersrc="scripts/installdmg.sh",
                           slavedest="installdmg.sh",
                           workdir=".")
mac_trunk_nochrome_steps.addStep(FileDownload,
                           mastersrc="configs/production.sample.config.nochrome",
                           slavedest="sample.config",
                           workdir="talos/")
mac_trunk_nochrome_steps.addStep(ShellCommand,
                           command=["python", "generate-tpcomponent.py"],
                           workdir="talos/page_load_test",
                           description="setting up pageloader",
                           haltOnFailure=True,
                           flunkOnFailure=True,
                           env=MozillaEnvironments['mac'])
mac_trunk_nochrome_steps.addStep(MozillaWgetLatest,
                           workdir=".",
                           branch="MAC-PL",
                           url=MAC_TRUNK_BUILDDIR,
                           filenameSearchString="en-US.mac.dmg",
                           env=MozillaEnvironments['mac'])
mac_trunk_nochrome_steps.addStep(MozillaInstallDmg,
                           workdir=".",
                           branch="MAC-PL",
                           haltOnFailure=True,
                           env=MozillaEnvironments['mac'])
mac_trunk_nochrome_steps.addStep(MozillaUpdateConfig,
                           workdir="talos/",
                           branch="1.9",
                           haltOnFailure=True,
                           executablePath="../Minefield.app/Contents/MacOS/firefox",
                           configPath=".",
                           env=MozillaEnvironments['mac'])
mac_trunk_nochrome_steps.addStep(MozillaRunPerfTests,
                           workdir="talos/",
                           branch="MAC-PL",
                           timeout=21600,
                           haltOnFailure=True,
                           command=['python', 'run_tests.py', '--noisy'],
                           env=MozillaEnvironments['mac'])

mac_trunk_fast_steps = factory.BuildFactory()
mac_trunk_fast_steps.addStep(ShellCommand,
                    workdir=".",
                    description="Cleanup",
                    command="rm -vrf *",
                    env=MozillaEnvironments['mac'])
mac_trunk_fast_steps.addStep(ShellCommand,
                           command=["cvs", "-d", CVSROOT, "co", "-d", "talos",
                                    "mozilla/testing/performance/talos"],
                           workdir=".",
                           description="checking out talos",
                           haltOnFailure=True,
                           flunkOnFailure=True,
                           env=MozillaEnvironments['mac'])
mac_trunk_fast_steps.addStep(FileDownload,
                           mastersrc="scripts/generate-tpcomponent.py",
                           slavedest="generate-tpcomponent.py",
                           workdir="talos/page_load_test")
mac_trunk_fast_steps.addStep(FileDownload,
                           mastersrc="scripts/installdmg.sh",
                           slavedest="installdmg.sh",
                           workdir=".")
mac_trunk_fast_steps.addStep(FileDownload,
                           mastersrc="configs/fast.production.sample.config",
                           slavedest="sample.config",
                           workdir="talos/")
mac_trunk_fast_steps.addStep(FileDownload,
                           mastersrc="configs/historic_manifest.txt",
                           slavedest="manifest.txt",
                           workdir="talos/page_load_test")
mac_trunk_fast_steps.addStep(ShellCommand,
                           command=["python", "generate-tpcomponent.py"],
                           workdir="talos/page_load_test",
                           description="setting up pageloader",
                           haltOnFailure=True,
                           flunkOnFailure=True,
                           env=MozillaEnvironments['mac'])
mac_trunk_fast_steps.addStep(MozillaWgetLatest,
                           workdir=".",
                           branch="MAC-PL",
                           url=MAC_TRUNK_BUILDDIR,
                           filenameSearchString="en-US.mac.dmg",
                           env=MozillaEnvironments['mac'])
mac_trunk_fast_steps.addStep(MozillaInstallDmg,
                           workdir=".",
                           branch="MAC-PL",
                           haltOnFailure=True,
                           env=MozillaEnvironments['mac'])
mac_trunk_fast_steps.addStep(MozillaUpdateConfig,
                           workdir="talos/",
                           branch="1.9",
                           haltOnFailure=True,
                           executablePath="../Minefield.app/Contents/MacOS/firefox",
                           configPath=".",
                           env=MozillaEnvironments['mac'])
mac_trunk_fast_steps.addStep(MozillaRunPerfTests,
                           workdir="talos/",
                           branch="MAC-PL",
                           timeout=21600,
                           haltOnFailure=True,
                           command=['python', 'run_tests.py', '--noisy'],
                           env=MozillaEnvironments['mac'])

leopard_trunk_steps = factory.BuildFactory()
leopard_trunk_steps.addStep(ShellCommand,
                    workdir=".",
                    description="Cleanup",
                    command="rm -vrf *",
                    env=MozillaEnvironments['mac'])
leopard_trunk_steps.addStep(ShellCommand,
                           command=["cvs", "-d", CVSROOT, "co", "-d", "talos",
                                    "mozilla/testing/performance/talos"],
                           workdir=".",
                           description="checking out talos",
                           haltOnFailure=True,
                           flunkOnFailure=True,
                           env=MozillaEnvironments['mac'])
leopard_trunk_steps.addStep(FileDownload,
                           mastersrc="scripts/generate-tpcomponent.py",
                           slavedest="generate-tpcomponent.py",
                           workdir="talos/page_load_test")
leopard_trunk_steps.addStep(FileDownload,
                           mastersrc="scripts/installdmg.ex",
                           slavedest="installdmg.ex",
                           workdir=".")
leopard_trunk_steps.addStep(FileDownload,
                           mastersrc="configs/production.sample.config",
                           slavedest="sample.config",
                           workdir="talos/")
leopard_trunk_steps.addStep(ShellCommand,
                           command=["python", "generate-tpcomponent.py"],
                           workdir="talos/page_load_test",
                           description="setting up pageloader",
                           haltOnFailure=True,
                           flunkOnFailure=True,
                           env=MozillaEnvironments['mac'])
leopard_trunk_steps.addStep(MozillaWgetLatest,
                           workdir=".",
                           branch="MAC-PL",
                           url=MAC_TRUNK_BUILDDIR,
                           filenameSearchString="en-US.mac.dmg",
                           env=MozillaEnvironments['mac'])
leopard_trunk_steps.addStep(MozillaInstallDmgEx,
                           workdir=".",
                           branch="MAC-PL",
                           haltOnFailure=True,
                           env=MozillaEnvironments['mac'])
leopard_trunk_steps.addStep(MozillaUpdateConfig,
                           workdir="talos/",
                           branch="1.9",
                           haltOnFailure=True,
                           executablePath="../Minefield.app/Contents/MacOS/firefox",
                           configPath=".",
                           env=MozillaEnvironments['mac'])
leopard_trunk_steps.addStep(MozillaRunPerfTests,
                           workdir="talos/",
                           branch="MAC-PL",
                           timeout=21600,
                           haltOnFailure=True,
                           command=['python', 'run_tests.py', '--noisy'],
                           env=MozillaEnvironments['mac'])

mac_branch_steps = factory.BuildFactory()
mac_branch_steps.addStep(ShellCommand,
                    workdir=".",
                    description="Cleanup",
                    command="rm -vrf * ../talos-checkout/*",
                    env=MozillaEnvironments['mac'])
mac_branch_steps.addStep(ShellCommand,
                    command=["cvs", "-d", CVSROOT, "co", "-d", "talos",
                             "mozilla/testing/performance/talos"],
                    workdir=".",
                    description="checking out talos",
                    haltOnFailure=True,
                    flunkOnFailure=True,
                    env=MozillaEnvironments['mac'])
mac_branch_steps.addStep(FileDownload,
                           mastersrc="scripts/generate-tpcomponent.py",
                           slavedest="generate-tpcomponent.py",
                           workdir="talos/page_load_test")
mac_branch_steps.addStep(FileDownload,
                           mastersrc="scripts/installdmg.sh",
                           slavedest="installdmg.sh",
                           workdir=".")
mac_branch_steps.addStep(FileDownload,
                           mastersrc="configs/production.sample.config.nogfx",
                           slavedest="sample.config",
                           workdir="talos/")
mac_branch_steps.addStep(ShellCommand,
                           command=["python", "generate-tpcomponent.py"],
                           workdir="talos/page_load_test",
                           description="setting up pageloader",
                           haltOnFailure=True,
                           flunkOnFailure=True,
                           env=MozillaEnvironments['mac'])
mac_branch_steps.addStep(MozillaWgetLatest,
                           workdir=".",
                           branch="MAC-BRANCH",
                           url=MAC_BRANCH_BUILDDIR,
                           filenameSearchString="en-US.mac.dmg",
                           env=MozillaEnvironments['mac'])
mac_branch_steps.addStep(MozillaInstallDmg,
                           workdir=".",
                           branch="MAC-BRANCH",
                           haltOnFailure=True,
                           env=MozillaEnvironments['mac'])
mac_branch_steps.addStep(MozillaUpdateConfig,
                           workdir="talos/",
                           branch="1.8",
                           haltOnFailure=True,
                           executablePath="../BonEcho.app/Contents/MacOS/firefox",
                           configPath=".",
                           env=MozillaEnvironments['mac'])
mac_branch_steps.addStep(MozillaRunPerfTests,
                           workdir="talos/",
                           branch="MAC-BRANCH",
                           timeout=14400,
                           haltOnFailure=True,
                           command=['python', 'run_tests.py', '--noisy'],
                           env=MozillaEnvironments['mac'])

mac_branch_fast_steps = factory.BuildFactory()
mac_branch_fast_steps.addStep(ShellCommand,
                    workdir=".",
                    description="Cleanup",
                    command="rm -vrf * ../talos-checkout/*",
                    env=MozillaEnvironments['mac'])
mac_branch_fast_steps.addStep(ShellCommand,
                    command=["cvs", "-d", CVSROOT, "co", "-d", "talos",
                             "mozilla/testing/performance/talos"],
                    workdir=".",
                    description="checking out talos",
                    haltOnFailure=True,
                    flunkOnFailure=True,
                    env=MozillaEnvironments['mac'])
mac_branch_fast_steps.addStep(FileDownload,
                           mastersrc="scripts/generate-tpcomponent.py",
                           slavedest="generate-tpcomponent.py",
                           workdir="talos/page_load_test")
mac_branch_fast_steps.addStep(FileDownload,
                           mastersrc="scripts/installdmg.sh",
                           slavedest="installdmg.sh",
                           workdir=".")
mac_branch_fast_steps.addStep(FileDownload,
                           mastersrc="configs/fast.production.sample.config",
                           slavedest="sample.config",
                           workdir="talos/")
mac_branch_fast_steps.addStep(FileDownload,
                           mastersrc="configs/historic_manifest.txt",
                           slavedest="manifest.txt",
                           workdir="talos/page_load_test")
mac_branch_fast_steps.addStep(ShellCommand,
                           command=["python", "generate-tpcomponent.py"],
                           workdir="talos/page_load_test",
                           description="setting up pageloader",
                           haltOnFailure=True,
                           flunkOnFailure=True,
                           env=MozillaEnvironments['mac'])
mac_branch_fast_steps.addStep(MozillaWgetLatest,
                           workdir=".",
                           branch="MAC-BRANCH",
                           url=MAC_BRANCH_BUILDDIR,
                           filenameSearchString="en-US.mac.dmg",
                           env=MozillaEnvironments['mac'])
mac_branch_fast_steps.addStep(MozillaInstallDmg,
                           workdir=".",
                           branch="MAC-BRANCH",
                           haltOnFailure=True,
                           env=MozillaEnvironments['mac'])
mac_branch_fast_steps.addStep(MozillaUpdateConfig,
                           workdir="talos/",
                           branch="1.8",
                           haltOnFailure=True,
                           executablePath="../BonEcho.app/Contents/MacOS/firefox",
                           configPath=".",
                           env=MozillaEnvironments['mac'])
mac_branch_fast_steps.addStep(MozillaRunPerfTests,
                           workdir="talos/",
                           branch="MAC-BRANCH",
                           timeout=14400,
                           haltOnFailure=True,
                           command=['python', 'run_tests.py', '--noisy'],
                           env=MozillaEnvironments['mac'])


win32_trunk_builder = {
    'name': "WINNT 5.1 mini talos trunk",
    'slavenames': ['qm-mini-xp01', 'qm-mini-xp02', 'qm-mini-xp03'],
    'builddir': "win32-trunk-mini",
    'factory': win32_trunk_steps,
    'category': "Firefox Trunk"
}

win32_trunk_nochrome_builder = {
    'name': "WINNT 5.1 mini talos trunk nochrome",
    'slavenames': ['qm-mini-xp05'],
    'builddir': "win32-trunk-mini-nochrome",
    'factory': win32_trunk_nochrome_steps,
    'category': "Firefox Trunk"
}

win32_trunk_fast_builder = {
    'name': "WINNT 5.1 mini talos trunk fast",
    'slavenames': ['qm-pxp-fast01'],
    'builddir': "win32-trunk-mini-fast",
    'factory': win32_trunk_fast_steps,
    'category': "Firefox Trunk"
}

win32_branch_builder = {
    'name': "WINNT 5.1 mini talos branch",
    'slavenames': ['qm-mini-xp04'],
    'builddir': "win32-branch",
    'factory': win32_branch_steps,
    'category': "Firefox BRANCH_1_8"
}

win32_branch_fast_builder = {
    'name': "WINNT 5.1 mini talos branch fast",
    'slavenames': ['qm-pxp-fast02'],
    'builddir': "win32-branch-fast",
    'factory': win32_branch_fast_steps,
    'category': "Firefox BRANCH_1_8"
}

vista_trunk_builder = {
    'name': "WINNT 6.0 talos trunk",
    'slavenames': ['qm-mini-vista01', 'qm-mini-vista02', 'qm-mini-vista03'],
    'builddir': "vista-trunk",
    'factory': vista_trunk_steps,
    'category': "Firefox Trunk"
}

vista_trunk_nochrome_builder = {
    'name': "WINNT 6.0 talos trunk nochrome",
    'slavenames': ['qm-mini-vista05'],
    'builddir': "vista-trunk-nochrome",
    'factory': vista_trunk_nochrome_steps,
    'category': "Firefox Trunk"
}

vista_branch_builder = {
    'name': "WINNT 6.0 talos branch",
    'slavenames': ['qm-mini-vista04'],
    'builddir': "vista-branch",
    'factory': vista_branch_steps,
    'category': "Firefox BRANCH_1_8"
}

linux_trunk_builder = {
    'name': "Linux talos trunk",
    'slavenames': ['qm-mini-ubuntu01', 'qm-mini-ubuntu02', 'qm-mini-ubuntu05'],
    'builddir': "linux-trunk",
    'factory': linux_trunk_steps,
    'category': "Firefox Trunk"
}

linux_trunk_nochrome_builder = {
    'name': "Linux talos trunk nochrome",
    'slavenames': ['qm-mini-ubuntu03'],
    'builddir': "linux-trunk-nochrome",
    'factory': linux_trunk_nochrome_steps,
    'category': "Firefox Trunk"
}

linux_trunk_fast_builder = {
    'name': "Linux talos trunk fast",
    'slavenames': ['qm-plinux-fast01'],
    'builddir': "linux-trunk-fast",
    'factory': linux_trunk_fast_steps,
    'category': "Firefox Trunk"
}

linux_branch_builder = {
    'name': "Linux talos branch",
    'slavenames': ['qm-mini-ubuntu04'],
    'builddir': "linux-branch",
    'factory': linux_branch_steps,
    'category': "Firefox BRANCH_1_8"
}

linux_branch_fast_builder = {
    'name': "Linux talos branch fast",
    'slavenames': ['qm-plinux-fast02'],
    'builddir': "linux-branch-fast",
    'factory': linux_branch_fast_steps,
    'category': "Firefox BRANCH_1_8"
}

mac_trunk_builder = {
    'name': "MacOSX Darwin 8.8.1 talos trunk",
    'slavenames': ['qm-pmac01', 'qm-pmac02', 'qm-pmac03'],
    'builddir': "mac-trunk",
    'factory': mac_trunk_steps,
    'category': "Firefox Trunk"
}

mac_trunk_nochrome_builder = {
    'name': "MacOSX Darwin 8.8.1 talos trunk nochrome",
    'slavenames': ['qm-pmac05'],
    'builddir': "mac-trunk-nochrome",
    'factory': mac_trunk_nochrome_steps,
    'category': "Firefox Trunk"
}

mac_trunk_fast_builder = {
    'name': "MacOSX Darwin 8.8.1 talos trunk fast",
    'slavenames': ['qm-pmac-fast01'],
    'builddir': "mac-trunk-fast",
    'factory': mac_trunk_fast_steps,
    'category': "Firefox Trunk"
}

leopard_trunk_builder = {
    'name': "MacOSX Darwin 9.0.0 talos trunk",
    'slavenames': ['qm-pmac-trunk04', 'qm-pmac-trunk05', 'qm-pmac-trunk06'],
    'builddir': "leopard-trunk",
    'factory': leopard_trunk_steps,
    'category': "Firefox Trunk"
}

mac_branch_builder = {
    'name': "MacOSX Darwin 8.8.1 talos branch",
    'slavenames': ['qm-pmac04'],
    'builddir': "mac-branch",
    'factory': mac_branch_steps,
    'category': "Firefox BRANCH_1_8"
}

mac_branch_fast_builder = {
    'name': "MacOSX Darwin 8.8.1 talos branch fast",
    'slavenames': ['qm-pmac-fast02'],
    'builddir': "mac-branch-fast",
    'factory': mac_branch_fast_steps,
    'category': "Firefox BRANCH_1_8"
}

c['builders'] = []

c['builders'].append(win32_trunk_builder)
c['builders'].append(win32_trunk_nochrome_builder)
c['builders'].append(win32_trunk_fast_builder)
c['builders'].append(win32_branch_builder)
c['builders'].append(win32_branch_fast_builder)
c['builders'].append(vista_trunk_builder)
c['builders'].append(vista_trunk_nochrome_builder)
c['builders'].append(vista_branch_builder)
c['builders'].append(linux_trunk_builder)
c['builders'].append(linux_trunk_nochrome_builder)
c['builders'].append(linux_trunk_fast_builder)
c['builders'].append(linux_branch_builder)
c['builders'].append(linux_branch_fast_builder)
c['builders'].append(mac_trunk_builder)
c['builders'].append(mac_trunk_nochrome_builder)
c['builders'].append(mac_trunk_fast_builder)
c['builders'].append(leopard_trunk_builder)
c['builders'].append(mac_branch_builder)
c['builders'].append(mac_branch_fast_builder)
