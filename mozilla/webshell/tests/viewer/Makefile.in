#!gmake
#
# The contents of this file are subject to the Netscape Public License
# Version 1.0 (the "NPL"); you may not use this file except in
# compliance with the NPL.  You may obtain a copy of the NPL at
# http://www.mozilla.org/NPL/
#
# Software distributed under the NPL is distributed on an "AS IS" basis,
# WITHOUT WARRANTY OF ANY KIND, either express or implied. See the NPL
# for the specific language governing rights and limitations under the
# NPL.
#
# The Initial Developer of this code under the NPL is Netscape
# Communications Corporation.  Portions created by Netscape are
# Copyright (C) 1998 Netscape Communications Corporation.  All Rights
# Reserved.

DEPTH=../../..
topsrcdir	= @top_srcdir@
srcdir		= @srcdir@
VPATH		= @srcdir@

include $(DEPTH)/config/autoconf.mk

DIRS	= public

PROGRAM	= viewer

EXPORT_RESOURCE_SAMPLES := \
	$(wildcard $(srcdir)/samples/test*.html) \
	$(wildcard $(srcdir)/samples/toolbarTest*.xul) \
	$(wildcard $(srcdir)/samples/treeTest*.xul) \
	$(wildcard $(srcdir)/samples/treeTest*.css) \
	$(wildcard $(srcdir)/samples/xulTest.css) \
	$(wildcard $(srcdir)/samples/aform.css) \
	$(wildcard $(srcdir)/samples/bform.css) \
	$(wildcard $(srcdir)/samples/cform.css) \
	$(wildcard $(srcdir)/samples/mozform.css) \
	$(wildcard $(srcdir)/samples/demoform.css) \
	$(wildcard $(srcdir)/samples/slider*.xul) \
	$(wildcard $(srcdir)/samples/scrollbar*.xul) \
	$(srcdir)/resources/find.html \
	$(srcdir)/resources/printsetup.html \
	$(srcdir)/resources/image_props.html \
	$(srcdir)/samples/raptor.jpg \
	$(srcdir)/samples/Anieyes.gif \
	$(srcdir)/samples/gear1.gif \
	$(srcdir)/samples/rock_gra.gif \
	$(srcdir)/samples/bg.jpg \
	$(srcdir)/samples/checkboxTest.xul \
	$(srcdir)/samples/beeptest.html \
	$(NULL)

EXPORT_RESOURCE_THROBBER := \
	$(wildcard $(srcdir)/throbber/anim*.gif) \
	$(NULL)

TOOLKIT_CPPSRCS_beos := \
	nsBeOSMain.cpp

TOOLKIT_CPPSRCS_gtk := \
	nsGTKMain.cpp \
	nsGTKMenu.cpp

TOOLKIT_CPPSRCS_motif := \
	nsMotifMenu.cpp \
	nsMotifMain.cpp

TOOLKIT_CPPSRCS_photon := \
	nsPhMain.cpp \
	nsPhMenu.cpp

TOOLKIT_CPPSRCS_xlib := \
	nsXlibMain.cpp


ifeq ($(MOZ_WIDGET_TOOLKIT),beos)
BEOS_PROGRAM_RESOURCE = $(srcdir)/viewer-beos.rsrc
endif

TOOLKIT_CPPSRCS := $(TOOLKIT_CPPSRCS_$(MOZ_WIDGET_TOOLKIT))


CPPSRCS =			   \
	$(TOOLKIT_CPPSRCS)	   \
	nsBaseDialog.cpp	   \
	nsFindDialog.cpp	   \
	nsXPBaseWindow.cpp	   \
	nsTableInspectorDialog.cpp \
	nsImageInspectorDialog.cpp \
	nsPrintSetupDialog.cpp	   \
	nsBrowserWindow.cpp	   \
	nsEditorMode.cpp	   \
	nsSetupRegistry.cpp	   \
	nsViewerApp.cpp		   \
	nsWebCrawler.cpp	   \
	$(NULL)

ifdef MOZ_OJI
	JSJ_LIB = -ljsj
endif

BASE_LIBS =	     \
	-lpref	     \
	$(ZLIB_LIBS) \
	-lreg	     \
	-l$(MOZ_LIB_JS_PREFIX)js	     \
	-lxpcom	     \
	-lsecfree    \
	-l$(MOZ_LIB_UTIL_PREFIX)util    \
	$(NULL)

GECKO_LIBS =			\
	-lraptorwebwidget	\
	$(MOZ_WIDGET_TOOLKIT_LDFLAGS) \
	-lraptorgfx		\
	$(MOZ_GFX_TOOLKIT_LDFLAGS) \
	$(TIMER_LIBS) \
	-lraptorhtmlpars	\
	-lexpat			\
	-lxmltok		\
	-ljsdom			\
	$(NULL)

IMGLIB_LIBS =	     \
	-limg	     \
	$(NULL)

ifndef NECKO
NETLIB_LIBS =	      \
	-labouturl    \
	-lfileurl     \
	-lftpurl      \
	-lgophurl     \
	-lhttpurl     \
	-lremoturl    \
	-lsockstuburl \
	-lmimetype    \
	-lnetcache    \
	-lnetcnvts    \
	-lnetlib      \
	-lnetwork     \
	-lxp	      \
	-ljsurl	      \
	-l$(MOZ_LIB_DBM_PREFIX)dbm      \
	-lpwcac	      \
	$(NULL)
else
NETLIB_LIBS =	      \
	-lneckoutil_s \
	-lxp	      \
	-ljsurl	      \
	-l$(MOZ_LIB_DBM_PREFIX)dbm      \
	$(NULL)
endif

LIBS =		       \
	$(GECKO_LIBS)  \
	$(NETLIB_LIBS) \
	$(IMGLIB_LIBS) \
	$(BASE_LIBS)   \
	$(JSJ_LIB)     \
	$(NSPR_LIBS)   \
	$(TK_LIBS)     \
	$(NULL)

include $(topsrcdir)/config/config.mk

CXXFLAGS += $(MOZ_TOOLKIT_REGISTRY_CFLAGS)

include $(topsrcdir)/config/rules.mk

RUN_VIEWER_SCRIPT= $(srcdir)/mozilla-viewer.sh

install:: $(PROGRAM) $(RUN_VIEWER_SCRIPT)
	$(INSTALL) $(EXPORT_RESOURCE_SAMPLES) $(DIST)/bin/res/samples
	$(INSTALL) $(EXPORT_RESOURCE_THROBBER) $(DIST)/bin/res/throbber
	$(INSTALL) $(srcdir)/resources/viewer.properties $(DIST)/bin/res
	$(INSTALL) $(RUN_VIEWER_SCRIPT) $(DIST)/bin
