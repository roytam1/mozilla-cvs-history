#!/tools/ns/bin/perl5.004 --
# DO NOT EDIT THIS FILE!  You must instead go to http://cvs-mirror.mozilla.org/webtools/despot, and
# tweak things from there.

$mode{'95'} = 'Open';
$branch{'95'} = 'HEAD';
$fullname{'95'} = '2-D Graphics';
$mode{'52'} = 'Open';
$branch{'52'} = 'HEAD';
$fullname{'52'} = 'Aurora/RDF BE';
$mode{'94'} = 'Open';
$branch{'94'} = 'HEAD';
$fullname{'94'} = 'Base XPCOM Classes';
$mode{'53'} = 'Open';
$branch{'53'} = 'HEAD';
$fullname{'53'} = 'Berkeley DB';
$mode{'54'} = 'Open';
$branch{'54'} = 'HEAD';
$fullname{'54'} = 'Browser Hooks';
$mode{'55'} = 'Open';
$branch{'55'} = 'HEAD';
$fullname{'55'} = 'Build Config';
$mode{'96'} = 'Open';
$branch{'96'} = 'HEAD';
$fullname{'96'} = 'Clipping and Compositing';
$mode{'15'} = 'Restricted';
$branch{'15'} = 'ColorSync_19980824_BRANCH';
$fullname{'15'} = 'ColorSync Branch';
$blessed{'15'} = [];
$super{'15'} = ['ebb3%apple.com','pinkerton%netscape.com','pnunn%netscape.com','saari%netscape.com',];
$mode{'56'} = 'Open';
$branch{'56'} = 'HEAD';
$fullname{'56'} = 'Composer';
$mode{'4'} = 'Open';
$branch{'4'} = 'HEAD';
$fullname{'4'} = 'default';
$defaultid = '4';
$mode{'3'} = 'Closed';
$branch{'3'} = 'HEAD';
$fullname{'3'} = 'despotaccess';
$blessed{'3'} = [];
$super{'3'} = ['despotdaemon%netscape.com',];
$mode{'58'} = 'Open';
$branch{'58'} = 'HEAD';
$fullname{'58'} = 'Dialup';
$mode{'59'} = 'Open';
$branch{'59'} = 'HEAD';
$fullname{'59'} = 'Directory SDK';
$mode{'103'} = 'Open';
$branch{'103'} = 'HEAD';
$fullname{'103'} = 'Document Object Model';
$mode{'46'} = 'Open';
$branch{'46'} = 'HEAD';
$fullname{'46'} = 'ef';
$mode{'101'} = 'Open';
$branch{'101'} = 'HEAD';
$fullname{'101'} = 'Embeddable Web Browser';
$mode{'49'} = 'Open';
$branch{'49'} = 'HEAD';
$fullname{'49'} = 'GTK';
$mode{'62'} = 'Open';
$branch{'62'} = 'HEAD';
$fullname{'62'} = 'HTML to Text/PostScript Translation';
$mode{'67'} = 'Open';
$branch{'67'} = 'HEAD';
$fullname{'67'} = 'I18N Library';
$mode{'66'} = 'Open';
$branch{'66'} = 'HEAD';
$fullname{'66'} = 'Image Conversion Library';
$mode{'63'} = 'Open';
$branch{'63'} = 'HEAD';
$fullname{'63'} = 'ImageLib';
$mode{'69'} = 'Open';
$branch{'69'} = 'HEAD';
$fullname{'69'} = 'Java and JS Capability-Based Security';
$mode{'68'} = 'Open';
$branch{'68'} = 'HEAD';
$fullname{'68'} = 'Java Stubs';
$mode{'70'} = 'Open';
$branch{'70'} = 'HEAD';
$fullname{'70'} = 'JavaScript';
$mode{'71'} = 'Open';
$branch{'71'} = 'HEAD';
$fullname{'71'} = 'JavaScript Debugger';
$mode{'72'} = 'Open';
$branch{'72'} = 'HEAD';
$fullname{'72'} = 'JavaScript/Java Reflection';
$mode{'12'} = 'Open';
$branch{'12'} = 'HEAD';
$fullname{'12'} = 'jpeg';
$mode{'64'} = 'Open';
$branch{'64'} = 'HEAD';
$fullname{'64'} = 'JPEG Image Handling';
$mode{'73'} = 'Open';
$branch{'73'} = 'HEAD';
$fullname{'73'} = 'Layout';
$mode{'74'} = 'Open';
$branch{'74'} = 'HEAD';
$fullname{'74'} = 'LibMocha';
$mode{'47'} = 'Open';
$branch{'47'} = 'HEAD';
$fullname{'47'} = 'Macintosh FE';
$mode{'75'} = 'Open';
$branch{'75'} = 'HEAD';
$fullname{'75'} = 'MailTo: Composing';
$mode{'76'} = 'Open';
$branch{'76'} = 'HEAD';
$fullname{'76'} = 'MIMELib';
$mode{'19'} = 'Open';
$branch{'19'} = 'HEAD';
$fullname{'19'} = 'mozilla-toplevel';
$mode{'77'} = 'Open';
$branch{'77'} = 'HEAD';
$fullname{'77'} = 'NetLib';
$mode{'99'} = 'Open';
$branch{'99'} = 'HEAD';
$fullname{'99'} = 'New HTML Layout Engine';
$mode{'102'} = 'Open';
$branch{'102'} = 'HEAD';
$fullname{'102'} = 'New HTML Parser';
$mode{'100'} = 'Open';
$branch{'100'} = 'HEAD';
$fullname{'100'} = 'New HTML Style System';
$mode{'98'} = 'Open';
$branch{'98'} = 'HEAD';
$fullname{'98'} = 'New Layout Engine';
$mode{'78'} = 'Open';
$branch{'78'} = 'HEAD';
$fullname{'78'} = 'NSPR';
$mode{'24'} = 'Restricted';
$branch{'24'} = 'HEAD';
$fullname{'24'} = 'nsprpub';
$blessed{'24'} = ['gordon%netscape.com',];
$super{'24'} = ['wtc%netscape.com','larryh%netscape.com','srinivas%netscape.com',];
$mode{'79'} = 'Open';
$branch{'79'} = 'HEAD';
$fullname{'79'} = 'Password Cache';
$mode{'80'} = 'Open';
$branch{'80'} = 'HEAD';
$fullname{'80'} = 'PICS';
$mode{'81'} = 'Open';
$branch{'81'} = 'HEAD';
$fullname{'81'} = 'Plugins';
$mode{'65'} = 'Open';
$branch{'65'} = 'HEAD';
$fullname{'65'} = 'PNG Image Handling';
$mode{'82'} = 'Open';
$branch{'82'} = 'HEAD';
$fullname{'82'} = 'Preferences';
$mode{'83'} = 'Open';
$branch{'83'} = 'HEAD';
$fullname{'83'} = 'Progress Window';
$mode{'84'} = 'Open';
$branch{'84'} = 'HEAD';
$fullname{'84'} = 'Registry';
$mode{'85'} = 'Open';
$branch{'85'} = 'HEAD';
$fullname{'85'} = 'Scheduler';
$mode{'86'} = 'Open';
$branch{'86'} = 'HEAD';
$fullname{'86'} = 'Security Stubs';
$mode{'87'} = 'Open';
$branch{'87'} = 'HEAD';
$fullname{'87'} = 'SmartUpdate';
$mode{'50'} = 'Open';
$branch{'50'} = 'HEAD';
$fullname{'50'} = 'StubFE';
$mode{'48'} = 'Open';
$branch{'48'} = 'HEAD';
$fullname{'48'} = 'Windows FE';
$mode{'88'} = 'Open';
$branch{'88'} = 'HEAD';
$fullname{'88'} = 'XML';
$mode{'90'} = 'Open';
$branch{'90'} = 'HEAD';
$fullname{'90'} = 'XP File Handling';
$mode{'91'} = 'Open';
$branch{'91'} = 'HEAD';
$fullname{'91'} = 'XP Miscellany';
$mode{'92'} = 'Open';
$branch{'92'} = 'HEAD';
$fullname{'92'} = 'XP Utilities';
$mode{'97'} = 'Open';
$branch{'97'} = 'HEAD';
$fullname{'97'} = 'XP Widgets';
$mode{'89'} = 'Open';
$branch{'89'} = 'HEAD';
$fullname{'89'} = 'XPCOM';
$mode{'93'} = 'Open';
$branch{'93'} = 'HEAD';
$fullname{'93'} = 'Zlib';
sub GetT {
($b,$_) = (@_);
if ($b eq 'ColorSync_19980824_BRANCH') {
}
if ($b eq 'HEAD') {
if (m:^CVSROOT/commitcheck\.pl$:) {return '3';}
if (m:^CVSROOT/passwd$:) {return '3';}
if (m:^jpeg/.*$:) {return '12';}
if (m:^mozilla/[^/]*$:) {return '19';}
if (m:^mozilla/cmd/macfe/.*$:) {return '47';}
if (m:^mozilla/nsprpub/.*$:) {return '24';}
if (m:^mozilla/ef/.*$:) {return '46';}
if (m:^mozilla/cmd/wincom/.*$:) {return '48';}
if (m:^mozilla/cmd/winfe/.*$:) {return '48';}
if (m:^mozilla/gfx/src/gtk/.*$:) {return '49';}
if (m:^mozilla/widget/src/gtk/.*$:) {return '49';}
if (m:^mozilla/cmd/stubfe/.*$:) {return '50';}
if (m:^mozilla/include/fe_proto\.h/.*$:) {return '50';}
if (m:^mozilla/include/structs\.h/.*$:) {return '50';}
if (m:^mozilla/modules/rdf/.*$:) {return '52';}
if (m:^mozilla/dbm/.*$:) {return '53';}
if (m:^mozilla/modules/libhook/.*$:) {return '54';}
if (m:^mozilla/build/.*$:) {return '55';}
if (m:^mozilla/config/.*$:) {return '55';}
if (m:^mozilla/l10n/.*$:) {return '55';}
if (m:^mozilla/include/edt\.h/.*$:) {return '56';}
if (m:^mozilla/include/edttypes\.h/.*$:) {return '56';}
if (m:^mozilla/lib/layout/.*$:) {return '56';}
if (m:^mozilla/modules/edtplug/.*$:) {return '56';}
if (m:^mozilla/cmd/dialup/.*$:) {return '58';}
if (m:^mozilla/directory/.*$:) {return '59';}
if (m:^mozilla/include/xlate\.h/.*$:) {return '62';}
if (m:^mozilla/lib/xlate/.*$:) {return '62';}
if (m:^mozilla/modules/libimg/.*$:) {return '63';}
if (m:^mozilla/modules/libutil/.*$:) {return '63';}
if (m:^mozilla/lib/libcnv/.*$:) {return '65';}
if (m:^mozilla/include/libcnv\.h/.*$:) {return '66';}
if (m:^mozilla/include/csid\.h/.*$:) {return '67';}
if (m:^mozilla/include/intl_csi\.h/.*$:) {return '67';}
if (m:^mozilla/include/libi18n\.h/.*$:) {return '67';}
if (m:^mozilla/include/resdef\.h/.*$:) {return '67';}
if (m:^mozilla/include/xpgetstr\.h/.*$:) {return '67';}
if (m:^mozilla/include/xplocale\.h/.*$:) {return '67';}
if (m:^mozilla/include/xpresdef\.h/.*$:) {return '67';}
if (m:^mozilla/include/xupfonts\.h/.*$:) {return '67';}
if (m:^mozilla/lib/libi18n/.*$:) {return '67';}
if (m:^mozilla/modules/oji/.*$:) {return '68';}
if (m:^mozilla/nav-java/.*$:) {return '68';}
if (m:^mozilla/sun-java/.*$:) {return '68';}
if (m:^mozilla/caps/.*$:) {return '69';}
if (m:^mozilla/js/ref/.*$:) {return '70';}
if (m:^mozilla/js/src/.*$:) {return '70';}
if (m:^mozilla/js/jsd/.*$:) {return '71';}
if (m:^mozilla/js/jsj/.*$:) {return '72';}
if (m:^mozilla/include/lo_ele\.h/.*$:) {return '73';}
if (m:^mozilla/lib/libparse/.*$:) {return '73';}
if (m:^mozilla/lib/libstyle/.*$:) {return '73';}
if (m:^mozilla/include/libevent\.h/.*$:) {return '74';}
if (m:^mozilla/include/libmocha\.h/.*$:) {return '74';}
if (m:^mozilla/lib/libmocha/.*$:) {return '74';}
if (m:^mozilla/lib/mailto/.*$:) {return '75';}
if (m:^mozilla/lib/libmime/.*$:) {return '76';}
if (m:^mozilla/network/.*$:) {return '77';}
if (m:^mozilla/lib/libpwcac/.*$:) {return '79';}
if (m:^mozilla/lib/libpics/.*$:) {return '80';}
if (m:^mozilla/modules/plugin/.*$:) {return '81';}
if (m:^mozilla/modules/libpref/.*$:) {return '82';}
if (m:^mozilla/modules/progress/.*$:) {return '83';}
if (m:^mozilla/modules/libreg/.*$:) {return '84';}
if (m:^mozilla/modules/schedulr/.*$:) {return '85';}
if (m:^mozilla/modules/security/.*$:) {return '86';}
if (m:^mozilla/modules/softupdt/.*$:) {return '87';}
if (m:^mozilla/modules/xml/.*$:) {return '88';}
if (m:^mozilla/xpcom/.*$:) {return '89';}
if (m:^mozilla/include/xp_file\.h/.*$:) {return '90';}
if (m:^mozilla/lib/xp/xp_file\.c/.*$:) {return '90';}
if (m:^mozilla/include/shist\.h/.*$:) {return '91';}
if (m:^mozilla/lib/libmisc/.*$:) {return '91';}
if (m:^mozilla/include/xp\.h/.*$:) {return '92';}
if (m:^mozilla/lib/mariner/.*$:) {return '92';}
if (m:^mozilla/modules/zlib/.*$:) {return '93';}
if (m:^mozilla/base/.*$:) {return '94';}
if (m:^mozilla/view/.*$:) {return '96';}
if (m:^mozilla/layout/.*$:) {return '98';}
if (m:^mozilla/webshell/.*$:) {return '101';}
if (m:^mozilla/htmlparser/.*$:) {return '102';}
if (m:^mozilla/dom/.*$:) {return '103';}
}
return '';
}





$debug = 0;

$origrepository = shift(@ARGV);
@files = @ARGV;


$envcvsroot = $ENV{'CVSROOT'};
open( REP, "<CVS/Repository");
$repository = <REP>;
chop($repository);
close(REP);
$repository =~ s:^$envcvsroot/::;


$doit = 0;

$| = 1;


if( $debug){
    print STDERR "----------------------------------------------\n";
    print STDERR "files: @files\n";
    print STDERR "origrepository: $origrepository\n";
    print STDERR "    repository: $repository\n";
    print STDERR "----------------------------------------------\n";
}

open(ENT, "<CVS/Entries" );
while( <ENT> ){
    chop;
    ($d,$fn,$rev,$mod_time,$sticky,$tag) = split(/\//);
    if ($tag =~ /^T(.*)$/) {
	$fbranch{$fn} = $1;
    }
}
close ENT;

foreach $f (@files) {
    $b = "";
    if (defined $fbranch{$f}) {$b = $fbranch{$f};}
    if ($b eq "") {$b = "HEAD";}
    $t = GetT($b, "$repository/$f");
    if ($debug) {
        print STDERR "GetT returned '$t' for '$repository/$f' branch '$b'\n";
    }
    if ($t eq "") {
        $t = $defaultid;
    }
    if (!defined $mode{$t} || $mode{$t} eq "Open") {
        next;
    }
    if ($debug) {
        print STDERR "Checking twig $t\n";
    }
    # OK, we have a match.  See if we're allowed to checkin here.
    if ($username eq "") {
        $username = $ENV{"CVS_USER"} || getlogin || (getpwuid($<))[0] || "nobody";
        if ($debug) {
            print STDERR "Username is $username\n";
            print STDERR "getlogin returns " . getlogin . "\n";
            print STDERR '(getpwuid($<))[0] returns ' . (getpwuid($<))[0] . "\n";
            print STDERR "Environment:\n";
            foreach $key (sort(keys %ENV)) {
                print STDERR $key, '=', $ENV{$key}, "\n";
            }
        }
    }
    $ok = 0;
    $s = $super{$t};
    foreach $u (@$s) {
        if ($debug) {
            print STDERR "Checking against super $u\n";
        }
        if ($u eq $username) {
            $ok = 1;
            break;
        }
    }
    if ($mode{$t} eq "Restricted") {
        $b = $blessed{$t};
        foreach $u (@$b) {
            if ($debug) {
                print STDERR "Checking against blessed $u\n";
            }
            if ($u eq $username) {
                $ok = 1;
                break;
            }
        }
    }
    if (!$ok) {
        print STDERR "You may not check into partition $fullname{$t}\n";
	print STDERR "the file $repository/$f on branch $b\n";
        print STDERR "If you think you should be allowed to, send mail to\n";
        print STDERR "one of the below people:\n";
        $s = $super{$t};
        foreach $u (@$s) {
            $u =~ s/%/@/;
            print STDERR "  $u\n";
        }
        exit 1;
    }
}

exit 0;
